<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redis Interview Mastery - Complete Guide</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #DC143C;
            --secondary-color: #FF6347;
            --accent-color: #FF4500;
            --bg-dark: #0a0a0a;
            --bg-card: rgba(20, 20, 20, 0.7);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: rgba(220, 20, 60, 0.3);
            --success-color: #00ff88;
            --warning-color: #ffa500;
            --code-bg: rgba(30, 30, 30, 0.9);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0a 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(220, 20, 60, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 69, 0, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            display: flex;
            max-width: 1800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 320px;
            min-width: 320px;
            flex-shrink: 0;
            height: 100vh;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 20px;
        }

        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        .logo {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .logo h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .logo p {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Search Box */
        .search-box {
            margin-bottom: 20px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: rgba(255, 255, 255, 0.08);
        }

        .search-box::after {
            content: 'üîç';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: rgba(220, 20, 60, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .progress-tracker h3 {
            font-size: 14px;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Section Groups */
        .section-group {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-color);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: rgba(220, 20, 60, 0.1);
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
        }

        .question-item {
            padding: 10px 15px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-size: 13px;
        }

        .question-item:hover {
            background: rgba(220, 20, 60, 0.1);
            border-left-color: var(--primary-color);
            transform: translateX(5px);
        }

        .question-item.active {
            background: rgba(220, 20, 60, 0.2);
            border-left-color: var(--primary-color);
            font-weight: 600;
        }

        .question-number {
            color: var(--primary-color);
            font-weight: 600;
            margin-right: 8px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 40px 60px;
            max-width: 1200px;
        }

        .question-header {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .question-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .meta-badge {
            padding: 6px 12px;
            background: rgba(220, 20, 60, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .question-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .question-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
        }

        /* Content Sections */
        .content-section {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .content-section:hover {
            border-color: var(--primary-color);
            box-shadow: 0 8px 32px rgba(220, 20, 60, 0.1);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .section-icon {
            font-size: 24px;
        }

        .section-label {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .content-section p {
            margin-bottom: 15px;
            font-size: 16px;
            line-height: 1.8;
        }

        .content-section ul, .content-section ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }

        .content-section li {
            margin-bottom: 10px;
            line-height: 1.8;
        }

        /* Code Blocks */
        .code-block {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            font-family: 'Fira Code', monospace;
            overflow-x: auto;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .code-lang {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .copy-btn {
            padding: 6px 12px;
            background: rgba(220, 20, 60, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .code-content {
            font-size: 14px;
            line-height: 1.6;
            color: #e8e8e8;
        }

        .code-content .keyword { color: #ff79c6; }
        .code-content .string { color: #50fa7b; }
        .code-content .comment { color: #6272a4; }
        .code-content .number { color: #bd93f9; }
        .code-content .function { color: #8be9fd; }

        /* SVG Diagrams */
        .diagram-container {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .diagram-title {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        /* Navigation Buttons */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px solid var(--border-color);
        }

        .nav-btn {
            flex: 1;
            padding: 15px 30px;
            background: rgba(220, 20, 60, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .nav-btn:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(220, 20, 60, 0.3);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* MCQ Quiz Styles */
        .quiz-container {
            background: rgba(220, 20, 60, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .quiz-question {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 12px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background: rgba(220, 20, 60, 0.1);
            border-color: var(--primary-color);
        }

        .quiz-option.correct {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--success-color);
        }

        .quiz-option.incorrect {
            background: rgba(255, 0, 0, 0.1);
            border-color: #ff0000;
        }

        /* Key Takeaways */
        .takeaway-item {
            display: flex;
            align-items: start;
            gap: 12px;
            padding: 12px;
            background: rgba(220, 20, 60, 0.05);
            border-left: 3px solid var(--primary-color);
            border-radius: 6px;
            margin-bottom: 12px;
        }

        .takeaway-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        /* Keywords */
        .keyword-tag {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(220, 20, 60, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            margin: 5px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .keyword-tag:hover {
            background: rgba(220, 20, 60, 0.2);
            border-color: var(--primary-color);
            color: var(--text-primary);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 280px;
            }
            
            .main-content {
                padding: 30px 40px;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .question-title {
                font-size: 24px;
            }
        }

        /* Loading Animation */
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: var(--text-secondary);
        }

        /* Highlight for search */
        .highlight {
            background-color: rgba(255, 255, 0, 0.3);
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="logo">
                <h1>‚ö° Redis Mastery</h1>
                <p>Interview Preparation</p>
            </div>

            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search questions...">
            </div>

            <div class="progress-tracker">
                <h3>Progress Tracker</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0 / 181 Questions</div>
            </div>

            <nav id="sidebarNav">
                <!-- Navigation will be populated by JavaScript -->
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <div id="questionContent">
                <div class="loading">Loading content...</div>
            </div>

            <div class="navigation-buttons">
                <button class="nav-btn" id="prevBtn" onclick="navigateQuestion('prev')">
                    ‚Üê Previous Question
                </button>
                <button class="nav-btn" id="nextBtn" onclick="navigateQuestion('next')">
                    Next Question ‚Üí
                </button>
            </div>
        </main>
    </div>

    <script>
        // Question Data Structure
        const sections = [
            {
                id: 'basics',
                title: 'üü¢ Section 1: Redis Basics',
                questions: [
                    { id: 1, title: 'What is Redis?', time: '1 minute' },
                    { id: 2, title: 'Is Redis a database or a cache?', time: '1 minute' },
                    { id: 3, title: 'What does Redis stand for?', time: '30 seconds' },
                    { id: 4, title: 'Is Redis in-memory or disk-based?', time: '1 minute' },
                    { id: 5, title: 'Why is Redis so fast?', time: '1 minute' },
                    { id: 6, title: 'What type of data does Redis store?', time: '1 minute' },
                    { id: 7, title: 'Is Redis open source?', time: '30 seconds' },
                    { id: 8, title: 'What is a key-value store?', time: '1 minute' },
                    { id: 9, title: 'Where is Redis mostly used?', time: '1 minute' },
                    { id: 10, title: 'Can Redis be used as a primary database?', time: '1-2 minutes' }
                ]
            },
            {
                id: 'concepts',
                title: 'üü¢ Section 2: Basic Redis Concepts',
                questions: [
                    { id: 11, title: 'What are the main data types supported by Redis?', time: '1 minute' },
                    { id: 12, title: 'Explain the difference between String and Hash in Redis', time: '1-2 minutes' },
                    { id: 13, title: 'What is TTL in Redis?', time: '1 minute' },
                    { id: 14, title: 'What does the EXPIRE command do?', time: '1 minute' },
                    { id: 15, title: 'Explain SET, SETNX, and GET commands', time: '2 minutes' },
                    { id: 16, title: 'What are INCR and DECR commands?', time: '1 minute' },
                    { id: 17, title: 'What happens if a key already exists and SET is executed?', time: '1 minute' },
                    { id: 18, title: 'What is persistence in Redis?', time: '1 minute' },
                    { id: 19, title: 'On which port does Redis run by default?', time: '30 seconds' },
                    { id: 20, title: 'What happens when Redis restarts?', time: '1-2 minutes' }
                ]
            },
            {
                id: 'datastructures',
                title: 'üü° Section 3: Redis Data Structures',
                questions: [
                    { id: 21, title: 'What is the maximum size of a Redis string?', time: '1 minute' },
                    { id: 22, title: 'Real-world use cases of Redis strings', time: '1 minute' },
                    { id: 23, title: 'Difference between SET and APPEND', time: '1 minute' },
                    { id: 24, title: 'What is a Redis List?', time: '1 minute' },
                    { id: 25, title: 'Difference between LPUSH and RPUSH', time: '1 minute' },
                    { id: 26, title: 'Where are Redis Lists used in real systems?', time: '1-2 minutes' },
                    { id: 27, title: 'What are blocking list commands?', time: '1 minute' },
                    { id: 28, title: 'Difference between Set and List', time: '1 minute' },
                    { id: 29, title: 'What does SADD do?', time: '30 seconds' },
                    { id: 30, title: 'Real-world use case of Redis Set', time: '1 minute' },
                    { id: 31, title: 'What is a Sorted Set?', time: '1 minute' },
                    { id: 32, title: 'Difference between Set and Sorted Set', time: '1 minute' },
                    { id: 33, title: 'What is a score in Sorted Set?', time: '1 minute' },
                    { id: 34, title: 'Real-world example of Sorted Set usage', time: '1-2 minutes' },
                    { id: 35, title: 'Why is Hash better than storing JSON as a string?', time: '1-2 minutes' },
                    { id: 36, title: 'Practical use case of Redis Hash', time: '1 minute' }
                ]
            },
            {
                id: 'intermediate',
                title: 'üü° Section 4: Intermediate Redis',
                questions: [
                    { id: 37, title: 'Explain Redis persistence mechanisms', time: '1-2 minutes' },
                    { id: 38, title: 'Compare RDB and AOF', time: '2 minutes' },
                    { id: 39, title: 'Can Redis lose data? In which situations?', time: '1-2 minutes' },
                    { id: 40, title: 'What is an eviction policy?', time: '1 minute' },
                    { id: 41, title: 'Explain LRU, LFU, FIFO eviction policies', time: '2 minutes' },
                    { id: 42, title: 'What is the maxmemory setting?', time: '1 minute' },
                    { id: 43, title: 'What happens when Redis reaches memory limit?', time: '1-2 minutes' },
                    { id: 44, title: 'What is Redis pipelining?', time: '1-2 minutes' },
                    { id: 45, title: 'Pipeline vs Transaction', time: '1-2 minutes' },
                    { id: 46, title: 'Explain MULTI / EXEC flow', time: '2 minutes' }
                ]
            },
            {
                id: 'tricky',
                title: 'üü† Section 5: Tricky Redis Questions',
                questions: [
                    { id: 47, title: 'Redis is single-threaded. Why doesn\'t it become slow?', time: '1-2 minutes' },
                    { id: 48, title: 'What happens internally when Redis memory is full?', time: '1-2 minutes' },
                    { id: 49, title: 'Does Redis support rollback? Why?', time: '1 minute' },
                    { id: 50, title: 'Can Redis fully replace Kafka?', time: '2 minutes' },
                    { id: 51, title: 'Is Redis as durable as MySQL?', time: '1-2 minutes' }
                ]
            },
            {
                id: 'transactions',
                title: 'üîµ Section 6: Redis Transactions & Atomicity',
                questions: [
                    { id: 52, title: 'Are Redis operations atomic?', time: '1 minute' },
                    { id: 53, title: 'What is MULTI in Redis?', time: '1 minute' },
                    { id: 54, title: 'What is WATCH?', time: '1-2 minutes' },
                    { id: 55, title: 'How does Redis handle optimistic locking?', time: '1-2 minutes' },
                    { id: 56, title: 'Can Redis transactions be rolled back?', time: '1 minute' },
                    { id: 57, title: 'What happens if one command fails inside MULTI?', time: '1 minute' },
                    { id: 58, title: 'How do you ensure consistency in Redis?', time: '2 minutes' }
                ]
            },
            {
                id: 'pubsub',
                title: 'üîµ Section 7: Redis Pub/Sub & Streams',
                questions: [
                    { id: 59, title: 'Explain Redis Pub/Sub architecture', time: '1-2 minutes' },
                    { id: 60, title: 'Difference between Publisher and Subscriber', time: '1 minute' },
                    { id: 61, title: 'Is Redis Pub/Sub data persistent?', time: '30-60 seconds' },
                    { id: 62, title: 'When should Redis Pub/Sub NOT be used?', time: '1-2 minutes' },
                    { id: 63, title: 'What happens if a subscriber is down?', time: '1-2 minutes' },
                    { id: 64, title: 'What are Redis Streams?', time: '1-2 minutes' },
                    { id: 65, title: 'Difference between Redis Streams and Pub/Sub', time: '2 minutes' },
                    { id: 66, title: 'What is a Consumer Group in Redis Streams?', time: '1-2 minutes' },
                    { id: 67, title: 'How does Redis ensure message delivery in Streams?', time: '1-2 minutes' },
                    { id: 68, title: 'How to reprocess failed messages in Redis Streams?', time: '1-2 minutes' }
                ]
            },
            {
                id: 'advanced',
                title: 'üî¥ Section 8: Advanced Redis',
                questions: [
                    { id: 69, title: 'Explain Redis replication', time: '2 minutes' },
                    { id: 70, title: 'Explain Redis Sentinel', time: '2 minutes' },
                    { id: 71, title: 'Explain Redis Cluster', time: '2-3 minutes' },
                    { id: 72, title: 'Replication vs Cluster', time: '2 minutes' },
                    { id: 73, title: 'What happens when a Redis master fails?', time: '2-3 minutes' }
                ]
            },
            {
                id: 'realworld',
                title: 'üî¥ Section 9: Real-World Scenarios',
                questions: [
                    { id: 74, title: 'Redis is down in production. What is your action plan?', time: '2 minutes' },
                    { id: 75, title: 'Design cache-aside pattern using Redis', time: '2 minutes' },
                    { id: 76, title: 'How do you prevent cache stampede?', time: '2 minutes' },
                    { id: 77, title: 'How do you secure Redis in production?', time: '1-2 minutes' },
                    { id: 78, title: 'How do you handle hot keys?', time: '2 minutes' },
                    { id: 79, title: 'Redis memory usage keeps increasing. How do you debug?', time: '2 minutes' },
                    { id: 80, title: 'How do you monitor Redis?', time: '1-2 minutes' },
                    { id: 81, title: 'Redis vs Memcached ‚Äî how do you decide?', time: '1-2 minutes' },
                    { id: 82, title: 'How do you maintain DB-Redis consistency?', time: '2 minutes' },
                    { id: 83, title: 'How do you handle large keys in Redis?', time: '1-2 minutes' }
                ]
            },
            {
                id: 'commands',
                title: 'üü£ Section 10: Command-Based (Hands-On)',
                questions: [
                    { id: 84, title: 'Set a key with TTL', time: '1 minute' },
                    { id: 85, title: 'Implement an atomic counter', time: '1 minute' },
                    { id: 86, title: 'Leaderboard using Sorted Set', time: '1-2 minutes' },
                    { id: 87, title: 'Implement rate limiting', time: '1-2 minutes' },
                    { id: 88, title: 'Redis queue implementation', time: '1-2 minutes' },
                    { id: 89, title: 'Memory inspection', time: '1 minute' },
                    { id: 90, title: 'Safe flushing strategy', time: '1 minute' }
                ]
            }
        ];

        let currentQuestionId = 1;
        let completedQuestions = new Set();

        // Initialize the application
        function init() {
            renderSidebar();
            loadQuestion(currentQuestionId);
            updateProgress();
            loadCompletedQuestions();
            setupKeyboardShortcuts();
        }

        // Render sidebar navigation
        function renderSidebar() {
            const nav = document.getElementById('sidebarNav');
            nav.innerHTML = '';

            sections.forEach(section => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section-group';

                const sectionTitle = document.createElement('div');
                sectionTitle.className = 'section-title';
                sectionTitle.textContent = section.title;
                sectionDiv.appendChild(sectionTitle);

                section.questions.forEach(question => {
                    const questionItem = document.createElement('div');
                    questionItem.className = 'question-item';
                    if (question.id === currentQuestionId) {
                        questionItem.classList.add('active');
                    }
                    if (completedQuestions.has(question.id)) {
                        questionItem.style.opacity = '0.6';
                    }

                    questionItem.innerHTML = `
                        <span class="question-number">Q${question.id}</span>
                        ${question.title}
                    `;

                    questionItem.onclick = () => loadQuestion(question.id);
                    sectionDiv.appendChild(questionItem);
                });

                nav.appendChild(sectionDiv);
            });
        }

        // Load question content
        function loadQuestion(questionId) {
            currentQuestionId = questionId;
            
            // Find question details
            let questionData = null;
            let sectionData = null;

            for (let section of sections) {
                const found = section.questions.find(q => q.id === questionId);
                if (found) {
                    questionData = found;
                    sectionData = section;
                    break;
                }
            }

            if (!questionData) {
                console.error('Question not found:', questionId);
                return;
            }

            // Get question content
            const content = getQuestionContent(questionId);
            document.getElementById('questionContent').innerHTML = content;

            // Update sidebar active state
            document.querySelectorAll('.question-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.question-item')[questionId - 1]?.classList.add('active');

            // Update navigation buttons
            updateNavigationButtons();

            // Scroll to top
            window.scrollTo(0, 0);

            // Add to completed questions
            markQuestionAsCompleted(questionId);
        }

        // Get question content (will be populated for each question)
        function getQuestionContent(questionId) {
            // This function will return the HTML content for each question
            // For now, returning a placeholder
            const questionDetails = findQuestionById(questionId);
            
            return `
                <div class="question-header">
                    <div class="question-meta">
                        <span class="meta-badge">Question ${questionId}</span>
                        <span class="meta-badge">‚è± ${questionDetails.time}</span>
                        <span class="meta-badge">Section: ${getSectionName(questionId)}</span>
                    </div>
                    <h1 class="question-title">${questionDetails.title}</h1>
                    <p class="question-subtitle">Complete interview-ready answer with examples, diagrams, and practice questions</p>
                </div>

                ${getDetailedContent(questionId)}
            `;
        }

        // Get detailed content for each question
        function getDetailedContent(questionId) {
            switch(questionId) {
                case 1:
                    return getQuestion1Content();
                case 2:
                    return getQuestion2Content();
                case 3:
                    return getQuestion3Content();
                case 4:
                    return getQuestion4Content();
                case 5:
                    return getQuestion5Content();
                case 6:
                    return getQuestion6Content();
                case 7:
                    return getQuestion7Content();
                case 8:
                    return getQuestion8Content();
                case 9:
                    return getQuestion9Content();
                case 10:
                    return getQuestion10Content();
                case 11:
                    return getQuestion11Content();
                case 12:
                    return getQuestion12Content();
                case 13:
                    return getQuestion13Content();
                case 14:
                    return getQuestion14Content();
                case 15:
                    return getQuestion15Content();
                case 16:
                    return getQuestion16Content();
                case 17:
                    return getQuestion17Content();
                case 18:
                    return getQuestion18Content();
                case 19:
                    return getQuestion19Content();
                case 20:
                    return getQuestion20Content();
                case 21:
                    return getQuestion21Content();
                case 22:
                    return getQuestion22Content();
                case 23:
                    return getQuestion23Content();
                case 24:
                    return getQuestion24Content();
                case 25:
                    return getQuestion25Content();
                case 26:
                    return getQuestion26Content();
                case 27:
                    return getQuestion27Content();
                case 28:
                    return getQuestion28Content();
                case 29:
                    return getQuestion29Content();
                case 30:
                    return getQuestion30Content();
                case 31:
                    return getQuestion31Content();
                case 32:
                    return getQuestion32Content();
                case 33:
                    return getQuestion33Content();
                case 34:
                    return getQuestion34Content();
                case 35:
                    return getQuestion35Content();
                case 36:
                    return getQuestion36Content();
                case 37:
                    return getQuestion37Content();
                case 38:
                    return getQuestion38Content();
                case 39:
                    return getQuestion39Content();
                case 40:
                    return getQuestion40Content();
                case 41:
                    return getQuestion41Content();
                case 42:
                    return getQuestion42Content();
                case 43:
                    return getQuestion43Content();
                case 44:
                    return getQuestion44Content();
                case 45:
                    return getQuestion45Content();
                case 46:
                    return getQuestion46Content();
                case 47:
                    return getQuestion47Content();
                case 48:
                    return getQuestion48Content();
                case 49:
                    return getQuestion49Content();
                case 50:
                    return getQuestion50Content();
                case 51:
                    return getQuestion51Content();
                case 52:
                    return getQuestion52Content();
                case 53:
                    return getQuestion53Content();
                case 54:
                    return getQuestion54Content();
                case 55:
                    return getQuestion55Content();
                case 56:
                    return getQuestion56Content();
                case 57:
                    return getQuestion57Content();
                case 58:
                    return getQuestion58Content();
                case 59:
                    return getQuestion59Content();
                case 60:
                    return getQuestion60Content();
                case 61:
                    return getQuestion61Content();
                case 62:
                    return getQuestion62Content();
                case 63:
                    return getQuestion63Content();
                case 64:
                    return getQuestion64Content();
                // Add more cases as we create content
                case 65:
                    return getQuestion65Content();
                case 66:
                    return getQuestion66Content();  
                case 67:
                    return getQuestion67Content();
                case 68:
                    return getQuestion68Content();
                case 69:
                    return getQuestion69Content();
                case 70:
                    return getQuestion70Content();
                case 71:
                    return getQuestion71Content();
                case 72:
                    return getQuestion72Content();
                case 73:
                    return getQuestion73Content();
                case 74:
                    return getQuestion74Content();
                case 75:
                    return getQuestion75Content();
                case 76:
                    return getQuestion76Content();
                case 77:
                    return getQuestion77Content();
                case 78:
                    return getQuestion78Content();
                case 79:
                    return getQuestion79Content();
                case 80:
                    return getQuestion80Content();
                case 81:
                    return getQuestion81Content();
                case 82:
                    return getQuestion82Content();
                case 83:
                    return getQuestion83Content();
                case 84:
                    return getQuestion84Content();
                case 85:
                    return getQuestion85Content();
                case 86:
                    return getQuestion86Content();
                case 87:
                    return getQuestion87Content();
                case 88:
                    return getQuestion88Content();
                case 89:
                    return getQuestion89Content();
                case 90:
                    return getQuestion90Content();

                default:
                    return `
                        <div class="content-section">
                            <div class="section-header">
                                <span class="section-icon">üìù</span>
                                <h2 class="section-label">Content Coming Soon</h2>
                            </div>
                            <p>Detailed content for Question ${questionId} will be added here.</p>
                            <p>This will include all 10 sections:</p>
                            <ul>
                                <li>Real Scenario</li>
                                <li>Actual Definition</li>
                                <li>Visual Diagrams</li>
                                <li>Code Examples</li>
                                <li>Cross Questions</li>
                                <li>Tricky Questions</li>
                                <li>Practical Scenarios</li>
                                <li>Key Takeaways</li>
                                <li>Keywords</li>
                                <li>MCQ Quiz</li>
                            </ul>
                        </div>
                    `;
            }
        }

        // ============================================================
        // QUESTION CONTENT FUNCTIONS
        // ============================================================
        
        // QUESTION 1: What is Redis?
        function getQuestion1Content() {
            return `
                <!-- Section 1: Real Scenario -->
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>Imagine you're building a social media platform like Twitter.</strong> You have millions of users posting tweets, liking content, and following each other. Every time someone loads their feed, your application needs to fetch data about users, their posts, likes, and followers.</p>
                    
                    <p>Your traditional MySQL database is doing fine, but you notice something frustrating: <em>the same data is being fetched over and over again</em>. Every time a popular user's profile is viewed, your database has to run the same complex queries. Your database server is getting hammered with repetitive requests, and response times are slowing down from 200ms to 2 seconds during peak hours.</p>
                    
                    <p><strong>The challenge:</strong> How do you reduce database load and speed up response times without buying expensive hardware? You need something that can serve frequently accessed data in milliseconds, not seconds. This is exactly where Redis comes into play.</p>
                </div>

                <!-- Section 2: Actual Definition -->
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>So, what exactly is Redis?</strong></p>
                    
                    <p><strong>Redis</strong> (Remote Dictionary Server) is an <strong>in-memory data structure store</strong> that can be used as a database, cache, message broker, and streaming engine. Think of it as a super-fast dictionary or hash map that lives in your computer's RAM instead of on disk.</p>
                    
                    <p>Unlike traditional databases that read and write to disk (which is slow), Redis keeps all data in memory (RAM), which makes it incredibly fast. We're talking about <strong>sub-millisecond response times</strong> ‚Äì it can handle millions of operations per second!</p>
                    
                    <p>Redis is often called a "data structure server" because it doesn't just store simple key-value pairs like "name: John". It supports rich data structures like lists, sets, sorted sets, hashes, and more. This makes it much more powerful than a basic cache.</p>
                    
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>üéØ Key Characteristics:</strong>
                        <ul style="margin-top: 10px;">
                            <li><strong>In-Memory:</strong> All data stored in RAM for speed</li>
                            <li><strong>NoSQL:</strong> No schemas, no tables, no SQL queries</li>
                            <li><strong>Key-Value Store:</strong> Access data by unique keys</li>
                            <li><strong>Single-Threaded:</strong> Uses one main thread but still blazing fast</li>
                            <li><strong>Optional Persistence:</strong> Can save data to disk if needed</li>
                            <li><strong>Open Source:</strong> Free and community-driven</li>
                        </ul>
                    </div>
                </div>

                <!-- Section 3: Visual Diagrams -->
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">Redis in Application Architecture</div>
                        <svg viewBox="0 0 800 500" style="max-width: 100%; height: auto;">
                            <!-- Client Application -->
                            <rect x="50" y="50" width="150" height="80" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="8"/>
                            <text x="125" y="85" text-anchor="middle" fill="#2196F3" font-size="14" font-weight="600">Client Application</text>
                            <text x="125" y="105" text-anchor="middle" fill="#bbb" font-size="12">(Web / Mobile)</text>
                            
                            <!-- Redis Cache -->
                            <rect x="325" y="30" width="150" height="120" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="3" rx="8">
                                <animate attributeName="opacity" values="0.3;1;0.3" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="400" y="70" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="700">‚ö° Redis</text>
                            <text x="400" y="90" text-anchor="middle" fill="#fff" font-size="12">(In-Memory Cache)</text>
                            <text x="400" y="110" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">~1ms response</text>
                            <text x="400" y="130" text-anchor="middle" fill="#888" font-size="11">RAM Storage</text>
                            
                            <!-- Database -->
                            <rect x="325" y="220" width="150" height="120" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="2" rx="8"/>
                            <text x="400" y="260" text-anchor="middle" fill="#9C27B0" font-size="16" font-weight="600">üóÑÔ∏è MySQL</text>
                            <text x="400" y="280" text-anchor="middle" fill="#fff" font-size="12">(Primary Database)</text>
                            <text x="400" y="300" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">~50-200ms</text>
                            <text x="400" y="320" text-anchor="middle" fill="#888" font-size="11">Disk Storage</text>
                            
                            <!-- Fast Path Arrow (Client to Redis) -->
                            <line x1="200" y1="75" x2="320" y2="80" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                            <text x="260" y="65" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Fast Path</text>
                            <text x="260" y="80" text-anchor="middle" fill="#00FF88" font-size="11">Cache Hit</text>
                            
                            <!-- Return from Redis -->
                            <line x1="320" y1="110" x2="200" y2="105" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                            
                            <!-- Slow Path Arrow (Client to DB via Redis) -->
                            <line x1="400" y1="150" x2="400" y2="215" stroke="#FFA500" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowOrange)">
                                <animate attributeName="stroke-dashoffset" from="0" to="10" dur="1s" repeatCount="indefinite"/>
                            </line>
                            <text x="450" y="185" fill="#FFA500" font-size="12" font-weight="600">Slow Path</text>
                            <text x="450" y="200" fill="#FFA500" font-size="11">Cache Miss</text>
                            
                            <!-- Return Path from DB -->
                            <line x1="370" y1="215" x2="370" y2="155" stroke="#FFA500" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowOrange)"/>
                            
                            <!-- Arrow Markers -->
                            <defs>
                                <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                                </marker>
                                <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#FFA500" />
                                </marker>
                            </defs>
                            
                            <!-- Performance Comparison Box -->
                            <rect x="550" y="100" width="200" height="180" fill="rgba(255, 255, 255, 0.05)" stroke="#666" stroke-width="1" rx="8"/>
                            <text x="650" y="125" text-anchor="middle" fill="#fff" font-size="14" font-weight="600">‚ö° Speed Comparison</text>
                            
                            <!-- Redis Speed Bar -->
                            <rect x="570" y="145" width="140" height="25" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="1" rx="4"/>
                            <text x="580" y="162" fill="#00FF88" font-size="12">Redis: 1ms</text>
                            
                            <!-- Database Speed Bar -->
                            <rect x="570" y="185" width="140" height="70" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="1" rx="4"/>
                            <text x="580" y="202" fill="#FFA500" font-size="12">Database:</text>
                            <text x="580" y="218" fill="#FFA500" font-size="12">50-200ms</text>
                            <text x="580" y="240" fill="#888" font-size="10">(50-200x slower)</text>
                            
                            <!-- Labels -->
                            <text x="400" y="430" text-anchor="middle" fill="#888" font-size="12" font-style="italic">Typical Web Application Architecture with Redis Caching</text>
                        </svg>
                    </div>
                    
                    <p><strong>Understanding the diagram:</strong></p>
                    <ul>
                        <li><strong>Fast Path (Green):</strong> When data is in Redis (cache hit), the response is served in ~1ms from RAM</li>
                        <li><strong>Slow Path (Orange):</strong> When data isn't cached (cache miss), Redis fetches from database, caches it, then returns it</li>
                        <li><strong>Speed Difference:</strong> Redis is 50-200 times faster than disk-based databases for read operations</li>
                        <li><strong>Reduced DB Load:</strong> Most requests hit Redis, dramatically reducing load on your primary database</li>
                    </ul>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>‚ÑπÔ∏è Why This Matters:</strong> By placing Redis in front of your database, you can serve 90-95% of requests from memory, reducing database load and improving user experience dramatically.
                    </div>
                </div>

                ${getQuestion1CodeExamples()}
                ${getQuestion1CrossQuestions()}
                ${getQuestion1TrickyQuestions()}
                ${getQuestion1PracticalScenarios()}
                ${getQuestion1KeyTakeaways()}
                ${getQuestion1Keywords()}
                ${getQuestion1Quiz()}
            `;
        }

        // Question 1 - Code Examples Section
        function getQuestion1CodeExamples() {
            return `
                <!-- Section 4: Code Examples -->
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <p><strong>Let's see Redis in action with simple examples:</strong></p>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Key-Value Storage</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Store a user's name</span>
<span class="keyword">SET</span> <span class="string">"user:1001:name"</span> <span class="string">"Alice Johnson"</span>
<span class="keyword">OK</span>

<span class="comment"># Retrieve the user's name</span>
<span class="keyword">GET</span> <span class="string">"user:1001:name"</span>
<span class="string">"Alice Johnson"</span>

<span class="comment"># Store user's age</span>
<span class="keyword">SET</span> <span class="string">"user:1001:age"</span> <span class="number">28</span>
<span class="keyword">OK</span>

<span class="comment"># Check if a key exists</span>
<span class="keyword">EXISTS</span> <span class="string">"user:1001:name"</span>
<span class="number">(integer) 1</span>  <span class="comment"># 1 means exists, 0 means doesn't exist</span></code></pre>
                    </div>
                    
                    <p><strong>What's happening:</strong> Redis stores data as key-value pairs. The key is like a unique identifier (similar to a variable name), and the value is the data you want to store.</p>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Using Redis in Python Application</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

<span class="comment"># Connect to Redis</span>
r = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>, decode_responses=<span class="keyword">True</span>)

<span class="comment"># Function to get user profile (with caching)</span>
<span class="keyword">def</span> <span class="function">get_user_profile</span>(user_id):
    cache_key = <span class="string">f"user:</span>{user_id}<span class="string">:profile"</span>
    
    <span class="comment"># Try to get from Redis first</span>
    cached_data = r.get(cache_key)
    
    <span class="keyword">if</span> cached_data:
        <span class="keyword">print</span>(<span class="string">"‚úÖ Cache HIT! Served from Redis"</span>)
        <span class="keyword">return</span> cached_data
    
    <span class="comment"># Cache miss - fetch from database (simulated)</span>
    <span class="keyword">print</span>(<span class="string">"‚ùå Cache MISS! Fetching from database..."</span>)
    time.sleep(<span class="number">0.1</span>)  <span class="comment"># Simulate slow database query</span>
    
    <span class="comment"># Store in Redis for next time (with 1 hour expiry)</span>
    profile_data = <span class="string">"{'name': 'Alice', 'email': 'alice@example.com'}"</span>
    r.setex(cache_key, <span class="number">3600</span>, profile_data)
    
    <span class="keyword">return</span> profile_data

<span class="comment"># First call - cache miss</span>
<span class="keyword">print</span>(get_user_profile(<span class="number">1001</span>))

<span class="comment"># Second call - cache hit!</span>
<span class="keyword">print</span>(get_user_profile(<span class="number">1001</span>))</code></pre>
                    </div>

                    <p><strong>What's happening:</strong> This code demonstrates the classic caching pattern. First request fetches from database (slow), stores in Redis, then subsequent requests are served from Redis cache (fast!).</p>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>‚úÖ Best Practice:</strong> Always set expiry times on cache keys to prevent Redis from filling up with stale data. Use <code>SETEX</code> or <code>EXPIRE</code> commands.
                    </div>
                </div>
            `;
        }

        // Continue with other sections... (I'll add them in parts due to length)
        function getQuestion1CrossQuestions() {
            return `
                <!-- Section 5: Cross Questions -->
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions (Follow-ups)</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Is Redis classified as a database or something else?</h4>
                        <p><strong>A:</strong> Redis can be both! It's primarily used as an <strong>in-memory cache</strong>, but it can also function as a database, message broker, or streaming engine. Most companies use it as a cache to speed up database queries.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Why do companies prefer Redis over traditional databases for caching?</h4>
                        <p><strong>A:</strong> Speed! Redis operates entirely in RAM, giving sub-millisecond response times compared to 50-200ms for disk-based databases. Plus, it's simpler - just key-value pairs without complex SQL queries.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What makes Redis different from Memcached?</h4>
                        <p><strong>A:</strong> Redis supports rich data structures (lists, sets, sorted sets) while Memcached only stores strings. Redis also offers persistence, pub/sub, transactions, and Lua scripting.</p>
                    </div>
                </div>
            `;
        }

        function getQuestion1TrickyQuestions() {
            return `
                <!-- Section 6: Tricky Questions -->
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions (Advanced)</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: If Redis stores everything in memory, doesn't that mean you lose all data when the server restarts?</h4>
                        <p><strong>Answer:</strong> Redis offers <strong>optional persistence</strong> using RDB snapshots or AOF logs. However, many companies use Redis purely as a cache without persistence for maximum speed.</p>
                        <p><em>Pro tip: For critical data, use both RDB and AOF. For pure caching, disable persistence.</em></p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Redis is single-threaded. Won't this make it slow?</h4>
                        <p><strong>Answer:</strong> No! Single-threaded design is a <strong>performance feature</strong>. It eliminates lock contention, and memory operations are so fast that CPU becomes the bottleneck, not threads.</p>
                        <p><em>Pro tip: Avoid slow operations like KEYS * - use SCAN instead.</em></p>
                    </div>
                </div>
            `;
        }

        function getQuestion1PracticalScenarios() {
            return `
                <!-- Section 7: Practical Scenarios -->
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenarios</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 20px 0 10px 0;">Scenario: E-commerce Product Caching</h3>
                    <p><strong>Problem:</strong> Database queries for product details create massive load during peak hours.</p>
                    <p><strong>Solution:</strong> Cache frequently accessed product data in Redis with smart TTL management.</p>
                    <p><strong>Results:</strong> 95% reduction in database queries, page load improved from 800ms to 50ms.</p>
                </div>
            `;
        }

        function getQuestion1KeyTakeaways() {
            return `
                <!-- Section 8: Key Takeaways -->
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    
                    <div class="takeaway-item">
                        <span class="takeaway-icon">‚úÖ</span>
                        <p><strong>Redis = Remote Dictionary Server</strong> - An in-memory data structure store with sub-millisecond response times</p>
                    </div>
                    
                    <div class="takeaway-item">
                        <span class="takeaway-icon">‚ö°</span>
                        <p><strong>Speed comes from RAM</strong> - 50-200x faster than disk-based databases</p>
                    </div>
                    
                    <div class="takeaway-item">
                        <span class="takeaway-icon">üéØ</span>
                        <p><strong>Not just a cache</strong> - Can be database, cache, message broker, or streaming engine</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">üöÄ</span>
                        <p><strong>Industry standard</strong> - Used by Twitter, GitHub, Instagram, Airbnb in production</p>
                    </div>
                </div>
            `;
        }

        function getQuestion1Keywords() {
            return `
                <!-- Section 9: Keywords -->
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords & Concepts</h2>
                    </div>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">Redis</span>
                        <span class="keyword-tag">In-Memory Database</span>
                        <span class="keyword-tag">Key-Value Store</span>
                        <span class="keyword-tag">Caching</span>
                        <span class="keyword-tag">NoSQL</span>
                        <span class="keyword-tag">RAM Storage</span>
                        <span class="keyword-tag">Single-Threaded</span>
                        <span class="keyword-tag">Persistence</span>
                        <span class="keyword-tag">TTL</span>
                        <span class="keyword-tag">Open Source</span>
                    </div>
                </div>
            `;
        }

        function getQuestion1Quiz() {
            return `
                <!-- Section 10: MCQ Quiz -->
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Practice Quiz</h2>
                    </div>
                    
                    <div class="quiz-container">
                        <div class="quiz-question">
                            <strong>Question 1:</strong> What is the primary reason Redis is so fast?
                        </div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                A) It uses multiple threads
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                B) It compresses data automatically
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">
                                C) It stores all data in RAM
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                D) It uses GPU acceleration
                            </div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct Answer: C</strong>
                            <p>Redis stores all data in RAM, which is 50-200x faster than disk storage!</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================================
        // QUESTION 2: Is Redis a database or a cache?
        // ============================================================
        
        function getQuestion2Content() {
            return `
                ${getQuestion2Section1_RealScenario()}
                ${getQuestion2Section2_Definition()}
                ${getQuestion2Section3_Diagrams()}
                ${getQuestion2Section4_CodeExamples()}
                ${getQuestion2Section5_CrossQuestions()}
                ${getQuestion2Section6_TrickyQuestions()}
                ${getQuestion2Section7_PracticalScenarios()}
                ${getQuestion2Section8_KeyTakeaways()}
                ${getQuestion2Section9_Keywords()}
                ${getQuestion2Section10_Quiz()}
            `;
        }

        function getQuestion2Section1_RealScenario() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    
                    <p><strong>You're in a technical architecture meeting at your company.</strong> The team is discussing whether to use Redis for the new user authentication system. The backend lead says, "Let's use Redis as our primary database for user sessions." The database architect responds, "No way! Redis is just a cache, not a real database."</p>
                    
                    <p>Now everyone's confused. The product manager asks, "So which one is it? Can we rely on Redis to store important data, or will we lose everything if the server restarts?" The DevOps engineer chimes in, "I've seen companies use Redis for both caching AND as a database. What's the real story here?"</p>
                    
                    <p><strong>This is one of the most common debates in software architecture:</strong> Is Redis fundamentally a cache that temporarily stores data, or is it a legitimate database that can persist data permanently? The answer is more nuanced than most people think, and understanding this distinction is crucial for making the right architectural decisions.</p>
                </div>
            `;
        }

        function getQuestion2Section2_Definition() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>Here's the truth: Redis can be BOTH a cache AND a database.</strong></p>
                    
                    <p>Let me explain. <strong>Redis is technically classified as an in-memory data structure store</strong>, which means it's a flexible tool that can be configured for different purposes depending on your needs.</p>
                    
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 10px;">üéØ Redis as a Cache:</h4>
                        <p>When used as a <strong>cache</strong>, Redis stores temporary copies of frequently accessed data from your main database. The data in Redis can be lost and rebuilt without major consequences because the "source of truth" lives in your primary database (like PostgreSQL or MySQL).</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Persistence:</strong> Often disabled for maximum speed</li>
                            <li><strong>Purpose:</strong> Speed up read operations</li>
                            <li><strong>Data Loss:</strong> Acceptable - cache can be rebuilt</li>
                            <li><strong>TTL:</strong> Keys expire automatically</li>
                            <li><strong>Eviction:</strong> Old data is removed when memory is full</li>
                        </ul>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 10px;">üóÑÔ∏è Redis as a Database:</h4>
                        <p>When used as a <strong>database</strong>, Redis becomes the primary storage system where your data lives. Losing this data would be catastrophic, so persistence mechanisms (RDB/AOF) are enabled to ensure durability.</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Persistence:</strong> Enabled (RDB snapshots + AOF logs)</li>
                            <li><strong>Purpose:</strong> Store critical application data</li>
                            <li><strong>Data Loss:</strong> Unacceptable - data must survive restarts</li>
                            <li><strong>TTL:</strong> Usually no expiration</li>
                            <li><strong>Eviction:</strong> Disabled (noeviction policy)</li>
                        </ul>
                    </div>

                    <p><strong>The Real Answer:</strong> Redis's identity depends entirely on how you configure and use it. It's like asking if a smartphone is a camera or a phone - it's both, depending on which features you're using at the moment!</p>

                    <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>‚ö†Ô∏è Important Distinction:</strong> Most companies (90%+) use Redis primarily as a <strong>cache</strong>, not a database. Using it as a primary database is possible but requires careful consideration of durability, backup strategies, and trade-offs.
                    </div>
                </div>
            `;
        }

        function getQuestion2Section3_Diagrams() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">Redis as Cache vs Database - Architectural Comparison</div>
                        <svg viewBox="0 0 900 550" style="max-width: 100%; height: auto;">
                            <!-- Title -->
                            <text x="450" y="30" text-anchor="middle" fill="#fff" font-size="18" font-weight="700">Two Different Use Cases</text>
                            
                            <!-- LEFT SIDE: Redis as Cache -->
                            <text x="220" y="70" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">Scenario 1: Redis as CACHE</text>
                            
                            <!-- Application Server -->
                            <rect x="145" y="90" width="150" height="60" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="8"/>
                            <text x="220" y="115" text-anchor="middle" fill="#2196F3" font-size="14" font-weight="600">Application</text>
                            <text x="220" y="133" text-anchor="middle" fill="#bbb" font-size="12">Server</text>
                            
                            <!-- Redis Cache -->
                            <rect x="145" y="180" width="150" height="80" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="2" rx="8">
                                <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="220" y="210" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">‚ö° Redis</text>
                            <text x="220" y="228" text-anchor="middle" fill="#888" font-size="11">(Cache Layer)</text>
                            <text x="220" y="245" text-anchor="middle" fill="#FFA500" font-size="10">Persistence: OFF</text>
                            
                            <!-- Primary Database -->
                            <rect x="145" y="290" width="150" height="80" fill="rgba(76, 175, 80, 0.2)" stroke="#4CAF50" stroke-width="3" rx="8"/>
                            <text x="220" y="320" text-anchor="middle" fill="#4CAF50" font-size="14" font-weight="700">üóÑÔ∏è PostgreSQL</text>
                            <text x="220" y="338" text-anchor="middle" fill="#fff" font-size="11">(Source of Truth)</text>
                            <text x="220" y="355" text-anchor="middle" fill="#00FF88" font-size="10">Persistence: ON</text>
                            
                            <!-- Arrows for Cache scenario -->
                            <path d="M 220 150 L 220 175" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowBlue)" stroke-dasharray="3,3"/>
                            <path d="M 220 260 L 220 285" stroke="#4CAF50" stroke-width="2" marker-end="url(#arrowGreen2)"/>
                            
                            <!-- Labels for Cache -->
                            <text x="240" y="168" fill="#888" font-size="10">Fast reads</text>
                            <text x="240" y="278" fill="#888" font-size="10">Source data</text>
                            
                            <!-- Cache characteristics -->
                            <rect x="145" y="390" width="150" height="130" fill="rgba(255, 255, 255, 0.03)" stroke="#666" stroke-width="1" rx="6"/>
                            <text x="220" y="410" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">‚úÖ Cache Benefits:</text>
                            <text x="155" y="430" fill="#bbb" font-size="10">‚Ä¢ 95% faster reads</text>
                            <text x="155" y="445" fill="#bbb" font-size="10">‚Ä¢ Reduces DB load</text>
                            <text x="155" y="460" fill="#bbb" font-size="10">‚Ä¢ Data loss OK</text>
                            <text x="155" y="475" fill="#bbb" font-size="10">‚Ä¢ Auto-expiry (TTL)</text>
                            <text x="155" y="490" fill="#bbb" font-size="10">‚Ä¢ Simple setup</text>
                            <text x="155" y="505" fill="#FFA500" font-size="10">‚ö†Ô∏è Not critical data</text>

                            <!-- Divider Line -->
                            <line x1="450" y1="60" x2="450" y2="540" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
                            
                            <!-- RIGHT SIDE: Redis as Database -->
                            <text x="680" y="70" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="600">Scenario 2: Redis as DATABASE</text>
                            
                            <!-- Application Server -->
                            <rect x="605" y="90" width="150" height="60" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="8"/>
                            <text x="680" y="115" text-anchor="middle" fill="#2196F3" font-size="14" font-weight="600">Application</text>
                            <text x="680" y="133" text-anchor="middle" fill="#bbb" font-size="12">Server</text>
                            
                            <!-- Redis Database -->
                            <rect x="605" y="180" width="150" height="120" fill="rgba(220, 20, 60, 0.3)" stroke="#DC143C" stroke-width="3" rx="8">
                                <animate attributeName="stroke-width" values="3;5;3" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="680" y="215" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">‚ö° Redis</text>
                            <text x="680" y="233" text-anchor="middle" fill="#fff" font-size="11">(Primary Database)</text>
                            <text x="680" y="251" text-anchor="middle" fill="#00FF88" font-size="10">Persistence: ON</text>
                            <text x="680" y="266" text-anchor="middle" fill="#00FF88" font-size="10">(RDB + AOF)</text>
                            <text x="680" y="283" text-anchor="middle" fill="#888" font-size="9">Source of Truth ‚úì</text>
                            
                            <!-- Optional Backup -->
                            <rect x="605" y="330" width="150" height="60" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="2" rx="8" stroke-dasharray="5,5"/>
                            <text x="680" y="355" text-anchor="middle" fill="#9C27B0" font-size="12">üì¶ Backup Store</text>
                            <text x="680" y="372" text-anchor="middle" fill="#888" font-size="10">(Optional)</text>
                            
                            <!-- Arrows for Database scenario -->
                            <path d="M 680 150 L 680 175" stroke="#2196F3" stroke-width="3" marker-end="url(#arrowBlue)"/>
                            <path d="M 680 300 L 680 325" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)" stroke-dasharray="3,3"/>
                            
                            <text x="700" y="168" fill="#fff" font-size="10">All data here!</text>
                            <text x="700" y="318" fill="#888" font-size="10">Backups only</text>
                            
                            <!-- Database characteristics -->
                            <rect x="605" y="410" width="150" height="110" fill="rgba(255, 255, 255, 0.03)" stroke="#666" stroke-width="1" rx="6"/>
                            <text x="680" y="430" text-anchor="middle" fill="#DC143C" font-size="12" font-weight="600">üóÑÔ∏è Database Mode:</text>
                            <text x="615" y="450" fill="#bbb" font-size="10">‚Ä¢ Data must persist</text>
                            <text x="615" y="465" fill="#bbb" font-size="10">‚Ä¢ No eviction</text>
                            <text x="615" y="480" fill="#bbb" font-size="10">‚Ä¢ Backup strategy</text>
                            <text x="615" y="495" fill="#bbb" font-size="10">‚Ä¢ Replication setup</text>
                            <text x="615" y="510" fill="#FFA500" font-size="10">‚ö†Ô∏è Critical data</text>

                            <!-- Arrow Markers -->
                            <defs>
                                <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#2196F3" />
                                </marker>
                                <marker id="arrowGreen2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#4CAF50" />
                                </marker>
                                <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                                </marker>
                            </defs>
                        </svg>
                    </div>
                    
                    <p><strong>Understanding the diagram:</strong></p>
                    <ul>
                        <li><strong>Left Side (Cache):</strong> Redis sits between application and database. PostgreSQL is the "source of truth." If Redis crashes, data is rebuilt from PostgreSQL.</li>
                        <li><strong>Right Side (Database):</strong> Redis IS the source of truth. Application stores data directly in Redis with persistence enabled. Data loss would be catastrophic.</li>
                        <li><strong>Key Difference:</strong> In cache mode, Redis is expendable. In database mode, Redis is critical infrastructure.</li>
                        <li><strong>Persistence Toggle:</strong> The same Redis installation can switch between these modes based on configuration.</li>
                    </ul>
                </div>
            `;
        }

        function getQuestion2Section4_CodeExamples() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <p><strong>Let's see the configuration differences between cache and database mode:</strong></p>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Configuring Redis as a Cache</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">redis.conf (Cache Configuration)</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># ========================================</span>
<span class="comment"># REDIS AS CACHE - Configuration</span>
<span class="comment"># ========================================</span>

<span class="comment"># Disable persistence for maximum speed</span>
<span class="keyword">save</span> <span class="string">""</span>  <span class="comment"># No RDB snapshots</span>
<span class="keyword">appendonly</span> no  <span class="comment"># No AOF persistence</span>

<span class="comment"># Set maximum memory limit</span>
<span class="keyword">maxmemory</span> <span class="number">2gb</span>

<span class="comment"># Eviction policy - remove least recently used keys</span>
<span class="keyword">maxmemory-policy</span> allkeys-lru

<span class="comment"># Default TTL for keys (optional)</span>
<span class="keyword">default-ttl</span> <span class="number">3600</span>  <span class="comment"># 1 hour</span>

<span class="comment"># Fast but unsafe - don't wait for disk writes</span>
<span class="keyword">stop-writes-on-bgsave-error</span> no</code></pre>
                    </div>
                    
                    <p><strong>What this does:</strong> Redis acts purely as a cache - fast, volatile, and expendable. Data loss on restart is expected and acceptable.</p>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Configuring Redis as a Database</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">redis.conf (Database Configuration)</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># ========================================</span>
<span class="comment"># REDIS AS DATABASE - Configuration</span>
<span class="comment"># ========================================</span>

<span class="comment"># Enable RDB snapshots (save to disk periodically)</span>
<span class="keyword">save</span> <span class="number">900 1</span>      <span class="comment"># After 900 sec (15 min) if at least 1 key changed</span>
<span class="keyword">save</span> <span class="number">300 10</span>     <span class="comment"># After 300 sec (5 min) if at least 10 keys changed</span>
<span class="keyword">save</span> <span class="number">60 10000</span>   <span class="comment"># After 60 sec if at least 10000 keys changed</span>

<span class="comment"># Enable AOF (Append-Only File) for durability</span>
<span class="keyword">appendonly</span> yes
<span class="keyword">appendfsync</span> everysec  <span class="comment"># Sync to disk every second</span>

<span class="comment"># Set higher memory limit (no eviction)</span>
<span class="keyword">maxmemory</span> <span class="number">8gb</span>

<span class="comment"># CRITICAL: Don't evict any data!</span>
<span class="keyword">maxmemory-policy</span> noeviction  <span class="comment"># Return errors instead of evicting</span>

<span class="comment"># Stop writes if background save fails</span>
<span class="keyword">stop-writes-on-bgsave-error</span> yes  <span class="comment"># Safety first!</span>

<span class="comment"># Enable replication for high availability</span>
<span class="keyword">replicaof</span> <span class="number">10.0.0.2 6379</span>  <span class="comment"># Optional: replica setup</span></code></pre>
                    </div>
                    
                    <p><strong>What this does:</strong> Redis becomes a durable database with persistence, no eviction, and safety checks. Data survives restarts.</p>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Using Redis as Cache in Python</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Cache Pattern</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> psycopg2
<span class="keyword">import</span> json

<span class="comment"># Connect to Redis (cache) and PostgreSQL (database)</span>
redis_client = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>)
db_conn = psycopg2.connect(<span class="string">"dbname=myapp user=postgres"</span>)

<span class="keyword">def</span> <span class="function">get_user_profile</span>(user_id):
    <span class="string">"""
    Redis as CACHE: Database is source of truth
    """</span>
    cache_key = <span class="string">f"user:</span>{user_id}<span class="string">:profile"</span>
    
    <span class="comment"># Try cache first</span>
    cached = redis_client.get(cache_key)
    <span class="keyword">if</span> cached:
        <span class="keyword">print</span>(<span class="string">"Cache HIT!"</span>)
        <span class="keyword">return</span> json.loads(cached)
    
    <span class="comment"># Cache miss - fetch from PostgreSQL (source of truth)</span>
    <span class="keyword">print</span>(<span class="string">"Cache MISS - querying PostgreSQL"</span>)
    cursor = db_conn.cursor()
    cursor.execute(<span class="string">"SELECT * FROM users WHERE id = %s"</span>, (user_id,))
    user_data = cursor.fetchone()
    
    <span class="comment"># Store in cache for 1 hour</span>
    redis_client.setex(cache_key, <span class="number">3600</span>, json.dumps(user_data))
    
    <span class="keyword">return</span> user_data

<span class="comment"># If Redis crashes, application still works (just slower)</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 4: Using Redis as Database</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Database Pattern</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json

<span class="comment"># Redis IS the database - no other database!</span>
redis_db = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>)

<span class="keyword">def</span> <span class="function">create_session</span>(user_id, session_data):
    <span class="string">"""
    Redis as DATABASE: Redis is the source of truth
    """</span>
    session_id = generate_session_id()
    session_key = <span class="string">f"session:</span>{session_id}<span class="string">"</span>
    
    <span class="comment"># Store critical session data ONLY in Redis</span>
    session_data[<span class="string">'user_id'</span>] = user_id
    session_data[<span class="string">'created_at'</span>] = time.time()
    
    <span class="comment"># No TTL - session stays until explicitly deleted</span>
    redis_db.set(session_key, json.dumps(session_data))
    
    <span class="keyword">return</span> session_id

<span class="keyword">def</span> <span class="function">get_session</span>(session_id):
    session_key = <span class="string">f"session:</span>{session_id}<span class="string">"</span>
    session_data = redis_db.get(session_key)
    
    <span class="keyword">if</span> <span class="keyword">not</span> session_data:
        <span class="keyword">raise</span> <span class="function">Exception</span>(<span class="string">"Session not found!"</span>)
    
    <span class="keyword">return</span> json.loads(session_data)

<span class="comment"># If Redis crashes, we lose ALL sessions - disaster!</span>
<span class="comment"># That's why persistence + replication is critical</span></code></pre>
                    </div>

                    <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>‚ö†Ô∏è Key Difference:</strong> In cache mode, losing Redis is annoying but not catastrophic. In database mode, losing Redis means losing critical data - that's why proper persistence, replication, and backups are essential!
                    </div>
                </div>
            `;
        }

        function getQuestion2Section5_CrossQuestions() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions (Follow-ups)</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Can Redis be used as both cache and database at the same time?</h4>
                        <p><strong>A:</strong> Yes! You can have different Redis instances or databases for different purposes. For example, database 0 for caching with no persistence, and database 1 for session storage with full persistence enabled. Many companies run multiple Redis instances for different use cases.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: In which scenarios would Redis NOT be suitable as a primary database?</h4>
                        <p><strong>A:</strong> Redis isn't suitable when you need: (1) Complex relational queries with JOINs, (2) ACID transactions across multiple tables, (3) Data larger than available RAM, (4) Strict regulatory compliance requiring traditional RDBMS features, or (5) Complex analytical queries (OLAP). For these cases, use PostgreSQL, MySQL, or specialized databases.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What percentage of companies use Redis as a cache vs database?</h4>
                        <p><strong>A:</strong> Approximately 90-95% of Redis deployments are for caching, with only 5-10% using it as a primary database. Common database use cases include session stores, real-time leaderboards, rate limiting counters, and pub/sub messaging where data is inherently temporary or can tolerate some data loss.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: If Redis is so fast, why not use it as a primary database for everything?</h4>
                        <p><strong>A:</strong> Three main reasons: (1) <strong>Cost</strong> - RAM is 10-30x more expensive than disk storage, (2) <strong>Capacity</strong> - Most datasets are too large to fit entirely in RAM, (3) <strong>Features</strong> - Redis lacks complex query capabilities, foreign keys, and traditional database features. Use Redis for hot data, traditional databases for cold data.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: What's the difference between Redis and Memcached for caching?</h4>
                        <p><strong>A:</strong> Redis supports rich data structures (lists, sets, sorted sets, hashes) while Memcached only handles simple key-value strings. Redis offers persistence options, pub/sub, transactions, and Lua scripting. Memcached is simpler and slightly faster for basic caching, but Redis is more versatile. Most new projects choose Redis.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q6: Can you give examples of companies using Redis as a database?</h4>
                        <p><strong>A:</strong> Twitter uses Redis to store timeline data, GitHub uses it for job queues, Instagram uses it for activity feeds, and Stack Overflow uses it for real-time operations. However, even these companies use Redis alongside traditional databases - Redis handles hot, frequently accessed data while PostgreSQL/MySQL handles the bulk of persistent data.</p>
                    </div>
                </div>
            `;
        }

        function getQuestion2Section6_TrickyQuestions() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions (Advanced)</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: If persistence is enabled, doesn't that make Redis as durable as MySQL or PostgreSQL?</h4>
                        <p><strong>Answer:</strong> Not quite! While Redis persistence helps, it's not as durable as traditional databases:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>RDB snapshots:</strong> You can lose data between snapshots (e.g., last 5 minutes of writes)</li>
                            <li><strong>AOF with everysec:</strong> You can still lose ~1 second of data on crash</li>
                            <li><strong>AOF with always:</strong> More durable but kills performance (not practical)</li>
                            <li><strong>Write-ahead logging:</strong> Traditional databases use WAL which is more robust</li>
                        </ul>
                        <p style="margin-top: 10px;">PostgreSQL can guarantee zero data loss with synchronous replication, but Redis makes durability/performance trade-offs.</p>
                        <p><em>Pro tip: For critical financial data, always use a traditional RDBMS. For session data or metrics, Redis is fine.</em></p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Why do most companies still use separate databases instead of Redis for everything?</h4>
                        <p><strong>Answer:</strong> The "RAM constraint" is the big one. Let's do the math:</p>
                        <ul style="margin-top: 10px;">
                            <li>Typical e-commerce database: 500GB of product/order data</li>
                            <li>RAM cost: ~$10/GB/month (AWS pricing)</li>
                            <li>To store in Redis: 500GB √ó $10 = <strong>$5,000/month</strong></li>
                            <li>Disk storage cost: ~$0.10/GB/month</li>
                            <li>Traditional database: 500GB √ó $0.10 = <strong>$50/month</strong></li>
                        </ul>
                        <p style="margin-top: 10px;">That's a 100x cost difference! The strategy is: cache the "hot" 20% in Redis, store the "cold" 80% on disk. This gives you 80% of the performance benefit at 20% of the cost.</p>
                        <p><em>Pro tip: Use Redis for frequently accessed data, traditional DBs for long-term storage.</em></p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: What happens if you configure Redis as a cache but accidentally disable eviction?</h4>
                        <p><strong>Answer:</strong> Disaster! Here's what happens:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Memory fills up:</strong> Redis reaches maxmemory limit</li>
                            <li><strong>With noeviction:</strong> All write commands start failing with OOM errors</li>
                            <li><strong>Application breaks:</strong> Can't cache new data, performance degrades</li>
                            <li><strong>Cache becomes useless:</strong> Stuck with old, stale data</li>
                        </ul>
                        <p style="margin-top: 10px;">This is why the default eviction policy matters! For caching, always use <code>allkeys-lru</code> or <code>volatile-lru</code>. For database mode, use <code>noeviction</code> and monitor memory closely.</p>
                        <p><em>Pro tip: Monitor Redis memory usage with alerts at 80% capacity.</em></p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can you use Redis as a database without any persistence at all?</h4>
                        <p><strong>Answer:</strong> Technically yes, but only for specific ephemeral use cases:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Session storage (with replication):</strong> Sessions can be recreated by re-login</li>
                            <li><strong>Real-time analytics:</strong> Losing a few minutes of metrics might be acceptable</li>
                            <li><strong>Rate limiting counters:</strong> Resets on restart might be fine</li>
                            <li><strong>Temporary job queues:</strong> Failed jobs can be retried</li>
                        </ul>
                        <p style="margin-top: 10px;">The key is: the data must be either (1) reconstructable, (2) temporary by nature, or (3) non-critical. Never do this for user data, payment info, or anything irreplaceable!</p>
                        <p><em>Pro tip: Even for "ephemeral" databases, consider enabling persistence for disaster recovery.</em></p>
                    </div>
                </div>
            `;
        }

        function getQuestion2Section7_PracticalScenarios() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenarios</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 20px 0 10px 0;">Scenario 1: E-commerce Product Catalog (Redis as Cache)</h3>
                    <p><strong>Problem:</strong> An online store has 10 million products in PostgreSQL. Popular products are queried thousands of times per minute, crushing the database.</p>
                    
                    <p><strong>Solution:</strong> Use Redis as a cache layer for product details.</p>
                    
                    <p><strong>Architecture:</strong></p>
                    <ul>
                        <li><strong>PostgreSQL:</strong> Source of truth with all 10M products</li>
                        <li><strong>Redis:</strong> Caches top 100K products (the "hot" items)</li>
                        <li><strong>TTL:</strong> 1-hour expiry to keep data fresh</li>
                        <li><strong>Eviction:</strong> LRU policy removes unpopular items</li>
                    </ul>

                    <p><strong>Results:</strong></p>
                    <ul>
                        <li>‚úÖ 95% cache hit rate</li>
                        <li>‚úÖ Database queries reduced from 50K/min to 2.5K/min</li>
                        <li>‚úÖ Page load time: 800ms ‚Üí 80ms</li>
                        <li>‚úÖ Database CPU: 85% ‚Üí 15%</li>
                        <li>üí∞ Cost: $200/month Redis vs $5,000/month database scaling</li>
                    </ul>

                    <h3 style="color: var(--primary-color); margin: 30px 0 10px 0;">Scenario 2: Gaming Leaderboard (Redis as Database)</h3>
                    <p><strong>Problem:</strong> A mobile game needs real-time leaderboards for 50 million players. MySQL can't handle the write volume for score updates.</p>
                    
                    <p><strong>Solution:</strong> Use Redis Sorted Sets as the primary database for leaderboards.</p>
                    
                    <p><strong>Architecture:</strong></p>
                    <ul>
                        <li><strong>Redis Sorted Sets:</strong> Store player scores (instant ranking)</li>
                        <li><strong>Persistence:</strong> RDB + AOF enabled</li>
                        <li><strong>Replication:</strong> 2 replicas for high availability</li>
                        <li><strong>Backup:</strong> Snapshot to S3 every hour</li>
                    </ul>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis Implementation</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Update player score (instant)</span>
<span class="keyword">ZADD</span> <span class="string">leaderboard:global</span> <span class="number">15000</span> <span class="string">player:12345</span>

<span class="comment"># Get top 100 players (< 1ms)</span>
<span class="keyword">ZREVRANGE</span> <span class="string">leaderboard:global</span> <span class="number">0</span> <span class="number">99</span> <span class="keyword">WITHSCORES</span>

<span class="comment"># Get player's rank instantly</span>
<span class="keyword">ZREVRANK</span> <span class="string">leaderboard:global</span> <span class="string">player:12345</span></code></pre>
                    </div>

                    <p><strong>Why Redis as Database here:</strong></p>
                    <ul>
                        <li>‚úÖ Handles 500K score updates per second</li>
                        <li>‚úÖ Rankings computed in O(log N) time</li>
                        <li>‚úÖ Top 100 query in < 1ms (vs 5 seconds in MySQL)</li>
                        <li>‚úÖ Leaderboard data is naturally temporary (resets weekly)</li>
                    </ul>

                    <h3 style="color: var(--primary-color); margin: 30px 0 10px 0;">Scenario 3: Hybrid Approach (Both Cache and Database)</h3>
                    <p><strong>Problem:</strong> A social media platform needs both fast access and data durability.</p>
                    
                    <p><strong>Solution:</strong> Use multiple Redis instances for different purposes:</p>
                    
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0; background: rgba(255, 255, 255, 0.02);">
                        <thead>
                            <tr style="background: rgba(220, 20, 60, 0.2); border-bottom: 2px solid var(--primary-color);">
                                <th style="padding: 12px; text-align: left;">Data Type</th>
                                <th style="padding: 12px; text-align: left;">Redis Role</th>
                                <th style="padding: 12px; text-align: left;">Persistence</th>
                                <th style="padding: 12px; text-align: left;">Reason</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 12px;">User profiles</td>
                                <td style="padding: 12px;">Cache</td>
                                <td style="padding: 12px;">‚ùå Disabled</td>
                                <td style="padding: 12px;">PostgreSQL is source</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 12px;">Active sessions</td>
                                <td style="padding: 12px;">Database</td>
                                <td style="padding: 12px;">‚úÖ Enabled</td>
                                <td style="padding: 12px;">No other storage</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 12px;">Feed timeline</td>
                                <td style="padding: 12px;">Cache</td>
                                <td style="padding: 12px;">‚ùå Disabled</td>
                                <td style="padding: 12px;">Rebuilds from posts table</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 12px;">Real-time counters</td>
                                <td style="padding: 12px;">Database</td>
                                <td style="padding: 12px;">‚úÖ Enabled</td>
                                <td style="padding: 12px;">Critical metrics</td>
                            </tr>
                        </tbody>
                    </table>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>‚úÖ Best Practice:</strong> Most production systems use Redis in multiple roles simultaneously. The key is understanding which data can be cached (and rebuilt) vs which data must persist in Redis as the source of truth.
                    </div>
                </div>
            `;
        }

        function getQuestion2Section8_KeyTakeaways() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    
                    <div class="takeaway-item">
                        <span class="takeaway-icon">‚úÖ</span>
                        <p><strong>Redis is BOTH cache and database</strong> - The role depends entirely on configuration and use case, not on the technology itself</p>
                    </div>
                    
                    <div class="takeaway-item">
                        <span class="takeaway-icon">üí∞</span>
                        <p><strong>90%+ use Redis as cache</strong> - Most deployments use Redis for caching because RAM is expensive and limited in capacity</p>
                    </div>
                    
                    <div class="takeaway-item">
                        <span class="takeaway-icon">üóÑÔ∏è</span>
                        <p><strong>Cache mode: expendable data</strong> - Persistence disabled, LRU eviction enabled, TTL on keys, database is source of truth</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">üíæ</span>
                        <p><strong>Database mode: critical data</strong> - Persistence enabled (RDB+AOF), no eviction, replication configured, Redis is source of truth</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">‚ö†Ô∏è</span>
                        <p><strong>Durability trade-off</strong> - Even with persistence, Redis is less durable than traditional databases (potential 1-sec to 5-min data loss)</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">üéØ</span>
                        <p><strong>Right tool for the job</strong> - Use Redis as cache for hot data, traditional DB for cold data, Redis as database only for specific use cases</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">üèóÔ∏è</span>
                        <p><strong>Hybrid approaches work best</strong> - Many companies run multiple Redis instances - some for caching, some for database needs</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">üí°</span>
                        <p><strong>Configuration is everything</strong> - The difference between cache and database is just configuration (maxmemory-policy, persistence settings, TTL)</p>
                    </div>
                </div>
            `;
        }

        function getQuestion2Section9_Keywords() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords & Concepts</h2>
                    </div>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">Cache vs Database</span>
                        <span class="keyword-tag">In-Memory Store</span>
                        <span class="keyword-tag">Persistence (RDB/AOF)</span>
                        <span class="keyword-tag">Source of Truth</span>
                        <span class="keyword-tag">Eviction Policy</span>
                        <span class="keyword-tag">LRU (Least Recently Used)</span>
                        <span class="keyword-tag">noeviction</span>
                        <span class="keyword-tag">TTL (Time To Live)</span>
                        <span class="keyword-tag">Durability</span>
                        <span class="keyword-tag">Data Loss</span>
                        <span class="keyword-tag">Volatile Storage</span>
                        <span class="keyword-tag">Persistent Storage</span>
                        <span class="keyword-tag">Cache Hit/Miss</span>
                        <span class="keyword-tag">Hot Data</span>
                        <span class="keyword-tag">Cold Data</span>
                        <span class="keyword-tag">Replication</span>
                        <span class="keyword-tag">High Availability</span>
                        <span class="keyword-tag">RAM Cost</span>
                        <span class="keyword-tag">Hybrid Architecture</span>
                        <span class="keyword-tag">maxmemory</span>
                        <span class="keyword-tag">appendonly</span>
                        <span class="keyword-tag">save command</span>
                    </div>
                </div>
            `;
        }

        function getQuestion2Section10_Quiz() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Practice Quiz</h2>
                    </div>
                    
                    <div class="quiz-container">
                        <div class="quiz-question">
                            <strong>Question 1:</strong> What is the PRIMARY difference between using Redis as a cache vs. a database?
                        </div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                A) Redis runs faster in cache mode than database mode
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                B) Cache mode uses different data structures than database mode
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">
                                C) In cache mode, another database is the source of truth; in database mode, Redis is the source of truth
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                D) Cache mode doesn't support persistence at all
                            </div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct Answer: C</strong>
                            <p><strong>Explanation:</strong> The fundamental difference is about the "source of truth." In cache mode, Redis holds temporary copies of data that exists in another database (like PostgreSQL). If Redis crashes, data can be rebuilt. In database mode, Redis IS the primary storage - losing Redis means losing data.</p>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <div class="quiz-question">
                            <strong>Question 2:</strong> Which configuration indicates Redis is being used as a cache?
                        </div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                A) appendonly yes, maxmemory-policy noeviction
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">
                                B) save "", maxmemory-policy allkeys-lru
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                C) save 900 1, appendfsync everysec
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                D) replicaof master-ip 6379, maxmemory-policy noeviction
                            </div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct Answer: B</strong>
                            <p><strong>Explanation:</strong> Cache configuration typically has: (1) <code>save ""</code> which disables RDB persistence for speed, (2) <code>maxmemory-policy allkeys-lru</code> which automatically evicts least recently used keys when memory is full. Options A and C enable persistence (database mode), and D configures replication which is for high availability.</p>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <div class="quiz-question">
                            <strong>Question 3:</strong> Why don't most companies use Redis as their primary database for all data?
                        </div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                A) Redis is too slow for primary database workloads
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">
                                B) RAM is expensive and limited - can't fit all data in memory cost-effectively
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                C) Redis doesn't support persistence at all
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                D) Redis can only store strings, not complex data
                            </div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct Answer: B</strong>
                            <p><strong>Explanation:</strong> RAM costs 10-30x more than disk storage and is physically limited. A 1TB dataset in Redis could cost $10,000/month in RAM vs $100/month on disk. That's why the strategy is: store "hot" frequently accessed data (20%) in Redis, "cold" rarely accessed data (80%) in traditional databases. This gives great performance at reasonable cost.</p>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <div class="quiz-question">
                            <strong>Question 4:</strong> A company stores user sessions in Redis with persistence enabled. Is this cache or database usage?
                        </div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                A) Cache, because sessions are temporary
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">
                                B) Database, because Redis is the source of truth for sessions
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                C) Neither, it's message broker usage
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                D) Both cache and database simultaneously
                            </div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct Answer: B</strong>
                            <p><strong>Explanation:</strong> Even though sessions are temporary, Redis is the PRIMARY and ONLY storage for session data - there's no other database backing it up. If Redis loses session data, users get logged out. This makes it database usage, not cache usage. The key question is: "Is Redis the source of truth?" If yes = database. If no (another DB is source) = cache.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper functions
        function findQuestionById(id) {
            for (let section of sections) {
                const found = section.questions.find(q => q.id === id);
                if (found) return found;
            }
            return null;
        }

        function getSectionName(questionId) {
            for (let section of sections) {
                if (section.questions.find(q => q.id === questionId)) {
                    return section.title;
                }
            }
            return '';
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            prevBtn.disabled = currentQuestionId === 1;
            nextBtn.disabled = currentQuestionId === 90;
        }

        function navigateQuestion(direction) {
            if (direction === 'prev' && currentQuestionId > 1) {
                loadQuestion(currentQuestionId - 1);
            } else if (direction === 'next' && currentQuestionId < 90) {
                loadQuestion(currentQuestionId + 1);
            }
        }

        function markQuestionAsCompleted(questionId) {
            completedQuestions.add(questionId);
            saveCompletedQuestions();
            updateProgress();
        }

        function updateProgress() {
            const total = 90;
            const completed = completedQuestions.size;
            const percentage = (completed / total) * 100;

            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${completed} / ${total} Questions`;
        }

        function saveCompletedQuestions() {
            localStorage.setItem('redisCompletedQuestions', JSON.stringify([...completedQuestions]));
        }

        function loadCompletedQuestions() {
            const saved = localStorage.getItem('redisCompletedQuestions');
            if (saved) {
                completedQuestions = new Set(JSON.parse(saved));
            }
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) return;
                
                switch(e.key) {
                    case 'ArrowLeft':
                        navigateQuestion('prev');
                        break;
                    case 'ArrowRight':
                        navigateQuestion('next');
                        break;
                }
            });
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const questionItems = document.querySelectorAll('.question-item');

            questionItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // ============================================================
        // QUESTION 3: What does Redis stand for?
        // ============================================================
        
        function getQuestion3Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>You're in a technical interview.</strong> The interviewer casually asks, "So, what does Redis stand for?" You might think, "That's easy!" But then they follow up with, "And why did they choose that name? What does it tell you about how Redis works?"</p>
                    <p>Suddenly, it's not just a trivia question - it's a chance to show you understand Redis at a deeper level. The name itself reveals the core philosophy and architecture of the system.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    <p><strong>Redis stands for: <span style="color: var(--primary-color); font-size: 20px;">REmote DIctionary Server</span></strong></p>
                    
                    <p>Let's break down what each word means:</p>
                    
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <p><strong>üåê Remote:</strong> Redis is a <em>network-accessible</em> service. It runs on a server and clients connect to it over TCP/IP. You can access it from any machine on the network, not just locally.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <p><strong>üìñ Dictionary:</strong> In programming, a dictionary (also called hash map or associative array) is a data structure that stores key-value pairs. Think of it like a real dictionary where you look up a word (key) to find its definition (value).</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <p><strong>üñ•Ô∏è Server:</strong> Redis runs as a server process that handles requests from multiple clients simultaneously. It's not a library you import - it's a standalone service.</p>
                    </div>

                    <p><strong>So Redis = A network-accessible key-value store that works like a dictionary.</strong> The name tells you exactly what it does!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagram</h2>
                    </div>
                    <div class="diagram-container">
                        <div class="diagram-title">Redis as a Remote Dictionary</div>
                        <svg viewBox="0 0 800 400" style="max-width: 100%; height: auto;">
                            <!-- Dictionary Metaphor -->
                            <rect x="300" y="50" width="200" height="300" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="3" rx="10"/>
                            <text x="400" y="80" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">üìñ Redis</text>
                            <text x="400" y="100" text-anchor="middle" fill="#888" font-size="12">(Remote Dictionary)</text>
                            
                            <!-- Key-Value Pairs Inside -->
                            <rect x="320" y="120" width="160" height="35" fill="rgba(255, 255, 255, 0.05)" stroke="#00FF88" stroke-width="1" rx="4"/>
                            <text x="330" y="140" fill="#00FF88" font-size="12">"user:1001" ‚Üí "Alice"</text>
                            
                            <rect x="320" y="165" width="160" height="35" fill="rgba(255, 255, 255, 0.05)" stroke="#00FF88" stroke-width="1" rx="4"/>
                            <text x="330" y="185" fill="#00FF88" font-size="12">"cart:5" ‚Üí {...}</text>
                            
                            <rect x="320" y="210" width="160" height="35" fill="rgba(255, 255, 255, 0.05)" stroke="#00FF88" stroke-width="1" rx="4"/>
                            <text x="330" y="230" fill="#00FF88" font-size="12">"session:xyz" ‚Üí {...}</text>

                            <rect x="320" y="255" width="160" height="35" fill="rgba(255, 255, 255, 0.05)" stroke="#00FF88" stroke-width="1" rx="4"/>
                            <text x="330" y="275" fill="#00FF88" font-size="12">"views:post:99" ‚Üí 15420</text>

                            <text x="400" y="315" text-anchor="middle" fill="#888" font-size="11">Key ‚Üí Value pairs</text>
                            <text x="400" y="330" text-anchor="middle" fill="#888" font-size="11">stored in memory</text>

                            <!-- Remote Clients -->
                            <rect x="50" y="100" width="120" height="60" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="110" y="125" text-anchor="middle" fill="#2196F3" font-size="13">üñ•Ô∏è Client 1</text>
                            <text x="110" y="145" text-anchor="middle" fill="#888" font-size="10">(Python App)</text>

                            <rect x="630" y="100" width="120" height="60" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="690" y="125" text-anchor="middle" fill="#2196F3" font-size="13">üì± Client 2</text>
                            <text x="690" y="145" text-anchor="middle" fill="#888" font-size="10">(Node.js API)</text>

                            <rect x="50" y="240" width="120" height="60" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="110" y="265" text-anchor="middle" fill="#2196F3" font-size="13">üåê Client 3</text>
                            <text x="110" y="285" text-anchor="middle" fill="#888" font-size="10">(Ruby on Rails)</text>

                            <!-- Network connections -->
                            <line x1="170" y1="130" x2="295" y2="150" stroke="#00FF88" stroke-width="2" stroke-dasharray="3,3">
                                <animate attributeName="stroke-dashoffset" from="0" to="6" dur="1s" repeatCount="indefinite"/>
                            </line>
                            <text x="230" y="135" fill="#00FF88" font-size="10">GET "user:1001"</text>

                            <line x1="630" y1="130" x2="505" y2="150" stroke="#FFA500" stroke-width="2" stroke-dasharray="3,3">
                                <animate attributeName="stroke-dashoffset" from="0" to="6" dur="1s" repeatCount="indefinite"/>
                            </line>
                            <text x="550" y="135" fill="#FFA500" font-size="10">SET "cart:5"</text>

                            <line x1="170" y1="270" x2="295" y2="250" stroke="#9C27B0" stroke-width="2" stroke-dasharray="3,3">
                                <animate attributeName="stroke-dashoffset" from="0" to="6" dur="1s" repeatCount="indefinite"/>
                            </line>
                            <text x="210" y="265" fill="#9C27B0" font-size="10">INCR "views:post:99"</text>

                            <text x="400" y="380" text-anchor="middle" fill="#888" font-size="11" font-style="italic">Multiple clients accessing the same dictionary over network</text>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    <p><strong>Redis behaves exactly like a dictionary/hash map:</strong></p>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python Dictionary vs Redis</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Python Dictionary (local, in-process)</span>
my_dict = {}
my_dict[<span class="string">"user:1001"</span>] = <span class="string">"Alice"</span>
<span class="keyword">print</span>(my_dict[<span class="string">"user:1001"</span>])  <span class="comment"># Output: Alice</span>

<span class="comment"># Redis (remote, network-accessible)</span>
<span class="keyword">import</span> redis
r = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>)
r.set(<span class="string">"user:1001"</span>, <span class="string">"Alice"</span>)
<span class="keyword">print</span>(r.get(<span class="string">"user:1001"</span>))  <span class="comment"># Output: Alice</span>

<span class="comment"># The API is almost identical - Redis is like a remote dictionary!</span></code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: Does the name relate to its working?</h4>
                        <p><strong>A:</strong> Absolutely! The name tells you: (1) It's <strong>remote</strong> - accessible over network, (2) It works like a <strong>dictionary</strong> - key-value storage, (3) It's a <strong>server</strong> - standalone process handling requests. The name is a perfect description of what Redis does.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Why call it a "dictionary" when it supports lists, sets, and other data structures?</h4>
                        <p><strong>A:</strong> The name refers to the <em>top-level structure</em>. Redis itself is a dictionary that maps keys to values. The <em>values</em> can be complex (lists, sets, hashes), but you still access them by key, just like a dictionary. Think of it as: Redis = {"key1": [list], "key2": {set}, "key3": {hash}}.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    <p><strong>Scenario:</strong> Multiple microservices need to share session data. A Python service creates a session, and a Node.js service needs to read it.</p>
                    <p><strong>Solution:</strong> Redis acts as the "remote dictionary" that all services can access. The "remote" part is crucial - any service on the network can read/write the same keys.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item">
                        <span class="takeaway-icon">‚úÖ</span>
                        <p><strong>Redis = REmote DIctionary Server</strong> - The name perfectly describes its architecture and functionality</p>
                    </div>
                    <div class="takeaway-item">
                        <span class="takeaway-icon">üåê</span>
                        <p><strong>Remote = Network accessible</strong> - Multiple clients can connect over TCP/IP from anywhere</p>
                    </div>
                    <div class="takeaway-item">
                        <span class="takeaway-icon">üìñ</span>
                        <p><strong>Dictionary = Key-value store</strong> - Works just like Python dict, JavaScript object, or Ruby hash</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">REmote DIctionary Server</span>
                        <span class="keyword-tag">Key-Value Store</span>
                        <span class="keyword-tag">Network Service</span>
                        <span class="keyword-tag">TCP/IP</span>
                        <span class="keyword-tag">Hash Map</span>
                        <span class="keyword-tag">Associative Array</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Practice Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Question:</strong> What does the "Remote" in Redis stand for?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) It's stored on remote disk storage</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) It's accessible over the network from remote clients</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) It's always deployed in remote data centers</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) It remotely backs up data to other servers</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>"Remote" means it's a network service that clients connect to over TCP/IP, not a local library.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================================
        // QUESTION 4: Is Redis in-memory or disk-based?
        // ============================================================
        
        function getQuestion4Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>You're presenting Redis to your team's CTO.</strong> She asks, "If Redis stores everything in memory, what happens during a server reboot? Won't we lose all our customer data?"</p>
                    <p>Your colleague jumps in: "But I heard Redis can write to disk too. So is it really an in-memory database?" The CTO looks confused: "So which is it - memory or disk?"</p>
                    <p>This is where many people get confused. The answer reveals one of Redis's most clever design decisions.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    <p><strong>Redis is primarily IN-MEMORY, but can optionally persist to disk.</strong></p>
                    
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color);">üß† Primary Storage: RAM (Memory)</h4>
                        <p>Redis stores ALL data in RAM (Random Access Memory) for blazing-fast access. Every key-value pair lives in memory, which is why Redis can serve millions of operations per second. This is non-negotiable - Redis always works from memory.</p>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3;">üíæ Optional Backup: Disk</h4>
                        <p>Redis <em>can</em> periodically save snapshots to disk (RDB files) or log every write operation (AOF files). But here's the key: <strong>Redis NEVER reads from disk during normal operations.</strong> Disk is only used for:</p>
                        <ul style="margin-top: 10px;">
                            <li>Backing up data</li>
                            <li>Restoring data after a restart</li>
                            <li>Replicating to other Redis instances</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Active data always lives in RAM, not on disk.</strong></p>
                    </div>

                    <p><strong>Think of it like this:</strong> You work from notes on your desk (RAM - fast access). Occasionally, you photocopy your notes and file them in a cabinet (disk - backup). If your desk gets cleared (server restart), you restore from the cabinet. But you ALWAYS work from your desk, not the filing cabinet.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    <div class="diagram-container">
                        <div class="diagram-title">Redis Memory Architecture</div>
                        <svg viewBox="0 0 800 450" style="max-width: 100%; height: auto;">
                            <!-- RAM (Primary) -->
                            <rect x="250" y="50" width="300" height="180" fill="rgba(220, 20, 60, 0.3)" stroke="#DC143C" stroke-width="4" rx="10">
                                <animate attributeName="opacity" values="0.6;1;0.6" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="400" y="85" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">‚ö° RAM (Memory)</text>
                            <text x="400" y="105" text-anchor="middle" fill="#fff" font-size="13">PRIMARY STORAGE</text>
                            <text x="400" y="125" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">ALL active data here!</text>
                            
                            <!-- Keys in RAM -->
                            <text x="280" y="155" fill="#fff" font-size="11">‚Ä¢ user:1001 ‚Üí "Alice"</text>
                            <text x="280" y="175" fill="#fff" font-size="11">‚Ä¢ cart:5 ‚Üí {...}</text>
                            <text x="280" y="195" fill="#fff" font-size="11">‚Ä¢ session:xyz ‚Üí {...}</text>
                            <text x="280" y="215" fill="#fff" font-size="11">‚Ä¢ 1M+ more keys...</text>

                            <text x="400" y="250" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">‚ö° Sub-millisecond access</text>

                            <!-- Disk (Optional Backup) -->
                            <rect x="250" y="290" width="300" height="130" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5" rx="10"/>
                            <text x="400" y="320" text-anchor="middle" fill="#9C27B0" font-size="18" font-weight="600">üíæ Disk Storage</text>
                            <text x="400" y="340" text-anchor="middle" fill="#888" font-size="12">OPTIONAL BACKUP</text>
                            
                            <text x="280" y="365" fill="#888" font-size="11">üìÑ dump.rdb (snapshot)</text>
                            <text x="280" y="385" fill="#888" font-size="11">üìÑ appendonly.aof (log)</text>
                            <text x="280" y="405" fill="#FFA500" font-size="11">‚ö†Ô∏è Used only for recovery</text>

                            <!-- Arrow showing backup flow -->
                            <line x1="400" y1="230" x2="400" y2="285" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowPurple2)">
                                <animate attributeName="stroke-dashoffset" from="0" to="10" dur="2s" repeatCount="indefinite"/>
                            </line>
                            <text x="420" y="260" fill="#9C27B0" font-size="11">Periodic</text>
                            <text x="420" y="273" fill="#9C27B0" font-size="11">backup</text>

                            <!-- Client -->
                            <rect x="50" y="140" width="130" height="70" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="115" y="168" text-anchor="middle" fill="#2196F3" font-size="14" font-weight="600">Client</text>
                            <text x="115" y="188" text-anchor="middle" fill="#888" font-size="11">Application</text>

                            <!-- Fast path to RAM -->
                            <line x1="180" y1="175" x2="245" y2="140" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen3)"/>
                            <text x="205" y="150" fill="#00FF88" font-size="12" font-weight="600">Fast!</text>
                            <text x="202" y="164" fill="#00FF88" font-size="10">~0.1ms</text>

                            <!-- No direct access to disk -->
                            <line x1="180" y1="195" x2="245" y2="350" stroke="#ff0000" stroke-width="2" stroke-dasharray="3,3"/>
                            <text x="195" y="280" fill="#ff0000" font-size="11" font-weight="600">‚úó Never!</text>
                            <text x="188" y="293" fill="#ff0000" font-size="9">No direct reads</text>

                            <!-- Markers -->
                            <defs>
                                <marker id="arrowPurple2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                                </marker>
                                <marker id="arrowGreen3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                                </marker>
                            </defs>

                            <text x="400" y="445" text-anchor="middle" fill="#888" font-size="11" font-style="italic">Redis always serves from RAM, optionally backs up to disk</text>
                        </svg>
                    </div>
                    <p><strong>Key points from diagram:</strong></p>
                    <ul>
                        <li>Clients ALWAYS read/write from RAM - never from disk</li>
                        <li>Disk is only for backup and recovery</li>
                        <li>All active data must fit in available RAM</li>
                    </ul>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis Configuration - Disk Persistence</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Enable RDB snapshots (save RAM to disk)</span>
<span class="keyword">save</span> <span class="number">900 1</span>     <span class="comment"># After 15 min if ‚â•1 key changed</span>
<span class="keyword">save</span> <span class="number">300 10</span>    <span class="comment"># After 5 min if ‚â•10 keys changed</span>

<span class="comment"># Enable AOF (Append-Only File)</span>
<span class="keyword">appendonly</span> yes
<span class="keyword">appendfsync</span> everysec  <span class="comment"># Sync to disk every second</span>

<span class="comment"># BUT: All reads/writes still happen in RAM!</span>
<span class="comment"># Disk is ONLY for backup/recovery</span></code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: Does Redis ever write data to disk?</h4>
                        <p><strong>A:</strong> Yes, if persistence is enabled! Redis can write snapshots (RDB) or logs (AOF) to disk. But this is for BACKUP only - Redis never reads from disk during normal operation. It's memory-first, disk-backup-optional.</p>
                    </div>
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: What happens to data if Redis restarts?</h4>
                        <p><strong>A:</strong> If persistence is DISABLED: All data is lost. If persistence is ENABLED: Redis loads data from disk back into RAM on startup, then continues serving from RAM. The restore might take a few seconds for large datasets.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• If disk is slower, why not just keep everything in memory without disk backup?</h4>
                        <p><strong>A:</strong> Many companies do exactly that for pure caching! But if Redis crashes, you lose everything. For critical data (sessions, counters), you need persistence. The trade-off: slight performance hit for safety. Choose based on whether your data is (1) expendable cache or (2) critical database.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    <p><strong>Scenario:</strong> A news site caches article HTML in Redis. The server crashes at 2am.</p>
                    <p><strong>With persistence OFF:</strong> Cache is empty after restart. First users after crash see slow page loads while cache rebuilds. But server recovers in seconds.</p>
                    <p><strong>With persistence ON:</strong> Cache instantly restored from disk. No cold start. But crash might lose last ~1 second of cached articles.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item">
                        <span class="takeaway-icon">‚úÖ</span>
                        <p><strong>Redis is IN-MEMORY first</strong> - All active data lives in RAM for speed</p>
                    </div>
                    <div class="takeaway-item">
                        <span class="takeaway-icon">üíæ</span>
                        <p><strong>Disk is optional backup</strong> - Used only for persistence/recovery, not serving requests</p>
                    </div>
                    <div class="takeaway-item">
                        <span class="takeaway-icon">‚ö°</span>
                        <p><strong>Never reads from disk</strong> - During operation, Redis ONLY accesses RAM</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">In-Memory</span>
                        <span class="keyword-tag">RAM Storage</span>
                        <span class="keyword-tag">Disk Persistence</span>
                        <span class="keyword-tag">RDB Snapshot</span>
                        <span class="keyword-tag">AOF Log</span>
                        <span class="keyword-tag">Volatile Memory</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Practice Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Question:</strong> During normal operations, where does Redis serve data from?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) Disk (for durability)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) RAM (memory)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Both RAM and disk equally</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) SSD cache</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>Redis ALWAYS serves from RAM. Disk is only for backup/recovery, never for serving requests.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // ============================================================
        // QUESTIONS 5-10: Completing Section 1 Basics
        // ============================================================

        function getQuestion5Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>Picture this: You're the lead engineer at a rapidly growing social media startup.</strong> Your app just went viral - you now have 50,000 concurrent users instead of your usual 5,000. Users are complaining that their feeds are taking 5-10 seconds to load. Your CEO is panicking: "If we don't fix this today, we'll lose all our new users!"</p>
                    
                    <p>Your database team reports: "Our MySQL server is maxed out at 100% CPU. We're handling 50,000 queries per second, but response time has degraded from 50ms to 3 seconds per query. We need to buy bigger servers - that's a $50,000/month expense!"</p>
                    
                    <p>Your colleague suggests: "What if we add Redis? I heard it's really fast." Your CTO asks the critical question: <strong>"How fast is Redis, really? Fast enough to justify adding another technology to our stack? And WHY is it so much faster than our database?"</strong></p>
                    
                    <p>This is the moment where understanding Redis's speed becomes business-critical. Let's break down exactly why Redis can handle your traffic spike without breaking a sweat.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>Redis is blazingly fast - and I mean REALLY fast.</strong> We're talking about:</p>
                    <ul>
                        <li><strong>100,000 to 500,000 operations per second</strong> on a single instance</li>
                        <li><strong>Sub-millisecond response times</strong> (typically 0.1ms to 1ms)</li>
                        <li><strong>50-200x faster than disk-based databases</strong> for read-heavy workloads</li>
                    </ul>

                    <p><strong>But speed isn't magic - it comes from 5 key architectural decisions:</strong></p>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">üß† Reason 1: In-Memory Operations (80% of the speed advantage)</h4>
                        <p><strong>The Physics of Speed:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li><strong>RAM access time:</strong> ~100 nanoseconds (0.0001 milliseconds)</li>
                            <li><strong>SSD access time:</strong> ~0.1 milliseconds (1,000x slower than RAM)</li>
                            <li><strong>HDD access time:</strong> ~10 milliseconds (100,000x slower than RAM)</li>
                        </ul>
                        <p style="margin-top: 10px;">When you read from Redis, the CPU grabs data directly from RAM. When you read from MySQL, the CPU has to: (1) seek on disk, (2) read blocks, (3) load into memory, (4) return data. That's the difference!</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">‚ö° Reason 2: Single-Threaded Architecture (15% of the advantage)</h4>
                        <p><strong>Wait, single-threaded is FASTER?</strong> Yes! Here's why:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>No lock contention:</strong> Multi-threaded databases spend CPU cycles managing locks</li>
                            <li><strong>No context switching:</strong> Switching between threads wastes precious CPU time</li>
                            <li><strong>No race conditions:</strong> Simple, predictable execution model</li>
                            <li><strong>CPU cache efficiency:</strong> Same thread keeps data in L1/L2 cache</li>
                        </ul>
                        <p style="margin-top: 10px;">Think of it like a single super-fast cashier vs. 10 slow cashiers fighting over the same cash register. The single cashier wins!</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">üéØ Reason 3: Simple Data Model (3% of the advantage)</h4>
                        <p><strong>No SQL parsing overhead:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Redis:</strong> <code>GET user:1001</code> - Direct hash table lookup, O(1) complexity</li>
                            <li><strong>MySQL:</strong> <code>SELECT * FROM users WHERE id = 1001</code> - Parse SQL ‚Üí Optimize ‚Üí Execute plan ‚Üí Return</li>
                        </ul>
                        <p style="margin-top: 10px;">No JOINs, no subqueries, no query optimization. Just: key ‚Üí value. Done.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">üîß Reason 4: Optimized Data Structures (1.5% of the advantage)</h4>
                        <p>Redis's data structures are written in highly optimized C code:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Linked lists:</strong> Hand-optimized for prepend/append operations</li>
                            <li><strong>Skip lists:</strong> Custom implementation for sorted sets</li>
                            <li><strong>Hash tables:</strong> Incremental rehashing to avoid blocking</li>
                        </ul>
                        <p style="margin-top: 10px;">Years of performance tuning in every data structure.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">üåê Reason 5: I/O Multiplexing (0.5% of the advantage)</h4>
                        <p>Redis uses <strong>epoll</strong> (Linux) or <strong>kqueue</strong> (BSD/macOS) for efficient I/O:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Single thread handles thousands of connections</strong> without creating threads</li>
                            <li><strong>Event-driven architecture</strong> - process requests as they arrive</li>
                            <li><strong>Non-blocking I/O</strong> - never waits on network operations</li>
                        </ul>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>‚ÑπÔ∏è The Bottom Line:</strong> Redis is fast because it eliminates almost every source of latency that plagues traditional databases. It's not one trick - it's a perfect storm of architectural decisions working together.
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">Speed Comparison: Redis vs MySQL Query Path</div>
                        <svg viewBox="0 0 900 600" style="max-width: 100%; height: auto;">
                            <!-- Title -->
                            <text x="450" y="30" text-anchor="middle" fill="#fff" font-size="18" font-weight="700">Same Query, Different Performance</text>
                            
                            <!-- LEFT: Redis Fast Path -->
                            <text x="220" y="65" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">‚ö° REDIS: 0.1ms</text>
                            
                            <!-- Client Request -->
                            <rect x="145" y="90" width="150" height="50" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="220" y="110" text-anchor="middle" fill="#2196F3" font-size="12">Client Request</text>
                            <text x="220" y="126" text-anchor="middle" fill="#888" font-size="10">GET user:1001</text>

                            <!-- Step 1: Network -->
                            <rect x="145" y="160" width="150" height="40" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="1" rx="4"/>
                            <text x="220" y="178" text-anchor="middle" fill="#FFA500" font-size="11">1. Network (0.01ms)</text>
                            <line x1="220" y1="140" x2="220" y2="155" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowBlue2)"/>

                            <!-- Step 2: Hash Lookup -->
                            <rect x="145" y="220" width="150" height="50" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="2" rx="6">
                                <animate attributeName="opacity" values="0.5;1;0.5" dur="0.5s" repeatCount="indefinite"/>
                            </rect>
                            <text x="220" y="238" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">2. RAM Lookup</text>
                            <text x="220" y="253" text-anchor="middle" fill="#00FF88" font-size="10">(0.0001ms)</text>
                            <line x1="220" y1="200" x2="220" y2="215" stroke="#FFA500" stroke-width="2" marker-end="url(#arrowOrange2)"/>

                            <!-- Step 3: Return -->
                            <rect x="145" y="290" width="150" height="40" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="1" rx="4"/>
                            <text x="220" y="308" text-anchor="middle" fill="#FFA500" font-size="11">3. Return (0.01ms)</text>
                            <line x1="220" y1="270" x2="220" y2="285" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen4)"/>

                            <!-- Total Time Redis -->
                            <rect x="145" y="350" width="150" height="50" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="3" rx="6"/>
                            <text x="220" y="372" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="700">‚úÖ Total: 0.1ms</text>
                            <text x="220" y="388" text-anchor="middle" fill="#888" font-size="10">Lightning fast!</text>

                            <!-- Divider -->
                            <line x1="450" y1="50" x2="450" y2="580" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>

                            <!-- RIGHT: MySQL Slow Path -->
                            <text x="680" y="65" text-anchor="middle" fill="#FFA500" font-size="16" font-weight="600">üê¢ MySQL: 50ms</text>
                            
                            <!-- Client Request -->
                            <rect x="605" y="90" width="150" height="50" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="680" y="110" text-anchor="middle" fill="#2196F3" font-size="12">Client Request</text>
                            <text x="680" y="126" text-anchor="middle" fill="#888" font-size="10">SELECT * FROM users...</text>

                            <!-- Step 1: Network -->
                            <rect x="605" y="160" width="150" height="30" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="1" rx="4"/>
                            <text x="680" y="178" text-anchor="middle" fill="#FFA500" font-size="10">1. Network (0.5ms)</text>
                            <line x1="680" y1="140" x2="680" y2="155" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowBlue2)"/>

                            <!-- Step 2: Parse SQL -->
                            <rect x="605" y="205" width="150" height="30" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="1" rx="4"/>
                            <text x="680" y="223" text-anchor="middle" fill="#9C27B0" font-size="10">2. Parse SQL (5ms)</text>
                            <line x1="680" y1="190" x2="680" y2="200" stroke="#FFA500" stroke-width="2" marker-end="url(#arrowOrange2)"/>

                            <!-- Step 3: Query Plan -->
                            <rect x="605" y="250" width="150" height="30" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="1" rx="4"/>
                            <text x="680" y="268" text-anchor="middle" fill="#9C27B0" font-size="10">3. Optimize (5ms)</text>
                            <line x1="680" y1="235" x2="680" y2="245" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple3)"/>

                            <!-- Step 4: Disk Seek -->
                            <rect x="605" y="295" width="150" height="35" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="2" rx="4">
                                <animate attributeName="opacity" values="0.3;0.6;0.3" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="680" y="310" text-anchor="middle" fill="#ff0000" font-size="10" font-weight="600">4. Disk Seek</text>
                            <text x="680" y="323" text-anchor="middle" fill="#ff0000" font-size="9">(30ms - SLOW!)</text>
                            <line x1="680" y1="280" x2="680" y2="290" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple3)"/>

                            <!-- Step 5: Read Data -->
                            <rect x="605" y="345" width="150" height="30" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="1" rx="4"/>
                            <text x="680" y="363" text-anchor="middle" fill="#ff0000" font-size="10">5. Read Disk (5ms)</text>
                            <line x1="680" y1="330" x2="680" y2="340" stroke="#ff0000" stroke-width="2"/>

                            <!-- Step 6: Process -->
                            <rect x="605" y="390" width="150" height="30" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="1" rx="4"/>
                            <text x="680" y="408" text-anchor="middle" fill="#9C27B0" font-size="10">6. Process (3ms)</text>
                            <line x1="680" y1="375" x2="680" y2="385" stroke="#ff0000" stroke-width="2" marker-end="url(#arrowPurple3)"/>

                            <!-- Step 7: Return -->
                            <rect x="605" y="435" width="150" height="30" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="1" rx="4"/>
                            <text x="680" y="453" text-anchor="middle" fill="#FFA500" font-size="10">7. Return (1.5ms)</text>
                            <line x1="680" y1="420" x2="680" y2="430" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowOrange2)"/>

                            <!-- Total Time MySQL -->
                            <rect x="605" y="485" width="150" height="50" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="3" rx="6"/>
                            <text x="680" y="507" text-anchor="middle" fill="#ff0000" font-size="14" font-weight="700">‚ö†Ô∏è Total: 50ms</text>
                            <text x="680" y="523" text-anchor="middle" fill="#888" font-size="10">500x slower!</text>

                            <!-- Bottom Comparison -->
                            <text x="450" y="570" text-anchor="middle" fill="#888" font-size="12" font-style="italic">Disk I/O is the killer - that's why Redis avoids it entirely</text>

                            <!-- Arrow Markers -->
                            <defs>
                                <marker id="arrowBlue2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#2196F3" />
                                </marker>
                                <marker id="arrowOrange2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#FFA500" />
                                </marker>
                                <marker id="arrowGreen4" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                                </marker>
                                <marker id="arrowPurple3" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                                </marker>
                            </defs>
                        </svg>
                    </div>

                    <p><strong>Understanding the diagram:</strong></p>
                    <ul>
                        <li><strong>Redis (Left):</strong> 3 simple steps, mostly network overhead. RAM lookup is near-instant (0.0001ms).</li>
                        <li><strong>MySQL (Right):</strong> 7 complex steps. Disk seek alone (30ms) takes 300,000x longer than Redis's RAM lookup!</li>
                        <li><strong>The Bottleneck:</strong> Physical disk I/O is the killer. Even SSDs can't compete with RAM.</li>
                        <li><strong>Result:</strong> Redis serves the same data 500x faster by staying in memory.</li>
                    </ul>

                    <div class="diagram-container" style="margin-top: 40px;">
                        <div class="diagram-title">Performance Comparison: Requests Per Second</div>
                        <svg viewBox="0 0 800 350" style="max-width: 100%; height: auto;">
                            <text x="400" y="30" text-anchor="middle" fill="#fff" font-size="16" font-weight="600">Operations Per Second (Same Hardware)</text>
                            
                            <!-- Redis Bar -->
                            <rect x="100" y="80" width="600" height="60" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="3" rx="6">
                                <animate attributeName="width" from="0" to="600" dur="2s" fill="freeze"/>
                            </rect>
                            <text x="110" y="108" fill="#00FF88" font-size="14" font-weight="700">‚ö° Redis</text>
                            <text x="110" y="128" fill="#fff" font-size="12">100,000 ops/second</text>
                            <text x="710" y="115" fill="#00FF88" font-size="16" font-weight="700">100K</text>

                            <!-- MySQL Bar -->
                            <rect x="100" y="170" width="12" height="60" fill="rgba(255, 165, 0, 0.3)" stroke="#FFA500" stroke-width="2" rx="6">
                                <animate attributeName="width" from="0" to="12" dur="2s" fill="freeze"/>
                            </rect>
                            <text x="120" y="198" fill="#FFA500" font-size="14" font-weight="600">üê¢ MySQL</text>
                            <text x="120" y="218" fill="#888" font-size="12">2,000 ops/second</text>
                            <text x="20" y="205" fill="#FFA500" font-size="14" font-weight="600">2K</text>

                            <!-- Comparison Text -->
                            <rect x="200" y="260" width="400" height="70" fill="rgba(220, 20, 60, 0.1)" stroke="var(--primary-color)" stroke-width="2" rx="8"/>
                            <text x="400" y="285" text-anchor="middle" fill="var(--primary-color)" font-size="14" font-weight="700">Redis is 50x faster!</text>
                            <text x="400" y="305" text-anchor="middle" fill="#fff" font-size="12">Same query, same server,</text>
                            <text x="400" y="320" text-anchor="middle" fill="#888" font-size="11">just different storage layer</text>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <p><strong>Let's benchmark Redis vs MySQL with real code:</strong></p>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Running Redis Benchmark</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Terminal - Redis Benchmark</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Run Redis benchmark (comes with Redis installation)</span>
<span class="keyword">redis-benchmark</span> <span class="string">-q</span> <span class="string">-n</span> <span class="number">100000</span>

<span class="comment"># Results on modest hardware:</span>
PING_INLINE: <span class="number">85034.02</span> requests per second
PING_MBULK: <span class="number">89285.71</span> requests per second
<span class="keyword">SET</span>: <span class="number">82644.63</span> requests per second
<span class="keyword">GET</span>: <span class="number">89285.71</span> requests per second
<span class="keyword">INCR</span>: <span class="number">88495.58</span> requests per second
<span class="keyword">LPUSH</span>: <span class="number">86956.52</span> requests per second
<span class="keyword">RPUSH</span>: <span class="number">87719.30</span> requests per second
<span class="keyword">LPOP</span>: <span class="number">88495.58</span> requests per second
<span class="keyword">RPOP</span>: <span class="number">86206.90</span> requests per second

<span class="comment"># That's 80,000+ operations per second per operation type!</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Speed Comparison in Python</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Performance Test</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> mysql.connector
<span class="keyword">import</span> time

<span class="comment"># Setup connections</span>
redis_client = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>)
mysql_conn = mysql.connector.connect(
    host=<span class="string">"localhost"</span>,
    user=<span class="string">"root"</span>,
    password=<span class="string">"password"</span>,
    database=<span class="string">"testdb"</span>
)

<span class="comment"># Test Redis Speed</span>
<span class="keyword">def</span> <span class="function">test_redis_speed</span>():
    iterations = <span class="number">10000</span>
    start = time.time()
    
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(iterations):
        redis_client.set(<span class="string">f"user:</span>{i}<span class="string">"</span>, <span class="string">f"data_</span>{i}<span class="string">"</span>)
        redis_client.get(<span class="string">f"user:</span>{i}<span class="string">"</span>)
    
    elapsed = time.time() - start
    <span class="keyword">print</span>(<span class="string">f"Redis: </span>{iterations}<span class="string"> ops in </span>{elapsed:.2f}<span class="string">s"</span>)
    <span class="keyword">print</span>(<span class="string">f"Redis: </span>{iterations/elapsed:.0f}<span class="string"> ops/second"</span>)
    <span class="keyword">print</span>(<span class="string">f"Redis: </span>{(elapsed/iterations)*1000:.2f}<span class="string">ms per operation"</span>)

<span class="comment"># Test MySQL Speed</span>
<span class="keyword">def</span> <span class="function">test_mysql_speed</span>():
    cursor = mysql_conn.cursor()
    iterations = <span class="number">10000</span>
    start = time.time()
    
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(iterations):
        cursor.execute(
            <span class="string">"INSERT INTO users (id, data) VALUES (%s, %s) ON DUPLICATE KEY UPDATE data = %s"</span>,
            (i, <span class="string">f"data_</span>{i}<span class="string">"</span>, <span class="string">f"data_</span>{i}<span class="string">"</span>)
        )
        cursor.execute(<span class="string">"SELECT data FROM users WHERE id = %s"</span>, (i,))
        cursor.fetchone()
    
    mysql_conn.commit()
    elapsed = time.time() - start
    <span class="keyword">print</span>(<span class="string">f"</span>\\n<span class="string">MySQL: </span>{iterations}<span class="string"> ops in </span>{elapsed:.2f}<span class="string">s"</span>)
    <span class="keyword">print</span>(<span class="string">f"MySQL: </span>{iterations/elapsed:.0f}<span class="string"> ops/second"</span>)
    <span class="keyword">print</span>(<span class="string">f"MySQL: </span>{(elapsed/iterations)*1000:.2f}<span class="string">ms per operation"</span>)

<span class="comment"># Run tests</span>
<span class="keyword">print</span>(<span class="string">"=== SPEED TEST ==="</span>)
test_redis_speed()
test_mysql_speed()

<span class="comment"># Sample Output:</span>
<span class="comment"># Redis: 10000 ops in 1.23s</span>
<span class="comment"># Redis: 8130 ops/second</span>
<span class="comment"># Redis: 0.12ms per operation</span>
<span class="comment">#</span>
<span class="comment"># MySQL: 10000 ops in 125.47s</span>
<span class="comment"># MySQL: 80 ops/second</span>
<span class="comment"># MySQL: 12.55ms per operation</span>
<span class="comment">#</span>
<span class="comment"># Redis is 100x faster in this test!</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Real-World Performance Impact</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - E-commerce Product Page</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> time
<span class="keyword">import</span> redis
<span class="keyword">import</span> json

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Product page requires 5 different data queries</span>
<span class="keyword">def</span> <span class="function">load_product_page_mysql</span>(product_id):
    <span class="string">"""Simulating MySQL queries"""</span>
    start = time.time()
    
    <span class="comment"># 1. Product details (50ms)</span>
    time.sleep(<span class="number">0.05</span>)
    product = {<span class="string">"name"</span>: <span class="string">"Laptop"</span>, <span class="string">"price"</span>: <span class="number">999</span>}
    
    <span class="comment"># 2. Reviews (60ms)</span>
    time.sleep(<span class="number">0.06</span>)
    reviews = [<span class="string">"Great!"</span>, <span class="string">"Amazing!"</span>]
    
    <span class="comment"># 3. Inventory check (40ms)</span>
    time.sleep(<span class="number">0.04</span>)
    inventory = {<span class="string">"stock"</span>: <span class="number">15</span>}
    
    <span class="comment"># 4. Recommendations (70ms)</span>
    time.sleep(<span class="number">0.07</span>)
    recommendations = [<span class="string">"mouse"</span>, <span class="string">"keyboard"</span>]
    
    <span class="comment"># 5. Pricing/discounts (30ms)</span>
    time.sleep(<span class="number">0.03</span>)
    discounts = {<span class="string">"active"</span>: <span class="keyword">True</span>, <span class="string">"percent"</span>: <span class="number">10</span>}
    
    elapsed = (time.time() - start) * <span class="number">1000</span>
    <span class="keyword">return</span> elapsed

<span class="keyword">def</span> <span class="function">load_product_page_redis</span>(product_id):
    <span class="string">"""Using Redis cache"""</span>
    start = time.time()
    
    <span class="comment"># All data from Redis - each takes ~0.1ms</span>
    product = json.loads(r.get(<span class="string">f"product:</span>{product_id}<span class="string">"</span>) <span class="keyword">or</span> <span class="string">"{}"</span>)
    reviews = json.loads(r.get(<span class="string">f"reviews:</span>{product_id}<span class="string">"</span>) <span class="keyword">or</span> <span class="string">"[]"</span>)
    inventory = json.loads(r.get(<span class="string">f"inventory:</span>{product_id}<span class="string">"</span>) <span class="keyword">or</span> <span class="string">"{}"</span>)
    recommendations = json.loads(r.get(<span class="string">f"recommendations:</span>{product_id}<span class="string">"</span>) <span class="keyword">or</span> <span class="string">"[]"</span>)
    discounts = json.loads(r.get(<span class="string">f"discounts:</span>{product_id}<span class="string">"</span>) <span class="keyword">or</span> <span class="string">"{}"</span>)
    
    elapsed = (time.time() - start) * <span class="number">1000</span>
    <span class="keyword">return</span> elapsed

<span class="comment"># Compare performance</span>
<span class="keyword">print</span>(<span class="string">"=== PRODUCT PAGE LOAD TIME ==="</span>)
mysql_time = load_product_page_mysql(<span class="number">12345</span>)
redis_time = load_product_page_redis(<span class="number">12345</span>)

<span class="keyword">print</span>(<span class="string">f"MySQL: </span>{mysql_time:.1f}<span class="string">ms"</span>)
<span class="keyword">print</span>(<span class="string">f"Redis: </span>{redis_time:.1f}<span class="string">ms"</span>)
<span class="keyword">print</span>(<span class="string">f"</span>\\n<span class="string">Redis is </span>{mysql_time/redis_time:.0f}<span class="string">x FASTER!"</span>)
<span class="keyword">print</span>(<span class="string">f"User sees page </span>{mysql_time - redis_time:.0f}<span class="string">ms sooner with Redis"</span>)

<span class="comment"># Output:</span>
<span class="comment"># MySQL: 250.0ms</span>
<span class="comment"># Redis: 0.5ms</span>
<span class="comment"># Redis is 500x FASTER!</span>
<span class="comment"># User sees page 249ms sooner with Redis</span></code></pre>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>‚úÖ Real Impact:</strong> For a page requiring 5 database queries, Redis reduces load time from 250ms to 0.5ms. That's the difference between a snappy app and a frustrating one!
                    </div>
                </div>

                ${getQuestion5RemainingSections()}
            `;
        }

        function getQuestion5RemainingSections() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions (Follow-ups)</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Is speed only because it is in-memory?</h4>
                        <p><strong>A:</strong> No! In-memory is 80% of the advantage, but single-threaded design (15%), simple data model (3%), optimized C code (1.5%), and I/O multiplexing (0.5%) all contribute. Even in-memory databases with multi-threading are slower than Redis because of lock contention and context switching overhead.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Does Redis use multithreading?</h4>
                        <p><strong>A:</strong> Data operations are single-threaded. However, Redis 6.0+ uses background threads for: (1) Lazy deletion of large keys, (2) Disk I/O for persistence, (3) Closing slow client connections. But the main event loop handling GET/SET commands remains single-threaded for maximum speed.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: How many operations per second can Redis handle in practice?</h4>
                        <p><strong>A:</strong> On modest hardware: 80K-100K ops/sec. On production servers with SSDs and good CPUs: 200K-500K ops/sec for simple operations. With pipelining: 1M+ ops/sec. With Redis Cluster (sharding): 10M+ ops/sec across multiple nodes.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: What makes Redis faster than Memcached?</h4>
                        <p><strong>A:</strong> Both are in-memory and fast, but Redis is typically 10-20% faster for simple operations due to: (1) Better-optimized C code, (2) More efficient memory allocator, (3) Smarter I/O multiplexing. However, Memcached is simpler and uses less memory per key. The difference is small - choose based on features, not speed.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Can Redis be slower than a database in any scenario?</h4>
                        <p><strong>A:</strong> Yes! For: (1) <strong>Complex aggregations</strong> (SUM, AVG across millions of rows) - databases have optimized engines, (2) <strong>Large range queries</strong> scanning millions of keys, (3) <strong>Cold start</strong> - first load from disk after restart. Redis excels at: point lookups, simple operations, and hot data access.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q6: Does network latency affect Redis performance?</h4>
                        <p><strong>A:</strong> Absolutely! Redis itself is sub-millisecond, but network adds: (1) LAN: ~0.1-1ms, (2) Same region cloud: ~1-5ms, (3) Cross-region: ~50-200ms. Solution: Place Redis close to your application servers. Use Redis Cluster for geo-distribution.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions (Advanced)</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: If single-threaded is so fast, why don't databases like MySQL or PostgreSQL go single-threaded?</h4>
                        <p><strong>Answer:</strong> Because databases handle COMPLEX operations that benefit from parallelism:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Multi-table JOINs:</strong> Can process different tables in parallel</li>
                            <li><strong>Complex aggregations:</strong> Can distribute SUM/AVG calculations</li>
                            <li><strong>Multiple concurrent transactions:</strong> Need isolation and parallelism</li>
                            <li><strong>Index building:</strong> Benefits massively from multiple cores</li>
                        </ul>
                        <p style="margin-top: 10px;">Redis operations are SIMPLE (get key, set key, increment counter). For simple operations, single-threaded is faster because you avoid all the overhead of coordination. For complex operations, multi-threaded wins.</p>
                        <p><em>Pro tip: Use the right tool for the job - Redis for simple fast operations, databases for complex queries.</em></p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: With Redis being so fast, why isn't everything built on Redis instead of traditional databases?</h4>
                        <p><strong>Answer:</strong> Three fundamental constraints:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>1. Data Size:</strong> Your data must fit in RAM. A 1TB dataset in Redis would cost $10,000/month in RAM vs $100/month on disk.</li>
                            <li><strong>2. Query Complexity:</strong> Redis can't do: JOINs, complex WHERE clauses, GROUP BY, aggregations. No SQL = limited querying.</li>
                            <li><strong>3. Durability:</strong> Even with persistence, Redis can lose seconds of data on crash. Banks can't accept that for transactions.</li>
                        </ul>
                        <p style="margin-top: 10px;">The winning strategy: Store COLD data (rarely accessed, bulk storage) in traditional databases, HOT data (frequently accessed, need speed) in Redis. This gives 80% of the speed benefit at 20% of the cost.</p>
                        <p><em>Pro tip: The 80/20 rule - 20% of your data gets 80% of traffic. Cache that 20% in Redis!</em></p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: What happens to Redis performance under extremely high concurrency (100K+ concurrent connections)?</h4>
                        <p><strong>Answer:</strong> Redis handles it surprisingly well due to I/O multiplexing, but there ARE limits:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Memory per connection:</strong> Each connection uses ~20KB of buffers. 100K connections = 2GB just for connections!</li>
                            <li><strong>File descriptor limits:</strong> OS limits on open connections (default often 10K, can be increased)</li>
                            <li><strong>Slow clients:</strong> One slow client can block others if it's not reading responses fast enough</li>
                            <li><strong>CPU saturation:</strong> Eventually the single thread maxes out one CPU core</li>
                        </ul>
                        <p style="margin-top: 10px;">Solution for massive scale: <strong>Redis Cluster</strong> - shard data across multiple Redis instances, each handling 10K-20K connections. This gives you 100K+ total connections with linear scalability.</p>
                        <p><em>Pro tip: Monitor client count and set maxclients to prevent resource exhaustion.</em></p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can a single slow Redis command block all other operations? What commands are dangerous?</h4>
                        <p><strong>Answer:</strong> YES! Since Redis is single-threaded, one slow command blocks everything. Dangerous commands:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>KEYS * :</strong> Scans ALL keys - blocks for seconds on millions of keys (use SCAN instead)</li>
                            <li><strong>FLUSHALL:</strong> Deletes everything - can take seconds (use FLUSHALL ASYNC in Redis 4.0+)</li>
                            <li><strong>Large SORT:</strong> Sorting millions of items blocks the server</li>
                            <li><strong>SUNIONSTORE on huge sets:</strong> Computing union of million-item sets takes time</li>
                        </ul>
                        <p style="margin-top: 10px;">Real production disaster story: A developer ran <code>KEYS user:*</code> in production with 10M keys. Redis blocked for 8 seconds. Every other request queued up. Site went down. Always use <code>SCAN</code> for iteration, never <code>KEYS *</code>.</p>
                        <p><em>Pro tip: Use redis-cli --bigkeys to find large keys that might cause slow operations.</em></p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenarios</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 20px 0 10px 0;">Scenario 1: Social Media Feed - From Slow to Lightning Fast</h3>
                    
                    <p><strong>Company:</strong> A Twitter-like social media platform with 5 million users</p>
                    
                    <p><strong>Problem Before Redis:</strong></p>
                    <ul>
                        <li>Feed generation requires: user data + posts + likes + followers (4 MySQL queries)</li>
                        <li>Each query: 50-80ms on average</li>
                        <li>Total page load: 200-320ms per user</li>
                        <li>With 50,000 concurrent users: Database at 95% CPU, queries queuing up</li>
                        <li>User experience: Slow, frustrating, users leaving platform</li>
                    </ul>

                    <p><strong>Solution with Redis:</strong></p>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Feed Caching Strategy</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">get_user_feed</span>(user_id, limit=<span class="number">50</span>):
    <span class="string">"""Get user's personalized feed"""</span>
    cache_key = <span class="string">f"feed:</span>{user_id}<span class="string">"</span>
    
    <span class="comment"># Try cache first</span>
    cached_feed = r.get(cache_key)
    <span class="keyword">if</span> cached_feed:
        <span class="keyword">print</span>(<span class="string">"‚úÖ Cache HIT - served in 0.5ms"</span>)
        <span class="keyword">return</span> json.loads(cached_feed)
    
    <span class="comment"># Cache miss - generate from database (slow)</span>
    <span class="keyword">print</span>(<span class="string">"‚ùå Cache MISS - fetching from DB (250ms)"</span>)
    feed_data = generate_feed_from_database(user_id, limit)
    
    <span class="comment"># Cache for 5 minutes</span>
    r.setex(cache_key, <span class="number">300</span>, json.dumps(feed_data))
    
    <span class="keyword">return</span> feed_data

<span class="keyword">def</span> <span class="function">generate_feed_from_database</span>(user_id, limit):
    <span class="string">"""Complex database queries (simulated)"""</span>
    <span class="comment"># In reality, this hits MySQL 4 times</span>
    <span class="keyword">return</span> {
        <span class="string">"user"</span>: {<span class="string">"id"</span>: user_id, <span class="string">"name"</span>: <span class="string">"Alice"</span>},
        <span class="string">"posts"</span>: [...],  <span class="comment"># 50 posts with metadata</span>
        <span class="string">"stats"</span>: {<span class="string">"followers"</span>: <span class="number">1523</span>, <span class="string">"following"</span>: <span class="number">892</span>}
    }

<span class="comment"># First request: Cache miss (250ms)</span>
<span class="comment"># Next 1000 requests in 5 min: Cache hits (0.5ms each)</span>
<span class="comment"># Database load reduced by 99.9%!</span></code></pre>
                    </div>

                    <p><strong>Results After Redis:</strong></p>
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0; background: rgba(255, 255, 255, 0.02);">
                        <thead>
                            <tr style="background: rgba(220, 20, 60, 0.2); border-bottom: 2px solid var(--primary-color);">
                                <th style="padding: 12px; text-align: left;">Metric</th>
                                <th style="padding: 12px; text-align: left;">Before Redis</th>
                                <th style="padding: 12px; text-align: left;">After Redis</th>
                                <th style="padding: 12px; text-align: left;">Improvement</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 12px;">Page Load Time</td>
                                <td style="padding: 12px; color: #ff0000;">250-320ms</td>
                                <td style="padding: 12px; color: #00FF88;">0.5-2ms</td>
                                <td style="padding: 12px; color: #00FF88;">‚úÖ 125-640x faster</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 12px;">DB Queries/sec</td>
                                <td style="padding: 12px; color: #ff0000;">200,000</td>
                                <td style="padding: 12px; color: #00FF88;">200</td>
                                <td style="padding: 12px; color: #00FF88;">‚úÖ 99.9% reduction</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 12px;">DB CPU Usage</td>
                                <td style="padding: 12px; color: #ff0000;">95%</td>
                                <td style="padding: 12px; color: #00FF88;">12%</td>
                                <td style="padding: 12px; color: #00FF88;">‚úÖ Saved $45K/month</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 12px;">Concurrent Users</td>
                                <td style="padding: 12px; color: #ff0000;">50K (struggling)</td>
                                <td style="padding: 12px; color: #00FF88;">500K (smooth)</td>
                                <td style="padding: 12px; color: #00FF88;">‚úÖ 10x capacity</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 style="color: var(--primary-color); margin: 30px 0 10px 0;">Scenario 2: E-commerce Product Search - Black Friday Survival</h3>
                    
                    <p><strong>Company:</strong> Online retailer with 10 million products</p>
                    
                    <p><strong>Challenge:</strong> Black Friday traffic spike - 10x normal load. Search queries crush Elasticsearch cluster.</p>
                    
                    <p><strong>Redis Solution - Search Result Caching:</strong></p>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Search Caching</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> hashlib
<span class="keyword">import</span> json

r = redis.Redis()

<span class="keyword">def</span> <span class="function">search_products</span>(query, filters, page=<span class="number">1</span>):
    <span class="string">"""Search with Redis caching"""</span>
    
    <span class="comment"># Create cache key from search parameters</span>
    cache_key = <span class="string">f"search:</span>{hashlib.md5(<span class="string">f'</span>{query}<span class="string">:</span>{filters}<span class="string">:</span>{page}<span class="string">'</span>.encode()).hexdigest()}<span class="string">"</span>
    
    <span class="comment"># Check cache</span>
    cached_results = r.get(cache_key)
    <span class="keyword">if</span> cached_results:
        <span class="keyword">return</span> {
            <span class="string">"results"</span>: json.loads(cached_results),
            <span class="string">"cached"</span>: <span class="keyword">True</span>,
            <span class="string">"time_ms"</span>: <span class="number">0.3</span>
        }
    
    <span class="comment"># Miss - query Elasticsearch (expensive!)</span>
    results = query_elasticsearch(query, filters, page)  <span class="comment"># 150ms</span>
    
    <span class="comment"># Cache for 10 minutes (popular searches stay cached)</span>
    r.setex(cache_key, <span class="number">600</span>, json.dumps(results))
    
    <span class="keyword">return</span> {
        <span class="string">"results"</span>: results,
        <span class="string">"cached"</span>: <span class="keyword">False</span>,
        <span class="string">"time_ms"</span>: <span class="number">150</span>
    }

<span class="comment"># Popular searches: "laptop", "phone", "headphones"</span>
<span class="comment"># These hit cache 99% of the time during Black Friday</span>
<span class="comment"># Result: Elasticsearch load reduced by 95%</span></code></pre>
                    </div>

                    <p><strong>Impact:</strong> Site stayed online during 10x traffic spike. Elasticsearch CPU went from 98% to 25%. Search response time: 150ms ‚Üí 0.3ms average.</p>

                    <h3 style="color: var(--primary-color); margin: 30px 0 10px 0;">Scenario 3: Gaming Leaderboard - Real-time Rankings</h3>
                    
                    <p><strong>Company:</strong> Mobile game with 50 million players</p>
                    
                    <p><strong>Requirements:</strong></p>
                    <ul>
                        <li>Update player scores in real-time (hundreds per second)</li>
                        <li>Show top 100 players instantly</li>
                        <li>Display any player's rank on-demand</li>
                    </ul>

                    <p><strong>Why MySQL Failed:</strong> Computing rankings on 50M rows = 5-10 seconds per query. Unacceptable for real-time gaming.</p>

                    <p><strong>Redis Sorted Sets Solution:</strong></p>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis Commands - Leaderboard</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Update player score (instant!)</span>
<span class="keyword">ZADD</span> <span class="string">leaderboard:global</span> <span class="number">15000</span> <span class="string">player:12345</span>
<span class="comment"># Complexity: O(log N) = 0.02ms with 50M players</span>

<span class="comment"># Get top 100 players (instant!)</span>
<span class="keyword">ZREVRANGE</span> <span class="string">leaderboard:global</span> <span class="number">0</span> <span class="number">99</span> <span class="keyword">WITHSCORES</span>
<span class="comment"># Complexity: O(log N + 100) = 0.1ms</span>

<span class="comment"># Get player's rank (instant!)</span>
<span class="keyword">ZREVRANK</span> <span class="string">leaderboard:global</span> <span class="string">player:12345</span>
<span class="comment"># Complexity: O(log N) = 0.02ms</span>
<span class="comment"># Returns: 3456 (player is rank #3457)</span>

<span class="comment"># Get score of specific player</span>
<span class="keyword">ZSCORE</span> <span class="string">leaderboard:global</span> <span class="string">player:12345</span>
<span class="comment"># Returns: 15000</span></code></pre>
                    </div>

                    <p><strong>Performance Comparison:</strong></p>
                    <ul>
                        <li><strong>MySQL:</strong> 5-10 seconds to compute rankings on 50M rows</li>
                        <li><strong>Redis:</strong> 0.02-0.1ms for all operations</li>
                        <li><strong>Speed Improvement:</strong> 50,000 - 500,000x faster!</li>
                    </ul>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>‚úÖ Production Wisdom:</strong> These three scenarios show Redis's sweet spot: <strong>hot data that's accessed frequently and needs instant responses.</strong> Cache frequently-accessed data, use for real-time features, and watch your application fly!
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    
                    <div class="takeaway-item">
                        <span class="takeaway-icon">‚ö°</span>
                        <p><strong>Speed comes from 5 factors</strong> - RAM (80%), single-threaded (15%), simple data model (3%), optimized code (1.5%), I/O multiplexing (0.5%)</p>
                    </div>
                    
                    <div class="takeaway-item">
                        <span class="takeaway-icon">üéØ</span>
                        <p><strong>100K-500K ops/second</strong> - On a single instance; millions with clustering</p>
                    </div>
                    
                    <div class="takeaway-item">
                        <span class="takeaway-icon">üß†</span>
                        <p><strong>Sub-millisecond latency</strong> - Typically 0.1-1ms per operation vs 50-200ms for databases</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">‚ö†Ô∏è</span>
                        <p><strong>Single-threaded is a feature</strong> - Eliminates lock contention, context switching, and race conditions</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">üíæ</span>
                        <p><strong>RAM vs Disk</strong> - RAM is 100,000x faster than HDD, 1,000x faster than SSD</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">üöÄ</span>
                        <p><strong>Real impact</strong> - Page loads 50-500x faster, database load reduced 95-99%, costs reduced dramatically</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">‚ö°</span>
                        <p><strong>Beware slow commands</strong> - KEYS *, FLUSHALL, large SORT can block entire server</p>
                    </div>

                    <div class="takeaway-item">
                        <span class="takeaway-icon">üéØ</span>
                        <p><strong>Cache hot data</strong> - 20% of data gets 80% of traffic - cache that 20% in Redis for maximum ROI</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords & Concepts</h2>
                    </div>
                    
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">In-Memory Speed</span>
                        <span class="keyword-tag">Single-Threaded</span>
                        <span class="keyword-tag">I/O Multiplexing</span>
                        <span class="keyword-tag">epoll</span>
                        <span class="keyword-tag">kqueue</span>
                        <span class="keyword-tag">Sub-millisecond</span>
                        <span class="keyword-tag">100K ops/sec</span>
                        <span class="keyword-tag">RAM vs Disk</span>
                        <span class="keyword-tag">Lock Contention</span>
                        <span class="keyword-tag">Context Switching</span>
                        <span class="keyword-tag">Event Loop</span>
                        <span class="keyword-tag">O(1) Complexity</span>
                        <span class="keyword-tag">CPU Cache</span>
                        <span class="keyword-tag">Network Latency</span>
                        <span class="keyword-tag">Benchmark</span>
                        <span class="keyword-tag">Throughput</span>
                        <span class="keyword-tag">Latency</span>
                        <span class="keyword-tag">Hot Data</span>
                        <span class="keyword-tag">Cache Hit Rate</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Practice Quiz</h2>
                    </div>
                    
                    <div class="quiz-container">
                        <div class="quiz-question">
                            <strong>Question 1:</strong> What is the PRIMARY reason Redis is so fast?
                        </div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                A) Multi-threaded processing with 8 cores
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">
                                B) In-memory storage (RAM) instead of disk
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                C) GPU acceleration for computations
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                D) Advanced compression algorithms
                            </div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p><strong>Explanation:</strong> RAM is 100,000x faster than HDD and 1,000x faster than SSD. This accounts for 80% of Redis's speed advantage. RAM access = 100 nanoseconds, Disk access = 10 milliseconds. That's the game-changer!</p>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <div class="quiz-question">
                            <strong>Question 2:</strong> How many operations per second can Redis typically handle on modest hardware?
                        </div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                A) 1,000 ops/second
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                B) 10,000 ops/second
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">
                                C) 100,000 ops/second
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                D) 1,000,000 ops/second
                            </div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: C</strong>
                            <p><strong>Explanation:</strong> Redis typically handles 80K-100K operations per second on modest hardware, and 200K-500K on production servers. With pipelining, it can exceed 1M ops/sec. Option D (1M) is achievable but requires pipelining or clustering.</p>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <div class="quiz-question">
                            <strong>Question 3:</strong> Why is Redis's single-threaded architecture considered an ADVANTAGE?
                        </div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                A) It uses less memory than multi-threaded systems
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">
                                B) It eliminates lock contention and context switching overhead
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                C) It's easier to write single-threaded code
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                D) It prevents multiple clients from connecting
                            </div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p><strong>Explanation:</strong> For simple operations (get/set by key), single-threaded is faster because you avoid: (1) Lock contention - threads fighting for resources, (2) Context switching - CPU time wasted changing threads, (3) Race conditions - complex synchronization. Think: one super-fast cashier beats 10 slow cashiers fighting over the register!</p>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <div class="quiz-question">
                            <strong>Question 4:</strong> Which Redis command is dangerous in production because it can block the entire server?
                        </div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                A) GET</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                B) SET
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">
                                C) KEYS *
                            </div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">
                                D) DEL
                            </div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: C</strong>
                            <p><strong>Explanation:</strong> KEYS * scans ALL keys in the database - with millions of keys, this can block Redis for seconds! Since Redis is single-threaded, every other operation queues up. Use SCAN instead for safe iteration. Other dangerous commands: FLUSHALL, large SORT operations.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function getQuestion6Content() { return `<div class="content-section"><div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Definition</h2></div><p><strong>Redis supports 8+ data types:</strong> Strings, Lists, Sets, Sorted Sets, Hashes, Bitmaps, HyperLogLogs, Streams. Not just strings!</p></div><div class="content-section"><div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div><div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Rich data structures</strong> - Not just key-value strings</p></div></div>`; }
        function getQuestion7Content() { return `<div class="content-section"><div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Definition</h2></div><p><strong>Yes! Redis is open source (BSD license).</strong> Free forever, source on GitHub. Redis Inc offers enterprise versions, but core is free.</p></div>`; }
        function getQuestion8Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>You're in a technical interview at a top tech company.</strong> The interviewer asks: "Explain the difference between a key-value store and a relational database." You start explaining, but they interrupt: "No, give me a real-world analogy first - something anyone can understand."</p>
                    
                    <p>You need to explain not just WHAT a key-value store is, but WHY it exists, WHEN to use it, and HOW it's fundamentally different from what most developers learn first (relational databases).</p>
                    
                    <p>This is a deceptively simple question that separates developers who just use tools from those who understand database fundamentals. Let's nail it.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>A key-value store is the simplest type of database that stores data as pairs:</strong></p>
                    <p style="font-size: 18px; text-align: center; margin: 20px 0; color: var(--primary-color);"><strong>Key (unique identifier) ‚Üí Value (the data)</strong></p>

                    <p>Think of it like a real-world dictionary, phone book, or locker system:</p>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">üîë Real-World Analogies:</h4>
                        <p><strong>1. Phone Book:</strong></p>
                        <ul>
                            <li><strong>Key:</strong> Person's name (unique identifier)</li>
                            <li><strong>Value:</strong> Phone number</li>
                            <li><strong>Lookup:</strong> "Alice Johnson" ‚Üí "(555) 123-4567"</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>2. Locker System:</strong></p>
                        <ul>
                            <li><strong>Key:</strong> Locker number (127)</li>
                            <li><strong>Value:</strong> Whatever's inside (backpack, books, gym clothes)</li>
                            <li><strong>Lookup:</strong> Locker #127 ‚Üí Your stuff</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>3. Programming Dictionary:</strong></p>
                        <ul>
                            <li><strong>Python:</strong> <code>my_dict["username"] = "alice123"</code></li>
                            <li><strong>JavaScript:</strong> <code>obj["email"] = "alice@example.com"</code></li>
                            <li><strong>Same concept as Redis!</strong></li>
                        </ul>
                    </div>

                    <p><strong>Key Characteristics:</strong></p>
                    <ul>
                        <li><strong>Simple Structure:</strong> Just key ‚Üí value, no tables, no rows, no columns</li>
                        <li><strong>Fast Lookups:</strong> O(1) complexity - constant time regardless of data size</li>
                        <li><strong>Unique Keys:</strong> Each key must be unique (like locker numbers)</li>
                        <li><strong>Any Value Type:</strong> Value can be string, number, JSON, binary, list, etc.</li>
                        <li><strong>No Relationships:</strong> Keys are independent - no foreign keys or JOINs</li>
                    </ul>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 15px;">üìä Key-Value vs Relational Database:</h4>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                            <thead>
                                <tr style="background: rgba(33, 150, 243, 0.2);">
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color);">Aspect</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color);">Key-Value (Redis)</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color);">Relational (MySQL)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong>Structure</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">key ‚Üí value</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Tables with rows & columns</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong>Schema</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Schema-less (flexible)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Fixed schema required</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong>Query</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><code>GET key</code></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><code>SELECT * FROM table WHERE...</code></td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong>Relationships</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">None (app handles)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Foreign keys, JOINs</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong>Speed</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">‚ö° O(1) - Instant</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">üê¢ O(log n) to O(n)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong>Use Case</strong></td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Caching, sessions, real-time</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Complex data, reports, analytics</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <p><strong>The Power of Simplicity:</strong> Key-value stores sacrifice features (JOINs, complex queries) for extreme speed and simplicity. This trade-off is perfect for caching, sessions, and real-time features.</p>
                </div>

                ${getQuestion8VisualDiagrams()}
                ${getQuestion8CodeExamples()}
                ${getQuestion8CrossQuestions()}
                ${getQuestion8TrickyQuestions()}
                ${getQuestion8PracticalScenarios()}
                ${getQuestion8Remaining()}
            `;
        }

        function getQuestion8VisualDiagrams() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">Key-Value Store Concept</div>
                        <svg viewBox="0 0 800 450" style="max-width: 100%; height: auto;">
                            <text x="400" y="30" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">How Key-Value Store Works</text>
                            
                            <!-- Keys Column -->
                            <text x="150" y="70" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">KEYS (Unique)</text>
                            <rect x="50" y="90" width="200" height="50" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="150" y="120" text-anchor="middle" fill="#fff" font-size="13">"user:1001"</text>
                            
                            <rect x="50" y="155" width="200" height="50" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="150" y="185" text-anchor="middle" fill="#fff" font-size="13">"session:abc123"</text>
                            
                            <rect x="50" y="220" width="200" height="50" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="150" y="250" text-anchor="middle" fill="#fff" font-size="13">"product:5001"</text>
                            
                            <rect x="50" y="285" width="200" height="50" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="150" y="315" text-anchor="middle" fill="#fff" font-size="13">"cart:user_789"</text>
                            
                            <!-- Arrow -->
                            <text x="400" y="230" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">‚Üí</text>
                            <text x="400" y="255" text-anchor="middle" fill="#888" font-size="11">(maps to)</text>
                            
                            <!-- Values Column -->
                            <text x="650" y="70" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">VALUES (Data)</text>
                            <rect x="550" y="90" width="200" height="50" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="650" y="115" text-anchor="middle" fill="#fff" font-size="11">{"name": "Alice",</text>
                            <text x="650" y="130" text-anchor="middle" fill="#fff" font-size="11">"email": "alice@..."}</text>
                            
                            <rect x="550" y="155" width="200" height="50" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="650" y="180" text-anchor="middle" fill="#fff" font-size="11">{"user_id": 1001,</text>
                            <text x="650" y="195" text-anchor="middle" fill="#fff" font-size="11">"expires": 1640000000}</text>
                            
                            <rect x="550" y="220" width="200" height="50" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="650" y="245" text-anchor="middle" fill="#fff" font-size="11">{"title": "Laptop",</text>
                            <text x="650" y="260" text-anchor="middle" fill="#fff" font-size="11">"price": 999}</text>
                            
                            <rect x="550" y="285" width="200" height="50" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="650" y="310" text-anchor="middle" fill="#fff" font-size="11">[{"id": 101}, {"id": 205},</text>
                            <text x="650" y="325" text-anchor="middle" fill="#fff" font-size="11">{"id": 309}]</text>
                            
                            <!-- Lookup example -->
                            <rect x="200" y="370" width="400" height="60" fill="rgba(220, 20, 60, 0.1)" stroke="var(--primary-color)" stroke-width="2" rx="8"/>
                            <text x="400" y="395" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">Example Lookup: GET "user:1001"</text>
                            <text x="400" y="415" text-anchor="middle" fill="#fff" font-size="11">Returns: {"name": "Alice", "email": "alice@..."} in 0.1ms</text>
                        </svg>
                    </div>

                    <div class="diagram-container" style="margin-top: 40px;">
                        <div class="diagram-title">Comparison: Lookup Speed</div>
                        <svg viewBox="0 0 700 300" style="max-width: 100%; height: auto;">
                            <text x="350" y="30" text-anchor="middle" fill="#fff" font-size="16" font-weight="600">Finding User Data by ID</text>
                            
                            <!-- Key-Value Store -->
                            <text x="150" y="70" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">Key-Value Store</text>
                            <rect x="50" y="90" width="80" height="30" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="2" rx="4">
                                <animate attributeName="opacity" values="0.5;1;0.5" dur="0.3s" repeatCount="indefinite"/>
                            </rect>
                            <text x="90" y="110" text-anchor="middle" fill="#fff" font-size="11">O(1)</text>
                            <text x="90" y="140" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">‚úÖ 0.1ms</text>
                            <text x="90" y="160" text-anchor="middle" fill="#888" font-size="10">Direct hash lookup</text>
                            
                            <!-- SQL Database with Index -->
                            <text x="350" y="70" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">SQL + Index</text>
                            <rect x="250" y="90" width="200" height="30" fill="rgba(255, 165, 0, 0.3)" stroke="#FFA500" stroke-width="2" rx="4"/>
                            <text x="350" y="110" text-anchor="middle" fill="#fff" font-size="11">O(log n)</text>
                            <text x="350" y="140" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">‚ö° 5-10ms</text>
                            <text x="350" y="160" text-anchor="middle" fill="#888" font-size="10">B-Tree index search</text>
                            
                            <!-- SQL Database without Index -->
                            <text x="550" y="70" text-anchor="middle" fill="#ff0000" font-size="14" font-weight="600">SQL No Index</text>
                            <rect x="460" y="90" width="180" height="100" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="2" rx="4"/>
                            <text x="550" y="110" text-anchor="middle" fill="#fff" font-size="11">O(n)</text>
                            <text x="550" y="150" text-anchor="middle" fill="#ff0000" font-size="12" font-weight="600">üê¢ 100-1000ms</text>
                            <text x="550" y="170" text-anchor="middle" fill="#888" font-size="10">Full table scan</text>
                            
                            <!-- Bottom explanation -->
                            <text x="350" y="230" text-anchor="middle" fill="#888" font-size="12">Key-Value: Always O(1) - same speed for 1 or 1 billion records</text>
                            <text x="350" y="250" text-anchor="middle" fill="#888" font-size="12">SQL: O(log n) with index, O(n) without - gets slower as data grows</text>
                        </svg>
                    </div>
                </div>
            `;
        }

        function getQuestion8CodeExamples() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <p><strong>Let's see key-value stores in action across different systems:</strong></p>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Redis (Key-Value Store)</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Simple key-value operations</span>
<span class="keyword">SET</span> <span class="string">"user:1001"</span> <span class="string">"Alice Johnson"</span>
<span class="keyword">OK</span>

<span class="keyword">GET</span> <span class="string">"user:1001"</span>
<span class="string">"Alice Johnson"</span>

<span class="comment"># Store JSON as value</span>
<span class="keyword">SET</span> <span class="string">"product:5001"</span> <span class="string">'{"name":"Laptop","price":999,"stock":15}'</span>
<span class="keyword">OK</span>

<span class="keyword">GET</span> <span class="string">"product:5001"</span>
<span class="string">'{"name":"Laptop","price":999,"stock":15}'</span>

<span class="comment"># Store with expiry (TTL)</span>
<span class="keyword">SETEX</span> <span class="string">"session:abc123"</span> <span class="number">3600</span> <span class="string">"user_data_here"</span>
<span class="comment"># Expires in 1 hour</span>

<span class="comment"># Check if key exists</span>
<span class="keyword">EXISTS</span> <span class="string">"user:1001"</span>
<span class="number">(integer) 1</span>  <span class="comment"># 1 = exists</span>

<span class="comment"># Delete a key</span>
<span class="keyword">DEL</span> <span class="string">"user:1001"</span>
<span class="number">(integer) 1</span>  <span class="comment"># 1 = deleted</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Comparison with MySQL (Relational)</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">SQL vs Redis Comparison</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment">-- MySQL (Relational Database)</span>
<span class="comment">-- Must define schema first</span>
<span class="keyword">CREATE TABLE</span> users (
    id <span class="keyword">INT PRIMARY KEY</span>,
    name <span class="keyword">VARCHAR</span>(<span class="number">100</span>),
    email <span class="keyword">VARCHAR</span>(<span class="number">100</span>)
);

<span class="comment">-- Insert data</span>
<span class="keyword">INSERT INTO</span> users (id, name, email)
<span class="keyword">VALUES</span> (<span class="number">1001</span>, <span class="string">'Alice Johnson'</span>, <span class="string">'alice@example.com'</span>);

<span class="comment">-- Query data</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id = <span class="number">1001</span>;
<span class="comment">-- Result: | 1001 | Alice Johnson | alice@example.com |</span>
<span class="comment">-- Time: ~10-50ms</span>

<span class="comment">---------------------------------------------------</span>

<span class="comment"># Redis (Key-Value Store)</span>
<span class="comment"># No schema needed - just store!</span>

<span class="comment"># Store data (multiple approaches)</span>
<span class="keyword">SET</span> <span class="string">"user:1001:name"</span> <span class="string">"Alice Johnson"</span>
<span class="keyword">SET</span> <span class="string">"user:1001:email"</span> <span class="string">"alice@example.com"</span>

<span class="comment"># Or store as JSON</span>
<span class="keyword">SET</span> <span class="string">"user:1001"</span> <span class="string">'{"name":"Alice Johnson","email":"alice@example.com"}'</span>

<span class="comment"># Query data</span>
<span class="keyword">GET</span> <span class="string">"user:1001"</span>
<span class="comment"># Result: '{"name":"Alice Johnson","email":"alice@example.com"}'</span>
<span class="comment"># Time: ~0.1ms (100x faster!)</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Python Dictionary vs Redis</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Python Dictionary (local, in-memory)</span>
my_cache = {}
my_cache[<span class="string">"user:1001"</span>] = {<span class="string">"name"</span>: <span class="string">"Alice"</span>, <span class="string">"age"</span>: <span class="number">28</span>}
user = my_cache[<span class="string">"user:1001"</span>]
<span class="keyword">print</span>(user)  <span class="comment"># {'name': 'Alice', 'age': 28}</span>

<span class="comment"># Redis (remote, persistent, shared)</span>
<span class="keyword">import</span> redis
<span class="keyword">import</span> json

r = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>, decode_responses=<span class="keyword">True</span>)

<span class="comment"># Store data</span>
user_data = {<span class="string">"name"</span>: <span class="string">"Alice"</span>, <span class="string">"age"</span>: <span class="number">28</span>}
r.set(<span class="string">"user:1001"</span>, json.dumps(user_data))

<span class="comment"># Retrieve data</span>
user = json.loads(r.get(<span class="string">"user:1001"</span>))
<span class="keyword">print</span>(user)  <span class="comment"># {'name': 'Alice', 'age': 28}</span>

<span class="comment"># Key differences:</span>
<span class="comment"># 1. Python dict: Only in this process, lost on restart</span>
<span class="comment"># 2. Redis: Available across all servers, survives restarts</span>
<span class="comment"># 3. Python dict: No network overhead</span>
<span class="comment"># 4. Redis: Network overhead but shared across apps</span></code></pre>
                    </div>
                </div>
            `;
        }

        function getQuestion8CrossQuestions() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: How is a key-value store different from a relational database?</h4>
                        <p><strong>A:</strong> Key-value stores are simpler: just key‚Üívalue with O(1) lookups, no schema, no JOINs, no complex queries. Relational databases have tables/rows/columns, support relationships (foreign keys, JOINs), complex WHERE clauses, and aggregations (SUM, GROUP BY). Key-value wins on speed and simplicity, relational wins on query flexibility and relationships.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Give a real-world analogy for key-value stores.</h4>
                        <p><strong>A:</strong> Best analogy is a <strong>locker system</strong>: You have locker #127 (key), you put your stuff inside (value), and when you need your stuff, you go directly to locker #127 (O(1) lookup). You don't need to check every locker, you don't need to know what's in other lockers, you just go straight to yours. That's exactly how Redis works!</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Why is it called "key-value" instead of just "value"?</h4>
                        <p><strong>A:</strong> Because you need the KEY to access the VALUE. Without a unique key, you can't efficiently find your data. The "key" is the identifier (like locker number, username, product ID), and the "value" is the actual data. The pairing is essential - key determines what you can retrieve.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can you have duplicate keys in a key-value store?</h4>
                        <p><strong>A:</strong> No! Keys must be unique, just like locker numbers. If you try to SET the same key twice, the new value overwrites the old one. This is by design - the key uniquely identifies the data. If you need multiple values for the same concept, use different keys (like "user:1001:email" and "user:1001:phone") or store a list/array as the value.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: What can you store as a "value" in Redis?</h4>
                        <p><strong>A:</strong> Almost anything! Strings, numbers, JSON objects, binary data (images, files), lists, sets, hashes, bitmaps. Each key can hold up to 512MB of data. Most commonly: strings (including JSON), but Redis supports complex data structures as values too.</p>
                    </div>
                </div>
            `;
        }

        function getQuestion8TrickyQuestions() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• If key-value stores are so simple and fast, why do we need complex databases at all?</h4>
                        <p><strong>Answer:</strong> Because simplicity = trade-offs! Key-value stores can't do:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>JOINs:</strong> Can't get "all orders with their user info" in one query</li>
                            <li><strong>Complex filtering:</strong> Can't do "find all users where age > 25 AND city = 'NYC'"</li>
                            <li><strong>Aggregations:</strong> Can't calculate SUM, AVG, COUNT across records</li>
                            <li><strong>Relationships:</strong> No foreign keys, cascading deletes, referential integrity</li>
                        </ul>
                        <p style="margin-top: 10px;">Use key-value for: caching, sessions, real-time data. Use SQL for: reports, analytics, complex business logic, data with relationships.</p>
                        <p><em>Pro tip: Most apps use BOTH - SQL for primary data, Redis for speed layer.</em></p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• How do you implement relationships in a key-value store if there are no JOINs?</h4>
                        <p><strong>Answer:</strong> Your application does the work! Example: Getting a user's orders:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>SQL:</strong> <code>SELECT * FROM orders JOIN users ON orders.user_id = users.id WHERE user_id = 1001</code></li>
                            <li><strong>Redis:</strong> Store relationship in the key! <code>SET "orders:user:1001" "[101,205,309]"</code> then fetch each: <code>GET "order:101"</code>, <code>GET "order:205"</code>, etc.</li>
                        </ul>
                        <p style="margin-top: 10px;">You make 1 database query vs N+1 Redis queries. But each Redis query is 50x faster, so N+1 Redis calls (5ms total) beats 1 MySQL query (50ms)! Your app manages relationships through smart key naming.</p>
                        <p><em>Pro tip: Design your Redis keys to represent relationships: "comments:post:555" contains comment IDs for post 555.</em></p>
                    </div>
                </div>
            `;
        }

        function getQuestion8PracticalScenarios() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenarios</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 20px 0 10px 0;">Scenario 1: Session Management - When Key-Value Wins</h3>
                    <p><strong>Problem:</strong> Web app needs to track logged-in users across multiple servers. MySQL session table gets hammered with lookups on every request.</p>
                    
                    <p><strong>Why Key-Value Is Perfect:</strong></p>
                    <ul>
                        <li>Simple access pattern: <code>session_id ‚Üí user_data</code></li>
                        <li>No relationships needed</li>
                        <li>Automatic expiry (TTL)</li>
                        <li>Needs to be FAST (every request checks session)</li>
                    </ul>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python Session Management</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Session storage with Redis (key-value)</span>
<span class="keyword">import</span> redis
<span class="keyword">import</span> uuid
<span class="keyword">import</span> json

r = redis.Redis()

<span class="keyword">def</span> <span class="function">create_session</span>(user_id):
    session_id = <span class="function">str</span>(uuid.uuid4())
    session_data = {
        <span class="string">"user_id"</span>: user_id,
        <span class="string">"logged_in_at"</span>: <span class="string">"2024-01-15"</span>,
        <span class="string">"permissions"</span>: [<span class="string">"read"</span>, <span class="string">"write"</span>]
    }
    
    <span class="comment"># Key: session_id, Value: session_data, TTL: 24 hours</span>
    r.setex(
        <span class="string">f"session:</span>{session_id}<span class="string">"</span>,
        <span class="number">86400</span>,  <span class="comment"># 24 hours</span>
        json.dumps(session_data)
    )
    <span class="keyword">return</span> session_id

<span class="keyword">def</span> <span class="function">get_session</span>(session_id):
    <span class="comment"># O(1) lookup - instant!</span>
    data = r.get(<span class="string">f"session:</span>{session_id}<span class="string">"</span>)
    <span class="keyword">return</span> json.loads(data) <span class="keyword">if</span> data <span class="keyword">else</span> <span class="keyword">None</span>

<span class="comment"># Result: 0.1ms vs 50ms with MySQL table</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 30px 0 10px 0;">Scenario 2: Analytics Dashboard - When SQL Wins</h3>
                    <p><strong>Problem:</strong> CEO wants dashboard showing "total sales by region by product category for Q4"</p>
                    
                    <p><strong>Why Relational Database Wins:</strong></p>
                    <ul>
                        <li>Complex aggregation: SUM(sales) GROUP BY region, category</li>
                        <li>Multiple table JOINs: sales ‚Üí products ‚Üí categories ‚Üí regions</li>
                        <li>WHERE clauses: date range filtering</li>
                        <li>Key-value can't do this efficiently</li>
                    </ul>

                    <p><strong>The Winning Strategy:</strong> Use both! SQL for complex queries + Redis to cache results.</p>
                </div>
            `;
        }

        function getQuestion8Remaining() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Simple structure</strong> - Just key ‚Üí value, like a dictionary or locker system</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>O(1) lookup</strong> - Constant time, doesn't matter if 100 or 100M keys</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>No relationships</strong> - Application handles connections between data</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üöÄ</span><p><strong>Perfect for</strong> - Caching, sessions, real-time data, counters</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>Not for</strong> - Complex queries, JOINs, aggregations, reports</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">Key-Value Store</span>
                        <span class="keyword-tag">Hash Map</span>
                        <span class="keyword-tag">Dictionary</span>
                        <span class="keyword-tag">O(1) Complexity</span>
                        <span class="keyword-tag">NoSQL</span>
                        <span class="keyword-tag">Schema-less</span>
                        <span class="keyword-tag">Direct Lookup</span>
                        <span class="keyword-tag">Unique Keys</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> What's the time complexity for key-value lookups?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) O(n)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">B) O(log n)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">C) O(1)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) O(n¬≤)</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: C</strong>
                            <p>Key-value lookups are O(1) - constant time regardless of data size!</p>
                        </div>
                    </div>
                </div>
            `;
        }
        function getQuestion9Content() { return `<div class="content-section"><div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Definition</h2></div><p><strong>Main uses:</strong> 1) Caching (90%), 2) Sessions, 3) Real-time analytics, 4) Message queues, 5) Rate limiting. Used by Twitter, GitHub, Instagram, Stack Overflow.</p></div>`; }
        function getQuestion10Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>It's Monday morning. You're the lead engineer at a fast-growing startup.</strong> Your CTO walks into the team room and drops a bombshell: "I've been thinking - why are we maintaining both PostgreSQL AND Redis? Redis is so fast. Can't we just use Redis as our only database and simplify our infrastructure?"</p>
                    
                    <p>The junior developers look excited - "Less complexity! Faster queries! Let's do it!" But your senior database architect looks worried. Your DevOps lead is skeptical. Your product manager asks: "Will this save money or cost money?"</p>
                    
                    <p><strong>This is a critical architectural decision that could make or break your startup.</strong> Use Redis as the primary database and you could achieve incredible performance - or catastrophic data loss. You need to understand not just IF it's possible, but WHEN it makes sense, WHAT the risks are, and HOW to do it safely.</p>
                    
                    <p>This question separates architects who understand trade-offs from developers who chase shiny objects. Let's dive deep into the reality of using Redis as a primary database.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>Yes, Redis CAN be used as a primary database - but it comes with serious trade-offs that make it suitable only for specific use cases.</strong></p>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #00FF88; margin-bottom: 15px;">‚úÖ What "Primary Database" Means:</h4>
                        <p>When Redis is your PRIMARY database, it means:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Source of Truth:</strong> Redis is the ONLY place this data exists</li>
                            <li><strong>No Backup Database:</strong> There's no PostgreSQL/MySQL behind it</li>
                            <li><strong>Data Loss = Disaster:</strong> If Redis loses data, it's gone forever</li>
                            <li><strong>All Reads & Writes:</strong> Every operation goes through Redis</li>
                        </ul>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">üéØ When Redis as Primary Database WORKS WELL:</h4>
                        <p><strong>1. Session Storage Systems</strong></p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Why it works:</strong> Sessions are temporary by nature (users log out)</li>
                            <li><strong>Data loss acceptable:</strong> User just needs to re-login</li>
                            <li><strong>Example:</strong> JWT session tokens, OAuth state, shopping carts</li>
                            <li><strong>Companies doing this:</strong> Airbnb, Twitter, GitHub (for sessions)</li>
                        </ul>

                        <p style="margin-top: 15px;"><strong>2. Real-time Leaderboards & Rankings</strong></p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Why it works:</strong> Sorted Sets provide instant ranking (O(log N))</li>
                            <li><strong>Data loss acceptable:</strong> Leaderboards reset anyway (daily/weekly)</li>
                            <li><strong>Example:</strong> Gaming scores, trending topics, live sports stats</li>
                            <li><strong>Companies doing this:</strong> Instagram (Stories ranking), gaming companies</li>
                        </ul>

                        <p style="margin-top: 15px;"><strong>3. Rate Limiting & Counters</strong></p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Why it works:</strong> Atomic operations (INCR, DECR) extremely fast</li>
                            <li><strong>Data loss acceptable:</strong> Counter resets aren't critical</li>
                            <li><strong>Example:</strong> API rate limits, view counts, like counts</li>
                            <li><strong>Companies doing this:</strong> Twitter (tweet counters), Cloudflare (rate limiting)</li>
                        </ul>

                        <p style="margin-top: 15px;"><strong>4. Real-time Analytics & Metrics</strong></p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Why it works:</strong> Fast writes for high-frequency events</li>
                            <li><strong>Data loss acceptable:</strong> Short-term metrics, can be rebuilt</li>
                            <li><strong>Example:</strong> Active users count, request throughput, server metrics</li>
                            <li><strong>Companies doing this:</strong> DataDog, New Relic (time-series data)</li>
                        </ul>

                        <p style="margin-top: 15px;"><strong>5. Message Queues & Pub/Sub</strong></p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Why it works:</strong> Lists and Streams built for queuing</li>
                            <li><strong>Data loss acceptable:</strong> Messages are transient</li>
                            <li><strong>Example:</strong> Job queues, notification systems, event streaming</li>
                            <li><strong>Companies doing this:</strong> Sidekiq, Bull (job processing)</li>
                        </ul>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border-left: 3px solid #FFA500; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #FFA500; margin-bottom: 15px;">‚ö†Ô∏è When Redis as Primary Database is RISKY:</h4>
                        <p><strong>1. User Account Data</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>‚ùå Usernames, passwords, emails - too critical to risk losing</li>
                            <li>‚ùå Even with persistence, Redis can lose seconds of data</li>
                            <li>‚úÖ <strong>Better:</strong> Store in PostgreSQL, cache hot profiles in Redis</li>
                        </ul>

                        <p style="margin-top: 15px;"><strong>2. Financial Transactions</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>‚ùå Payments, balances, invoices - require ACID guarantees</li>
                            <li>‚ùå Redis doesn't support multi-key transactions well</li>
                            <li>‚úÖ <strong>Better:</strong> PostgreSQL with ACID, cache in Redis</li>
                        </ul>

                        <p style="margin-top: 15px;"><strong>3. Historical Data & Audit Logs</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>‚ùå Regulatory compliance requires durable storage</li>
                            <li>‚ùå RAM costs 10-30x more than disk (cost prohibitive)</li>
                            <li>‚úÖ <strong>Better:</strong> PostgreSQL/S3 for archives</li>
                        </ul>

                        <p style="margin-top: 15px;"><strong>4. Complex Relationships</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>‚ùå Orders with items, users with posts, products with categories</li>
                            <li>‚ùå No JOINs = complex application logic</li>
                            <li>‚úÖ <strong>Better:</strong> SQL database designed for relationships</li>
                        </ul>

                        <p style="margin-top: 15px;"><strong>5. Large Datasets (>100GB)</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>‚ùå RAM cost becomes prohibitive ($10K+/month)</li>
                            <li>‚ùå Example: 1TB in Redis = $10,000/mo vs $100/mo on disk</li>
                            <li>‚úÖ <strong>Better:</strong> SQL for bulk storage, Redis for hot data</li>
                        </ul>
                    </div>

                    <div style="background: rgba(156, 39, 176, 0.1); border-left: 3px solid #9C27B0; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #9C27B0; margin-bottom: 15px;">üèóÔ∏è Requirements for Using Redis as Primary Database:</h4>
                        <p>If you decide to use Redis as primary storage, you MUST have:</p>
                        <ol style="margin-top: 10px;">
                            <li><strong>Persistence Enabled:</strong> Both RDB snapshots + AOF logging</li>
                            <li><strong>Replication Setup:</strong> At least 2 replicas for high availability</li>
                            <li><strong>Backup Strategy:</strong> Regular backups to S3/disk</li>
                            <li><strong>Monitoring:</strong> Alerts on memory usage, replication lag</li>
                            <li><strong>Disaster Recovery Plan:</strong> Tested restore procedures</li>
                            <li><strong>Memory Planning:</strong> 2-3x your data size for overhead</li>
                            <li><strong>Cost Analysis:</strong> Can you afford RAM costs as data grows?</li>
                        </ol>
                    </div>
                </div>

                ${getQuestion10VisualDiagrams()}
                ${getQuestion10CodeExamples()}
                ${getQuestion10CrossQuestions()}
                ${getQuestion10TrickyQuestions()}
                ${getQuestion10PracticalScenarios()}
                ${getQuestion10KeyTakeaways()}
            `;
        }

        function getQuestion10VisualDiagrams() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">Decision Tree: Can You Use Redis as Primary Database?</div>
                        <svg viewBox="0 0 900 700" style="max-width: 100%; height: auto;">
                            <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">Redis as Primary DB - Decision Framework</text>
                            
                            <!-- Start -->
                            <rect x="350" y="60" width="200" height="50" fill="rgba(33, 150, 243, 0.3)" stroke="#2196F3" stroke-width="3" rx="8"/>
                            <text x="450" y="88" text-anchor="middle" fill="#fff" font-size="14" font-weight="600">Can I use Redis</text>
                            <text x="450" y="103" text-anchor="middle" fill="#fff" font-size="12">as primary DB?</text>

                            <!-- Question 1: Data Size -->
                            <line x1="450" y1="110" x2="450" y2="140" stroke="#888" stroke-width="2"/>
                            <rect x="320" y="140" width="260" height="50" fill="rgba(220, 20, 60, 0.2)" stroke="var(--primary-color)" stroke-width="2" rx="6"/>
                            <text x="450" y="168" text-anchor="middle" fill="#fff" font-size="13" font-weight="600">Q1: Will data fit in RAM</text>
                            <text x="450" y="183" text-anchor="middle" fill="#888" font-size="11">comfortably (&lt;50GB)?</text>

                            <!-- Yes path - Q2 -->
                            <line x1="320" y1="165" x2="200" y2="165" stroke="#00FF88" stroke-width="2"/>
                            <line x1="200" y1="165" x2="200" y2="210" stroke="#00FF88" stroke-width="2"/>
                            <text x="250" y="160" fill="#00FF88" font-size="11">YES</text>
                            
                            <rect x="70" y="210" width="260" height="50" fill="rgba(220, 20, 60, 0.2)" stroke="var(--primary-color)" stroke-width="2" rx="6"/>
                            <text x="200" y="238" text-anchor="middle" fill="#fff" font-size="13" font-weight="600">Q2: Is data loss</text>
                            <text x="200" y="253" text-anchor="middle" fill="#888" font-size="11">acceptable/recoverable?</text>

                            <!-- No path from Q1 -->
                            <line x1="580" y1="165" x2="700" y2="165" stroke="#ff0000" stroke-width="2"/>
                            <line x1="700" y1="165" x2="700" y2="230" stroke="#ff0000" stroke-width="2"/>
                            <text x="630" y="160" fill="#ff0000" font-size="11">NO</text>
                            
                            <rect x="620" y="230" width="160" height="80" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="3" rx="8"/>
                            <text x="700" y="260" text-anchor="middle" fill="#ff0000" font-size="14" font-weight="700">‚ùå DON'T USE</text>
                            <text x="700" y="278" text-anchor="middle" fill="#fff" font-size="11">Too expensive</text>
                            <text x="700" y="293" text-anchor="middle" fill="#888" font-size="10">Use SQL + Redis cache</text>

                            <!-- Yes from Q2 - Q3 -->
                            <line x1="70" y1="235" x2="20" y2="235" stroke="#00FF88" stroke-width="2"/>
                            <line x1="20" y1="235" x2="20" y2="310" stroke="#00FF88" stroke-width="2"/>
                            <text x="35" y="270" fill="#00FF88" font-size="11">YES</text>
                            
                            <rect x="20" y="310" width="200" height="50" fill="rgba(220, 20, 60, 0.2)" stroke="var(--primary-color)" stroke-width="2" rx="6"/>
                            <text x="120" y="338" text-anchor="middle" fill="#fff" font-size="13" font-weight="600">Q3: Need complex</text>
                            <text x="120" y="353" text-anchor="middle" fill="#888" font-size="11">queries/JOINs?</text>

                            <!-- No from Q2 -->
                            <line x1="330" y1="235" x2="420" y2="235" stroke="#ff0000" stroke-width="2"/>
                            <line x1="420" y1="235" x2="420" y2="340" stroke="#ff0000" stroke-width="2"/>
                            <text x="365" y="230" fill="#ff0000" font-size="11">NO</text>
                            
                            <rect x="340" y="340" width="160" height="80" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="3" rx="8"/>
                            <text x="420" y="370" text-anchor="middle" fill="#ff0000" font-size="14" font-weight="700">‚ùå DON'T USE</text>
                            <text x="420" y="388" text-anchor="middle" fill="#fff" font-size="11">Data too critical</text>
                            <text x="420" y="403" text-anchor="middle" fill="#888" font-size="10">Use SQL database</text>

                            <!-- Yes from Q3 - FAIL -->
                            <line x1="120" y1="360" x2="120" y2="450" stroke="#ff0000" stroke-width="2"/>
                            <text x="135" y="400" fill="#ff0000" font-size="11">YES</text>
                            
                            <rect x="40" y="450" width="160" height="80" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="3" rx="8"/>
                            <text x="120" y="480" text-anchor="middle" fill="#ff0000" font-size="14" font-weight="700">‚ùå DON'T USE</text>
                            <text x="120" y="498" text-anchor="middle" fill="#fff" font-size="11">Use SQL for</text>
                            <text x="120" y="513" text-anchor="middle" fill="#888" font-size="10">complex queries</text>

                            <!-- No from Q3 - Q4 -->
                            <line x1="220" y1="335" x2="280" y2="335" stroke="#00FF88" stroke-width="2"/>
                            <line x1="280" y1="335" x2="280" y2="480" stroke="#00FF88" stroke-width="2"/>
                            <line x1="280" y1="480" x2="340" y2="480" stroke="#00FF88" stroke-width="2"/>
                            <text x="245" y="330" fill="#00FF88" font-size="11">NO</text>
                            
                            <rect x="340" y="455" width="200" height="50" fill="rgba(220, 20, 60, 0.2)" stroke="var(--primary-color)" stroke-width="2" rx="6"/>
                            <text x="440" y="483" text-anchor="middle" fill="#fff" font-size="13" font-weight="600">Q4: Can afford RAM</text>
                            <text x="440" y="498" text-anchor="middle" fill="#888" font-size="11">cost growth?</text>

                            <!-- Yes from Q4 - SUCCESS! -->
                            <line x1="440" y1="505" x2="440" y2="560" stroke="#00FF88" stroke-width="3"/>
                            <text x="455" y="530" fill="#00FF88" font-size="11">YES</text>
                            
                            <rect x="340" y="560" width="200" height="100" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="4" rx="10">
                                <animate attributeName="opacity" values="0.6;1;0.6" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="440" y="595" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="700">‚úÖ YES, USE REDIS!</text>
                            <text x="440" y="618" text-anchor="middle" fill="#fff" font-size="12">Perfect for:</text>
                            <text x="440" y="635" text-anchor="middle" fill="#888" font-size="10">Sessions, Leaderboards,</text>
                            <text x="440" y="650" text-anchor="middle" fill="#888" font-size="10">Counters, Real-time Data</text>

                            <!-- No from Q4 -->
                            <line x1="540" y1="480" x2="620" y2="480" stroke="#ff0000" stroke-width="2"/>
                            <line x1="620" y1="480" x2="620" y2="580" stroke="#ff0000" stroke-width="2"/>
                            <text x="570" y="475" fill="#ff0000" font-size="11">NO</text>
                            
                            <rect x="540" y="580" width="160" height="80" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="3" rx="8"/>
                            <text x="620" y="610" text-anchor="middle" fill="#ff0000" font-size="14" font-weight="700">‚ùå DON'T USE</text>
                            <text x="620" y="628" text-anchor="middle" fill="#fff" font-size="11">Cost prohibitive</text>
                            <text x="620" y="643" text-anchor="middle" fill="#888" font-size="10">Use disk-based DB</text>
                        </svg>
                    </div>

                    <div class="diagram-container" style="margin-top: 40px;">
                        <div class="diagram-title">Architecture Comparison: Redis as Cache vs Primary Database</div>
                        <svg viewBox="0 0 900 500" style="max-width: 100%; height: auto;">
                            <text x="450" y="30" text-anchor="middle" fill="#fff" font-size="16" font-weight="600">Two Different Architectures</text>
                            
                            <!-- LEFT: Redis as Cache -->
                            <text x="220" y="70" text-anchor="middle" fill="#00FF88" font-size="15" font-weight="600">Redis as CACHE (Recommended)</text>
                            
                            <rect x="145" y="100" width="150" height="60" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="220" y="125" text-anchor="middle" fill="#2196F3" font-size="13">Application</text>
                            <text x="220" y="143" text-anchor="middle" fill="#888" font-size="11">Server</text>

                            <rect x="145" y="190" width="150" height="70" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                            <text x="220" y="215" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">‚ö° Redis</text>
                            <text x="220" y="233" text-anchor="middle" fill="#888" font-size="10">(Cache Layer)</text>
                            <text x="220" y="248" text-anchor="middle" fill="#FFA500" font-size="9">Persistence: OFF</text>

                            <rect x="145" y="290" width="150" height="80" fill="rgba(76, 175, 80, 0.3)" stroke="#4CAF50" stroke-width="3" rx="6"/>
                            <text x="220" y="320" text-anchor="middle" fill="#4CAF50" font-size="13" font-weight="700">üóÑÔ∏è PostgreSQL</text>
                            <text x="220" y="338" text-anchor="middle" fill="#fff" font-size="11">(Source of Truth)</text>
                            <text x="220" y="355" text-anchor="middle" fill="#00FF88" font-size="9">All data here!</text>

                            <line x1="220" y1="160" x2="220" y2="185" stroke="#2196F3" stroke-width="2" stroke-dasharray="3,3"/>
                            <line x1="220" y1="260" x2="220" y2="285" stroke="#4CAF50" stroke-width="2"/>
                            <text x="240" y="178" fill="#888" font-size="9">Fast reads</text>
                            <text x="240" y="278" fill="#888" font-size="9">Fallback</text>

                            <!-- Benefits -->
                            <rect x="120" y="390" width="200" height="90" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="220" y="410" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">‚úÖ Benefits:</text>
                            <text x="130" y="428" fill="#fff" font-size="10">‚Ä¢ Data loss OK</text>
                            <text x="130" y="443" fill="#fff" font-size="10">‚Ä¢ Low risk</text>
                            <text x="130" y="458" fill="#fff" font-size="10">‚Ä¢ Best of both worlds</text>
                            <text x="130" y="473" fill="#888" font-size="9">90% of companies do this</text>

                            <!-- Divider -->
                            <line x1="450" y1="60" x2="450" y2="490" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>

                            <!-- RIGHT: Redis as Primary -->
                            <text x="680" y="70" text-anchor="middle" fill="#FFA500" font-size="15" font-weight="600">Redis as PRIMARY DB (Risky)</text>
                            
                            <rect x="605" y="100" width="150" height="60" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F2" stroke-width="2" rx="6"/>
                            <text x="680" y="125" text-anchor="middle" fill="#2196F3" font-size="13">Application</text>
                            <text x="680" y="143" text-anchor="middle" fill="#888" font-size="11">Server</text>

                            <rect x="605" y="190" width="150" height="100" fill="rgba(220, 20, 60, 0.3)" stroke="#DC143C" stroke-width="3" rx="6">
                                <animate attributeName="stroke-width" values="3;5;3" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="680" y="225" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">‚ö° Redis</text>
                            <text x="680" y="243" text-anchor="middle" fill="#fff" font-size="11">(PRIMARY DB)</text>
                            <text x="680" y="261" text-anchor="middle" fill="#00FF88" font-size="9">Persistence: ON</text>
                            <text x="680" y="276" text-anchor="middle" fill="#00FF88" font-size="9">Replication: ON</text>

                            <text x="680" y="310" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">‚ö†Ô∏è Only data store!</text>

                            <line x1="680" y1="160" x2="680" y2="185" stroke="#2196F3" stroke-width="3"/>
                            <text x="700" y="178" fill="#fff" font-size="9">All data!</text>

                            <!-- Optional Backup -->
                            <rect x="605" y="320" width="150" height="50" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="2" rx="6" stroke-dasharray="5,5"/>
                            <text x="680" y="345" text-anchor="middle" fill="#9C27B0" font-size="11">üì¶ Backups to S3</text>
                            <text x="680" y="360" text-anchor="middle" fill="#888" font-size="9">(Optional safety)</text>
                            <line x1="680" y1="290" x2="680" y2="315" stroke="#9C27B0" stroke-width="2" stroke-dasharray="3,3"/>

                            <!-- Risks -->
                            <rect x="580" y="390" width="200" height="90" fill="rgba(255, 69, 0, 0.1)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="680" y="410" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">‚ö†Ô∏è Risks:</text>
                            <text x="590" y="428" fill="#fff" font-size="10">‚Ä¢ Data loss disaster</text>
                            <text x="590" y="443" fill="#fff" font-size="10">‚Ä¢ High cost (RAM)</text>
                            <text x="590" y="458" fill="#fff" font-size="10">‚Ä¢ Limited queries</text>
                            <text x="590" y="473" fill="#888" font-size="9">Only 5-10% do this</text>
                        </svg>
                    </div>

                    <div class="diagram-container" style="margin-top: 40px;">
                        <div class="diagram-title">Cost Comparison: Redis vs SQL for Growing Data</div>
                        <svg viewBox="0 0 800 400" style="max-width: 100%; height: auto;">
                            <text x="400" y="30" text-anchor="middle" fill="#fff" font-size="16" font-weight="600">Monthly Cost as Data Grows</text>
                            
                            <!-- Axes -->
                            <line x1="80" y1="320" x2="750" y2="320" stroke="#666" stroke-width="2"/>
                            <line x1="80" y1="320" x2="80" y2="60" stroke="#666" stroke-width="2"/>
                            
                            <!-- X-axis labels -->
                            <text x="150" y="340" text-anchor="middle" fill="#888" font-size="11">10GB</text>
                            <text x="280" y="340" text-anchor="middle" fill="#888" font-size="11">50GB</text>
                            <text x="410" y="340" text-anchor="middle" fill="#888" font-size="11">100GB</text>
                            <text x="540" y="340" text-anchor="middle" fill="#888" font-size="11">500GB</text>
                            <text x="670" y="340" text-anchor="middle" fill="#888" font-size="11">1TB</text>
                            <text x="400" y="370" text-anchor="middle" fill="#888" font-size="12">Data Size</text>
                            
                            <!-- Y-axis labels -->
                            <text x="60" y="325" text-anchor="end" fill="#888" font-size="11">$0</text>
                            <text x="60" y="240" text-anchor="end" fill="#888" font-size="11">$1K</text>
                            <text x="60" y="155" text-anchor="end" fill="#888" font-size="11">$5K</text>
                            <text x="60" y="70" text-anchor="end" fill="#888" font-size="11">$10K</text>
                            <text x="30" y="190" text-anchor="middle" fill="#888" font-size="12" transform="rotate(-90 30 190)">Monthly Cost</text>
                            
                            <!-- SQL Line (low and flat) -->
                            <polyline points="80,315 150,312 280,305 410,295 540,260 670,240" 
                                fill="none" stroke="#4CAF50" stroke-width="3"/>
                            <text x="690" y="235" fill="#4CAF50" font-size="12" font-weight="600">SQL (Disk)</text>
                            
                            <!-- Redis Line (expensive growth) -->
                            <polyline points="80,315 150,290 280,220 410,150 540,75 670,65" 
                                fill="none" stroke="#DC143C" stroke-width="3">
                                <animate attributeName="stroke-dashoffset" from="0" to="20" dur="1s" repeatCount="indefinite"/>
                            </polyline>
                            <text x="690" y="70" fill="#DC143C" font-size="12" font-weight="600">Redis (RAM)</text>
                            
                            <!-- Cost examples -->
                            <rect x="150" y="100" width="500" height="150" fill="rgba(0, 0, 0, 0.3)" stroke="#666" stroke-width="1" rx="6"/>
                            <text x="400" y="125" text-anchor="middle" fill="#fff" font-size="13" font-weight="600">Real Cost Examples:</text>
                            
                            <text x="170" y="150" fill="#4CAF50" font-size="11">SQL 100GB: $100/month</text>
                            <text x="170" y="168" fill="#DC143C" font-size="11">Redis 100GB: $5,000/month</text>
                            <text x="170" y="188" fill="#888" font-size="10">‚Üí 50x more expensive!</text>
                            
                            <text x="170" y="213" fill="#4CAF50" font-size="11">SQL 1TB: $500/month</text>
                            <text x="170" y="231" fill="#DC143C" font-size="11">Redis 1TB: $50,000/month</text>
                            <text x="170" y="250" fill="#888" font-size="10">‚Üí 100x more expensive!</text>
                        </svg>
                    </div>
                </div>
            `;
        }

        function getQuestion10CodeExamples() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <p><strong>Let's see how to properly configure Redis as a primary database:</strong></p>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Redis Configuration for Primary Database</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">redis.conf - Primary Database Setup</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># ================================================</span>
<span class="comment"># REDIS AS PRIMARY DATABASE - PRODUCTION CONFIG</span>
<span class="comment"># ================================================</span>

<span class="comment"># CRITICAL: Enable BOTH persistence methods</span>
<span class="comment"># RDB: Periodic snapshots</span>
<span class="keyword">save</span> <span class="number">900 1</span>      <span class="comment"># After 15 min if ‚â•1 key changed</span>
<span class="keyword">save</span> <span class="number">300 10</span>     <span class="comment"># After 5 min if ‚â•10 keys changed</span>
<span class="keyword">save</span> <span class="number">60 10000</span>   <span class="comment"># After 1 min if ‚â•10K keys changed</span>

<span class="comment"># AOF: Log every write operation</span>
<span class="keyword">appendonly</span> yes
<span class="keyword">appendfsync</span> everysec  <span class="comment"># Balance between performance and durability</span>

<span class="comment"># Memory Management</span>
<span class="keyword">maxmemory</span> <span class="number">8gb</span>
<span class="keyword">maxmemory-policy</span> noeviction  <span class="comment"># NEVER evict data!</span>

<span class="comment"># Stop writes if background save fails (safety!)</span>
<span class="keyword">stop-writes-on-bgsave-error</span> yes

<span class="comment"># Enable replication (MUST HAVE!)</span>
<span class="comment"># Set up at least 2 replicas for high availability</span>
<span class="keyword">replicaof</span> <span class="string">master-redis-ip</span> <span class="number">6379</span>

<span class="comment"># Auto failover with Redis Sentinel</span>
<span class="keyword">sentinel</span> monitor mymaster <span class="string">redis-master</span> <span class="number">6379</span> <span class="number">2</span>
<span class="keyword">sentinel</span> down-after-milliseconds mymaster <span class="number">5000</span>
<span class="keyword">sentinel</span> failover-timeout mymaster <span class="number">10000</span>

<span class="comment"># Monitoring (REQUIRED)</span>
<span class="keyword">slowlog-log-slower-than</span> <span class="number">10000</span>  <span class="comment"># Log queries >10ms</span>
<span class="keyword">slowlog-max-len</span> <span class="number">128</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Session Storage as Primary DB (Good Use Case)</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Session Management</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json
<span class="keyword">import</span> uuid
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta

<span class="comment"># Redis IS the primary database for sessions</span>
<span class="comment"># No other database backing it up</span>
r = redis.Redis(
    host=<span class="string">'redis-cluster.prod.company.com'</span>,
    port=<span class="number">6379</span>,
    decode_responses=<span class="keyword">True</span>,
    socket_keepalive=<span class="keyword">True</span>
)

<span class="keyword">class</span> <span class="function">SessionStore</span>:
    <span class="string">"""Redis as PRIMARY database for user sessions"""</span>
    
    <span class="keyword">def</span> <span class="function">create_session</span>(<span class="keyword">self</span>, user_id, user_data):
        <span class="string">"""Create new session - stored ONLY in Redis"""</span>
        session_id = <span class="function">str</span>(uuid.uuid4())
        
        session = {
            <span class="string">"session_id"</span>: session_id,
            <span class="string">"user_id"</span>: user_id,
            <span class="string">"user_data"</span>: user_data,
            <span class="string">"created_at"</span>: datetime.now().isoformat(),
            <span class="string">"last_activity"</span>: datetime.now().isoformat()
        }
        
        <span class="comment"># Store with 24-hour expiry</span>
        key = <span class="string">f"session:</span>{session_id}<span class="string">"</span>
        r.setex(key, <span class="number">86400</span>, json.dumps(session))
        
        <span class="comment"># Also store user‚Üísession mapping for logout</span>
        r.sadd(<span class="string">f"user_sessions:</span>{user_id}<span class="string">"</span>, session_id)
        r.expire(<span class="string">f"user_sessions:</span>{user_id}<span class="string">"</span>, <span class="number">86400</span>)
        
        <span class="keyword">return</span> session_id
    
    <span class="keyword">def</span> <span class="function">get_session</span>(<span class="keyword">self</span>, session_id):
        <span class="string">"""Retrieve session - Redis is source of truth"""</span>
        key = <span class="string">f"session:</span>{session_id}<span class="string">"</span>
        data = r.get(key)
        
        <span class="keyword">if</span> <span class="keyword">not</span> data:
            <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># Session expired or doesn't exist</span>
        
        session = json.loads(data)
        
        <span class="comment"># Update last activity timestamp</span>
        session[<span class="string">"last_activity"</span>] = datetime.now().isoformat()
        r.setex(key, <span class="number">86400</span>, json.dumps(session))  <span class="comment"># Refresh TTL</span>
        
        <span class="keyword">return</span> session
    
    <span class="keyword">def</span> <span class="function">delete_session</span>(<span class="keyword">self</span>, session_id):
        <span class="string">"""Logout - delete from Redis"""</span>
        session = <span class="keyword">self</span>.get_session(session_id)
        <span class="keyword">if</span> session:
            user_id = session[<span class="string">"user_id"</span>]
            r.srem(<span class="string">f"user_sessions:</span>{user_id}<span class="string">"</span>, session_id)
        
        r.delete(<span class="string">f"session:</span>{session_id}<span class="string">"</span>)
    
    <span class="keyword">def</span> <span class="function">logout_all_devices</span>(<span class="keyword">self</span>, user_id):
        <span class="string">"""Delete all sessions for a user"""</span>
        session_ids = r.smembers(<span class="string">f"user_sessions:</span>{user_id}<span class="string">"</span>)
        
        <span class="keyword">for</span> session_id <span class="keyword">in</span> session_ids:
            r.delete(<span class="string">f"session:</span>{session_id}<span class="string">"</span>)
        
        r.delete(<span class="string">f"user_sessions:</span>{user_id}<span class="string">"</span>)

<span class="comment"># Why this works as primary DB:</span>
<span class="comment"># 1. Sessions are temporary by nature</span>
<span class="comment"># 2. Data loss = user re-logs in (annoying but not disaster)</span>
<span class="comment"># 3. Needs to be FAST (checked on every request)</span>
<span class="comment"># 4. Simple key-value access pattern</span>
<span class="comment"># 5. Auto-expiry with TTL is perfect</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Leaderboard as Primary DB (Perfect Use Case)</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Gaming Leaderboard</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">Leaderboard</span>:
    <span class="string">"""Redis as PRIMARY database for game leaderboard"""</span>
    
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, game_id):
        <span class="keyword">self</span>.key = <span class="string">f"leaderboard:</span>{game_id}<span class="string">"</span>
    
    <span class="keyword">def</span> <span class="function">update_score</span>(<span class="keyword">self</span>, player_id, score):
        <span class="string">"""Update player score - instant ranking update"""</span>
        <span class="comment"># ZADD is atomic - score updates in O(log N)</span>
        r.zadd(<span class="keyword">self</span>.key, {player_id: score})
        
        <span class="comment"># Get player's new rank</span>
        rank = r.zrevrank(<span class="keyword">self</span>.key, player_id)
        <span class="keyword">return</span> rank + <span class="number">1</span>  <span class="comment"># Rank is 1-indexed</span>
    
    <span class="keyword">def</span> <span class="function">get_top_players</span>(<span class="keyword">self</span>, count=<span class="number">100</span>):
        <span class="string">"""Get top N players with scores"""</span>
        <span class="comment"># O(log N + count) - blazing fast!</span>
        players = r.zrevrange(<span class="keyword">self</span>.key, <span class="number">0</span>, count-<span class="number">1</span>, withscores=<span class="keyword">True</span>)
        
        <span class="keyword">return</span> [
            {<span class="string">"rank"</span>: i+<span class="number">1</span>, <span class="string">"player_id"</span>: p, <span class="string">"score"</span>: <span class="function">int</span>(s)}
            <span class="keyword">for</span> i, (p, s) <span class="keyword">in</span> <span class="function">enumerate</span>(players)
        ]
    
    <span class="keyword">def</span> <span class="function">get_player_rank</span>(<span class="keyword">self</span>, player_id):
        <span class="string">"""Get specific player's rank and score"""</span>
        rank = r.zrevrank(<span class="keyword">self</span>.key, player_id)
        score = r.zscore(<span class="keyword">self</span>.key, player_id)
        
        <span class="keyword">if</span> rank <span class="keyword">is</span> <span class="keyword">None</span>:
            <span class="keyword">return</span> <span class="keyword">None</span>
        
        <span class="keyword">return</span> {
            <span class="string">"player_id"</span>: player_id,
            <span class="string">"rank"</span>: rank + <span class="number">1</span>,
            <span class="string">"score"</span>: <span class="function">int</span>(score)
        }
    
    <span class="keyword">def</span> <span class="function">get_around_player</span>(<span class="keyword">self</span>, player_id, count=<span class="number">10</span>):
        <span class="string">"""Get players around specific player's rank"""</span>
        rank = r.zrevrank(<span class="keyword">self</span>.key, player_id)
        <span class="keyword">if</span> rank <span class="keyword">is</span> <span class="keyword">None</span>:
            <span class="keyword">return</span> []
        
        start = <span class="function">max</span>(<span class="number">0</span>, rank - count)
        end = rank + count
        
        players = r.zrevrange(<span class="keyword">self</span>.key, start, end, withscores=<span class="keyword">True</span>)
        
        <span class="keyword">return</span> [
            {<span class="string">"rank"</span>: start+i+<span class="number">1</span>, <span class="string">"player_id"</span>: p, <span class="string">"score"</span>: <span class="function">int</span>(s)}
            <span class="keyword">for</span> i, (p, s) <span class="keyword">in</span> <span class="function">enumerate</span>(players)
        ]

<span class="comment"># Example usage</span>
leaderboard = Leaderboard(<span class="string">"battle_royale_season_5"</span>)

<span class="comment"># Player scores a kill - instant update!</span>
new_rank = leaderboard.update_score(<span class="string">"player_12345"</span>, <span class="number">15000</span>)
<span class="keyword">print</span>(<span class="string">f"You are now rank #</span>{new_rank}<span class="string">!"</span>)  <span class="comment"># Instant!</span>

<span class="comment"># Get top 10 players</span>
top_players = leaderboard.get_top_players(<span class="number">10</span>)

<span class="comment"># Why this works perfectly as primary DB:</span>
<span class="comment"># 1. Leaderboards reset weekly/monthly anyway</span>
<span class="comment"># 2. Data loss = annoying but not catastrophic</span>
<span class="comment"># 3. Needs sub-millisecond performance (real-time gaming)</span>
<span class="comment"># 4. Sorted Sets are PERFECT for rankings</span>
<span class="comment"># 5. MySQL would take 5-10 seconds for rankings on 50M players</span></code></pre>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>‚úÖ Pattern Recognition:</strong> Both examples (sessions + leaderboards) share key traits: (1) Temporary/resettable data, (2) Simple access patterns, (3) Speed critical, (4) Data loss tolerable. These are the ONLY scenarios where Redis as primary DB makes sense!
                    </div>
                </div>

                ${getQuestion10CrossQuestions()}
                ${getQuestion10TrickyQuestions()}
                ${getQuestion10PracticalScenarios()}
                ${getQuestion10KeyTakeaways()}
            `;
        }

        function getQuestion10CrossQuestions() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions (Follow-ups)</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Would you recommend Redis as a primary database?</h4>
                        <p><strong>A:</strong> Only for specific use cases like sessions, leaderboards, counters. For user accounts, transactions, or complex data - use PostgreSQL + Redis cache. The hybrid approach is what 90%+ companies do successfully.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What's the biggest risk?</h4>
                        <p><strong>A:</strong> Two risks: (1) Data loss (1-sec to 5-min on crashes), (2) RAM cost explosion as data grows ($5K/month for 500GB vs $100/month on disk).</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What companies use Redis as primary DB?</h4>
                        <p><strong>A:</strong> Twitter (timelines), Instagram (feeds), GitHub (queues) - but ALL also use PostgreSQL/MySQL for core data. They use Redis only for specific hot data.</p>
                    </div>
                </div>
            `;
        }

        function getQuestion10TrickyQuestions() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• If persistence is enabled, why don't banks use Redis?</h4>
                        <p><strong>A:</strong> Redis with AOF can lose ~1 second of data. For banks processing $10M/minute, 1 second = $166K lost. PostgreSQL guarantees ZERO data loss with synchronous replication. Banks need absolute durability over speed.</p>
                    </div>
                </div>
            `;
        }

        function getQuestion10PracticalScenarios() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    
                    <p><strong>E-commerce learns the hard way:</strong></p>
                    <p>Month 1: "Use only Redis!" - 5GB, $50/month ‚úÖ</p>
                    <p>Month 6: CEO wants reports - Redis can't do GROUP BY ‚ùå</p>
                    <p>Month 12: 650GB data = $6,500/month cost explosion ‚ùå</p>
                    <p>Month 18: Painful 6-month migration to PostgreSQL + Redis cache = $300/month total ‚úÖ</p>
                    <p><strong>Lesson:</strong> Hybrid architecture from day 1 saves pain later!</p>
                </div>
            `;
        }

        function getQuestion10KeyTakeaways() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Yes, but only for specific cases</strong> - Sessions, leaderboards, counters, real-time data</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>Major risks</strong> - Data loss, RAM cost explosion, no complex queries</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üèóÔ∏è</span><p><strong>Hybrid wins</strong> - PostgreSQL/MySQL + Redis cache is best for 90%+ of apps</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">Primary Database</span><span class="keyword-tag">RAM Cost</span><span class="keyword-tag">Data Durability</span><span class="keyword-tag">Hybrid Architecture</span><span class="keyword-tag">Session Storage</span><span class="keyword-tag">Leaderboards</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> When is Redis as primary DB a GOOD choice?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) User account data</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) Gaming leaderboards</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Financial transactions</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) 1TB audit logs</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>Leaderboards are perfect: temporary data, resets weekly, extreme speed needed, data loss tolerable.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // SECTION 2: Questions 11-20
        function getQuestion11Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>You're in a technical interview at Netflix.</strong> The interviewer asks: "We need to build several features - user sessions, trending content rankings, recently watched lists, and user profiles. Which Redis data types would you use for each and why?"</p>
                    
                    <p>This question tests whether you understand that Redis isn't just a "key-value store" - it's a data structure server with 8+ specialized types. Your answer reveals if you've built real systems or just memorized documentation.</p>
                    
                    <p><strong>The interviewer is looking for:</strong> (1) Knowledge of all data types, (2) Real-world use cases for each, (3) Why the right type matters for performance.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>Redis supports 8+ specialized data structures, each optimized for specific access patterns:</strong></p>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">1. üìù STRINGS</h4>
                        <p><strong>What:</strong> Binary-safe strings up to 512MB. Can store text, numbers, JSON, serialized objects, even images.</p>
                        <p><strong>Operations:</strong> SET, GET, INCR, DECR, APPEND</p>
                        <p><strong>Time Complexity:</strong> O(1) for all operations</p>
                        <p><strong>Use Cases:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>Caching HTML fragments, API responses</li>
                            <li>Atomic counters (page views, likes)</li>
                            <li>Session tokens</li>
                            <li>Feature flags (string "true"/"false")</li>
                        </ul>
                        <p><strong>Real Example:</strong> <code>SET user:1001:profile '{"name":"Alice","email":"alice@ex.com"}'</code></p>
                    </div>

                    <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #FFA500; margin-bottom: 15px;">2. üìã LISTS</h4>
                        <p><strong>What:</strong> Ordered collections implemented as linked lists. Elements maintain insertion order.</p>
                        <p><strong>Operations:</strong> LPUSH, RPUSH, LPOP, RPOP, LRANGE</p>
                        <p><strong>Time Complexity:</strong> O(1) for push/pop at ends, O(N) for middle access</p>
                        <p><strong>Use Cases:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>Activity feeds (latest posts)</li>
                            <li>Message queues (producer-consumer)</li>
                            <li>Recently viewed items</li>
                            <li>Undo/redo functionality</li>
                        </ul>
                        <p><strong>Real Example:</strong> <code>LPUSH feed:user:1001 "Posted a photo"</code> ‚Üí adds to front of feed</p>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #00FF88; margin-bottom: 15px;">3. üéØ SETS</h4>
                        <p><strong>What:</strong> Unordered collections of unique strings. No duplicates allowed.</p>
                        <p><strong>Operations:</strong> SADD, SREM, SISMEMBER, SUNION, SINTER</p>
                        <p><strong>Time Complexity:</strong> O(1) for add/remove/check membership</p>
                        <p><strong>Use Cases:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>Tags on articles/products</li>
                            <li>Unique visitor tracking</li>
                            <li>Friend/follower lists</li>
                            <li>Set operations (union, intersection for recommendations)</li>
                        </ul>
                        <p><strong>Real Example:</strong> <code>SADD article:555:tags "redis" "nosql"</code> ‚Üí unique tags only</p>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 15px;">4. üèÜ SORTED SETS (ZSets)</h4>
                        <p><strong>What:</strong> Sets where each member has a score. Members ordered by score (ascending).</p>
                        <p><strong>Operations:</strong> ZADD, ZRANK, ZREVRANGE, ZINCRBY</p>
                        <p><strong>Time Complexity:</strong> O(log N) for add/remove, O(log N + M) for range queries</p>
                        <p><strong>Use Cases:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>Leaderboards (gaming scores)</li>
                            <li>Priority queues</li>
                            <li>Trending content (score = views/likes)</li>
                            <li>Time-based data (score = timestamp)</li>
                        </ul>
                        <p><strong>Real Example:</strong> <code>ZADD leaderboard 15000 "player123"</code> ‚Üí instant rankings</p>
                    </div>

                    <div style="background: rgba(156, 39, 176, 0.1); border-left: 3px solid #9C27B0; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #9C27B0; margin-bottom: 15px;">5. üóÇÔ∏è HASHES</h4>
                        <p><strong>What:</strong> Maps of field-value pairs. Like mini-documents or objects.</p>
                        <p><strong>Operations:</strong> HSET, HGET, HGETALL, HINCRBY</p>
                        <p><strong>Time Complexity:</strong> O(1) for single field access, O(N) for HGETALL</p>
                        <p><strong>Use Cases:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>User profiles with multiple attributes</li>
                            <li>Product details (price, stock, description)</li>
                            <li>Session data with multiple fields</li>
                            <li>Rate limiting counters per user</li>
                        </ul>
                        <p><strong>Real Example:</strong> <code>HSET user:1001 name "Alice" age 28 city "NYC"</code></p>
                        <p><strong>Memory Benefit:</strong> More efficient than multiple String keys!</p>
                    </div>

                    <div style="background: rgba(255, 235, 59, 0.1); border-left: 3px solid #FFEB3B; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #FFEB3B; margin-bottom: 15px;">6. üî¢ BITMAPS</h4>
                        <p><strong>What:</strong> Bit arrays (not a separate type - uses Strings with bit operations).</p>
                        <p><strong>Operations:</strong> SETBIT, GETBIT, BITCOUNT, BITOP</p>
                        <p><strong>Time Complexity:</strong> O(1) for single bit, O(N) for operations</p>
                        <p><strong>Use Cases:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>Daily active users (1 bit per user per day)</li>
                            <li>Feature flags (1 bit per feature)</li>
                            <li>Real-time analytics</li>
                            <li>Access control (permissions as bits)</li>
                        </ul>
                        <p><strong>Real Example:</strong> <code>SETBIT logins:user:1001:2024 0 1</code> ‚Üí logged in day 0</p>
                        <p><strong>Space Efficient:</strong> 1 million users = only 125KB!</p>
                    </div>

                    <div style="background: rgba(255, 87, 34, 0.1); border-left: 3px solid #FF5722; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #FF5722; margin-bottom: 15px;">7. üìä HYPERLOGLOG</h4>
                        <p><strong>What:</strong> Probabilistic data structure for cardinality estimation (counting unique items).</p>
                        <p><strong>Operations:</strong> PFADD, PFCOUNT, PFMERGE</p>
                        <p><strong>Time Complexity:</strong> O(1) for all operations</p>
                        <p><strong>Accuracy:</strong> ~0.81% error rate (very accurate!)</p>
                        <p><strong>Use Cases:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>Unique visitors per page</li>
                            <li>Distinct search queries</li>
                            <li>Unique IP addresses</li>
                            <li>Cardinality of large datasets</li>
                        </ul>
                        <p><strong>Real Example:</strong> <code>PFADD unique_visitors:page:home user123</code></p>
                        <p><strong>Amazing Efficiency:</strong> Uses only 12KB to count billions of unique items!</p>
                    </div>

                    <div style="background: rgba(103, 58, 183, 0.1); border-left: 3px solid #673AB7; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #673AB7; margin-bottom: 15px;">8. üì° STREAMS</h4>
                        <p><strong>What:</strong> Append-only log structure (like Apache Kafka). Messages with unique IDs.</p>
                        <p><strong>Operations:</strong> XADD, XREAD, XRANGE, XGROUP</p>
                        <p><strong>Time Complexity:</strong> O(1) for append, O(log N) for range queries</p>
                        <p><strong>Use Cases:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>Event sourcing</li>
                            <li>Activity logs</li>
                            <li>Message broker (lightweight alternative to Kafka)</li>
                            <li>Real-time data pipelines</li>
                        </ul>
                        <p><strong>Real Example:</strong> <code>XADD events * action "purchase" user "alice" amount 99</code></p>
                        <p><strong>Features:</strong> Consumer groups, message acknowledgment, time-travel queries</p>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <strong>‚ÑπÔ∏è Why Multiple Types Matter:</strong> Each type is optimized for specific operations. Using the right type = simpler code + better performance + less memory. For example, Sorted Sets provide O(log N) rankings - doing this with Lists or Sets would be O(N) or require complex application logic!
                    </div>
                </div>

                ${getQuestion11VisualDiagrams()}
                ${getQuestion11CodeExamples()}
                ${getQuestion11CrossQuestions()}
                ${getQuestion11TrickyQuestions()}
                ${getQuestion11PracticalScenarios()}
                ${getQuestion11Remaining()}
            `;
        }

        function getQuestion11VisualDiagrams() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">Redis Data Types - Quick Reference Guide</div>
                        <svg viewBox="0 0 1000 650" style="max-width: 100%; height: auto;">
                            <text x="500" y="30" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">Choose the Right Data Type</text>
                            
                            <!-- Decision Flow -->
                            <rect x="400" y="60" width="200" height="50" fill="rgba(33, 150, 243, 0.3)" stroke="#2196F3" stroke-width="2" rx="8"/>
                            <text x="500" y="90" text-anchor="middle" fill="#fff" font-size="13">What do you need?</text>
                            
                            <!-- Row 1 -->
                            <rect x="50" y="140" width="180" height="110" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                            <text x="140" y="165" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">STRING</text>
                            <text x="140" y="185" text-anchor="middle" fill="#fff" font-size="10">Simple value?</text>
                            <text x="140" y="202" text-anchor="middle" fill="#00FF88" font-size="9">Cache, Counter</text>
                            <text x="140" y="220" text-anchor="middle" fill="#888" font-size="8">SET key "val"</text>
                            <text x="140" y="235" text-anchor="middle" fill="#FFA500" font-size="8">O(1)</text>

                            <rect x="250" y="140" width="180" height="110" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="340" y="165" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">LIST</text>
                            <text x="340" y="185" text-anchor="middle" fill="#fff" font-size="10">Ordered items?</text>
                            <text x="340" y="202" text-anchor="middle" fill="#00FF88" font-size="9">Feed, Queue</text>
                            <text x="340" y="220" text-anchor="middle" fill="#888" font-size="8">LPUSH key "item"</text>
                            <text x="340" y="235" text-anchor="middle" fill="#FFA500" font-size="8">O(1) push/pop</text>

                            <rect x="450" y="140" width="180" height="110" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="540" y="165" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">SET</text>
                            <text x="540" y="185" text-anchor="middle" fill="#fff" font-size="10">Unique items?</text>
                            <text x="540" y="202" text-anchor="middle" fill="#00FF88" font-size="9">Tags, IDs</text>
                            <text x="540" y="220" text-anchor="middle" fill="#888" font-size="8">SADD key "member"</text>
                            <text x="540" y="235" text-anchor="middle" fill="#FFA500" font-size="8">O(1) add/check</text>

                            <rect x="650" y="140" width="180" height="110" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="740" y="165" text-anchor="middle" fill="#2196F3" font-size="13" font-weight="600">SORTED SET</text>
                            <text x="740" y="185" text-anchor="middle" fill="#fff" font-size="10">Ranked items?</text>
                            <text x="740" y="202" text-anchor="middle" fill="#00FF88" font-size="9">Leaderboard</text>
                            <text x="740" y="220" text-anchor="middle" fill="#888" font-size="8">ZADD key 100 "m"</text>
                            <text x="740" y="235" text-anchor="middle" fill="#FFA500" font-size="8">O(log N)</text>

                            <!-- Row 2 -->
                            <rect x="50" y="280" width="180" height="110" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                            <text x="140" y="305" text-anchor="middle" fill="#9C27B0" font-size="13" font-weight="600">HASH</text>
                            <text x="140" y="325" text-anchor="middle" fill="#fff" font-size="10">Object fields?</text>
                            <text x="140" y="342" text-anchor="middle" fill="#00FF88" font-size="9">Profile, Product</text>
                            <text x="140" y="360" text-anchor="middle" fill="#888" font-size="8">HSET key f v</text>
                            <text x="140" y="375" text-anchor="middle" fill="#FFA500" font-size="8">O(1) per field</text>

                            <rect x="250" y="280" width="180" height="110" fill="rgba(255, 235, 59, 0.2)" stroke="#FFEB3B" stroke-width="2" rx="6"/>
                            <text x="340" y="305" text-anchor="middle" fill="#FFEB3B" font-size="13" font-weight="600">BITMAP</text>
                            <text x="340" y="325" text-anchor="middle" fill="#fff" font-size="10">Binary flags?</text>
                            <text x="340" y="342" text-anchor="middle" fill="#00FF88" font-size="9">Daily Activity</text>
                            <text x="340" y="360" text-anchor="middle" fill="#888" font-size="8">SETBIT k 0 1</text>
                            <text x="340" y="375" text-anchor="middle" fill="#FFA500" font-size="8">125KB/1M users!</text>

                            <rect x="450" y="280" width="180" height="110" fill="rgba(255, 87, 34, 0.2)" stroke="#FF5722" stroke-width="2" rx="6"/>
                            <text x="540" y="305" text-anchor="middle" fill="#FF5722" font-size="12" font-weight="600">HYPERLOGLOG</text>
                            <text x="540" y="325" text-anchor="middle" fill="#fff" font-size="10">Count unique?</text>
                            <text x="540" y="342" text-anchor="middle" fill="#00FF88" font-size="9">Unique Visitors</text>
                            <text x="540" y="360" text-anchor="middle" fill="#888" font-size="8">PFADD key "id"</text>
                            <text x="540" y="375" text-anchor="middle" fill="#FFA500" font-size="8">12KB for billions!</text>

                            <rect x="650" y="280" width="180" height="110" fill="rgba(103, 58, 183, 0.2)" stroke="#673AB7" stroke-width="2" rx="6"/>
                            <text x="740" y="305" text-anchor="middle" fill="#673AB7" font-size="13" font-weight="600">STREAM</text>
                            <text x="740" y="325" text-anchor="middle" fill="#fff" font-size="10">Event log?</text>
                            <text x="740" y="342" text-anchor="middle" fill="#00FF88" font-size="9">Activity Feed</text>
                            <text x="740" y="360" text-anchor="middle" fill="#888" font-size="8">XADD s * k v</text>
                            <text x="740" y="375" text-anchor="middle" fill="#FFA500" font-size="8">Like Kafka</text>

                            <!-- Use Case Matrix -->
                            <rect x="50" y="420" width="900" height="210" fill="rgba(0, 0, 0, 0.3)" stroke="#666" stroke-width="2" rx="8"/>
                            <text x="500" y="450" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">Common Use Cases Matrix</text>
                            
                            <text x="70" y="480" fill="#00FF88" font-size="11" font-weight="600">Feature</text>
                            <text x="300" y="480" fill="#00FF88" font-size="11" font-weight="600">Best Type</text>
                            <text x="550" y="480" fill="#00FF88" font-size="11" font-weight="600">Why?</text>
                            
                            <line x1="70" y1="490" x2="920" y2="490" stroke="#666" stroke-width="1"/>
                            
                            <text x="70" y="510" fill="#fff" font-size="10">User Session</text>
                            <text x="300" y="510" fill="#FFA500" font-size="10">STRING or HASH</text>
                            <text x="550" y="510" fill="#888" font-size="9">Simple token or multiple fields</text>
                            
                            <text x="70" y="535" fill="#fff" font-size="10">Twitter Feed</text>
                            <text x="300" y="535" fill="#FFA500" font-size="10">LIST</text>
                            <text x="550" y="535" fill="#888" font-size="9">LPUSH new tweets, LRANGE latest 50</text>
                            
                            <text x="70" y="560" fill="#fff" font-size="10">Gaming Leaderboard</text>
                            <text x="300" y="560" fill="#FFA500" font-size="10">SORTED SET</text>
                            <text x="550" y="560" fill="#888" font-size="9">Auto-ranked by score, O(log N) updates</text>
                            
                            <text x="70" y="585" fill="#fff" font-size="10">Article Tags</text>
                            <text x="300" y="585" fill="#FFA500" font-size="10">SET</text>
                            <text x="550" y="585" fill="#888" font-size="9">Unique tags, set operations (union/intersect)</text>
                            
                            <text x="70" y="610" fill="#fff" font-size="10">Page View Counter</text>
                            <text x="300" y="610" fill="#FFA500" font-size="10">STRING (INCR)</text>
                            <text x="550" y="610" fill="#888" font-size="9">Atomic increment, thread-safe</text>
                        </svg>
                    </div>
                </div>
            `;
        }

        function getQuestion11CodeExamples() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example: All 8 Data Types in One Application</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Social Media App Using All Types</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># 1. STRING - Cache user profile</span>
<span class="keyword">def</span> <span class="function">cache_profile</span>(user_id, data):
    r.setex(<span class="string">f"profile:</span>{user_id}<span class="string">"</span>, <span class="number">3600</span>, json.dumps(data))
    
<span class="comment"># 2. LIST - Activity feed (latest posts)</span>
<span class="keyword">def</span> <span class="function">add_to_feed</span>(user_id, post):
    r.lpush(<span class="string">f"feed:</span>{user_id}<span class="string">"</span>, post)
    r.ltrim(<span class="string">f"feed:</span>{user_id}<span class="string">"</span>, <span class="number">0</span>, <span class="number">99</span>)  <span class="comment"># Keep only 100 latest</span>

<span class="keyword">def</span> <span class="function">get_feed</span>(user_id, count=<span class="number">20</span>):
    <span class="keyword">return</span> r.lrange(<span class="string">f"feed:</span>{user_id}<span class="string">"</span>, <span class="number">0</span>, count-<span class="number">1</span>)

<span class="comment"># 3. SET - Followers/Following</span>
<span class="keyword">def</span> <span class="function">follow</span>(user_id, target_id):
    r.sadd(<span class="string">f"following:</span>{user_id}<span class="string">"</span>, target_id)
    r.sadd(<span class="string">f"followers:</span>{target_id}<span class="string">"</span>, user_id)

<span class="keyword">def</span> <span class="function">is_following</span>(user_id, target_id):
    <span class="keyword">return</span> r.sismember(<span class="string">f"following:</span>{user_id}<span class="string">"</span>, target_id)

<span class="keyword">def</span> <span class="function">mutual_friends</span>(user1, user2):
    <span class="comment"># Set intersection!</span>
    <span class="keyword">return</span> r.sinter(<span class="string">f"following:</span>{user1}<span class="string">"</span>, <span class="string">f"following:</span>{user2}<span class="string">"</span>)

<span class="comment"># 4. SORTED SET - Trending posts</span>
<span class="keyword">def</span> <span class="function">like_post</span>(post_id):
    r.zincrby(<span class="string">"trending:posts"</span>, <span class="number">1</span>, post_id)

<span class="keyword">def</span> <span class="function">get_trending</span>(count=<span class="number">10</span>):
    <span class="keyword">return</span> r.zrevrange(<span class="string">"trending:posts"</span>, <span class="number">0</span>, count-<span class="number">1</span>, withscores=<span class="keyword">True</span>)

<span class="comment"># 5. HASH - User settings</span>
<span class="keyword">def</span> <span class="function">update_settings</span>(user_id, **settings):
    r.hset(<span class="string">f"settings:</span>{user_id}<span class="string">"</span>, mapping=settings)

<span class="keyword">def</span> <span class="function">get_setting</span>(user_id, setting):
    <span class="keyword">return</span> r.hget(<span class="string">f"settings:</span>{user_id}<span class="string">"</span>, setting)

<span class="comment"># Example: update_settings(1001, theme="dark", notifications=True)</span>

<span class="comment"># 6. BITMAP - Daily active users</span>
<span class="keyword">def</span> <span class="function">mark_active</span>(user_id, date):
    <span class="comment"># Each user gets 1 bit per day</span>
    day_offset = <span class="function">int</span>((date - datetime(<span class="number">2024</span>, <span class="number">1</span>, <span class="number">1</span>)).days)
    r.setbit(<span class="string">f"active:</span>{date.year}<span class="string">"</span>, day_offset * <span class="number">1000000</span> + user_id, <span class="number">1</span>)

<span class="keyword">def</span> <span class="function">count_daily_active</span>(date):
    day_offset = <span class="function">int</span>((date - datetime(<span class="number">2024</span>, <span class="number">1</span>, <span class="number">1</span>)).days)
    <span class="keyword">return</span> r.bitcount(<span class="string">f"active:</span>{date.year}<span class="string">"</span>, 
                         day_offset * <span class="number">1000000</span>, 
                         (day_offset + <span class="number">1</span>) * <span class="number">1000000</span>)

<span class="comment"># 7. HYPERLOGLOG - Unique page views</span>
<span class="keyword">def</span> <span class="function">track_page_view</span>(page, user_id):
    r.pfadd(<span class="string">f"unique_views:</span>{page}<span class="string">"</span>, user_id)

<span class="keyword">def</span> <span class="function">get_unique_views</span>(page):
    <span class="keyword">return</span> r.pfcount(<span class="string">f"unique_views:</span>{page}<span class="string">"</span>)

<span class="comment"># Uses only 12KB regardless of user count!</span>

<span class="comment"># 8. STREAM - Activity log</span>
<span class="keyword">def</span> <span class="function">log_activity</span>(user_id, action, **data):
    r.xadd(<span class="string">"activity_log"</span>, {
        <span class="string">"user_id"</span>: user_id,
        <span class="string">"action"</span>: action,
        **data
    })

<span class="keyword">def</span> <span class="function">get_recent_activity</span>(count=<span class="number">100</span>):
    <span class="keyword">return</span> r.xrevrange(<span class="string">"activity_log"</span>, <span class="string">"+"</span>, <span class="string">"-"</span>, count=count)

<span class="comment"># Example usage:</span>
<span class="comment"># log_activity(1001, "post_created", post_id=555, text="Hello")</span></code></pre>
                    </div>
                </div>
            `;
        }

        function getQuestion11CrossQuestions() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Which data type should I use for a shopping cart?</h4>
                        <p><strong>A:</strong> <strong>HASH</strong> is best. Key = <code>cart:user123</code>, fields = product IDs, values = quantities. Example: <code>HSET cart:user123 product:555 2 product:777 1</code>. Alternative: STRING with JSON, but Hash allows atomic updates per item (HINCRBY).</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: When should I use List vs Sorted Set?</h4>
                        <p><strong>A:</strong> <strong>List</strong> = order by insertion (feed, queue). <strong>Sorted Set</strong> = order by score (rankings, priority). Example: Twitter feed uses List (chronological), leaderboard uses Sorted Set (by score).</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can I store JSON in Redis?</h4>
                        <p><strong>A:</strong> Yes! Store as STRING: <code>SET user:1001 '{"name":"Alice","age":28}'</code>. But if accessing individual fields frequently, use HASH instead (more efficient). Redis also has RedisJSON module for native JSON support with path queries.</p>
                    </div>
                </div>
            `;
        }

        function getQuestion11TrickyQuestions() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Why use Hash instead of multiple String keys?</h4>
                        <p><strong>Answer:</strong> Memory efficiency! Example:</p>
                        <p><strong>Multiple Strings:</strong></p>
                        <ul>
                            <li><code>SET user:1001:name "Alice"</code></li>
                            <li><code>SET user:1001:age "28"</code></li>
                            <li><code>SET user:1001:city "NYC"</code></li>
                            <li>Each key has overhead (~50-100 bytes)</li>
                            <li>Total: ~300 bytes overhead</li>
                        </ul>
                        <p><strong>One Hash:</strong></p>
                        <ul>
                            <li><code>HSET user:1001 name "Alice" age 28 city "NYC"</code></li>
                            <li>Single key overhead (~50 bytes)</li>
                            <li>Saves 250 bytes per user!</li>
                        </ul>
                        <p>For 1M users: saves 250MB of RAM. Plus, HGETALL retrieves all fields in one command vs 3 separate GETs.</p>
                    </div>
                </div>
            `;
        }

        function getQuestion11PracticalScenarios() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    
                    <p><strong>Building a Social Media App - Choosing Types:</strong></p>
                    <ul>
                        <li><strong>User profiles:</strong> HASH (name, bio, avatar URL)</li>
                        <li><strong>Activity feed:</strong> LIST (latest 100 posts)</li>
                        <li><strong>Followers:</strong> SET (unique user IDs)</li>
                        <li><strong>Trending posts:</strong> SORTED SET (score = likes)</li>
                        <li><strong>View counter:</strong> STRING with INCR</li>
                        <li><strong>Unique visitors:</strong> HYPERLOGLOG (12KB for billions)</li>
                    </ul>
                    <p><strong>Result:</strong> Each type optimized for its use case = faster queries + less code!</p>
                </div>
            `;
        }

        function getQuestion11Remaining() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>8 main types</strong> - Each optimized for specific patterns</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Right type matters</strong> - Performance + memory + simpler code</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üöÄ</span><p><strong>Most common</strong> - Strings (80%), Hashes (10%), Sorted Sets (5%)</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">Strings</span><span class="keyword-tag">Lists</span><span class="keyword-tag">Sets</span><span class="keyword-tag">Sorted Sets</span><span class="keyword-tag">Hashes</span><span class="keyword-tag">Bitmaps</span><span class="keyword-tag">HyperLogLog</span><span class="keyword-tag">Streams</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> Which type for gaming leaderboard?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) List</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) Sorted Set</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Set</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) Hash</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>Sorted Sets auto-rank by score with O(log N) updates!</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getQuestion12Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>Meet Sarah, a junior developer at a startup.</strong> Her team is building a user profile system and she's confused: "Should I use one String key to store all user data, or use a Hash with multiple fields? What's the difference?"</p>
                    
                    <p>Her senior colleague explains: "Imagine you have a user with name, email, age, and city. You can store this in two ways..."</p>
                    
                    <p>This is a fundamental choice every Redis developer faces. Let's understand when to use each approach and why it matters for performance and memory!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">STRING - Single Value Approach</h4>
                        <p><strong>What it is:</strong> One key stores one complete value (can be text, number, or JSON)</p>
                        <p><strong>How it works:</strong> The entire value is treated as a single unit - you read/write everything together</p>
                        <p><strong>Example:</strong></p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET user:1001 '{"name":"Alice","email":"alice@ex.com","age":28,"city":"NYC"}'</code>
                        </div>
                        <p style="margin-top: 10px;"><strong>To get name only:</strong> You must GET the entire JSON and parse it in your application</p>
                        <p><strong>Good for:</strong> Simple values, counters, small objects you always fetch completely</p>
                    </div>

                    <div style="background: rgba(156, 39, 176, 0.1); border-left: 3px solid #9C27B0; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #9C27B0; margin-bottom: 15px;">HASH - Multiple Fields Approach</h4>
                        <p><strong>What it is:</strong> One key contains multiple field-value pairs (like a mini-document)</p>
                        <p><strong>How it works:</strong> Each field can be read/written independently</p>
                        <p><strong>Example:</strong></p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">HSET user:1001 name "Alice" email "alice@ex.com" age 28 city "NYC"</code>
                        </div>
                        <p style="margin-top: 10px;"><strong>To get name only:</strong> <code style="color: #50fa7b;">HGET user:1001 name</code> ‚Üí Returns just "Alice"</p>
                        <p><strong>Good for:</strong> Objects with many fields where you often need just one or two fields</p>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 10px;">üéØ Key Differences Summary</h4>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                            <tr style="background: rgba(220,20,60,0.2); border-bottom: 2px solid var(--primary-color);">
                                <th style="padding: 10px; text-align: left;">Aspect</th>
                                <th style="padding: 10px; text-align: left;">STRING</th>
                                <th style="padding: 10px; text-align: left;">HASH</th>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><strong>Structure</strong></td>
                                <td style="padding: 8px;">One blob of data</td>
                                <td style="padding: 8px;">Multiple field:value pairs</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><strong>Access</strong></td>
                                <td style="padding: 8px;">All or nothing</td>
                                <td style="padding: 8px;">Individual fields</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><strong>Update</strong></td>
                                <td style="padding: 8px;">Rewrite entire value</td>
                                <td style="padding: 8px;">Update single field</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><strong>Memory</strong></td>
                                <td style="padding: 8px;">More (separate keys)</td>
                                <td style="padding: 8px;">Less (shared overhead)</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><strong>Speed</strong></td>
                                <td style="padding: 8px;">Fast for small data</td>
                                <td style="padding: 8px;">Fast for partial access</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px;"><strong>Use Case</strong></td>
                                <td style="padding: 8px;">Simple cache, counters</td>
                                <td style="padding: 8px;">User profiles, settings</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">String vs Hash - Visual Comparison</div>
                        <svg viewBox="0 0 1000 600" style="max-width: 100%; height: auto;">
                            <text x="500" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">STRING vs HASH Storage Patterns</text>
                            
                            <!-- LEFT SIDE - STRING -->
                            <text x="250" y="70" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="600">STRING Approach</text>
                            
                            <!-- String storage visualization -->
                            <rect x="100" y="100" width="300" height="80" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="3" rx="8">
                                <animate attributeName="opacity" values="0.6;1;0.6" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="250" y="130" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">Key: user:1001</text>
                            <text x="250" y="155" text-anchor="middle" fill="#fff" font-size="11">Value: '{...entire JSON...}'</text>
                            <text x="250" y="172" text-anchor="middle" fill="#888" font-size="9">One big blob of data</text>

                            <!-- Access pattern -->
                            <rect x="120" y="210" width="260" height="120" fill="rgba(0,0,0,0.3)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="250" y="235" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">How to access?</text>
                            <text x="130" y="260" fill="#fff" font-size="10">GET user:1001</text>
                            <text x="130" y="280" fill="#888" font-size="9">‚Üí Returns entire JSON</text>
                            <text x="130" y="300" fill="#888" font-size="9">‚Üí Parse in application</text>
                            <text x="130" y="320" fill="#888" font-size="9">‚Üí Extract what you need</text>

                            <!-- Pros/Cons -->
                            <rect x="120" y="350" width="120" height="80" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="180" y="375" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">‚úÖ Pros</text>
                            <text x="130" y="395" fill="#fff" font-size="9">‚Ä¢ Simple</text>
                            <text x="130" y="410" fill="#fff" font-size="9">‚Ä¢ Fast for small data</text>
                            <text x="130" y="425" fill="#fff" font-size="9">‚Ä¢ JSON flexibility</text>

                            <rect x="260" y="350" width="120" height="80" fill="rgba(255, 0, 0, 0.1)" stroke="#ff0000" stroke-width="2" rx="6"/>
                            <text x="320" y="375" text-anchor="middle" fill="#ff0000" font-size="12" font-weight="600">‚ùå Cons</text>
                            <text x="270" y="395" fill="#fff" font-size="9">‚Ä¢ Fetch all data</text>
                            <text x="270" y="410" fill="#fff" font-size="9">‚Ä¢ Parse overhead</text>
                            <text x="270" y="425" fill="#fff" font-size="9">‚Ä¢ Update = rewrite all</text>

                            <!-- RIGHT SIDE - HASH -->
                            <text x="750" y="70" text-anchor="middle" fill="#9C27B0" font-size="18" font-weight="600">HASH Approach</text>
                            
                            <!-- Hash storage visualization -->
                            <rect x="600" y="100" width="300" height="180" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="3" rx="8">
                                <animate attributeName="opacity" values="0.6;1;0.6" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="750" y="125" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="600">Key: user:1001</text>
                            
                            <!-- Individual fields -->
                            <rect x="620" y="140" width="120" height="30" fill="rgba(0,0,0,0.4)" stroke="#00FF88" stroke-width="1" rx="4"/>
                            <text x="680" y="160" text-anchor="middle" fill="#fff" font-size="10">name ‚Üí "Alice"</text>
                            
                            <rect x="760" y="140" width="120" height="30" fill="rgba(0,0,0,0.4)" stroke="#00FF88" stroke-width="1" rx="4"/>
                            <text x="820" y="160" text-anchor="middle" fill="#fff" font-size="10">email ‚Üí "a@ex"</text>
                            
                            <rect x="620" y="180" width="120" height="30" fill="rgba(0,0,0,0.4)" stroke="#00FF88" stroke-width="1" rx="4"/>
                            <text x="680" y="200" text-anchor="middle" fill="#fff" font-size="10">age ‚Üí 28</text>
                            
                            <rect x="760" y="180" width="120" height="30" fill="rgba(0,0,0,0.4)" stroke="#00FF88" stroke-width="1" rx="4"/>
                            <text x="820" y="200" text-anchor="middle" fill="#fff" font-size="10">city ‚Üí "NYC"</text>
                            
                            <text x="750" y="260" text-anchor="middle" fill="#888" font-size="9">Each field stored separately</text>

                            <!-- Access pattern -->
                            <rect x="620" y="300" width="260" height="120" fill="rgba(0,0,0,0.3)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="750" y="325" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">How to access?</text>
                            <text x="630" y="350" fill="#fff" font-size="10">HGET user:1001 name</text>
                            <text x="630" y="370" fill="#00FF88" font-size="9">‚Üí Returns just "Alice"</text>
                            <text x="630" y="390" fill="#00FF88" font-size="9">‚Üí No parsing needed!</text>
                            <text x="630" y="410" fill="#888" font-size="9">‚Üí Update one field: HSET ...</text>

                            <!-- Pros/Cons -->
                            <rect x="620" y="440" width="120" height="95" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="680" y="465" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">‚úÖ Pros</text>
                            <text x="630" y="485" fill="#fff" font-size="9">‚Ä¢ Get single field</text>
                            <text x="630" y="500" fill="#fff" font-size="9">‚Ä¢ Update one field</text>
                            <text x="630" y="515" fill="#fff" font-size="9">‚Ä¢ Less memory</text>
                            <text x="630" y="530" fill="#fff" font-size="9">‚Ä¢ No JSON parsing</text>

                            <rect x="760" y="440" width="120" height="95" fill="rgba(255, 0, 0, 0.1)" stroke="#ff0000" stroke-width="2" rx="6"/>
                            <text x="820" y="465" text-anchor="middle" fill="#ff0000" font-size="12" font-weight="600">‚ùå Cons</text>
                            <text x="770" y="485" fill="#fff" font-size="9">‚Ä¢ More commands</text>
                            <text x="770" y="500" fill="#fff" font-size="9">‚Ä¢ Slightly complex</text>
                            <text x="770" y="515" fill="#fff" font-size="9">‚Ä¢ Not for nested data</text>

                            <!-- Bottom comparison -->
                            <rect x="100" y="460" width="800" height="100" fill="rgba(33, 150, 243, 0.1)" stroke="#2196F3" stroke-width="2" rx="8"/>
                            <text x="500" y="485" text-anchor="middle" fill="#2196F3" font-size="14" font-weight="600">üí° When to Use Each?</text>
                            
                            <text x="120" y="510" fill="#DC143C" font-size="11" font-weight="600">Use STRING when:</text>
                            <text x="130" y="530" fill="#fff" font-size="10">‚Ä¢ Always need complete object</text>
                            <text x="130" y="545" fill="#fff" font-size="10">‚Ä¢ Data is small (&lt;1KB)</text>

                            <text x="520" y="510" fill="#9C27B0" font-size="11" font-weight="600">Use HASH when:</text>
                            <text x="530" y="530" fill="#fff" font-size="10">‚Ä¢ Often need just 1-2 fields</text>
                            <text x="530" y="545" fill="#fff" font-size="10">‚Ä¢ Update fields independently</text>
                        </svg>
                    </div>

                    <div class="diagram-container" style="margin-top: 30px;">
                        <div class="diagram-title">Memory Usage Comparison</div>
                        <svg viewBox="0 0 800 400" style="max-width: 100%; height: auto;">
                            <text x="400" y="30" text-anchor="middle" fill="#fff" font-size="16" font-weight="600">Memory Usage: 1000 Users</text>
                            
                            <!-- STRING approach -->
                            <rect x="100" y="70" width="250" height="250" fill="rgba(220, 20, 60, 0.1)" stroke="#DC143C" stroke-width="2" rx="8"/>
                            <text x="225" y="100" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">STRING Approach</text>
                            
                            <text x="110" y="130" fill="#fff" font-size="11">1000 separate keys:</text>
                            <text x="120" y="155" fill="#888" font-size="10">‚Ä¢ user:1:name = "Alice"</text>
                            <text x="120" y="175" fill="#888" font-size="10">‚Ä¢ user:1:email = "..."</text>
                            <text x="120" y="195" fill="#888" font-size="10">‚Ä¢ user:1:age = 28</text>
                            <text x="120" y="215" fill="#888" font-size="10">‚Ä¢ user:1:city = "NYC"</text>
                            <text x="120" y="235" fill="#666" font-size="9">... √ó 1000 users √ó 4 fields</text>
                            
                            <rect x="110" y="255" width="230" height="50" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="2" rx="6"/>
                            <text x="225" y="275" text-anchor="middle" fill="#ff0000" font-size="12" font-weight="600">Memory: ~800KB</text>
                            <text x="225" y="295" text-anchor="middle" fill="#888" font-size="10">Each key has overhead</text>

                            <!-- HASH approach -->
                            <rect x="450" y="70" width="250" height="250" fill="rgba(156, 39, 176, 0.1)" stroke="#9C27B0" stroke-width="2" rx="8"/>
                            <text x="575" y="100" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="600">HASH Approach</text>
                            
                            <text x="460" y="130" fill="#fff" font-size="11">1000 hashes:</text>
                            <text x="470" y="155" fill="#888" font-size="10">user:1 {</text>
                            <text x="490" y="175" fill="#888" font-size="10">name: "Alice",</text>
                            <text x="490" y="195" fill="#888" font-size="10">email: "...",</text>
                            <text x="490" y="215" fill="#888" font-size="10">age: 28,</text>
                            <text x="490" y="235" fill="#888" font-size="10">city: "NYC"</text>
                            <text x="470" y="250" fill="#888" font-size="10">}</text>
                            
                            <rect x="460" y="255" width="230" height="50" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="575" y="275" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Memory: ~400KB</text>
                            <text x="575" y="295" text-anchor="middle" fill="#888" font-size="10">Shared overhead!</text>

                            <!-- Savings -->
                            <text x="400" y="355" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="700">50% Memory Savings! üí∞</text>
                            <text x="400" y="380" text-anchor="middle" fill="#888" font-size="11">Hash is more memory-efficient for objects with multiple fields</text>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: STRING Approach</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI - Using Strings</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Store user as JSON string</span>
<span class="keyword">SET</span> <span class="string">user:1001</span> <span class="string">'{"name":"Alice","email":"alice@example.com","age":28,"city":"NYC"}'</span>

<span class="comment"># Get entire user</span>
<span class="keyword">GET</span> <span class="string">user:1001</span>
<span class="string">"{\"name\":\"Alice\",\"email\":\"alice@example.com\",\"age\":28,\"city\":\"NYC\"}"</span>

<span class="comment"># Problem: Want to update just the age?</span>
<span class="comment"># You must:</span>
<span class="comment"># 1. GET the entire value</span>
<span class="comment"># 2. Parse JSON in your application</span>
<span class="comment"># 3. Modify the age field</span>
<span class="comment"># 4. Convert back to JSON</span>
<span class="comment"># 5. SET the entire value again</span>

<span class="comment"># Alternative: Separate keys for each field</span>
<span class="keyword">SET</span> <span class="string">user:1001:name</span> <span class="string">"Alice"</span>
<span class="keyword">SET</span> <span class="string">user:1001:email</span> <span class="string">"alice@example.com"</span>
<span class="keyword">SET</span> <span class="string">user:1001:age</span> <span class="number">28</span>
<span class="keyword">SET</span> <span class="string">user:1001:city</span> <span class="string">"NYC"</span>

<span class="comment"># Get just the name</span>
<span class="keyword">GET</span> <span class="string">user:1001:name</span>
<span class="string">"Alice"</span>

<span class="comment"># Update just the age</span>
<span class="keyword">SET</span> <span class="string">user:1001:age</span> <span class="number">29</span>

<span class="comment"># Problem with this approach:</span>
<span class="comment"># - 4 separate keys = more memory overhead</span>
<span class="comment"># - Need 4 GET commands to fetch complete user</span>
<span class="comment"># - No atomic operations across all fields</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: HASH Approach (Better!)</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI - Using Hashes</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Create user with all fields at once</span>
<span class="keyword">HSET</span> <span class="string">user:1001</span> <span class="string">name</span> <span class="string">"Alice"</span> <span class="string">email</span> <span class="string">"alice@example.com"</span> <span class="string">age</span> <span class="number">28</span> <span class="string">city</span> <span class="string">"NYC"</span>
<span class="number">(integer) 4</span>  <span class="comment"># 4 fields created</span>

<span class="comment"># Get single field - FAST!</span>
<span class="keyword">HGET</span> <span class="string">user:1001</span> <span class="string">name</span>
<span class="string">"Alice"</span>

<span class="comment"># Get multiple specific fields</span>
<span class="keyword">HMGET</span> <span class="string">user:1001</span> <span class="string">name</span> <span class="string">age</span>
<span class="number">1)</span> <span class="string">"Alice"</span>
<span class="number">2)</span> <span class="string">"28"</span>

<span class="comment"># Get ALL fields</span>
<span class="keyword">HGETALL</span> <span class="string">user:1001</span>
<span class="number">1)</span> <span class="string">"name"</span>
<span class="number">2)</span> <span class="string">"Alice"</span>
<span class="number">3)</span> <span class="string">"email"</span>
<span class="number">4)</span> <span class="string">"alice@example.com"</span>
<span class="number">5)</span> <span class="string">"age"</span>
<span class="number">6)</span> <span class="string">"28"</span>
<span class="number">7)</span> <span class="string">"city"</span>
<span class="number">8)</span> <span class="string">"NYC"</span>

<span class="comment"># Update single field - NO JSON parsing!</span>
<span class="keyword">HSET</span> <span class="string">user:1001</span> <span class="string">age</span> <span class="number">29</span>
<span class="number">(integer) 0</span>  <span class="comment"># 0 = field updated (not created)</span>

<span class="comment"># Add new field</span>
<span class="keyword">HSET</span> <span class="string">user:1001</span> <span class="string">country</span> <span class="string">"USA"</span>
<span class="number">(integer) 1</span>  <span class="comment"># 1 = new field created</span>

<span class="comment"># Delete a field</span>
<span class="keyword">HDEL</span> <span class="string">user:1001</span> <span class="string">country</span>
<span class="number">(integer) 1</span>

<span class="comment"># Check if field exists</span>
<span class="keyword">HEXISTS</span> <span class="string">user:1001</span> <span class="string">name</span>
<span class="number">(integer) 1</span>  <span class="comment"># Yes, exists</span>

<span class="comment"># Get all field names</span>
<span class="keyword">HKEYS</span> <span class="string">user:1001</span>
<span class="number">1)</span> <span class="string">"name"</span>
<span class="number">2)</span> <span class="string">"email"</span>
<span class="number">3)</span> <span class="string">"age"</span>
<span class="number">4)</span> <span class="string">"city"</span>

<span class="comment"># Get number of fields</span>
<span class="keyword">HLEN</span> <span class="string">user:1001</span>
<span class="number">(integer) 4</span>

<span class="comment"># Increment numeric field atomically</span>
<span class="keyword">HINCRBY</span> <span class="string">user:1001:stats</span> <span class="string">login_count</span> <span class="number">1</span>
<span class="number">(integer) 1</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Real Python Application</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - String vs Hash Comparison</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># ============================================</span>
<span class="comment"># APPROACH 1: STRING with JSON</span>
<span class="comment"># ============================================</span>
<span class="keyword">class</span> <span class="function">UserProfileString</span>:
    <span class="keyword">def</span> <span class="function">save</span>(<span class="keyword">self</span>, user_id, profile):
        <span class="comment"># Must convert entire object to JSON</span>
        r.set(<span class="string">f"user:</span>{user_id}<span class="string">"</span>, json.dumps(profile))
    
    <span class="keyword">def</span> <span class="function">get_name</span>(<span class="keyword">self</span>, user_id):
        <span class="comment"># Must fetch and parse entire JSON</span>
        data = r.get(<span class="string">f"user:</span>{user_id}<span class="string">"</span>)
        profile = json.loads(data)
        <span class="keyword">return</span> profile[<span class="string">"name"</span>]
    
    <span class="keyword">def</span> <span class="function">update_age</span>(<span class="keyword">self</span>, user_id, new_age):
        <span class="comment"># Must get all, modify, save all</span>
        data = r.get(<span class="string">f"user:</span>{user_id}<span class="string">"</span>)
        profile = json.loads(data)
        profile[<span class="string">"age"</span>] = new_age
        r.set(<span class="string">f"user:</span>{user_id}<span class="string">"</span>, json.dumps(profile))

<span class="comment"># ============================================</span>
<span class="comment"># APPROACH 2: HASH (Better!)</span>
<span class="comment"># ============================================</span>
<span class="keyword">class</span> <span class="function">UserProfileHash</span>:
    <span class="keyword">def</span> <span class="function">save</span>(<span class="keyword">self</span>, user_id, profile):
        <span class="comment"># Save all fields at once</span>
        r.hset(<span class="string">f"user:</span>{user_id}<span class="string">"</span>, mapping=profile)
    
    <span class="keyword">def</span> <span class="function">get_name</span>(<span class="keyword">self</span>, user_id):
        <span class="comment"># Get just one field - no parsing!</span>
        <span class="keyword">return</span> r.hget(<span class="string">f"user:</span>{user_id}<span class="string">"</span>, <span class="string">"name"</span>)
    
    <span class="keyword">def</span> <span class="function">update_age</span>(<span class="keyword">self</span>, user_id, new_age):
        <span class="comment"># Update just one field - atomic!</span>
        r.hset(<span class="string">f"user:</span>{user_id}<span class="string">"</span>, <span class="string">"age"</span>, new_age)

<span class="comment"># Usage example</span>
profile = {
    <span class="string">"name"</span>: <span class="string">"Alice"</span>,
    <span class="string">"email"</span>: <span class="string">"alice@example.com"</span>,
    <span class="string">"age"</span>: <span class="number">28</span>,
    <span class="string">"city"</span>: <span class="string">"NYC"</span>
}

<span class="comment"># Hash approach is cleaner and faster!</span>
user_hash = UserProfileHash()
user_hash.save(<span class="number">1001</span>, profile)
name = user_hash.get_name(<span class="number">1001</span>)  <span class="comment"># Just "Alice"</span>
user_hash.update_age(<span class="number">1001</span>, <span class="number">29</span>)  <span class="comment"># Only updates age field</span></code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: When should I use String instead of Hash?</h4>
                        <p><strong>A:</strong> Use STRING when: (1) Data is very small (just a counter or flag), (2) You ALWAYS need the complete object, (3) Data structure changes frequently (JSON is flexible). Example: <code>SET page:views 1000</code> for a simple counter.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can Hash store nested objects like JSON?</h4>
                        <p><strong>A:</strong> No! Hash fields can only store flat strings. If you need nested data like <code>{"address": {"street": "...", "city": "..."}}</code>, use a STRING with JSON, or flatten the structure: <code>HSET user:1 address_street "..." address_city "..."</code></p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Is Hash really more memory efficient?</h4>
                        <p><strong>A:</strong> Yes! With 1000 users √ó 10 fields: Separate STRING keys = ~1.2MB, HASH = ~600KB. That's 50% savings! Each Redis key has ~100 bytes overhead. Hash shares one key for all fields.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can I set TTL on individual Hash fields?</h4>
                        <p><strong>A:</strong> No! TTL applies to the entire Hash key, not individual fields. If you need field-level expiry, use separate STRING keys: <code>SET session:token:abc "..." EX 3600</code></p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Which is faster for reading?</h4>
                        <p><strong>A:</strong> <strong>STRING</strong> is slightly faster if you need ALL data (one GET vs HGETALL). <strong>HASH</strong> is much faster if you need just 1-2 fields (HGET vs GET+JSON parse). For 80% of cases where you need partial data, Hash wins!</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can Hash fields have the same name as the key?</h4>
                        <p><strong>Answer:</strong> Yes! They're in different namespaces. This is valid:</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                            <code style="color: #50fa7b;">SET user "Alice"  <span style="color: #888;">// String key</span><br>
                            HSET user name "Bob"  <span style="color: #888;">// Hash key with field "name"</span></code>
                        </div>
                        <p>These are TWO different keys! GET user returns "Alice", HGET user name returns "Bob". However, this is confusing - use different key names in practice!</p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: What if I HSET a STRING key by mistake?</h4>
                        <p><strong>Answer:</strong> Error! You'll get: <code style="color: #ff0000;">(error) WRONGTYPE Operation against a key holding the wrong kind of value</code></p>
                        <p style="margin-top: 10px;">Redis keys have a TYPE. Once set, you can't mix operations:</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                            <code style="color: #888;">SET user:1 "data"  // Now it's a STRING<br>
                            HSET user:1 name "Alice"  // ERROR!</code>
                        </div>
                        <p><strong>Solution:</strong> Delete the key first: <code>DEL user:1</code> then create as Hash</p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Are Hash operations atomic across multiple fields?</h4>
                        <p><strong>Answer:</strong> Partially! <code>HSET user:1 name "Alice" age 28</code> is atomic - both fields set together. BUT <code>HGET</code> and then <code>HSET</code> in two separate commands is NOT atomic. Between the two commands, another client could modify the data.</p>
                        <p style="margin-top: 10px;"><strong>For atomic multi-field operations, use Lua scripts or transactions (MULTI/EXEC).</strong></p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    
                    <p><strong>Scenario: Building a User Profile Cache</strong></p>
                    <p>Your team is caching 100,000 user profiles. Each has: name, email, age, city, signup_date, premium_status (6 fields).</p>

                    <h4 style="color: var(--primary-color); margin-top: 20px;">Option 1: Separate STRING keys</h4>
                    <div style="background: rgba(255, 0, 0, 0.1); border-left: 3px solid #ff0000; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <p><strong>Approach:</strong></p>
                        <code>SET user:1:name "Alice"<br>
                        SET user:1:email "alice@ex.com"<br>
                        SET user:1:age 28</code>
                        <p style="margin-top: 10px;"><strong>Memory:</strong> 100K users √ó 6 fields √ó 150 bytes = ~90MB</p>
                        <p><strong>To get name:</strong> 1 GET command ‚úÖ</p>
                        <p><strong>To get full profile:</strong> 6 GET commands ‚ùå</p>
                        <p><strong>Result:</strong> Good for single-field access, bad for complete profiles</p>
                    </div>

                    <h4 style="color: var(--primary-color);">Option 2: STRING with JSON</h4>
                    <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <p><strong>Approach:</strong></p>
                        <code>SET user:1 '{"name":"Alice","email":"...","age":28,...}'</code>
                        <p style="margin-top: 10px;"><strong>Memory:</strong> ~60MB (less overhead)</p>
                        <p><strong>To get name:</strong> GET + JSON parse in app ‚ùå</p>
                        <p><strong>To get full profile:</strong> 1 GET ‚úÖ</p>
                        <p><strong>To update age:</strong> GET + parse + modify + SET (4 steps!) ‚ùå</p>
                        <p><strong>Result:</strong> Good for full reads, bad for partial updates</p>
                    </div>

                    <h4 style="color: var(--primary-color);">Option 3: HASH (Winner! üèÜ)</h4>
                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <p><strong>Approach:</strong></p>
                        <code>HSET user:1 name "Alice" email "alice@ex.com" age 28 ...</code>
                        <p style="margin-top: 10px;"><strong>Memory:</strong> ~45MB (best!) ‚úÖ</p>
                        <p><strong>To get name:</strong> HGET user:1 name (instant!) ‚úÖ</p>
                        <p><strong>To get full profile:</strong> HGETALL user:1 ‚úÖ</p>
                        <p><strong>To update age:</strong> HSET user:1 age 29 (one command!) ‚úÖ</p>
                        <p><strong>Result:</strong> Best of all worlds - flexible, fast, memory-efficient!</p>
                    </div>

                    <p><strong>Real Impact:</strong></p>
                    <ul>
                        <li>50% less memory = $500/month savings on AWS</li>
                        <li>Single-field updates 10x faster (no JSON parsing)</li>
                        <li>Code is cleaner and more maintainable</li>
                    </ul>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>STRING = one blob</strong> - Get/set entire value as a unit</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üóÇÔ∏è</span><p><strong>HASH = field-value pairs</strong> - Access individual fields independently</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Hash saves 50% memory</strong> - Shared overhead vs separate keys</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Hash faster for partial access</strong> - No JSON parsing needed</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Use Hash for objects</strong> - User profiles, settings, product details</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üö´</span><p><strong>Hash can't do nesting</strong> - Only flat key-value, no nested objects</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">STRING</span><span class="keyword-tag">HASH</span><span class="keyword-tag">HSET</span><span class="keyword-tag">HGET</span><span class="keyword-tag">HGETALL</span><span class="keyword-tag">Field-Value</span><span class="keyword-tag">Memory Efficiency</span><span class="keyword-tag">JSON Parsing</span><span class="keyword-tag">Partial Access</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> You need to cache user profiles and often fetch just the username. Which is better?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) STRING with JSON</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) HASH with fields</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Separate STRING keys for each field</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) LIST of values</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>HASH is perfect! You can <code>HGET user:1 username</code> to get just the username without fetching/parsing the entire profile. It's faster and uses less memory than separate keys!</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getQuestion13Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>Meet Tom, a developer building a login system.</strong> His manager asks: "Tom, users are staying logged in forever! Even when they close the browser, their sessions never expire. Can you make sessions expire after 30 minutes of inactivity?"</p>
                    
                    <p>Tom scratches his head: "How do I make data in Redis automatically disappear after some time?" His senior colleague smiles: "That's what TTL is for - Time To Live!"</p>
                    
                    <p>This is one of Redis's most powerful features - automatic data expiry. Let's understand how it works!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>TTL = Time To Live</strong> - The number of seconds remaining before a key automatically expires and gets deleted from Redis.</p>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">üïê How TTL Works</h4>
                        <p><strong>1. Set a key with expiry:</strong></p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <code style="color: #50fa7b;">SET session:abc123 "user_data" EX 1800</code><br>
                            <span style="color: #888; font-size: 11px;">‚Üë This session will auto-delete in 1800 seconds (30 minutes)</span>
                        </div>

                        <p style="margin-top: 15px;"><strong>2. Check how much time is left:</strong></p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <code style="color: #50fa7b;">TTL session:abc123</code><br>
                            <code style="color: #FFA500;">(integer) 1650</code> <span style="color: #888; font-size: 11px;">‚Üê 1650 seconds remaining</span>
                        </div>

                        <p style="margin-top: 15px;"><strong>3. After 30 minutes:</strong></p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; margin: 10px 0;">
                            <code style="color: #50fa7b;">GET session:abc123</code><br>
                            <code style="color: #888;">(nil)</code> <span style="color: #888; font-size: 11px;">‚Üê Key automatically deleted!</span>
                        </div>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 15px;">üìä TTL Return Values Explained</h4>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                            <tr style="background: rgba(220,20,60,0.2); border-bottom: 2px solid var(--primary-color);">
                                <th style="padding: 10px; text-align: left;">TTL Returns</th>
                                <th style="padding: 10px; text-align: left;">Meaning</th>
                                <th style="padding: 10px; text-align: left;">Example</th>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><code>Positive number</code></td>
                                <td style="padding: 8px;">Seconds until expiry</td>
                                <td style="padding: 8px;">1800 = expires in 30 min</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><code>-1</code></td>
                                <td style="padding: 8px;">Key exists, NO expiry set</td>
                                <td style="padding: 8px;">Lives forever until deleted</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><code>-2</code></td>
                                <td style="padding: 8px;">Key does NOT exist</td>
                                <td style="padding: 8px;">Already expired or never created</td>
                            </tr>
                        </table>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #00FF88; margin-bottom: 10px;">üéØ Common Use Cases for TTL</h4>
                        <ul style="margin-top: 10px;">
                            <li><strong>Session Management:</strong> 30-minute session timeout</li>
                            <li><strong>Cache Expiry:</strong> Refresh cached data every hour</li>
                            <li><strong>Rate Limiting:</strong> Reset counters every 60 seconds</li>
                            <li><strong>OTP Codes:</strong> Verification codes expire in 5 minutes</li>
                            <li><strong>Temporary Links:</strong> Download links valid for 24 hours</li>
                            <li><strong>Password Reset Tokens:</strong> Valid for 1 hour only</li>
                        </ul>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">TTL Timeline - How Keys Expire</div>
                        <svg viewBox="0 0 1000 500" style="max-width: 100%; height: auto;">
                            <text x="500" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">TTL Lifecycle Example</text>
                            
                            <!-- Timeline -->
                            <line x1="100" y1="150" x2="900" y2="150" stroke="#666" stroke-width="3"/>
                            
                            <!-- Time 0: Key Created -->
                            <circle cx="100" cy="150" r="10" fill="#00FF88">
                                <animate attributeName="r" values="10;15;10" dur="2s" repeatCount="indefinite"/>
                            </circle>
                            <text x="100" y="180" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">T=0</text>
                            <text x="100" y="200" text-anchor="middle" fill="#fff" font-size="11">Key Created</text>
                            <rect x="50" y="210" width="100" height="60" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="100" y="230" text-anchor="middle" fill="#00FF88" font-size="10">SET session:abc</text>
                            <text x="100" y="245" text-anchor="middle" fill="#888" font-size="9">"user_data"</text>
                            <text x="100" y="260" text-anchor="middle" fill="#FFA500" font-size="9">EX 1800</text>

                            <!-- Time 300: After 5 min -->
                            <circle cx="250" cy="150" r="8" fill="#2196F3"/>
                            <text x="250" y="180" text-anchor="middle" fill="#2196F3" font-size="12" font-weight="600">T=300s</text>
                            <text x="250" y="200" text-anchor="middle" fill="#fff" font-size="11">After 5 minutes</text>
                            <rect x="200" y="210" width="100" height="60" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="250" y="230" text-anchor="middle" fill="#2196F3" font-size="10">TTL session:abc</text>
                            <text x="250" y="250" text-anchor="middle" fill="#00FF88" font-size="11">‚Üí 1500 seconds</text>

                            <!-- Time 900: After 15 min -->
                            <circle cx="500" cy="150" r="8" fill="#FFA500"/>
                            <text x="500" y="180" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">T=900s</text>
                            <text x="500" y="200" text-anchor="middle" fill="#fff" font-size="11">After 15 minutes</text>
                            <rect x="450" y="210" width="100" height="60" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="500" y="230" text-anchor="middle" fill="#FFA500" font-size="10">TTL session:abc</text>
                            <text x="500" y="250" text-anchor="middle" fill="#FFA500" font-size="11">‚Üí 900 seconds</text>

                            <!-- Time 1770: Almost expired -->
                            <circle cx="750" cy="150" r="8" fill="#ff0000"/>
                            <text x="750" y="180" text-anchor="middle" fill="#ff0000" font-size="12" font-weight="600">T=1770s</text>
                            <text x="750" y="200" text-anchor="middle" fill="#fff" font-size="11">Almost expired!</text>
                            <rect x="700" y="210" width="100" height="60" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="2" rx="6"/>
                            <text x="750" y="230" text-anchor="middle" fill="#ff0000" font-size="10">TTL session:abc</text>
                            <text x="750" y="250" text-anchor="middle" fill="#ff0000" font-size="11">‚Üí 30 seconds</text>

                            <!-- Time 1800: Expired -->
                            <circle cx="900" cy="150" r="12" fill="#ff0000" opacity="0.3">
                                <animate attributeName="opacity" values="0.3;0.8;0.3" dur="1.5s" repeatCount="indefinite"/>
                            </circle>
                            <text x="900" y="180" text-anchor="middle" fill="#ff0000" font-size="12" font-weight="600">T=1800s</text>
                            <text x="900" y="200" text-anchor="middle" fill="#ff0000" font-size="11" font-weight="700">EXPIRED!</text>
                            <rect x="850" y="210" width="100" height="60" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="2" rx="6"/>
                            <text x="900" y="230" text-anchor="middle" fill="#ff0000" font-size="10">GET session:abc</text>
                            <text x="900" y="250" text-anchor="middle" fill="#888" font-size="11">‚Üí (nil)</text>

                            <!-- Explanation box -->
                            <rect x="100" y="320" width="800" height="140" fill="rgba(0,0,0,0.3)" stroke="#DC143C" stroke-width="2" rx="8"/>
                            <text x="500" y="350" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="600">What Happens During TTL?</text>
                            
                            <text x="120" y="380" fill="#fff" font-size="12"><strong>‚úÖ Key is accessible:</strong> GET, SET, HGET all work normally</text>
                            <text x="120" y="405" fill="#fff" font-size="12"><strong>‚è≥ TTL decreases:</strong> Every second, TTL value goes down by 1</text>
                            <text x="120" y="430" fill="#fff" font-size="12"><strong>üóëÔ∏è At T=0 seconds:</strong> Redis automatically deletes the key (happens in background)</strong></text>
                        </svg>
                    </div>

                    <div class="diagram-container" style="margin-top: 30px;">
                        <div class="diagram-title">TTL Return Values Flowchart</div>
                        <svg viewBox="0 0 800 400" style="max-width: 100%; height: auto;">
                            <text x="400" y="30" text-anchor="middle" fill="#fff" font-size="16" font-weight="600">What does TTL return?</text>
                            
                            <!-- Start -->
                            <rect x="300" y="60" width="200" height="50" fill="rgba(33, 150, 243, 0.3)" stroke="#2196F3" stroke-width="3" rx="8"/>
                            <text x="400" y="90" text-anchor="middle" fill="#fff" font-size="14" font-weight="600">TTL mykey</text>

                            <!-- Arrow down -->
                            <line x1="400" y1="110" x2="400" y2="150" stroke="#888" stroke-width="2"/>
                            
                            <!-- Decision box -->
                            <rect x="300" y="150" width="200" height="50" fill="rgba(220, 20, 60, 0.2)" stroke="var(--primary-color)" stroke-width="2" rx="6"/>
                            <text x="400" y="180" text-anchor="middle" fill="#fff" font-size="13">Does key exist?</text>

                            <!-- No path -->
                            <line x1="300" y1="175" x2="150" y2="175" stroke="#ff0000" stroke-width="2"/>
                            <line x1="150" y1="175" x2="150" y2="240" stroke="#ff0000" stroke-width="2"/>
                            <text x="210" y="170" fill="#ff0000" font-size="11">NO</text>
                            
                            <rect x="70" y="240" width="160" height="80" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="3" rx="8"/>
                            <text x="150" y="270" text-anchor="middle" fill="#ff0000" font-size="16" font-weight="700">Returns: -2</text>
                            <text x="150" y="295" text-anchor="middle" fill="#fff" font-size="11">Key doesn't exist</text>

                            <!-- Yes path -->
                            <line x1="400" y1="200" x2="400" y2="240" stroke="#00FF88" stroke-width="2"/>
                            <text x="420" y="225" fill="#00FF88" font-size="11">YES</text>
                            
                            <rect x="300" y="240" width="200" height="50" fill="rgba(220, 20, 60, 0.2)" stroke="var(--primary-color)" stroke-width="2" rx="6"/>
                            <text x="400" y="270" text-anchor="middle" fill="#fff" font-size="13">Does it have expiry?</text>

                            <!-- No expiry -->
                            <line x1="500" y1="265" x2="650" y2="265" stroke="#FFA500" stroke-width="2"/>
                            <line x1="650" y1="265" x2="650" y2="330" stroke="#FFA500" stroke-width="2"/>
                            <text x="560" y="260" fill="#FFA500" font-size="11">NO</text>
                            
                            <rect x="570" y="330" width="160" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="3" rx="8"/>
                            <text x="650" y="360" text-anchor="middle" fill="#FFA500" font-size="16" font-weight="700">Returns: -1</text>
                            <text x="650" y="385" text-anchor="middle" fill="#fff" font-size="11">No expiry set</text>

                            <!-- Yes expiry -->
                            <line x1="400" y1="290" x2="400" y2="330" stroke="#00FF88" stroke-width="2"/>
                            <text x="420" y="315" fill="#00FF88" font-size="11">YES</text>
                            
                            <rect x="320" y="330" width="160" height="80" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="3" rx="8">
                                <animate attributeName="opacity" values="0.6;1;0.6" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="400" y="360" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="700">Returns: N</text>
                            <text x="400" y="385" text-anchor="middle" fill="#fff" font-size="11">N = seconds remaining</text>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic TTL Operations</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI - TTL Commands</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Create a key with 30-minute expiry</span>
<span class="keyword">SET</span> <span class="string">session:user123</span> <span class="string">"logged_in_data"</span> <span class="keyword">EX</span> <span class="number">1800</span>
<span class="keyword">OK</span>

<span class="comment"># Check TTL immediately</span>
<span class="keyword">TTL</span> <span class="string">session:user123</span>
<span class="number">(integer) 1799</span>  <span class="comment"># Almost 30 minutes left</span>

<span class="comment"># Wait a few minutes, check again</span>
<span class="keyword">TTL</span> <span class="string">session:user123</span>
<span class="number">(integer) 1200</span>  <span class="comment"># 20 minutes left</span>

<span class="comment"># Create a key WITHOUT expiry</span>
<span class="keyword">SET</span> <span class="string">permanent:data</span> <span class="string">"never_expires"</span>

<span class="comment"># Check its TTL</span>
<span class="keyword">TTL</span> <span class="string">permanent:data</span>
<span class="number">(integer) -1</span>  <span class="comment"># -1 means no expiry</span>

<span class="comment"># Check TTL of non-existent key</span>
<span class="keyword">TTL</span> <span class="string">nonexistent:key</span>
<span class="number">(integer) -2</span>  <span class="comment"># -2 means doesn't exist</span>

<span class="comment"># Get TTL in milliseconds (more precise)</span>
<span class="keyword">PTTL</span> <span class="string">session:user123</span>
<span class="number">(integer) 1199850</span>  <span class="comment"># Milliseconds remaining</span>

<span class="comment"># See remaining time in human format</span>
<span class="comment"># (Not a Redis command, just for understanding)</span>
<span class="comment"># 1200 seconds = 20 minutes</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Session Management with TTL</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Session with Auto-Expiry</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">SessionManager</span>:
    <span class="keyword">def</span> <span class="function">create_session</span>(<span class="keyword">self</span>, user_id, session_data):
        <span class="string">"""Create session that expires in 30 minutes"""</span>
        session_id = <span class="string">f"session:</span>{user_id}<span class="string">"</span>
        
        <span class="comment"># Store session with 30-minute TTL</span>
        r.setex(
            session_id,
            <span class="number">1800</span>,  <span class="comment"># 1800 seconds = 30 minutes</span>
            json.dumps(session_data)
        )
        
        <span class="keyword">print</span>(<span class="string">f"Session created for user </span>{user_id}<span class="string">, expires in 30 min"</span>)
        <span class="keyword">return</span> session_id
    
    <span class="keyword">def</span> <span class="function">check_session</span>(<span class="keyword">self</span>, user_id):
        <span class="string">"""Check if session is still valid"""</span>
        session_id = <span class="string">f"session:</span>{user_id}<span class="string">"</span>
        
        <span class="comment"># Get remaining TTL</span>
        ttl = r.ttl(session_id)
        
        <span class="keyword">if</span> ttl == -<span class="number">2</span>:
            <span class="keyword">return</span> {<span class="string">"valid"</span>: <span class="keyword">False</span>, <span class="string">"message"</span>: <span class="string">"Session expired or doesn't exist"</span>}
        
        <span class="keyword">if</span> ttl == -<span class="number">1</span>:
            <span class="keyword">return</span> {<span class="string">"valid"</span>: <span class="keyword">True</span>, <span class="string">"message"</span>: <span class="string">"Session has no expiry (shouldn't happen!)"</span>}
        
        <span class="comment"># Convert seconds to minutes for user-friendly display</span>
        minutes_left = ttl // <span class="number">60</span>
        
        <span class="keyword">return</span> {
            <span class="string">"valid"</span>: <span class="keyword">True</span>,
            <span class="string">"message"</span>: <span class="string">f"Session valid for </span>{minutes_left}<span class="string"> more minutes"</span>,
            <span class="string">"seconds_left"</span>: ttl
        }
    
    <span class="keyword">def</span> <span class="function">extend_session</span>(<span class="keyword">self</span>, user_id):
        <span class="string">"""Extend session by another 30 minutes (on user activity)"""</span>
        session_id = <span class="string">f"session:</span>{user_id}<span class="string">"</span>
        
        <span class="comment"># Reset TTL to 30 minutes</span>
        r.expire(session_id, <span class="number">1800</span>)
        <span class="keyword">print</span>(<span class="string">"Session extended by 30 minutes"</span>)

<span class="comment"># Usage</span>
manager = SessionManager()

<span class="comment"># User logs in</span>
manager.create_session(<span class="number">12345</span>, {
    <span class="string">"username"</span>: <span class="string">"alice"</span>,
    <span class="string">"email"</span>: <span class="string">"alice@example.com"</span>,
    <span class="string">"login_time"</span>: datetime.now().isoformat()
})

<span class="comment"># Check session status</span>
status = manager.check_session(<span class="number">12345</span>)
<span class="keyword">print</span>(status)  <span class="comment"># Valid for 30 minutes</span>

<span class="comment"># User clicks something (activity detected)</span>
manager.extend_session(<span class="number">12345</span>)  <span class="comment"># Reset timer!</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: OTP Code with TTL</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - One-Time Password Expiry</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> random

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">send_otp</span>(phone_number):
    <span class="string">"""Generate and store OTP that expires in 5 minutes"""</span>
    <span class="comment"># Generate 6-digit OTP</span>
    otp = <span class="function">str</span>(random.randint(<span class="number">100000</span>, <span class="number">999999</span>))
    
    <span class="comment"># Store with 5-minute expiry</span>
    key = <span class="string">f"otp:</span>{phone_number}<span class="string">"</span>
    r.setex(key, <span class="number">300</span>, otp)  <span class="comment"># 300 seconds = 5 minutes</span>
    
    <span class="keyword">print</span>(<span class="string">f"OTP </span>{otp}<span class="string"> sent to </span>{phone_number}<span class="string">. Valid for 5 minutes."</span>)
    <span class="keyword">return</span> otp

<span class="keyword">def</span> <span class="function">verify_otp</span>(phone_number, user_entered_otp):
    <span class="string">"""Verify OTP before it expires"""</span>
    key = <span class="string">f"otp:</span>{phone_number}<span class="string">"</span>
    
    <span class="comment"># Check TTL first</span>
    ttl = r.ttl(key)
    
    <span class="keyword">if</span> ttl == -<span class="number">2</span>:
        <span class="keyword">return</span> {<span class="string">"success"</span>: <span class="keyword">False</span>, <span class="string">"message"</span>: <span class="string">"OTP expired or not sent"</span>}
    
    <span class="comment"># Get stored OTP</span>
    stored_otp = r.get(key)
    
    <span class="keyword">if</span> stored_otp == user_entered_otp:
        <span class="comment"># Success! Delete OTP immediately (one-time use)</span>
        r.delete(key)
        <span class="keyword">return</span> {<span class="string">"success"</span>: <span class="keyword">True</span>, <span class="string">"message"</span>: <span class="string">"OTP verified!"</span>}
    <span class="keyword">else</span>:
        <span class="keyword">return</span> {
            <span class="string">"success"</span>: <span class="keyword">False</span>,
            <span class="string">"message"</span>: <span class="string">f"Wrong OTP. Try again. Expires in </span>{ttl}<span class="string"> seconds."</span>
        }

<span class="comment"># Usage</span>
send_otp(<span class="string">"+1234567890"</span>)
<span class="comment"># User receives: OTP 456789 sent to +1234567890. Valid for 5 minutes.</span>

<span class="comment"># User enters OTP</span>
result = verify_otp(<span class="string">"+1234567890"</span>, <span class="string">"456789"</span>)
<span class="keyword">print</span>(result)  <span class="comment"># OTP verified!</span></code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: What happens when TTL reaches 0?</h4>
                        <p><strong>A:</strong> Redis automatically deletes the key in the background. The deletion happens asynchronously - not instantly at T=0, but within milliseconds. The key becomes inaccessible immediately when TTL hits 0.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Does accessing a key reset its TTL?</h4>
                        <p><strong>A:</strong> No! GET, HGET, etc. do NOT reset TTL. TTL keeps counting down regardless of access. To reset TTL, you must explicitly call <code>EXPIRE key seconds</code> again.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can I check TTL of Hash fields individually?</h4>
                        <p><strong>A:</strong> No! TTL applies to the entire key, not individual Hash fields. If <code>user:1001</code> expires, ALL fields (name, email, age, etc.) expire together.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: What if I SET a key that already has TTL?</h4>
                        <p><strong>A:</strong> SET removes the TTL! After SET, the key has no expiry (TTL = -1). To keep TTL while updating, use <code>SET key value KEEPTTL</code> (Redis 6.0+) or <code>GET</code> old TTL, then <code>SET</code> and <code>EXPIRE</code>.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: How accurate is TTL?</h4>
                        <p><strong>A:</strong> Very accurate! Redis checks for expired keys every 100ms, and also checks on access. Worst case: a key expires ~100ms late. For most applications (sessions, caches), this is perfectly fine.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: I have 1 million keys with TTL. Does this slow down Redis?</h4>
                        <p><strong>Answer:</strong> Slightly, but Redis handles it well! Redis uses two strategies:</p>
                        <ol style="margin-top: 10px;">
                            <li><strong>Lazy expiry:</strong> When you access a key, Redis checks if it's expired</li>
                            <li><strong>Active expiry:</strong> Every 100ms, Redis randomly checks 20 keys with TTL and deletes expired ones</li>
                        </ol>
                        <p style="margin-top: 10px;">With 1M keys expiring, Redis spends ~1-2% CPU on expiry checks. This is acceptable for most applications. If you see performance issues, reduce the number of keys with short TTLs (seconds) and use longer TTLs (minutes/hours) where possible.</p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I remove TTL from a key?</h4>
                        <p><strong>Answer:</strong> Yes! Use <code>PERSIST key</code>. This removes the TTL and makes the key permanent (TTL becomes -1). Example:</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                            <code style="color: #50fa7b;">SET session:abc "data" EX 1800<br>
                            TTL session:abc  <span style="color: #888;">// 1800</span><br>
                            PERSIST session:abc<br>
                            TTL session:abc  <span style="color: #888;">// -1 (no expiry!)</span></code>
                        </div>
                        <p><strong>Use case:</strong> User clicks "Remember me" - you PERSIST their session so it doesn't expire.</p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: What happens to TTL during Redis restart?</h4>
                        <p><strong>Answer:</strong> It depends on persistence:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>With RDB:</strong> TTL is saved! Keys with TTL resume countdown after restart</li>
                            <li><strong>With AOF:</strong> EXPIRE commands are logged, TTL preserved</li>
                            <li><strong>No persistence:</strong> All keys lost, including TTLs</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Edge case:</strong> If restart takes 5 minutes and a key had TTL of 3 minutes, it will be immediately expired on restart (Redis is smart about this!).</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    
                    <p><strong>Scenario: E-commerce Flash Sale System</strong></p>
                    <p>You're building a system where users can hold a product in their cart for 10 minutes during a flash sale. After 10 minutes, the product is released back to inventory.</p>

                    <h4 style="color: var(--primary-color); margin-top: 20px;">Requirements:</h4>
                    <ul>
                        <li>User adds product to cart ‚Üí reserved for 10 minutes</li>
                        <li>Show countdown timer to user</li>
                        <li>After 10 min, auto-release to inventory</li>
                        <li>If user checks out, remove reservation</li>
                    </ul>

                    <h4 style="color: var(--primary-color); margin-top: 20px;">Implementation with TTL:</h4>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Cart Reservation System</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">reserve_product</span>(user_id, product_id, quantity):
    <span class="string">"""Reserve product for 10 minutes"""</span>
    key = <span class="string">f"cart:</span>{user_id}<span class="string">:</span>{product_id}<span class="string">"</span>
    
    <span class="comment"># Reserve with 10-minute TTL</span>
    r.setex(key, <span class="number">600</span>, quantity)  <span class="comment"># 600 seconds = 10 min</span>
    
    <span class="keyword">print</span>(<span class="string">f"Reserved </span>{quantity}<span class="string"> units for user </span>{user_id}<span class="string">"</span>)
    <span class="keyword">return</span> <span class="keyword">True</span>

<span class="keyword">def</span> <span class="function">get_time_remaining</span>(user_id, product_id):
    <span class="string">"""Get countdown timer"""</span>
    key = <span class="string">f"cart:</span>{user_id}<span class="string">:</span>{product_id}<span class="string">"</span>
    ttl = r.ttl(key)
    
    <span class="keyword">if</span> ttl == -<span class="number">2</span>:
        <span class="keyword">return</span> {<span class="string">"expired"</span>: <span class="keyword">True</span>, <span class="string">"message"</span>: <span class="string">"Reservation expired"</span>}
    
    minutes = ttl // <span class="number">60</span>
    seconds = ttl % <span class="number">60</span>
    
    <span class="keyword">return</span> {
        <span class="string">"expired"</span>: <span class="keyword">False</span>,
        <span class="string">"time_left"</span>: <span class="string">f"</span>{minutes}<span class="string">:</span>{seconds:02d}<span class="string">"</span>,
        <span class="string">"seconds"</span>: ttl
    }

<span class="keyword">def</span> <span class="function">checkout</span>(user_id, product_id):
    <span class="string">"""Complete purchase - remove reservation"""</span>
    key = <span class="string">f"cart:</span>{user_id}<span class="string">:</span>{product_id}<span class="string">"</span>
    
    <span class="comment"># Check if still reserved</span>
    <span class="keyword">if</span> r.exists(key):
        quantity = r.get(key)
        r.delete(key)  <span class="comment"># Remove reservation</span>
        <span class="keyword">print</span>(<span class="string">f"Checkout successful! Purchased </span>{quantity}<span class="string"> units"</span>)
        <span class="keyword">return</span> <span class="keyword">True</span>
    <span class="keyword">else</span>:
        <span class="keyword">print</span>(<span class="string">"Reservation expired! Product released."</span>)
        <span class="keyword">return</span> <span class="keyword">False</span>

<span class="comment"># Usage</span>
reserve_product(<span class="number">12345</span>, <span class="string">"PROD-999"</span>, <span class="number">2</span>)
<span class="comment"># Reserved 2 units for user 12345</span>

<span class="comment"># Show countdown (call this repeatedly in frontend)</span>
timer = get_time_remaining(<span class="number">12345</span>, <span class="string">"PROD-999"</span>)
<span class="keyword">print</span>(timer)  <span class="comment"># {'expired': False, 'time_left': '9:58', 'seconds': 598}</span>

<span class="comment"># After 10 minutes - TTL automatically expires!</span>
<span class="comment"># Next call returns: {'expired': True, 'message': 'Reservation expired'}</span></code></pre>
                    </div>

                    <p style="margin-top: 20px;"><strong>Why TTL is perfect here:</strong></p>
                    <ul>
                        <li>‚úÖ No cron jobs needed - Redis handles expiry</li>
                        <li>‚úÖ Accurate countdown timer via TTL command</li>
                        <li>‚úÖ Automatic cleanup - no orphaned reservations</li>
                        <li>‚úÖ Scales to millions of concurrent reservations</li>
                    </ul>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚è∞</span><p><strong>TTL = Time To Live</strong> - Seconds until key auto-expires</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üî¢</span><p><strong>Three return values</strong> - Positive (seconds left), -1 (no expiry), -2 (doesn't exist)</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Perfect for</strong> - Sessions, OTP codes, rate limiting, temporary data</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üö´</span><p><strong>No auto-refresh</strong> - Accessing key doesn't reset TTL</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üóëÔ∏è</span><p><strong>Auto cleanup</strong> - Redis deletes expired keys automatically</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Very accurate</strong> - ¬±100ms accuracy, enough for most use cases</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">TTL</span><span class="keyword-tag">Time To Live</span><span class="keyword-tag">EXPIRE</span><span class="keyword-tag">SETEX</span><span class="keyword-tag">PTTL</span><span class="keyword-tag">PERSIST</span><span class="keyword-tag">Auto-Expiry</span><span class="keyword-tag">Session Timeout</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> You run <code>TTL mykey</code> and get -1. What does this mean?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) Key expired 1 second ago</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) Key exists but has no expiry set</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Key doesn't exist</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) Key will expire in 1 second</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>TTL returns -1 when the key exists but has NO expiry set (it will live forever until manually deleted). -2 means key doesn't exist, positive number means seconds remaining!</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getQuestion14Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>Meet Lisa, building a file upload system.</strong> Users upload files, get a temporary download link. Her boss asks: "Lisa, these download links should expire after 24 hours for security. How do we do that?"</p>
                    
                    <p>Lisa already knows about Redis but realizes: "I created the key, but forgot to set expiry! How do I add expiry to an existing key?" This is where the EXPIRE command comes in!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>EXPIRE key seconds</strong> - Sets or updates the expiry time on an existing key. The key will automatically be deleted after the specified number of seconds.</p>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">Basic Usage</h4>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px;">
                            <code style="color: #50fa7b;">SET mykey "some_value"</code><br>
                            <code style="color: #50fa7b;">EXPIRE mykey 3600</code> <span style="color: #888;">‚Üê Expires in 1 hour</span><br>
                            <code style="color: #FFA500;">(integer) 1</code> <span style="color: #888;">‚Üê Success!</span>
                        </div>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 15px;">üîÑ EXPIRE Variations</h4>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="background: rgba(220,20,60,0.2);">
                                <th style="padding: 10px; text-align: left;">Command</th>
                                <th style="padding: 10px; text-align: left;">What It Does</th>
                                <th style="padding: 10px; text-align: left;">Example</th>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><code>EXPIRE key sec</code></td>
                                <td style="padding: 8px;">Expire in N seconds</td>
                                <td style="padding: 8px;"><code>EXPIRE session 1800</code></td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><code>EXPIREAT key unix</code></td>
                                <td style="padding: 8px;">Expire at exact timestamp</td>
                                <td style="padding: 8px;"><code>EXPIREAT key 1735689600</code></td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><code>PEXPIRE key ms</code></td>
                                <td style="padding: 8px;">Expire in milliseconds</td>
                                <td style="padding: 8px;"><code>PEXPIRE key 5000</code></td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;"><code>SETEX key sec val</code></td>
                                <td style="padding: 8px;">SET + EXPIRE (atomic)</td>
                                <td style="padding: 8px;"><code>SETEX session 1800 "data"</code></td>
                            </tr>
                        </table>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <p><strong>üí° Key Point:</strong> EXPIRE returns 1 if successful, 0 if key doesn't exist. You can update expiry on a key that already has one!</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagram</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">EXPIRE Command Flow</div>
                        <svg viewBox="0 0 900 500" style="max-width: 100%; height: auto;">
                            <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">How EXPIRE Works</text>
                            
                            <!-- Key without expiry -->
                            <rect x="50" y="80" width="200" height="100" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="8"/>
                            <text x="150" y="110" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">Key Exists</text>
                            <text x="150" y="135" text-anchor="middle" fill="#fff" font-size="11">download_link_abc</text>
                            <text x="150" y="155" text-anchor="middle" fill="#888" font-size="10">TTL: -1 (no expiry)</text>

                            <!-- Arrow -->
                            <line x1="250" y1="130" x2="330" y2="130" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowgreen)"/>
                            <text x="290" y="120" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">EXPIRE</text>
                            <text x="290" y="150" text-anchor="middle" fill="#888" font-size="10">86400 seconds</text>

                            <!-- Key with expiry -->
                            <rect x="350" y="80" width="200" height="100" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="3" rx="8">
                                <animate attributeName="opacity" values="0.6;1;0.6" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="450" y="110" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">Key Now Has TTL</text>
                            <text x="450" y="135" text-anchor="middle" fill="#fff" font-size="11">download_link_abc</text>
                            <text x="450" y="155" text-anchor="middle" fill="#00FF88" font-size="10">TTL: 86400 (24 hours)</text>

                            <!-- Countdown -->
                            <line x1="550" y1="130" x2="630" y2="130" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowblue)"/>
                            <text x="590" y="120" text-anchor="middle" fill="#2196F3" font-size="10">Time passes...</text>

                            <!-- Key about to expire -->
                            <rect x="650" y="80" width="200" height="100" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="2" rx="8"/>
                            <text x="750" y="110" text-anchor="middle" fill="#ff0000" font-size="14" font-weight="600">After 24 Hours</text>
                            <text x="750" y="135" text-anchor="middle" fill="#888" font-size="11">download_link_abc</text>
                            <text x="750" y="155" text-anchor="middle" fill="#ff0000" font-size="10">DELETED! üóëÔ∏è</text>

                            <!-- Examples section -->
                            <rect x="50" y="220" width="800" height="250" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                            <text x="450" y="250" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="600">Common EXPIRE Patterns</text>
                            
                            <text x="70" y="285" fill="#00FF88" font-size="12" font-weight="600">1. Set expiry after creation:</text>
                            <rect x="80" y="295" width="760" height="40" fill="rgba(0,0,0,0.4)" rx="4"/>
                            <text x="90" y="312" fill="#50fa7b" font-size="10">SET session:user123 "data"</text>
                            <text x="90" y="327" fill="#50fa7b" font-size="10">EXPIRE session:user123 1800  <span fill="#888">‚Üê Add 30-min expiry</span></text>

                            <text x="70" y="360" fill="#00FF88" font-size="12" font-weight="600">2. Update existing expiry:</text>
                            <rect x="80" y="370" width="760" height="25" fill="rgba(0,0,0,0.4)" rx="4"/>
                            <text x="90" y="387" fill="#50fa7b" font-size="10">EXPIRE session:user123 3600  <span fill="#888">‚Üê Extend to 1 hour</span></text>

                            <text x="70" y="415" fill="#00FF88" font-size="12" font-weight="600">3. Expire at exact time (New Year midnight):</text>
                            <rect x="80" y="425" width="760" height="25" fill="rgba(0,0,0,0.4)" rx="4"/>
                            <text x="90" y="442" fill="#50fa7b" font-size="10">EXPIREAT promo:newyear 1704067200  <span fill="#888">‚Üê Jan 1, 2024 00:00:00</span></text>

                            <!-- Arrow markers -->
                            <defs>
                                <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                                </marker>
                                <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#2196F3" />
                                </marker>
                            </defs>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: All EXPIRE Variations</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI - EXPIRE Commands</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Basic EXPIRE - add expiry to existing key</span>
<span class="keyword">SET</span> <span class="string">mykey</span> <span class="string">"value"</span>
<span class="keyword">EXPIRE</span> <span class="string">mykey</span> <span class="number">60</span>
<span class="number">(integer) 1</span>  <span class="comment"># Success</span>

<span class="comment"># Try to expire non-existent key</span>
<span class="keyword">EXPIRE</span> <span class="string">nonexistent</span> <span class="number">60</span>
<span class="number">(integer) 0</span>  <span class="comment"># Failed - key doesn't exist</span>

<span class="comment"># SETEX - SET + EXPIRE in one atomic operation</span>
<span class="keyword">SETEX</span> <span class="string">session:abc</span> <span class="number">1800</span> <span class="string">"user_data"</span>
<span class="keyword">OK</span>  <span class="comment"># Created with 30-min expiry</span>

<span class="comment"># EXPIREAT - expire at specific Unix timestamp</span>
<span class="keyword">SET</span> <span class="string">promo:summer</span> <span class="string">"20% off"</span>
<span class="keyword">EXPIREAT</span> <span class="string">promo:summer</span> <span class="number">1725148800</span>  <span class="comment"># Sep 1, 2024</span>
<span class="number">(integer) 1</span>

<span class="comment"># PEXPIRE - millisecond precision</span>
<span class="keyword">SET</span> <span class="string">realtime:data</span> <span class="string">"snapshot"</span>
<span class="keyword">PEXPIRE</span> <span class="string">realtime:data</span> <span class="number">5000</span>  <span class="comment"># 5 seconds</span>

<span class="comment"># Update expiry on key that already has one</span>
<span class="keyword">SET</span> <span class="string">key1</span> <span class="string">"val"</span> <span class="keyword">EX</span> <span class="number">60</span>
<span class="keyword">EXPIRE</span> <span class="string">key1</span> <span class="number">120</span>  <span class="comment"># Extend from 60 to 120 seconds</span>
<span class="number">(integer) 1</span>

<span class="comment"># Check TTL to verify</span>
<span class="keyword">TTL</span> <span class="string">key1</span>
<span class="number">(integer) 119</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Download Link System</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Temporary Download Links</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> uuid
<span class="keyword">import</span> time

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">create_download_link</span>(file_path, expiry_hours=<span class="number">24</span>):
    <span class="string">"""Generate temporary download link"""</span>
    <span class="comment"># Generate unique token</span>
    token = <span class="function">str</span>(uuid.uuid4())
    key = <span class="string">f"download:</span>{token}<span class="string">"</span>
    
    <span class="comment"># Store file path</span>
    r.set(key, file_path)
    
    <span class="comment"># Set expiry in seconds</span>
    seconds = expiry_hours * <span class="number">3600</span>
    r.expire(key, seconds)
    
    <span class="keyword">print</span>(<span class="string">f"Link: https://mysite.com/download/</span>{token}<span class="string">"</span>)
    <span class="keyword">print</span>(<span class="string">f"Expires in </span>{expiry_hours}<span class="string"> hours"</span>)
    <span class="keyword">return</span> token

<span class="keyword">def</span> <span class="function">extend_link_expiry</span>(token, additional_hours=<span class="number">24</span>):
    <span class="string">"""User requests extension"""</span>
    key = <span class="string">f"download:</span>{token}<span class="string">"</span>
    
    <span class="keyword">if</span> <span class="keyword">not</span> r.exists(key):
        <span class="keyword">return</span> {<span class="string">"success"</span>: <span class="keyword">False</span>, <span class="string">"message"</span>: <span class="string">"Link expired"</span>}
    
    <span class="comment"># Add more time</span>
    current_ttl = r.ttl(key)
    new_ttl = current_ttl + (additional_hours * <span class="number">3600</span>)
    r.expire(key, new_ttl)
    
    <span class="keyword">return</span> {
        <span class="string">"success"</span>: <span class="keyword">True</span>,
        <span class="string">"message"</span>: <span class="string">f"Extended by </span>{additional_hours}<span class="string"> hours"</span>,
        <span class="string">"new_expiry_hours"</span>: new_ttl / <span class="number">3600</span>
    }

<span class="keyword">def</span> <span class="function">download_file</span>(token):
    <span class="string">"""User clicks download link"""</span>
    key = <span class="string">f"download:</span>{token}<span class="string">"</span>
    
    file_path = r.get(key)
    
    <span class="keyword">if</span> <span class="keyword">not</span> file_path:
        <span class="keyword">return</span> {<span class="string">"success"</span>: <span class="keyword">False</span>, <span class="string">"error"</span>: <span class="string">"Link expired or invalid"</span>}
    
    <span class="comment"># Get time remaining</span>
    ttl = r.ttl(key)
    hours_left = ttl / <span class="number">3600</span>
    
    <span class="keyword">return</span> {
        <span class="string">"success"</span>: <span class="keyword">True</span>,
        <span class="string">"file"</span>: file_path,
        <span class="string">"expires_in"</span>: <span class="string">f"</span>{hours_left:.1f}<span class="string"> hours"</span>
    }

<span class="comment"># Usage</span>
token = create_download_link(<span class="string">"/files/report.pdf"</span>, expiry_hours=<span class="number">24</span>)
<span class="comment"># Link: https://mysite.com/download/abc-123-def</span>
<span class="comment"># Expires in 24 hours</span>

<span class="comment"># User requests extension</span>
extend_link_expiry(token, additional_hours=<span class="number">48</span>)
<span class="comment"># Extended by 48 hours</span></code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: What's the difference between EXPIRE and SETEX?</h4>
                        <p><strong>A:</strong> <code>SETEX</code> is atomic - sets value AND expiry in one command (recommended). <code>SET</code> + <code>EXPIRE</code> uses two commands, leaving a tiny window where key exists without expiry (network failure risk).</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can I expire individual Hash fields?</h4>
                        <p><strong>A:</strong> No! EXPIRE works on entire keys only. All Hash fields expire together when the key expires.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Does EXPIRE work on all data types?</h4>
                        <p><strong>A:</strong> Yes! EXPIRE works on all Redis data types: Strings, Hashes, Lists, Sets, Sorted Sets, Bitmaps, HyperLogLog, Streams.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• What happens if you SET a key that already has EXPIRE?</h4>
                        <p><strong>Answer:</strong> The expiry is REMOVED! After SET, TTL becomes -1 (no expiry). To keep TTL, use <code>SET key value KEEPTTL</code> (Redis 6.0+) or manually restore it with EXPIRE.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    <p><strong>Email Verification Tokens:</strong> When user signs up, send email with verification link valid for 1 hour. Store token in Redis with EXPIRE 3600. After verification, delete token immediately.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚è∞</span><p><strong>EXPIRE key seconds</strong> - Adds/updates expiry on existing key</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Returns 1/0</strong> - 1 for success, 0 if key doesn't exist</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Can update expiry</strong> - Call EXPIRE again to change TTL</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>SETEX is atomic</strong> - Safer than SET + EXPIRE</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">EXPIRE</span><span class="keyword-tag">EXPIREAT</span><span class="keyword-tag">PEXPIRE</span><span class="keyword-tag">SETEX</span><span class="keyword-tag">TTL</span><span class="keyword-tag">Expiry</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> You run <code>EXPIRE mykey 60</code> and it returns 0. What does this mean?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) Key will expire in 60 seconds</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) Key doesn't exist - command failed</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Key already has expiry</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) Syntax error</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>EXPIRE returns 0 when the key doesn't exist. You can't set expiry on a non-existent key! Create the key first with SET, then use EXPIRE.</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getQuestion15Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>Meet David, building a distributed task system.</strong> Multiple servers try to process the same job. His boss warns: "David, we're processing the same task twice! Two servers grabbed it simultaneously. We need a distributed lock."</p>
                    
                    <p>David knows SET and GET, but needs something smarter: "How do I ensure only ONE server can grab the lock?" Enter SETNX - SET if Not eXists!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">SET key value</h4>
                        <p><strong>What:</strong> Sets a key to hold a value. Always succeeds, overwrites if key exists.</p>
                        <p><strong>Returns:</strong> "OK"</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET username "alice"</code><br>
                            <code style="color: #FFA500;">OK</code>
                        </div>
                    </div>

                    <div style="background: rgba(156, 39, 176, 0.1); border-left: 3px solid #9C27B0; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #9C27B0; margin-bottom: 15px;">SETNX key value</h4>
                        <p><strong>What:</strong> "SET if Not eXists" - Only sets if key doesn't exist. Atomic operation!</p>
                        <p><strong>Returns:</strong> 1 (success, key created) or 0 (failed, key already exists)</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SETNX lock:task1 "server-A"</code><br>
                            <code style="color: #00FF88;">(integer) 1</code> <span style="color: #888;">‚Üê Success! Got the lock</span><br><br>
                            <code style="color: #50fa7b;">SETNX lock:task1 "server-B"</code><br>
                            <code style="color: #ff0000;">(integer) 0</code> <span style="color: #888;">‚Üê Failed! Lock taken</span>
                        </div>
                        <p style="margin-top: 10px;"><strong>Use Case:</strong> Distributed locks, preventing duplicate operations</p>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 15px;">GET key</h4>
                        <p><strong>What:</strong> Gets the value of a key</p>
                        <p><strong>Returns:</strong> Value or (nil) if key doesn't exist</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">GET username</code><br>
                            <code style="color: #fff;">"alice"</code><br><br>
                            <code style="color: #50fa7b;">GET nonexistent</code><br>
                            <code style="color: #888;">(nil)</code>
                        </div>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #00FF88; margin-bottom: 10px;">üí° Modern Alternative (Redis 2.6.12+)</h4>
                        <p><code>SET key value NX</code> = Same as SETNX, but can also add expiry!</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET lock:task1 "server-A" NX EX 30</code><br>
                            <span style="color: #888; font-size: 11px;">‚Üë Set ONLY if not exists, with 30-second expiry</span>
                        </div>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagram</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">SET vs SETNX Behavior</div>
                        <svg viewBox="0 0 900 500" style="max-width: 100%; height: auto;">
                            <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">SET vs SETNX Comparison</text>
                            
                            <!-- SET behavior -->
                            <text x="225" y="70" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="600">SET (Always Works)</text>
                            
                            <rect x="100" y="100" width="250" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="225" y="125" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">Before: mykey = "old"</text>
                            <text x="225" y="145" text-anchor="middle" fill="#888" font-size="10">Key already exists</text>
                            <text x="225" y="165" text-anchor="middle" fill="#666" font-size="9">TTL: -1</text>

                            <text x="225" y="205" text-anchor="middle" fill="#fff" font-size="12">‚Üì SET mykey "new"</text>

                            <rect x="100" y="230" width="250" height="80" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="3" rx="6"/>
                            <text x="225" y="255" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">After: mykey = "new" ‚úÖ</text>
                            <text x="225" y="275" text-anchor="middle" fill="#fff" font-size="10">Overwrote old value!</text>
                            <text x="225" y="295" text-anchor="middle" fill="#FFA500" font-size="9">‚ö†Ô∏è TTL removed!</text>

                            <!-- SETNX behavior -->
                            <text x="675" y="70" text-anchor="middle" fill="#9C27B0" font-size="16" font-weight="600">SETNX (Conditional)</text>
                            
                            <!-- Case 1: Key doesn't exist -->
                            <rect x="550" y="100" width="250" height="80" fill="rgba(100, 100, 100, 0.2)" stroke="#666" stroke-width="2" rx="6" stroke-dasharray="5,5"/>
                            <text x="675" y="125" text-anchor="middle" fill="#888" font-size="12" font-weight="600">Before: mykey doesn't exist</text>
                            <text x="675" y="145" text-anchor="middle" fill="#666" font-size="10">(nil)</text>

                            <text x="675" y="205" text-anchor="middle" fill="#fff" font-size="12">‚Üì SETNX mykey "value"</text>

                            <rect x="550" y="230" width="250" height="80" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="3" rx="6"/>
                            <text x="675" y="255" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">After: mykey = "value" ‚úÖ</text>
                            <text x="675" y="275" text-anchor="middle" fill="#fff" font-size="10">Created! Returns 1</text>

                            <!-- Case 2: Key exists -->
                            <rect x="550" y="340" width="250" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="675" y="365" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">If key already exists:</text>
                            <text x="675" y="385" text-anchor="middle" fill="#888" font-size="10">mykey = "old"</text>

                            <text x="675" y="440" text-anchor="middle" fill="#fff" font-size="12">‚Üì SETNX mykey "new"</text>

                            <rect x="550" y="455" width="250" height="35" fill="rgba(255, 0, 0, 0.3)" stroke="#ff0000" stroke-width="3" rx="6"/>
                            <text x="675" y="478" text-anchor="middle" fill="#ff0000" font-size="12" font-weight="600">Returns 0 ‚ùå (No change!)</text>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Commands</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># SET - always works, overwrites</span>
<span class="keyword">SET</span> <span class="string">user:name</span> <span class="string">"Alice"</span>
<span class="keyword">OK</span>

<span class="keyword">SET</span> <span class="string">user:name</span> <span class="string">"Bob"</span>
<span class="keyword">OK</span>  <span class="comment"># Overwrote Alice</span>

<span class="keyword">GET</span> <span class="string">user:name</span>
<span class="string">"Bob"</span>

<span class="comment"># SETNX - only if key doesn't exist</span>
<span class="keyword">SETNX</span> <span class="string">lock:job1</span> <span class="string">"server-A"</span>
<span class="number">(integer) 1</span>  <span class="comment"># Success! Lock acquired</span>

<span class="keyword">SETNX</span> <span class="string">lock:job1</span> <span class="string">"server-B"</span>
<span class="number">(integer) 0</span>  <span class="comment"># Failed! Already locked</span>

<span class="keyword">GET</span> <span class="string">lock:job1</span>
<span class="string">"server-A"</span>  <span class="comment"># Server-A still has lock</span>

<span class="comment"># Modern approach with expiry</span>
<span class="keyword">SET</span> <span class="string">lock:job2</span> <span class="string">"server-A"</span> <span class="keyword">NX</span> <span class="keyword">EX</span> <span class="number">30</span>
<span class="keyword">OK</span>  <span class="comment"># Lock with 30-second auto-expiry</span>

<span class="keyword">SET</span> <span class="string">lock:job2</span> <span class="string">"server-B"</span> <span class="keyword">NX</span> <span class="keyword">EX</span> <span class="number">30</span>
<span class="keyword">(nil)</span>  <span class="comment"># Failed to acquire lock</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Distributed Lock System</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Distributed Lock</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time
<span class="keyword">import</span> uuid

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">DistributedLock</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, lock_name, timeout=<span class="number">10</span>):
        <span class="keyword">self</span>.lock_name = <span class="string">f"lock:</span>{lock_name}<span class="string">"</span>
        <span class="keyword">self</span>.timeout = timeout
        <span class="keyword">self</span>.identifier = <span class="function">str</span>(uuid.uuid4())
    
    <span class="keyword">def</span> <span class="function">acquire</span>(<span class="keyword">self</span>):
        <span class="string">"""Try to acquire lock"""</span>
        <span class="comment"># SET with NX (only if not exists) and EX (expiry)</span>
        result = r.set(
            <span class="keyword">self</span>.lock_name,
            <span class="keyword">self</span>.identifier,
            nx=<span class="keyword">True</span>,  <span class="comment"># SETNX behavior</span>
            ex=<span class="keyword">self</span>.timeout  <span class="comment"># Auto-expire</span>
        )
        
        <span class="keyword">if</span> result:
            <span class="keyword">print</span>(<span class="string">f"‚úÖ Lock acquired: </span>{<span class="keyword">self</span>.lock_name}<span class="string">"</span>)
            <span class="keyword">return</span> <span class="keyword">True</span>
        <span class="keyword">else</span>:
            <span class="keyword">print</span>(<span class="string">f"‚ùå Lock busy: </span>{<span class="keyword">self</span>.lock_name}<span class="string">"</span>)
            <span class="keyword">return</span> <span class="keyword">False</span>
    
    <span class="keyword">def</span> <span class="function">release</span>(<span class="keyword">self</span>):
        <span class="string">"""Release lock (only if we own it)"""</span>
        <span class="comment"># Check if we own the lock</span>
        current_value = r.get(<span class="keyword">self</span>.lock_name)
        
        <span class="keyword">if</span> current_value == <span class="keyword">self</span>.identifier:
            r.delete(<span class="keyword">self</span>.lock_name)
            <span class="keyword">print</span>(<span class="string">f"üîì Lock released: </span>{<span class="keyword">self</span>.lock_name}<span class="string">"</span>)
            <span class="keyword">return</span> <span class="keyword">True</span>
        <span class="keyword">else</span>:
            <span class="keyword">print</span>(<span class="string">"‚ö†Ô∏è Lock expired or owned by someone else"</span>)
            <span class="keyword">return</span> <span class="keyword">False</span>

<span class="comment"># Usage: Multiple servers processing jobs</span>
<span class="keyword">def</span> <span class="function">process_job</span>(job_id, server_name):
    lock = DistributedLock(<span class="string">f"job:</span>{job_id}<span class="string">"</span>, timeout=<span class="number">30</span>)
    
    <span class="keyword">if</span> lock.acquire():
        <span class="keyword">try</span>:
            <span class="keyword">print</span>(<span class="string">f"[</span>{server_name}<span class="string">] Processing job </span>{job_id}<span class="string">..."</span>)
            time.sleep(<span class="number">5</span>)  <span class="comment"># Simulate work</span>
            <span class="keyword">print</span>(<span class="string">f"[</span>{server_name}<span class="string">] Job </span>{job_id}<span class="string"> completed!"</span>)
        <span class="keyword">finally</span>:
            lock.release()
    <span class="keyword">else</span>:
        <span class="keyword">print</span>(<span class="string">f"[</span>{server_name}<span class="string">] Job </span>{job_id}<span class="string"> already being processed"</span>)

<span class="comment"># Simulate two servers trying to process same job</span>
process_job(<span class="number">123</span>, <span class="string">"Server-A"</span>)  <span class="comment"># Gets lock</span>
process_job(<span class="number">123</span>, <span class="string">"Server-B"</span>)  <span class="comment"># Fails to get lock</span></code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: Why use SETNX instead of checking with GET first?</h4>
                        <p><strong>A:</strong> Race condition! Between GET (check) and SET (acquire), another process could grab it. SETNX is atomic - check and set happen together, guaranteed.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: What if SETNX succeeds but EXPIRE fails?</h4>
                        <p><strong>A:</strong> Lock never expires = deadlock! Solution: Use <code>SET key value NX EX seconds</code> which is atomic (one command).</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: Can GET fail?</h4>
                        <p><strong>A:</strong> GET never "fails" - it returns (nil) if key doesn't exist. This is expected behavior, not an error.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• What if two servers call SETNX at EXACT same time?</h4>
                        <p><strong>Answer:</strong> Impossible! Redis is single-threaded. Commands execute one-at-a-time in order received. One SETNX returns 1 (wins), the other returns 0 (loses). This is why Redis is perfect for distributed locks!</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    <p><strong>Email Campaign System:</strong> 5 worker servers process email queue. Need to ensure each email processed exactly once. Use SETNX with email ID as lock key. First worker to SETNX successfully processes email, others skip it.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">üìù</span><p><strong>SET always works</strong> - Overwrites existing keys</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>SETNX is conditional</strong> - Only sets if key doesn't exist (atomic)</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Perfect for locks</strong> - Prevents race conditions in distributed systems</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Modern: SET...NX EX</strong> - Atomic lock with auto-expiry</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">SET</span><span class="keyword-tag">SETNX</span><span class="keyword-tag">GET</span><span class="keyword-tag">Distributed Lock</span><span class="keyword-tag">Atomic</span><span class="keyword-tag">Race Condition</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> Two servers run SETNX for same key simultaneously. What happens?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) Both get 1 (both succeed)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) One gets 1, other gets 0</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Both get 0 (both fail)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) Redis crashes</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>Redis is single-threaded! Commands execute one-at-a-time. First SETNX creates key (returns 1), second finds key exists (returns 0). This makes SETNX perfect for distributed locks!</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getQuestion16Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>Meet Emma, building a page view counter.</strong> Her code: GET count ‚Üí add 1 ‚Üí SET new count. Boss tests with 100 concurrent users. Final count: 43 views instead of 100! Emma's confused: "Why are we losing counts?"</p>
                    
                    <p>Senior dev explains: "Race condition! Between GET and SET, other requests overwrite your value. You need ATOMIC operations." Enter INCR and DECR!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">INCR key</h4>
                        <p><strong>What:</strong> Atomically increments the integer value by 1. If key doesn't exist, sets it to 0 first, then increments to 1.</p>
                        <p><strong>Returns:</strong> The NEW value after increment</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET views 100</code><br>
                            <code style="color: #50fa7b;">INCR views</code><br>
                            <code style="color: #00FF88;">(integer) 101</code>
                        </div>
                        <p style="margin-top: 10px;"><strong>Key Point:</strong> Thread-safe! Multiple processes can INCR simultaneously without losing counts.</p>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 15px;">DECR key</h4>
                        <p><strong>What:</strong> Atomically decrements the integer value by 1</p>
                        <p><strong>Returns:</strong> The NEW value after decrement</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET stock 50</code><br>
                            <code style="color: #50fa7b;">DECR stock</code><br>
                            <code style="color: #2196F3;">(integer) 49</code>
                        </div>
                    </div>

                    <div style="background: rgba(156, 39, 176, 0.1); border-left: 3px solid #9C27B0; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #9C27B0; margin-bottom: 15px;">üî¢ Variations</h4>
                        <ul>
                            <li><code>INCRBY key amount</code> - Increment by N</li>
                            <li><code>DECRBY key amount</code> - Decrement by N</li>
                            <li><code>INCRBYFLOAT key 0.5</code> - Increment by decimal</li>
                        </ul>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">INCRBY score 10</code> <span style="color: #888;">‚Üê Add 10 points</span><br>
                            <code style="color: #50fa7b;">DECRBY inventory 5</code> <span style="color: #888;">‚Üê Sold 5 items</span>
                        </div>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagram</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">Race Condition: GET+SET vs INCR</div>
                        <svg viewBox="0 0 900 450" style="max-width: 100%; height: auto;">
                            <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">Why INCR is Better Than GET+SET</text>
                            
                            <!-- BAD: GET + SET -->
                            <text x="225" y="70" text-anchor="middle" fill="#ff0000" font-size="14" font-weight="600">‚ùå GET + SET (Race Condition)</text>
                            
                            <rect x="50" y="90" width="350" height="140" fill="rgba(255, 0, 0, 0.1)" stroke="#ff0000" stroke-width="2" rx="6"/>
                            <text x="225" y="115" text-anchor="middle" fill="#fff" font-size="12">Initial: counter = 100</text>
                            
                            <!-- Two concurrent requests -->
                            <rect x="70" y="130" width="140" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="4"/>
                            <text x="140" y="150" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">User A</text>
                            <text x="80" y="170" fill="#fff" font-size="9">GET ‚Üí 100</text>
                            <text x="80" y="185" fill="#fff" font-size="9">+1 = 101</text>
                            <text x="80" y="200" fill="#fff" font-size="9">SET 101</text>

                            <rect x="230" y="130" width="140" height="80" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="4"/>
                            <text x="300" y="150" text-anchor="middle" fill="#2196F3" font-size="11" font-weight="600">User B</text>
                            <text x="240" y="170" fill="#fff" font-size="9">GET ‚Üí 100 üò±</text>
                            <text x="240" y="185" fill="#fff" font-size="9">+1 = 101</text>
                            <text x="240" y="200" fill="#fff" font-size="9">SET 101</text>

                            <text x="225" y="235" text-anchor="middle" fill="#ff0000" font-size="13" font-weight="700">Result: counter = 101 (Lost 1 count!)</text>

                            <!-- GOOD: INCR -->
                            <text x="675" y="70" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">‚úÖ INCR (Atomic)</text>
                            
                            <rect x="500" y="90" width="350" height="140" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="3" rx="6">
                                <animate attributeName="opacity" values="0.6;1;0.6" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="675" y="115" text-anchor="middle" fill="#fff" font-size="12">Initial: counter = 100</text>
                            
                            <rect x="520" y="130" width="140" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="4"/>
                            <text x="590" y="150" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">User A</text>
                            <text x="530" y="175" fill="#fff" font-size="9">INCR counter</text>
                            <text x="530" y="195" fill="#00FF88" font-size="9">‚Üí 101 ‚úÖ</text>

                            <rect x="680" y="130" width="140" height="80" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="4"/>
                            <text x="750" y="150" text-anchor="middle" fill="#2196F3" font-size="11" font-weight="600">User B</text>
                            <text x="690" y="175" fill="#fff" font-size="9">INCR counter</text>
                            <text x="690" y="195" fill="#00FF88" font-size="9">‚Üí 102 ‚úÖ</text>

                            <text x="675" y="235" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="700">Result: counter = 102 (Correct!)</text>

                            <!-- Explanation -->
                            <rect x="100" y="280" width="700" height="150" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                            <text x="450" y="310" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="600">Why INCR is Atomic</text>
                            
                            <text x="120" y="340" fill="#fff" font-size="11"><strong>GET + SET Problem:</strong></text>
                            <text x="130" y="360" fill="#888" font-size="10">‚Ä¢ Read (100) ‚Üí Calculate (101) ‚Üí Write (101)</text>
                            <text x="130" y="378" fill="#888" font-size="10">‚Ä¢ If another request reads before write, it sees old value</text>
                            
                            <text x="120" y="405" fill="#fff" font-size="11"><strong>INCR Solution:</strong></text>
                            <text x="130" y="420" fill="#00FF88" font-size="10">‚Ä¢ Redis executes Read+Increment+Write as ONE operation</text>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Usage</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># INCR - increment by 1</span>
<span class="keyword">SET</span> <span class="string">page_views</span> <span class="number">1000</span>
<span class="keyword">INCR</span> <span class="string">page_views</span>
<span class="number">(integer) 1001</span>

<span class="comment"># INCR on non-existent key (creates it as 0, then increments)</span>
<span class="keyword">INCR</span> <span class="string">new_counter</span>
<span class="number">(integer) 1</span>

<span class="comment"># INCRBY - increment by N</span>
<span class="keyword">INCRBY</span> <span class="string">score</span> <span class="number">50</span>
<span class="number">(integer) 50</span>

<span class="comment"># DECR - decrement by 1</span>
<span class="keyword">SET</span> <span class="string">stock</span> <span class="number">100</span>
<span class="keyword">DECR</span> <span class="string">stock</span>
<span class="number">(integer) 99</span>

<span class="comment"># DECRBY - decrement by N</span>
<span class="keyword">DECRBY</span> <span class="string">stock</span> <span class="number">10</span>
<span class="number">(integer) 89</span>

<span class="comment"># INCRBYFLOAT - decimals</span>
<span class="keyword">SET</span> <span class="string">temperature</span> <span class="number">20.5</span>
<span class="keyword">INCRBYFLOAT</span> <span class="string">temperature</span> <span class="number">1.3</span>
<span class="string">"21.8"</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Page View Counter</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Thread-Safe Counter</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">track_page_view</span>(page_id):
    <span class="string">"""Increment page view counter (thread-safe!)"""</span>
    key = <span class="string">f"views:page:</span>{page_id}<span class="string">"</span>
    new_count = r.incr(key)
    <span class="keyword">return</span> new_count

<span class="keyword">def</span> <span class="function">get_view_count</span>(page_id):
    <span class="string">"""Get current view count"""</span>
    key = <span class="string">f"views:page:</span>{page_id}<span class="string">"</span>
    count = r.get(key)
    <span class="keyword">return</span> <span class="function">int</span>(count) <span class="keyword">if</span> count <span class="keyword">else</span> <span class="number">0</span>

<span class="comment"># Usage - even with 1000 concurrent requests, count is accurate!</span>
views = track_page_view(<span class="number">123</span>)
<span class="keyword">print</span>(<span class="string">f"Page viewed </span>{views}<span class="string"> times"</span>)</code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: What if I INCR a key with string value like "hello"?</h4>
                        <p><strong>A:</strong> Error! <code>(error) ERR value is not an integer or out of range</code>. INCR only works on values that can be interpreted as integers.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: Can DECR go negative?</h4>
                        <p><strong>A:</strong> Yes! <code>SET count 0; DECR count</code> ‚Üí <code>-1</code>. Redis supports negative integers.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Why is INCR atomic if Redis is single-threaded?</h4>
                        <p><strong>Answer:</strong> BECAUSE Redis is single-threaded! Commands execute one-at-a-time, no interruptions. INCR is implemented as read-modify-write inside Redis core, happens as single operation. Multi-threading would need locks; single-threading gives us atomicity for free!</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    <p><strong>API Rate Limiting:</strong> Allow 100 requests per minute per user. Use <code>INCR rate:user:123:202401081430</code> (key per minute). If INCR returns > 100, reject request. Key auto-expires after 60 seconds.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>INCR/DECR are atomic</strong> - No race conditions</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üî¢</span><p><strong>Returns new value</strong> - Useful for immediate feedback</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Thread-safe</strong> - Perfect for counters in distributed systems</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Common uses</strong> - Page views, likes, inventory, rate limiting</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">INCR</span><span class="keyword-tag">DECR</span><span class="keyword-tag">INCRBY</span><span class="keyword-tag">Atomic</span><span class="keyword-tag">Thread-Safe</span><span class="keyword-tag">Race Condition</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> You INCR a non-existent key. What happens?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) Error - key doesn't exist</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) Creates key with value 1</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Returns 0</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) Creates key with value 0</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>INCR treats non-existent keys as 0, then increments. So: non-existent ‚Üí 0 ‚Üí +1 ‚Üí 1. Returns 1. Very convenient for counters!</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getQuestion17Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>New developer Alex makes a mistake:</strong> He creates a session key with 30-minute expiry. Later updates the session data with SET. Users complain: "Sessions never expire now!" Alex discovers SET removed the TTL. Oops!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>When you SET an existing key, three things happen:</strong></p>
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 10px;">1. Value is Overwritten</h4>
                        <p>Old value completely replaced with new value. No merge, no warning.</p>
                        
                        <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">2. TTL is Removed! ‚ö†Ô∏è</h4>
                        <p>If key had expiry, it's GONE after SET. TTL becomes -1 (no expiry).</p>
                        
                        <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">3. Type is Changed</h4>
                        <p>If key was a Hash/List, now it's a String. Previous data lost!</p>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #00FF88; margin-bottom: 10px;">‚úÖ Solution: Preserve TTL</h4>
                        <p><strong>Option 1:</strong> <code>SET key value KEEPTTL</code> (Redis 6.0+)</p>
                        <p><strong>Option 2:</strong> Get TTL first, then SET with EX option</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagram</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">What SET Does to Existing Keys</div>
                        <svg viewBox="0 0 800 400" style="max-width: 100%; height: auto;">
                            <text x="400" y="30" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="700">SET Overwrites Everything!</text>
                            
                            <rect x="50" y="70" width="300" height="120" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                            <text x="200" y="100" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">BEFORE SET</text>
                            <text x="70" y="130" fill="#fff" font-size="11">Key: session:abc</text>
                            <text x="70" y="150" fill="#00FF88" font-size="10">Value: "old_data"</text>
                            <text x="70" y="170" fill="#FFA500" font-size="10">TTL: 1800 seconds</text>

                            <text x="400" y="140" text-anchor="middle" fill="#fff" font-size="14">‚Üí SET session:abc "new_data" ‚Üí</text>

                            <rect x="450" y="70" width="300" height="120" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="3" rx="6"/>
                            <text x="600" y="100" text-anchor="middle" fill="#ff0000" font-size="14" font-weight="600">AFTER SET</text>
                            <text x="470" y="130" fill="#fff" font-size="11">Key: session:abc</text>
                            <text x="470" y="150" fill="#fff" font-size="10">Value: "new_data" ‚úÖ</text>
                            <text x="470" y="170" fill="#ff0000" font-size="10">TTL: -1 (removed!) ‚ö†Ô∏è</text>

                            <rect x="50" y="220" width="700" height="150" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="6"/>
                            <text x="400" y="250" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">Solutions to Keep TTL</text>
                            
                            <text x="70" y="280" fill="#fff" font-size="11"><strong>Method 1:</strong> SET with KEEPTTL (Redis 6.0+)</text>
                            <code x="80" y="300" fill="#50fa7b" font-size="10">SET session:abc "new_data" KEEPTTL</code>
                            
                            <text x="70" y="330" fill="#fff" font-size="11"><strong>Method 2:</strong> Manually restore TTL</text>
                            <code x="80" y="350" fill="#50fa7b" font-size="10">ttl = TTL session:abc; SET session:abc "new"; EXPIRE session:abc ttl</code>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI - SET Overwrites</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Create key with 1-hour expiry</span>
<span class="keyword">SET</span> <span class="string">session:abc</span> <span class="string">"data1"</span> <span class="keyword">EX</span> <span class="number">3600</span>
<span class="keyword">TTL</span> <span class="string">session:abc</span>
<span class="number">(integer) 3599</span>

<span class="comment"># Update value - TTL removed!</span>
<span class="keyword">SET</span> <span class="string">session:abc</span> <span class="string">"data2"</span>
<span class="keyword">TTL</span> <span class="string">session:abc</span>
<span class="number">(integer) -1</span>  <span class="comment"># No expiry now!</span>

<span class="comment"># Solution 1: KEEPTTL</span>
<span class="keyword">SET</span> <span class="string">session:abc</span> <span class="string">"data1"</span> <span class="keyword">EX</span> <span class="number">3600</span>
<span class="keyword">SET</span> <span class="string">session:abc</span> <span class="string">"data2"</span> <span class="keyword">KEEPTTL</span>
<span class="keyword">TTL</span> <span class="string">session:abc</span>
<span class="number">(integer) 3598</span>  <span class="comment"># TTL preserved!</span></code></pre>
                    </div>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Preserve TTL</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">update_without_losing_ttl</span>(key, new_value):
    <span class="comment"># Get current TTL</span>
    ttl = r.ttl(key)
    
    <span class="keyword">if</span> ttl == -<span class="number">2</span>:
        <span class="keyword">print</span>(<span class="string">"Key doesn't exist"</span>)
        <span class="keyword">return</span>
    
    <span class="keyword">if</span> ttl == -<span class="number">1</span>:
        <span class="comment"># No expiry, just SET</span>
        r.set(key, new_value)
    <span class="keyword">else</span>:
        <span class="comment"># Restore TTL</span>
        r.set(key, new_value)
        r.expire(key, ttl)
    
    <span class="keyword">print</span>(<span class="string">f"Updated </span>{key}<span class="string"> with TTL preserved"</span>)</code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: Does HSET also remove TTL?</h4>
                        <p><strong>A:</strong> No! HSET updates fields within a Hash. TTL applies to the entire key and is preserved when you HSET individual fields.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• If I SET a Hash key, what happens?</h4>
                        <p><strong>Answer:</strong> The Hash is DESTROYED! SET changes the key type to String. All Hash fields are lost. Always check key type before SET.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    <p><strong>Session Update Bug:</strong> Sessions expire in 30 minutes. When user makes request, you update session data with SET. Sessions stop expiring! Fix: Use <code>SET session:id data KEEPTTL</code> or manually restore TTL.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>SET removes TTL</strong> - Key becomes permanent</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Use KEEPTTL</strong> - Preserves expiry (Redis 6.0+)</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Changes type</strong> - Hash/List becomes String</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">SET</span><span class="keyword-tag">Overwrite</span><span class="keyword-tag">TTL</span><span class="keyword-tag">KEEPTTL</span><span class="keyword-tag">EXPIRE</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> Key has TTL of 1000 seconds. You run <code>SET key "new"</code>. What's the TTL now?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) 1000 seconds</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) -1 (no expiry)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) 0 (expired)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) Error</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>SET removes TTL! After SET, TTL becomes -1 (no expiry). To keep TTL, use <code>SET key "new" KEEPTTL</code> (Redis 6.0+).</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getQuestion18Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>Startup CTO panics:</strong> "Redis server crashed! We lost ALL user sessions and cache data!" Engineer responds: "Did you enable persistence?" CTO: "What's that?" This conversation happens more often than you'd think!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>Persistence = Saving in-memory data to disk so it survives Redis restarts/crashes.</strong></p>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">1. RDB (Redis Database Backup)</h4>
                        <p><strong>What:</strong> Point-in-time snapshots of entire dataset</p>
                        <p><strong>How:</strong> Fork process, write to .rdb file</p>
                        <p><strong>Config:</strong> <code>save 900 1</code> (save every 15 min if ‚â•1 change)</p>
                        <p><strong>Pros:</strong> Fast recovery, compact files, good for backups</p>
                        <p><strong>Cons:</strong> Can lose 5-15 minutes of data on crash</p>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 15px;">2. AOF (Append Only File)</h4>
                        <p><strong>What:</strong> Logs every write command</p>
                        <p><strong>How:</strong> Appends commands to .aof file, replays on restart</p>
                        <p><strong>Config:</strong> <code>appendfsync everysec</code> (sync every second)</p>
                        <p><strong>Pros:</strong> More durable (lose ~1 sec max), can replay commands</p>
                        <p><strong>Cons:</strong> Larger files, slower recovery</p>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #00FF88; margin-bottom: 10px;">‚úÖ Best Practice: Use BOTH!</h4>
                        <p>RDB for fast backups + AOF for durability = maximum safety</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagram</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">RDB vs AOF Comparison</div>
                        <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                            <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">Two Persistence Methods</text>
                            
                            <!-- RDB -->
                            <text x="225" y="70" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">RDB (Snapshots)</text>
                            <rect x="50" y="90" width="350" height="120" fill="rgba(220, 20, 60, 0.1)" stroke="#DC143C" stroke-width="2" rx="6"/>
                            <text x="225" y="120" text-anchor="middle" fill="#fff" font-size="11">Periodic full backup</text>
                            <text x="70" y="145" fill="#888" font-size="10">T=0: Write dump.rdb (all data)</text>
                            <text x="70" y="165" fill="#888" font-size="10">T=15min: Write dump.rdb again</text>
                            <text x="70" y="185" fill="#FFA500" font-size="9">If crash at T=10min ‚Üí lose 10 min</text>

                            <!-- AOF -->
                            <text x="675" y="70" text-anchor="middle" fill="#2196F3" font-size="14" font-weight="600">AOF (Command Log)</text>
                            <rect x="500" y="90" width="350" height="120" fill="rgba(33, 150, 243, 0.1)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="675" y="120" text-anchor="middle" fill="#fff" font-size="11">Append each command</text>
                            <text x="520" y="145" fill="#888" font-size="10">T=0: SET key1 "val" ‚Üí write to AOF</text>
                            <text x="520" y="165" fill="#888" font-size="10">T=1s: INCR counter ‚Üí write to AOF</text>
                            <text x="520" y="185" fill="#00FF88" font-size="9">If crash ‚Üí lose ~1 second only</text>

                            <!-- Comparison -->
                            <rect x="50" y="240" width="800" height="140" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="6"/>
                            <text x="450" y="270" text-anchor="middle" fill="#fff" font-size="14" font-weight="600">Quick Comparison</text>
                            
                            <text x="70" y="300" fill="#DC143C" font-size="11" font-weight="600">RDB:</text>
                            <text x="80" y="320" fill="#888" font-size="10">‚úÖ Fast startup, ‚ùå Can lose 15 min, ‚úÖ Small files</text>
                            
                            <text x="70" y="350" fill="#2196F3" font-size="11" font-weight="600">AOF:</text>
                            <text x="80" y="370" fill="#888" font-size="10">‚úÖ Lose ~1 sec only, ‚ùå Slower startup, ‚ùå Larger files</text>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">redis.conf - Enable Both</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># RDB configuration</span>
<span class="keyword">save</span> <span class="number">900 1</span>     <span class="comment"># After 15 min if ‚â•1 key changed</span>
<span class="keyword">save</span> <span class="number">300 10</span>    <span class="comment"># After 5 min if ‚â•10 keys changed</span>
<span class="keyword">save</span> <span class="number">60 10000</span>  <span class="comment"># After 1 min if ‚â•10000 keys</span>

<span class="comment"># AOF configuration</span>
<span class="keyword">appendonly</span> yes
<span class="keyword">appendfsync</span> everysec  <span class="comment"># Sync every second (recommended)</span>

<span class="comment"># File paths</span>
<span class="keyword">dbfilename</span> dump.rdb
<span class="keyword">appendfilename</span> <span class="string">"appendonly.aof"</span></code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: Which is better - RDB or AOF?</h4>
                        <p><strong>A:</strong> Use BOTH! RDB for fast backups, AOF for durability. If you must choose one: AOF for critical data (sessions), RDB for cache (okay to lose some data).</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• With AOF, can I lose 0 data?</h4>
                        <p><strong>Answer:</strong> Almost! Use <code>appendfsync always</code> to fsync after EVERY command. But this is SLOW (1000x slower writes). Trade-off: Perfect durability vs performance. Most use <code>everysec</code> (lose ~1 sec max).</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    <p><strong>E-commerce:</strong> Product catalog cache (use RDB, can rebuild). User shopping carts (use AOF, can't lose). Payment processing queue (use AOF + replication). Choose persistence based on data criticality!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Two methods</strong> - RDB (snapshots) + AOF (command log)</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>RDB faster</strong> - But can lose 15 minutes</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üõ°Ô∏è</span><p><strong>AOF more durable</strong> - Lose ~1 second max</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Use both</strong> - Best practice for production</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">Persistence</span><span class="keyword-tag">RDB</span><span class="keyword-tag">AOF</span><span class="keyword-tag">Durability</span><span class="keyword-tag">Snapshot</span><span class="keyword-tag">fsync</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> Server crashes with RDB (save 900 1) only. How much data can you lose?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) Zero data</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">B) ~1 second</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">C) Up to 15 minutes</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) All data</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: C</strong>
                            <p>RDB saves every 900 seconds (15 min). If crash happens 14 minutes after last save, you lose 14 minutes of data! For better durability, enable AOF (loses ~1 sec max).</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getQuestion19Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>DevOps engineer setting up firewall:</strong> "Which port should I open for Redis?" Simple question, important for security and connectivity!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">üì° Port 6379</h4>
                        <p><strong>Redis default TCP port:</strong> 6379</p>
                        <p><strong>Why 6379?</strong> On phone keypad, it spells "MERZ" - named after Italian actress Alessia Merz (creator's inside joke!)</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; margin-top: 15px;">
                            <code style="color: #50fa7b;">redis-cli -h localhost -p 6379</code><br>
                            <code style="color: #50fa7b;">redis-cli</code> <span style="color: #888; font-size: 11px;">‚Üê Defaults to localhost:6379</span>
                        </div>
                    </div>

                    <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #FFA500; margin-bottom: 10px;">üîí Security Tip</h4>
                        <p>Some companies change to non-standard port (e.g., 16379) for basic security through obscurity. But real security needs: authentication + firewall rules!</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagram</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">Redis Connection</div>
                        <svg viewBox="0 0 600 250" style="max-width: 100%; height: auto;">
                            <text x="300" y="30" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="700">Client ‚Üí Redis Connection</text>
                            
                            <rect x="50" y="80" width="150" height="80" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="125" y="110" text-anchor="middle" fill="#2196F3" font-size="13" font-weight="600">Application</text>
                            <text x="125" y="135" text-anchor="middle" fill="#888" font-size="10">redis-cli / Client</text>

                            <line x1="200" y1="120" x2="300" y2="120" stroke="#00FF88" stroke-width="3" marker-end="url(#arrow)"/>
                            <text x="250" y="110" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">Port 6379</text>

                            <rect x="300" y="80" width="250" height="80" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                            <text x="425" y="110" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">Redis Server</text>
                            <text x="425" y="135" text-anchor="middle" fill="#888" font-size="10">localhost:6379</text>

                            <text x="300" y="190" text-anchor="middle" fill="#888" font-size="11">redis-cli -h localhost -p 6379</text>
                            <text x="300" y="210" text-anchor="middle" fill="#666" font-size="9">Or just: redis-cli (uses default port)</text>

                            <defs>
                                <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                                </marker>
                            </defs>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Connection Examples</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Connect to default port</span>
<span class="keyword">redis-cli</span>

<span class="comment"># Explicitly specify port</span>
<span class="keyword">redis-cli</span> -h localhost -p <span class="number">6379</span>

<span class="comment"># Connect to custom port</span>
<span class="keyword">redis-cli</span> -h localhost -p <span class="number">16379</span>

<span class="comment"># Python client</span>
<span class="keyword">import</span> redis
r = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>)</code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">üì°</span><p><strong>Default port: 6379</strong> - TCP port for Redis</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Phone keypad spells MERZ</strong> - Fun fact about the port number!</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>Can be changed</strong> - Some use non-standard ports for security</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">Port 6379</span><span class="keyword-tag">TCP</span><span class="keyword-tag">redis-cli</span><span class="keyword-tag">Connection</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> What is Redis's default port number?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) 3306</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">B) 5432</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">C) 6379</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) 27017</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: C</strong>
                            <p>Redis default port is 6379. Fun fact: On phone keypad it spells "MERZ" (Italian actress Alessia Merz)!</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getQuestion20Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>3 AM emergency call:</strong> "Redis server crashed! Do we lose everything?!" The answer depends entirely on your persistence configuration. Let's understand what happens during restart.</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>When Redis restarts, what happens depends on persistence settings:</strong></p>

                    <div style="background: rgba(255, 0, 0, 0.1); border-left: 3px solid #ff0000; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #ff0000; margin-bottom: 15px;">‚ùå No Persistence</h4>
                        <p><strong>Result:</strong> ALL DATA LOST! Redis starts empty.</p>
                        <p><strong>Use case:</strong> Pure cache where data can be rebuilt</p>
                    </div>

                    <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #FFA500; margin-bottom: 15px;">‚ö†Ô∏è RDB Only</h4>
                        <p><strong>Result:</strong> Loads last snapshot</p>
                        <p><strong>Data loss:</strong> Everything since last save (could be 5-15 minutes)</p>
                        <p><strong>Recovery time:</strong> Fast! Seconds for small datasets</p>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 15px;">üìù AOF Only</h4>
                        <p><strong>Result:</strong> Replays all commands from AOF log</p>
                        <p><strong>Data loss:</strong> ~1 second (last fsync)</p>
                        <p><strong>Recovery time:</strong> Slower - replays every command</p>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #00FF88; margin-bottom: 15px;">‚úÖ Both RDB + AOF</h4>
                        <p><strong>Result:</strong> Uses AOF (more recent/durable)</p>
                        <p><strong>Data loss:</strong> ~1 second maximum</p>
                        <p><strong>Recovery time:</strong> Same as AOF alone</p>
                        <p><strong>Best practice!</strong> RDB for backups, AOF for recovery</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagram</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">Redis Restart Scenarios</div>
                        <svg viewBox="0 0 800 450" style="max-width: 100%; height: auto;">
                            <text x="400" y="30" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">What Happens When Redis Restarts?</text>
                            
                            <!-- Scenario 1: No persistence -->
                            <rect x="50" y="70" width="330" height="80" fill="rgba(255, 0, 0, 0.2)" stroke="#ff0000" stroke-width="2" rx="6"/>
                            <text x="215" y="95" text-anchor="middle" fill="#ff0000" font-size="13" font-weight="600">No Persistence</text>
                            <text x="215" y="120" text-anchor="middle" fill="#fff" font-size="11">‚ùå ALL DATA LOST</text>
                            <text x="215" y="140" text-anchor="middle" fill="#888" font-size="9">Redis starts completely empty</text>

                            <!-- Scenario 2: RDB -->
                            <rect x="420" y="70" width="330" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="585" y="95" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">RDB Only</text>
                            <text x="585" y="120" text-anchor="middle" fill="#fff" font-size="11">Loads dump.rdb</text>
                            <text x="585" y="140" text-anchor="middle" fill="#888" font-size="9">Lost: 5-15 min since last save</text>

                            <!-- Scenario 3: AOF -->
                            <rect x="50" y="180" width="330" height="80" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                            <text x="215" y="205" text-anchor="middle" fill="#2196F3" font-size="13" font-weight="600">AOF Only</text>
                            <text x="215" y="230" text-anchor="middle" fill="#fff" font-size="11">Replays appendonly.aof</text>
                            <text x="215" y="250" text-anchor="middle" fill="#888" font-size="9">Lost: ~1 second max</text>

                            <!-- Scenario 4: Both -->
                            <rect x="420" y="180" width="330" height="80" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="3" rx="6">
                                <animate attributeName="opacity" values="0.6;1;0.6" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="585" y="205" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">RDB + AOF ‚úÖ</text>
                            <text x="585" y="230" text-anchor="middle" fill="#fff" font-size="11">Uses AOF (newer data)</text>
                            <text x="585" y="250" text-anchor="middle" fill="#888" font-size="9">Lost: ~1 second, RDB as backup</text>

                            <!-- Timeline -->
                            <rect x="50" y="290" width="700" height="140" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="6"/>
                            <text x="400" y="320" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">Recovery Timeline</text>
                            
                            <text x="70" y="350" fill="#fff" font-size="11"><strong>T=0:</strong> Redis crashes</text>
                            <text x="70" y="370" fill="#fff" font-size="11"><strong>T+1s:</strong> Redis restarts, checks for AOF</text>
                            <text x="70" y="390" fill="#fff" font-size="11"><strong>T+2-10s:</strong> Loads data (AOF > RDB > nothing)</text>
                            <text x="70" y="410" fill="#00FF88" font-size="11"><strong>T+10s:</strong> Redis ready! ‚úÖ</text>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI - Check Persistence</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Check current persistence status</span>
<span class="keyword">INFO</span> persistence

<span class="comment"># Output shows:</span>
<span class="comment"># rdb_last_save_time: timestamp of last RDB save</span>
<span class="comment"># aof_enabled: 0 or 1</span>
<span class="comment"># aof_current_size: size of AOF file</span>

<span class="comment"># Force save before restart (emergency backup)</span>
<span class="keyword">SAVE</span>  <span class="comment"># Blocks until save completes</span>
<span class="comment"># Or</span>
<span class="keyword">BGSAVE</span>  <span class="comment"># Background save (recommended)</span>

<span class="comment"># Check if save succeeded</span>
<span class="keyword">LASTSAVE</span>
<span class="number">(integer) 1704745200</span>  <span class="comment"># Unix timestamp</span></code></pre>
                    </div>

                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Bash - Safe Redis Restart</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># Before restart - ensure data is saved</span>
redis-cli BGSAVE
sleep <span class="number">5</span>  <span class="comment"># Wait for save to complete</span>

<span class="comment"># Restart Redis</span>
sudo systemctl restart redis

<span class="comment"># Check if Redis is back up</span>
redis-cli ping
<span class="comment"># Should return: PONG</span>

<span class="comment"># Verify data loaded</span>
redis-cli DBSIZE
<span class="comment"># Returns number of keys loaded</span></code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: If I have both RDB and AOF, which does Redis use on restart?</h4>
                        <p><strong>A:</strong> AOF! It's newer and more complete. RDB is kept as backup/emergency fallback.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q: Does TTL continue after restart?</h4>
                        <p><strong>A:</strong> Yes! TTLs are saved in persistence files. If key had 30 min TTL and restart took 1 min, it will have 29 min left after restart.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• What if AOF file is corrupted?</h4>
                        <p><strong>Answer:</strong> Redis WON'T start! Use <code>redis-check-aof --fix appendonly.aof</code> to repair. It truncates corrupted commands at the end. You might lose a few commands but Redis will start. This is why having RDB backup is important!</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    <p><strong>Production Disaster:</strong> E-commerce site, Redis crashes during Black Friday. (1) No persistence ‚Üí lost all shopping carts, disaster! (2) With AOF ‚Üí lost ~1 second, <50 carts affected, acceptable. (3) Recovery time: 15 seconds, site back up. Lesson: ALWAYS enable persistence for critical data!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>No persistence = total loss</strong> - All data gone on restart</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üìù</span><p><strong>AOF preferred</strong> - Used if both exist, more durable</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>Recovery time varies</strong> - Seconds to minutes based on data size</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>TTLs preserved</strong> - Expiry continues after restart</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">Restart</span><span class="keyword-tag">Recovery</span><span class="keyword-tag">RDB</span><span class="keyword-tag">AOF</span><span class="keyword-tag">Data Loss</span><span class="keyword-tag">BGSAVE</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> Redis has both RDB and AOF enabled. On restart, which file does it use?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) RDB (faster)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) AOF (more recent)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Both (merges them)</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) Whichever is larger</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>When both exist, Redis uses AOF because it's more recent and complete (logs every command). RDB is kept as backup. AOF is prioritized for recovery!</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Copy code function
        function copyCode(button) {
            const codeBlock = button.closest('.code-block');
            const code = codeBlock.querySelector('.code-content').innerText;
            
            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = '‚úì Copied!';
                button.style.background = 'var(--success-color)';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                button.textContent = '‚úó Failed';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            });
        }

        // ============================================================
        // SECTION 3: Redis Data Structures (Q21-Q36)
        // ============================================================
        
        function getQuestion21Content() {
            return `
                <div class="content-section">
                    <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
                    <p><strong>Developer asks:</strong> "I need to store user profile JSON. Each profile is 2KB. Can Redis handle 10,000 users?" The answer depends on Redis string limits!</p>
                </div>
                <div class="content-section">
                    <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
                    <p><strong>Maximum String Size: 512 MB</strong></p>
                    <p>Redis strings can store up to 512 megabytes of data. This includes text, JSON, serialized objects, even small images!</p>
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <p><strong>Practical Limits:</strong></p>
                        <ul>
                            <li>10,000 users √ó 2KB = 20MB ‚úÖ Easy</li>
                            <li>100MB image = ‚úÖ Possible but not recommended</li>
                            <li>1GB file = ‚ùå Exceeds limit, split into chunks</li>
                        </ul>
                    </div>
                    <p><strong>Best Practice:</strong> Keep strings under 1MB for performance. Large values slow down GET/SET operations.</p>
                </div>
                <div class="content-section">
                    <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üìè</span><p><strong>Max: 512MB</strong> - Hard limit for Redis strings</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Recommended: &lt;1MB</strong> - For good performance</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Common use: 1KB-100KB</strong> - JSON, HTML fragments</p></div>
                </div>
                <div class="content-section">
                    <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">512MB</span><span class="keyword-tag">String Size</span><span class="keyword-tag">Limits</span>
                    </div>
                </div>
                <div class="content-section">
                    <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> Can Redis store a 600MB string?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) Yes</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) No - exceeds 512MB limit</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Yes but slow</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>Redis strings have a hard limit of 512MB. A 600MB value would be rejected. Split into chunks if needed!</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Continue with Q22-Q36 in condensed format due to token limits...
        function getQuestion22Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>Meet Maya, a junior developer at a startup.</strong> Her tech lead asks: "Maya, we're using Redis strings everywhere - sessions, cache, counters. But I want you to understand WHY we chose strings for each case. Can you explain real-world string use cases?"</p>
                    
                    <p>Maya realizes she knows the commands but not the practical applications. Let's help her understand where Redis strings shine in production systems!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <p><strong>Redis Strings are the most versatile data type</strong> - binary-safe sequences that can store text, numbers, JSON, serialized objects, or even small images. This flexibility makes them perfect for 6 major use cases in production systems.</p>

                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">1. üåê Web Page Caching</h4>
                        <p><strong>Problem:</strong> Generating HTML is slow (database queries, template rendering)</p>
                        <p><strong>Solution:</strong> Cache the rendered HTML in Redis</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET page:home:html "&lt;html&gt;&lt;body&gt;...&lt;/body&gt;&lt;/html&gt;" EX 300</code>
                        </div>
                        <p style="margin-top: 10px;"><strong>Result:</strong> Page loads in 5ms instead of 500ms!</p>
                    </div>

                    <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #FFA500; margin-bottom: 15px;">2. üîë Session Storage</h4>
                        <p><strong>Problem:</strong> Need to track logged-in users across multiple servers</p>
                        <p><strong>Solution:</strong> Store session data as JSON string</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET session:abc123 '{"user_id":1001,"username":"maya"}' EX 1800</code>
                        </div>
                        <p style="margin-top: 10px;"><strong>Why Strings?</strong> Fast, simple, works with any web framework</p>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #00FF88; margin-bottom: 15px;">3. üìä Counters & Analytics</h4>
                        <p><strong>Problem:</strong> Track page views, likes, shares in real-time</p>
                        <p><strong>Solution:</strong> Use String + INCR for atomic counting</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">INCR article:555:views</code><br>
                            <code style="color: #50fa7b;">INCR user:maya:post_count</code>
                        </div>
                        <p style="margin-top: 10px;"><strong>Why Strings?</strong> INCR is atomic (no race conditions!)</p>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 15px;">4. ‚è±Ô∏è Rate Limiting</h4>
                        <p><strong>Problem:</strong> Prevent API abuse (max 100 requests/minute per user)</p>
                        <p><strong>Solution:</strong> Counter with TTL per time window</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">INCR rate:user123:202401081430</code> <span style="color: #888; font-size: 11px;">‚Üê Key per minute</span><br>
                            <code style="color: #50fa7b;">EXPIRE rate:user123:202401081430 60</code>
                        </div>
                        <p style="margin-top: 10px;"><strong>Logic:</strong> If INCR returns > 100, reject request</p>
                    </div>

                    <div style="background: rgba(156, 39, 176, 0.1); border-left: 3px solid #9C27B0; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #9C27B0; margin-bottom: 15px;">5. üö© Feature Flags</h4>
                        <p><strong>Problem:</strong> Enable/disable features without deploying code</p>
                        <p><strong>Solution:</strong> Store boolean flags as strings</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET feature:new_ui "enabled"</code><br>
                            <code style="color: #50fa7b;">SET feature:beta_payments "disabled"</code>
                        </div>
                        <p style="margin-top: 10px;"><strong>Benefit:</strong> Change features instantly for all servers</p>
                    </div>

                    <div style="background: rgba(255, 235, 59, 0.1); border-left: 3px solid #FFEB3B; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #FFEB3B; margin-bottom: 15px;">6. üé´ JWT Token Storage</h4>
                        <p><strong>Problem:</strong> Temporarily store authentication tokens for validation</p>
                        <p><strong>Solution:</strong> Cache JWTs with expiry</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET token:eyJhbGc... "valid" EX 3600</code>
                        </div>
                        <p style="margin-top: 10px;"><strong>Use Case:</strong> Check if token revoked before processing request</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">6 Real-World Redis String Use Cases</div>
                        <svg viewBox="0 0 1000 700" style="max-width: 100%; height: auto;">
                            <text x="500" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Strings in Production Systems</text>
                            
                            <!-- Use Case 1: Caching -->
                            <rect x="50" y="70" width="280" height="140" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="2" rx="8">
                                <animate attributeName="opacity" values="0.7;1;0.7" dur="3s" repeatCount="indefinite"/>
                            </rect>
                            <text x="190" y="100" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">1. WEB CACHING</text>
                            <text x="70" y="130" fill="#fff" font-size="11">Problem: Slow page load</text>
                            <text x="70" y="150" fill="#00FF88" font-size="10">Solution: Cache HTML</text>
                            <text x="70" y="170" fill="#888" font-size="9">SET page:home "&lt;html&gt;..."</text>
                            <text x="70" y="190" fill="#FFA500" font-size="9">‚ö° 500ms ‚Üí 5ms</text>

                            <!-- Use Case 2: Sessions -->
                            <rect x="360" y="70" width="280" height="140" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="8">
                                <animate attributeName="opacity" values="0.7;1;0.7" dur="3s" repeatCount="indefinite" begin="0.5s"/>
                            </rect>
                            <text x="500" y="100" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="700">2. SESSION STORAGE</text>
                            <text x="380" y="130" fill="#fff" font-size="11">Problem: Track users</text>
                            <text x="380" y="150" fill="#00FF88" font-size="10">Solution: Store JSON</text>
                            <text x="380" y="170" fill="#888" font-size="9">SET session:abc '{...}'</text>
                            <text x="380" y="190" fill="#FFA500" font-size="9">üîë 30-min TTL</text>

                            <!-- Use Case 3: Counters -->
                            <rect x="670" y="70" width="280" height="140" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="8">
                                <animate attributeName="opacity" values="0.7;1;0.7" dur="3s" repeatCount="indefinite" begin="1s"/>
                            </rect>
                            <text x="810" y="100" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="700">3. COUNTERS</text>
                            <text x="690" y="130" fill="#fff" font-size="11">Problem: Track views</text>
                            <text x="690" y="150" fill="#00FF88" font-size="10">Solution: INCR</text>
                            <text x="690" y="170" fill="#888" font-size="9">INCR article:555:views</text>
                            <text x="690" y="190" fill="#FFA500" font-size="9">üìä Atomic & Fast</text>

                            <!-- Use Case 4: Rate Limiting -->
                            <rect x="50" y="240" width="280" height="140" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="8">
                                <animate attributeName="opacity" values="0.7;1;0.7" dur="3s" repeatCount="indefinite" begin="1.5s"/>
                            </rect>
                            <text x="190" y="270" text-anchor="middle" fill="#2196F3" font-size="14" font-weight="700">4. RATE LIMITING</text>
                            <text x="70" y="300" fill="#fff" font-size="11">Problem: API abuse</text>
                            <text x="70" y="320" fill="#00FF88" font-size="10">Solution: Counter/min</text>
                            <text x="70" y="340" fill="#888" font-size="9">INCR rate:user:2024...</text>
                            <text x="70" y="360" fill="#FFA500" font-size="9">‚è±Ô∏è Max 100/minute</text>

                            <!-- Use Case 5: Feature Flags -->
                            <rect x="360" y="240" width="280" height="140" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="2" rx="8">
                                <animate attributeName="opacity" values="0.7;1;0.7" dur="3s" repeatCount="indefinite" begin="2s"/>
                            </rect>
                            <text x="500" y="270" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">5. FEATURE FLAGS</text>
                            <text x="380" y="300" fill="#fff" font-size="11">Problem: Deploy risk</text>
                            <text x="380" y="320" fill="#00FF88" font-size="10">Solution: Toggle flags</text>
                            <text x="380" y="340" fill="#888" font-size="9">SET feature:ui "on"</text>
                            <text x="380" y="360" fill="#FFA500" font-size="9">üö© No redeploy!</text>

                            <!-- Use Case 6: JWT Tokens -->
                            <rect x="670" y="240" width="280" height="140" fill="rgba(255, 235, 59, 0.2)" stroke="#FFEB3B" stroke-width="2" rx="8">
                                <animate attributeName="opacity" values="0.7;1;0.7" dur="3s" repeatCount="indefinite" begin="2.5s"/>
                            </rect>
                            <text x="810" y="270" text-anchor="middle" fill="#FFEB3B" font-size="14" font-weight="700">6. JWT TOKENS</text>
                            <text x="690" y="300" fill="#fff" font-size="11">Problem: Revoke JWT</text>
                            <text x="690" y="320" fill="#00FF88" font-size="10">Solution: Blocklist</text>
                            <text x="690" y="340" fill="#888" font-size="9">SET token:xyz "revoked"</text>
                            <text x="690" y="360" fill="#FFA500" font-size="9">üé´ Quick check</text>

                            <!-- Decision Flow -->
                            <rect x="50" y="410" width="900" height="260" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                            <text x="500" y="440" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="700">When to Use Redis Strings?</text>
                            
                            <rect x="80" y="460" width="380" height="90" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                            <text x="270" y="485" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">‚úÖ Perfect For:</text>
                            <text x="100" y="510" fill="#fff" font-size="11">‚Ä¢ Simple values (text, numbers)</text>
                            <text x="100" y="530" fill="#fff" font-size="11">‚Ä¢ Need TTL/expiry</text>
                            <text x="100" y="545" fill="#fff" font-size="11">‚Ä¢ Atomic operations (INCR)</text>

                            <rect x="520" y="460" width="380" height="90" fill="rgba(255, 0, 0, 0.1)" stroke="#ff0000" stroke-width="2" rx="6"/>
                            <text x="710" y="485" text-anchor="middle" fill="#ff0000" font-size="13" font-weight="600">‚ùå Not Good For:</text>
                            <text x="540" y="510" fill="#fff" font-size="11">‚Ä¢ Frequently updated parts of object</text>
                            <text x="540" y="530" fill="#fff" font-size="11">‚Ä¢ Need to query by fields</text>
                            <text x="540" y="545" fill="#fff" font-size="11">‚Ä¢ Complex nested data (use Hash)</text>

                            <text x="500" y="585" text-anchor="middle" fill="#888" font-size="12">Real Companies Using These Patterns:</text>
                            <text x="500" y="610" text-anchor="middle" fill="#fff" font-size="11">Twitter (caching), GitHub (rate limiting), Stripe (sessions),</text>
                            <text x="500" y="630" text-anchor="middle" fill="#fff" font-size="11">Instagram (counters), Netflix (feature flags), Uber (JWT tokens)</text>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Page Caching System</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Cache HTML Pages</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">get_page</span>(page_name):
    <span class="string">"""Get page from cache or generate"""</span>
    cache_key = <span class="string">f"page:</span>{page_name}<span class="string">:html"</span>
    
    <span class="comment"># Try cache first</span>
    cached = r.get(cache_key)
    <span class="keyword">if</span> cached:
        <span class="keyword">print</span>(<span class="string">"‚úÖ Cache HIT - Fast!"</span>)
        <span class="keyword">return</span> cached
    
    <span class="comment"># Cache miss - generate page (slow)</span>
    <span class="keyword">print</span>(<span class="string">"‚ùå Cache MISS - Generating..."</span>)
    time.sleep(<span class="number">0.5</span>)  <span class="comment"># Simulate slow generation</span>
    html = <span class="string">f"&lt;html&gt;&lt;body&gt;Welcome to </span>{page_name}<span class="string">!&lt;/body&gt;&lt;/html&gt;"</span>
    
    <span class="comment"># Cache for 5 minutes</span>
    r.setex(cache_key, <span class="number">300</span>, html)
    
    <span class="keyword">return</span> html

<span class="comment"># First call - slow (500ms)</span>
get_page(<span class="string">"home"</span>)  <span class="comment"># Cache MISS</span>

<span class="comment"># Second call - fast (1ms)</span>
get_page(<span class="string">"home"</span>)  <span class="comment"># Cache HIT!</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Rate Limiting Implementation</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - API Rate Limiter</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">check_rate_limit</span>(user_id, max_requests=<span class="number">100</span>):
    <span class="string">"""Allow max 100 requests per minute"""</span>
    <span class="comment"># Create key with current minute</span>
    current_minute = datetime.now().strftime(<span class="string">"%Y%m%d%H%M"</span>)
    key = <span class="string">f"rate:</span>{user_id}<span class="string">:</span>{current_minute}<span class="string">"</span>
    
    <span class="comment"># Increment request count</span>
    request_count = r.incr(key)
    
    <span class="comment"># Set expiry on first request (60 seconds)</span>
    <span class="keyword">if</span> request_count == <span class="number">1</span>:
        r.expire(key, <span class="number">60</span>)
    
    <span class="comment"># Check if limit exceeded</span>
    <span class="keyword">if</span> request_count > max_requests:
        <span class="keyword">return</span> {
            <span class="string">"allowed"</span>: <span class="keyword">False</span>,
            <span class="string">"message"</span>: <span class="string">f"Rate limit exceeded! Max </span>{max_requests}<span class="string">/min"</span>,
            <span class="string">"retry_after"</span>: r.ttl(key)
        }
    
    <span class="keyword">return</span> {
        <span class="string">"allowed"</span>: <span class="keyword">True</span>,
        <span class="string">"remaining"</span>: max_requests - request_count
    }

<span class="comment"># Usage in API endpoint</span>
result = check_rate_limit(<span class="string">"user123"</span>)
<span class="keyword">if</span> result[<span class="string">"allowed"</span>]:
    <span class="keyword">print</span>(<span class="string">f"Request allowed. </span>{result['remaining']}<span class="string"> remaining"</span>)
<span class="keyword">else</span>:
    <span class="keyword">print</span>(<span class="string">f"Blocked! Retry in </span>{result['retry_after']}<span class="string"> seconds"</span>)</code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Feature Flags System</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Dynamic Feature Toggle</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">FeatureFlags</span>:
    <span class="keyword">def</span> <span class="function">is_enabled</span>(<span class="keyword">self</span>, feature_name):
        <span class="string">"""Check if feature is enabled"""</span>
        key = <span class="string">f"feature:</span>{feature_name}<span class="string">"</span>
        status = r.get(key)
        <span class="keyword">return</span> status == <span class="string">"enabled"</span>
    
    <span class="keyword">def</span> <span class="function">enable</span>(<span class="keyword">self</span>, feature_name):
        <span class="string">"""Enable a feature"""</span>
        r.set(<span class="string">f"feature:</span>{feature_name}<span class="string">"</span>, <span class="string">"enabled"</span>)
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Feature '</span>{feature_name}<span class="string">' enabled"</span>)
    
    <span class="keyword">def</span> <span class="function">disable</span>(<span class="keyword">self</span>, feature_name):
        <span class="string">"""Disable a feature"""</span>
        r.set(<span class="string">f"feature:</span>{feature_name}<span class="string">"</span>, <span class="string">"disabled"</span>)
        <span class="keyword">print</span>(<span class="string">f"‚ùå Feature '</span>{feature_name}<span class="string">' disabled"</span>)

<span class="comment"># Usage in application code</span>
flags = FeatureFlags()

<span class="comment"># In your code</span>
<span class="keyword">if</span> flags.is_enabled(<span class="string">"new_ui"</span>):
    <span class="keyword">print</span>(<span class="string">"Show new UI design"</span>)
<span class="keyword">else</span>:
    <span class="keyword">print</span>(<span class="string">"Show old UI"</span>)

<span class="comment"># Admin can toggle features instantly (no deployment!)</span>
flags.enable(<span class="string">"new_ui"</span>)  <span class="comment"># All servers see change immediately</span></code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why not use database for caching?</h4>
                        <p><strong>A:</strong> Database is 100x slower! Redis: ~1ms, MySQL: ~50-100ms. Redis is in-memory (RAM) vs database on disk (SSD/HDD). For frequently accessed data, Redis wins dramatically.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can I store images in Redis strings?</h4>
                        <p><strong>A:</strong> Technically yes (binary-safe, up to 512MB), but NOT recommended! Use Redis for metadata/URLs, store actual images in S3/CDN. Redis memory is expensive ($10/GB) vs S3 ($0.02/GB).</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What if cache and database go out of sync?</h4>
                        <p><strong>A:</strong> Use TTL! Set reasonable expiry (5-60 minutes). Cache becomes stale ‚Üí expires ‚Üí fresh data fetched from database. Trade-off: Shorter TTL = more consistent but more DB load.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Rate limiting per minute vs per hour?</h4>
                        <p><strong>A:</strong> Per minute is easier (key = user:YYYYMMDDHHMM, TTL 60 sec). Per hour requires sliding window or multiple keys. Most APIs use per-minute or per-second windows for simplicity.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Why not use Hash instead of JSON string for sessions?</h4>
                        <p><strong>A:</strong> Both work! Hash if you update fields individually (HSET session:x last_activity time). JSON string if you always replace entire session. JSON is simpler for most frameworks.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Cache stampede problem</h4>
                        <p><strong>Scenario:</strong> Popular page cached for 5 min. At expiry, 10,000 requests hit simultaneously. All see cache miss, all query database, database dies!</p>
                        <p style="margin-top: 10px;"><strong>Solution 1:</strong> "Cache with lock" - First request rebuilds cache, others wait</p>
                        <p><strong>Solution 2:</strong> "Probabilistic early expiration" - Refresh cache BEFORE expiry (e.g., at 80% of TTL)</p>
                        <p><strong>Solution 3:</strong> "Always serve stale" - Return old cache while rebuilding in background</p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: What if Redis crashes during rate limiting?</h4>
                        <p><strong>Answer:</strong> Counter resets ‚Üí users get fresh 100 requests! Options:</p>
                        <p style="margin-top: 10px;"><strong>1.</strong> Accept it - rare crash, temporary issue</p>
                        <p><strong>2.</strong> Enable Redis persistence (AOF) - lose only ~1 second</p>
                        <p><strong>3.</strong> Use Redis Cluster/replication - failover to replica</p>
                        <p style="margin-top: 10px;">Most companies accept option 1 - rate limits aren't critical data.</p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Feature flag changes take time to propagate?</h4>
                        <p><strong>Problem:</strong> 100 app servers, each caches flag value locally for 1 minute. Flag change takes up to 1 minute to reach all servers!</p>
                        <p style="margin-top: 10px;"><strong>Solution:</strong> Either:</p>
                        <p><strong>A)</strong> Don't cache flags locally - check Redis every time (adds ~1ms latency)</p>
                        <p><strong>B)</strong> Use Redis Pub/Sub to broadcast flag changes instantly to all servers</p>
                        <p style="margin-top: 10px;">Trade-off: Consistency vs performance. Most choose A for simplicity.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    
                    <p><strong>Scenario: Building a News Website</strong></p>
                    <p>You're building a news site with 1 million visitors/day. Homepage shows latest 50 articles. Each article page gets 10,000 views. Let's use Redis strings strategically!</p>

                    <h4 style="color: var(--primary-color); margin-top: 20px;">Without Redis:</h4>
                    <div style="background: rgba(255, 0, 0, 0.1); border-left: 3px solid #ff0000; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <p><strong>Homepage Request:</strong></p>
                        <ul>
                            <li>Query MySQL: SELECT * FROM articles ORDER BY published_at DESC LIMIT 50</li>
                            <li>Join with authors, categories, tags (3 more queries)</li>
                            <li>Render template</li>
                            <li><strong>Total time: 500ms</strong></li>
                            <li><strong>1M requests/day √ó 500ms = 500 million ms = 139 hours of DB time!</strong></li>
                        </ul>
                        <p style="margin-top: 10px; color: #ff0000;"><strong>Result: Database overloaded, site slow, angry users! üò°</strong></p>
                    </div>

                    <h4 style="color: var(--primary-color);">With Redis String Caching:</h4>
                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <div class="code-block">
                            <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px;"><code><span class="comment"># Cache rendered homepage HTML for 5 minutes</span>
<span class="keyword">SET</span> <span class="string">page:home:html</span> <span class="string">"&lt;html&gt;...50 articles...&lt;/html&gt;"</span> <span class="keyword">EX</span> <span class="number">300</span>

<span class="comment"># Cache each article page for 1 hour</span>
<span class="keyword">SET</span> <span class="string">article:12345:html</span> <span class="string">"&lt;html&gt;...article content...&lt;/html&gt;"</span> <span class="keyword">EX</span> <span class="number">3600</span>

<span class="comment"># Track views (use for "trending" section)</span>
<span class="keyword">INCR</span> <span class="string">article:12345:views</span></code></pre>
                        </div>
                        <p style="margin-top: 15px;"><strong>Homepage Request:</strong></p>
                        <ul>
                            <li>Check Redis cache: GET page:home:html</li>
                            <li>Cache hit? Return HTML (1ms)</li>
                            <li>Cache miss? Query DB, render, cache it (500ms, but only once per 5 min)</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>Impact:</strong></p>
                        <ul>
                            <li>‚úÖ 99.9% requests: 1ms (from cache)</li>
                            <li>‚úÖ 0.1% requests: 500ms (cache refresh)</li>
                            <li>‚úÖ Database load: 99% reduction!</li>
                            <li>‚úÖ Can handle 10x traffic with same database</li>
                        </ul>
                        <p style="margin-top: 10px; color: #00FF88;"><strong>Result: Fast site, happy users, happy database! üöÄ</strong></p>
                    </div>

                    <h4 style="color: var(--primary-color);">Bonus: Add Rate Limiting</h4>
                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <p><strong>Problem:</strong> Bots scraping articles (1000 requests/min from same IP)</p>
                        <div class="code-block">
                            <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px;"><code><span class="comment"># Rate limit: max 60 requests per minute per IP</span>
<span class="keyword">INCR</span> <span class="string">rate:192.168.1.100:202401081430</span>
<span class="keyword">EXPIRE</span> <span class="string">rate:192.168.1.100:202401081430</span> <span class="number">60</span>

<span class="comment"># If INCR returns > 60, block request</span></code></pre>
                        </div>
                        <p style="margin-top: 10px;"><strong>Result:</strong> Bots blocked, legitimate users unaffected!</p>
                    </div>

                    <p><strong>Total Cost Savings:</strong></p>
                    <ul>
                        <li><strong>Before:</strong> Need expensive database server ($500/month) to handle load</li>
                        <li><strong>After:</strong> Cheap database ($50/month) + Redis ($30/month) = 84% cost reduction!</li>
                    </ul>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">üåê</span><p><strong>Caching:</strong> Store rendered HTML/JSON to avoid slow generation</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üîë</span><p><strong>Sessions:</strong> Track logged-in users across multiple servers</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Counters:</strong> Atomic INCR for views, likes, shares</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>Rate Limiting:</strong> Prevent API abuse with TTL counters</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üö©</span><p><strong>Feature Flags:</strong> Toggle features without deployment</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üé´</span><p><strong>JWT Tokens:</strong> Quick revocation check before validation</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">Caching</span><span class="keyword-tag">Sessions</span><span class="keyword-tag">Counters</span><span class="keyword-tag">Rate Limiting</span><span class="keyword-tag">Feature Flags</span><span class="keyword-tag">JWT</span><span class="keyword-tag">INCR</span><span class="keyword-tag">TTL</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> Your API gets 1000 requests/sec. What's the BEST Redis string use case?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) Store user passwords</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) Cache API responses</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) Store images</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) Replace database</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>Caching API responses in Redis strings reduces database load by 90%+ and speeds up responses from 100ms to 1ms! Never store passwords (use proper hashing), images (too large), or replace database (need persistence).</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function getQuestion23Content() {
            return `
                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üé¨</span>
                        <h2 class="section-label">1. Real Scenario</h2>
                    </div>
                    <p><strong>Meet Jake, building a logging system.</strong> His manager asks: "Jake, we need to append log entries to Redis. Don't overwrite - ADD to existing logs!" Jake wonders: "Should I GET the old value, concatenate, then SET? That seems inefficient..."</p>
                    
                    <p>His senior colleague says: "Use APPEND command! It's atomic and doesn't require GET first." Let's understand the difference!</p>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìö</span>
                        <h2 class="section-label">2. Actual Definition</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">SET Command</h4>
                        <p><strong>SET key value</strong> - Completely replaces the value, regardless of what was there before.</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET message "Hello"</code><br>
                            <code style="color: #888;">‚Üí message = "Hello"</code><br><br>
                            <code style="color: #50fa7b;">SET message "World"</code><br>
                            <code style="color: #888;">‚Üí message = "World" (overwrote "Hello"!)</code>
                        </div>
                        <p style="margin-top: 10px;"><strong>Behavior:</strong> Old value completely discarded. Always returns "OK".</p>
                    </div>

                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #00FF88; margin-bottom: 15px;">APPEND Command</h4>
                        <p><strong>APPEND key value</strong> - Adds the value to the END of existing string. If key doesn't exist, creates it (like SET).</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #50fa7b;">SET message "Hello"</code><br>
                            <code style="color: #888;">‚Üí message = "Hello"</code><br><br>
                            <code style="color: #50fa7b;">APPEND message " World"</code><br>
                            <code style="color: #888;">‚Üí message = "Hello World"</code><br>
                            <code style="color: #FFA500;">(integer) 11</code> <span style="color: #888;">‚Üê Returns new length</span>
                        </div>
                        <p style="margin-top: 10px;"><strong>Behavior:</strong> Preserves old value, adds new text. Returns length of resulting string.</p>
                    </div>

                    <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 20px; border-radius: 6px; margin: 20px 0;">
                        <h4 style="color: #2196F3; margin-bottom: 15px;">üìä Key Differences</h4>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr style="background: rgba(220,20,60,0.2);">
                                <th style="padding: 10px; text-align: left;">Aspect</th>
                                <th style="padding: 10px; text-align: left;">SET</th>
                                <th style="padding: 10px; text-align: left;">APPEND</th>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;">Old Value</td>
                                <td style="padding: 8px;">‚ùå Discarded</td>
                                <td style="padding: 8px;">‚úÖ Preserved</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;">Operation</td>
                                <td style="padding: 8px;">Replace</td>
                                <td style="padding: 8px;">Add to end</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;">Return Value</td>
                                <td style="padding: 8px;">"OK"</td>
                                <td style="padding: 8px;">New length (integer)</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;">If Key Missing</td>
                                <td style="padding: 8px;">Creates new</td>
                                <td style="padding: 8px;">Creates new</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 8px;">Use Case</td>
                                <td style="padding: 8px;">Updating value</td>
                                <td style="padding: 8px;">Building strings</td>
                            </tr>
                        </table>
                    </div>

                    <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 20px 0;">
                        <p><strong>üí° Pro Tip:</strong> APPEND is more efficient than GET ‚Üí concatenate ‚Üí SET because it's a single atomic operation. No race conditions!</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìä</span>
                        <h2 class="section-label">3. Visual Diagrams</h2>
                    </div>
                    
                    <div class="diagram-container">
                        <div class="diagram-title">SET vs APPEND Behavior</div>
                        <svg viewBox="0 0 1000 600" style="max-width: 100%; height: auto;">
                            <text x="500" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">SET vs APPEND: How They Work</text>
                            
                            <!-- SET Operation -->
                            <text x="250" y="70" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="600">SET (Replace)</text>
                            
                            <rect x="50" y="100" width="400" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="250" y="125" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">Initial State</text>
                            <text x="70" y="150" fill="#fff" font-size="11">key: log</text>
                            <text x="70" y="170" fill="#888" font-size="10">value: "Error: Connection failed"</text>

                            <text x="250" y="210" text-anchor="middle" fill="#fff" font-size="12">‚Üì SET log "Warning: Disk full"</text>

                            <rect x="50" y="240" width="400" height="80" fill="rgba(220, 20, 60, 0.3)" stroke="#DC143C" stroke-width="3" rx="6">
                                <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="250" y="265" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">After SET</text>
                            <text x="70" y="290" fill="#fff" font-size="11">key: log</text>
                            <text x="70" y="310" fill="#ff0000" font-size="10">value: "Warning: Disk full" ‚ö†Ô∏è Old data lost!</text>

                            <!-- APPEND Operation -->
                            <text x="750" y="70" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">APPEND (Add)</text>
                            
                            <rect x="550" y="100" width="400" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                            <text x="750" y="125" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">Initial State</text>
                            <text x="570" y="150" fill="#fff" font-size="11">key: log</text>
                            <text x="570" y="170" fill="#888" font-size="10">value: "Error: Connection failed"</text>

                            <text x="750" y="210" text-anchor="middle" fill="#fff" font-size="12">‚Üì APPEND log " | Warning: Disk full"</text>

                            <rect x="550" y="240" width="400" height="100" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="3" rx="6">
                                <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" repeatCount="indefinite"/>
                            </rect>
                            <text x="750" y="265" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">After APPEND</text>
                            <text x="570" y="290" fill="#fff" font-size="11">key: log</text>
                            <text x="570" y="310" fill="#00FF88" font-size="10">value: "Error: Connection failed</text>
                            <text x="570" y="325" fill="#00FF88" font-size="10"> | Warning: Disk full" ‚úÖ Old data preserved!</text>

                            <!-- Comparison scenario -->
                            <rect x="50" y="380" width="900" height="190" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                            <text x="500" y="410" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">Building a Log File: The Wrong Way vs Right Way</text>
                            
                            <text x="80" y="445" fill="#ff0000" font-size="13" font-weight="600">‚ùå Inefficient Way (3 operations):</text>
                            <rect x="90" y="455" width="400" height="100" fill="rgba(255, 0, 0, 0.1)" stroke="#ff0000" stroke-width="1" rx="4"/>
                            <text x="100" y="475" fill="#fff" font-size="10">1. GET log ‚Üí "Line1"</text>
                            <text x="100" y="495" fill="#fff" font-size="10">2. In app: newValue = "Line1" + "\\nLine2"</text>
                            <text x="100" y="515" fill="#fff" font-size="10">3. SET log "Line1\\nLine2"</text>
                            <text x="100" y="535" fill="#FFA500" font-size="9">‚ö†Ô∏è Race condition! Another process might SET in between</text>

                            <text x="520" y="445" fill="#00FF88" font-size="13" font-weight="600">‚úÖ Efficient Way (1 operation):</text>
                            <rect x="530" y="455" width="400" height="100" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="1" rx="4"/>
                            <text x="540" y="475" fill="#fff" font-size="10">1. APPEND log "\\nLine2"</text>
                            <text x="540" y="495" fill="#888" font-size="10">(That's it!)</text>
                            <text x="540" y="535" fill="#00FF88" font-size="9">‚úÖ Atomic! Thread-safe! Faster!</text>
                        </svg>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üíª</span>
                        <h2 class="section-label">4. Code Examples</h2>
                    </div>
                    
                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic SET vs APPEND</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Redis CLI</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="comment"># SET - Replaces value completely</span>
<span class="keyword">SET</span> <span class="string">greeting</span> <span class="string">"Hello"</span>
<span class="keyword">OK</span>

<span class="keyword">GET</span> <span class="string">greeting</span>
<span class="string">"Hello"</span>

<span class="keyword">SET</span> <span class="string">greeting</span> <span class="string">"Goodbye"</span>
<span class="keyword">OK</span>

<span class="keyword">GET</span> <span class="string">greeting</span>
<span class="string">"Goodbye"</span>  <span class="comment"># "Hello" is gone!</span>

<span class="comment"># APPEND - Adds to existing value</span>
<span class="keyword">SET</span> <span class="string">sentence</span> <span class="string">"Hello"</span>
<span class="keyword">OK</span>

<span class="keyword">APPEND</span> <span class="string">sentence</span> <span class="string">" World"</span>
<span class="number">(integer) 11</span>  <span class="comment"># Returns new length</span>

<span class="keyword">GET</span> <span class="string">sentence</span>
<span class="string">"Hello World"</span>  <span class="comment"># Old value preserved!</span>

<span class="keyword">APPEND</span> <span class="string">sentence</span> <span class="string">"!"</span>
<span class="number">(integer) 12</span>

<span class="keyword">GET</span> <span class="string">sentence</span>
<span class="string">"Hello World!"</span>

<span class="comment"># APPEND on non-existent key (creates it)</span>
<span class="keyword">APPEND</span> <span class="string">newkey</span> <span class="string">"First"</span>
<span class="number">(integer) 5</span>  <span class="comment"># Created and appended</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Building a Log File</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - Logger System</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">RedisLogger</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, log_key):
        <span class="keyword">self</span>.log_key = log_key
    
    <span class="keyword">def</span> <span class="function">append_log</span>(<span class="keyword">self</span>, message):
        <span class="string">"""Append log entry with timestamp"""</span>
        timestamp = datetime.now().strftime(<span class="string">"%Y-%m-%d %H:%M:%S"</span>)
        log_entry = <span class="string">f"[</span>{timestamp}<span class="string">] </span>{message}<span class="string">\\n"</span>
        
        <span class="comment"># Single atomic operation!</span>
        new_length = r.append(<span class="keyword">self</span>.log_key, log_entry)
        
        <span class="keyword">print</span>(<span class="string">f"Logged: </span>{message}<span class="string"> (total size: </span>{new_length}<span class="string"> bytes)"</span>)
        <span class="keyword">return</span> new_length
    
    <span class="keyword">def</span> <span class="function">get_logs</span>(<span class="keyword">self</span>):
        <span class="string">"""Get entire log"""</span>
        <span class="keyword">return</span> r.get(<span class="keyword">self</span>.log_key) <span class="keyword">or</span> <span class="string">"(empty)"</span>
    
    <span class="keyword">def</span> <span class="function">clear_logs</span>(<span class="keyword">self</span>):
        <span class="string">"""Clear log file"""</span>
        r.delete(<span class="keyword">self</span>.log_key)
        <span class="keyword">print</span>(<span class="string">"Logs cleared"</span>)

<span class="comment"># Usage</span>
logger = RedisLogger(<span class="string">"app:error_log"</span>)

logger.append_log(<span class="string">"Application started"</span>)
logger.append_log(<span class="string">"Database connection established"</span>)
logger.append_log(<span class="string">"ERROR: Failed to load config"</span>)

<span class="keyword">print</span>(<span class="string">"\\n=== Full Log ==="</span>)
<span class="keyword">print</span>(logger.get_logs())

<span class="comment"># Output:</span>
<span class="comment"># [2024-01-08 10:30:15] Application started</span>
<span class="comment"># [2024-01-08 10:30:16] Database connection established</span>
<span class="comment"># [2024-01-08 10:30:17] ERROR: Failed to load config</span></code></pre>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Building CSV Data</h3>
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-lang">Python - CSV Builder</span>
                            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                        </div>
                        <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">build_csv_report</span>(report_id):
    <span class="string">"""Build CSV report line by line using APPEND"""</span>
    key = <span class="string">f"report:</span>{report_id}<span class="string">:csv"</span>
    
    <span class="comment"># Start with header</span>
    r.set(key, <span class="string">"Date,User,Action,Status\\n"</span>)
    
    <span class="comment"># Append data rows (imagine this comes from database)</span>
    rows = [
        <span class="string">"2024-01-08,alice,login,success"</span>,
        <span class="string">"2024-01-08,bob,purchase,failed"</span>,
        <span class="string">"2024-01-08,charlie,logout,success"</span>
    ]
    
    <span class="keyword">for</span> row <span class="keyword">in</span> rows:
        r.append(key, row + <span class="string">"\\n"</span>)
        <span class="keyword">print</span>(<span class="string">f"Added row: </span>{row}<span class="string">"</span>)
    
    <span class="comment"># Set expiry - report available for 1 hour</span>
    r.expire(key, <span class="number">3600</span>)
    
    <span class="keyword">return</span> r.get(key)

<span class="comment"># Generate report</span>
csv_data = build_csv_report(<span class="number">12345</span>)
<span class="keyword">print</span>(<span class="string">"\\n=== Generated CSV ==="</span>)
<span class="keyword">print</span>(csv_data)</code></pre>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">‚ùì</span>
                        <h2 class="section-label">5. Cross Questions</h2>
                    </div>
                    
                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Can APPEND work with numbers?</h4>
                        <p><strong>A:</strong> Yes! Redis treats numbers as strings. <code>SET count 10; APPEND count 5</code> ‚Üí "105" (string concatenation, not math!). For math, use INCR/DECR.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Is APPEND faster than GET + SET?</h4>
                        <p><strong>A:</strong> Yes! APPEND is one operation (~1ms) vs GET + SET (~2ms). More importantly, it's atomic - no race conditions when multiple clients append simultaneously.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can I append to the beginning of a string?</h4>
                        <p><strong>A:</strong> No! APPEND only adds to END. To prepend, you must: <code>GET old ‚Üí SET new+old</code>. Or better: use Redis Lists with LPUSH for prepending.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: What happens if I APPEND to a non-string type?</h4>
                        <p><strong>A:</strong> Error! <code>HSET user:1 name "Alice"; APPEND user:1 " Smith"</code> ‚Üí <code>WRONGTYPE Operation against a key holding the wrong kind of value</code>. APPEND only works on String keys.</p>
                    </div>

                    <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Does APPEND preserve TTL like SET does?</h4>
                        <p><strong>A:</strong> Yes! APPEND preserves existing TTL. <code>SETEX key 60 "val"; APPEND key "2"</code> ‚Üí TTL still ~60 seconds. Unlike SET which removes TTL unless you specify KEEPTTL.</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üéØ</span>
                        <h2 class="section-label">6. Tricky Questions</h2>
                    </div>
                    
                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Two processes APPEND to same key simultaneously. What happens?</h4>
                        <p><strong>Answer:</strong> Both succeed! Redis is single-threaded, so operations execute one-after-another. Both APPENDs happen sequentially:</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #888;">Initial: "Start"</code><br>
                            <code style="color: #50fa7b;">Process A: APPEND key " A" ‚Üí "Start A"</code><br>
                            <code style="color: #50fa7b;">Process B: APPEND key " B" ‚Üí "Start A B"</code>
                        </div>
                        <p style="margin-top: 10px;">Unlike GET+SET which has race conditions, APPEND is thread-safe!</p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Can APPEND make a string exceed 512MB limit?</h4>
                        <p><strong>Answer:</strong> No! If APPEND would push string over 512MB limit, Redis returns error:</p>
                        <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                            <code style="color: #ff0000;">(error) ERR string exceeds maximum allowed size</code>
                        </div>
                        <p style="margin-top: 10px;">The key's value is NOT modified. Original value stays intact. You need to handle this error in your app (e.g., create a new key for continued logging).</p>
                    </div>

                    <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                        <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Memory optimization: APPEND vs SET for logs?</h4>
                        <p><strong>Scenario:</strong> Building 1GB log file, one line at a time. Which uses less memory during construction?</p>
                        <p style="margin-top: 10px;"><strong>Answer:</strong> APPEND! With SET approach (GET+concat+SET), you temporarily hold TWO copies in memory: old value + new value = 2x memory usage at peak. APPEND modifies in-place, only needs 1x memory. For large strings, APPEND is significantly more memory-efficient!</p>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè¢</span>
                        <h2 class="section-label">7. Practical Scenario</h2>
                    </div>
                    
                    <p><strong>Real-World Case: Distributed Task Queue Logs</strong></p>
                    <p>You're building a task processing system with 50 worker servers. Each worker needs to append logs to a shared Redis key for debugging.</p>

                    <h4 style="color: var(--primary-color); margin-top: 20px;">‚ùå Wrong Approach (GET + SET):</h4>
                    <div style="background: rgba(255, 0, 0, 0.1); border-left: 3px solid #ff0000; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <div class="code-block">
                            <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px;"><code><span class="comment"># Worker A and Worker B both do this:</span>
old_log = r.get(<span class="string">"task:123:log"</span>)  <span class="comment"># Both read "Line1"</span>
new_log = old_log + <span class="string">"\\nLine2"</span>    <span class="comment"># A: "Line1\\nLine2"</span>
r.set(<span class="string">"task:123:log"</span>, new_log)    <span class="comment"># B: "Line1\\nLine2"</span></code></pre>
                        </div>
                        <p style="margin-top: 10px; color: #ff0000;"><strong>Problem:</strong> Race condition! Both workers read old value simultaneously, both add their line, both write back. Result: Only ONE line added instead of two! Lost data!</p>
                    </div>

                    <h4 style="color: var(--primary-color);">‚úÖ Correct Approach (APPEND):</h4>
                    <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                        <div class="code-block">
                            <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px;"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> threading

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">worker_log</span>(worker_id, task_id, message):
    <span class="string">"""Each worker appends its log atomically"""</span>
    log_entry = <span class="string">f"[Worker-</span>{worker_id}<span class="string">] </span>{message}<span class="string">\\n"</span>
    r.append(<span class="string">f"task:</span>{task_id}<span class="string">:log"</span>, log_entry)

<span class="comment"># Simulate 50 workers logging simultaneously</span>
threads = []
<span class="keyword">for</span> worker_id <span class="keyword">in</span> <span class="function">range</span>(<span class="number">50</span>):
    t = threading.Thread(
        target=worker_log, 
        args=(worker_id, <span class="number">123</span>, <span class="string">f"Processed item </span>{worker_id}<span class="string">"</span>)
    )
    threads.append(t)
    t.start()

<span class="keyword">for</span> t <span class="keyword">in</span> threads:
    t.join()

<span class="comment"># Check log - all 50 lines present!</span>
log = r.get(<span class="string">"task:123:log"</span>)
line_count = log.count(<span class="string">"\\n"</span>)
<span class="keyword">print</span>(<span class="string">f"Total lines: </span>{line_count}<span class="string">"</span>)  <span class="comment"># 50 ‚úÖ</span></code></pre>
                        </div>
                        <p style="margin-top: 10px; color: #00FF88;"><strong>Result:</strong> All 50 lines logged correctly! No race conditions! Each APPEND happens atomically, guaranteed by Redis single-threaded architecture.</p>
                    </div>

                    <h4 style="color: var(--primary-color);">Production Benefits:</h4>
                    <ul>
                        <li><strong>No lost logs:</strong> Every worker's log entry preserved</li>
                        <li><strong>No locking needed:</strong> APPEND is inherently thread-safe</li>
                        <li><strong>Better performance:</strong> 1 operation instead of 3 (GET+concat+SET)</li>
                        <li><strong>Lower memory usage:</strong> No temporary concatenation strings</li>
                    </ul>

                    <p style="margin-top: 20px;"><strong>Real Companies Using This Pattern:</strong></p>
                    <ul>
                        <li><strong>GitHub Actions:</strong> Multiple workers append to job logs</li>
                        <li><strong>Netflix:</strong> Distributed systems append to debug traces</li>
                        <li><strong>Uber:</strong> Ride processing logs from multiple services</li>
                    </ul>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üí°</span>
                        <h2 class="section-label">8. Key Takeaways</h2>
                    </div>
                    <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>SET replaces</strong> - Old value completely discarded</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ûï</span><p><strong>APPEND adds</strong> - Concatenates to end of string</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>APPEND is atomic</strong> - Thread-safe, no race conditions</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üìè</span><p><strong>Returns length</strong> - APPEND returns new string length</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Use APPEND for logs</strong> - Building strings incrementally</p></div>
                    <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Preserves TTL</strong> - Unlike SET, APPEND keeps expiry</p></div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üè∑Ô∏è</span>
                        <h2 class="section-label">9. Keywords</h2>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                        <span class="keyword-tag">SET</span><span class="keyword-tag">APPEND</span><span class="keyword-tag">Atomic</span><span class="keyword-tag">Thread-Safe</span><span class="keyword-tag">Logging</span><span class="keyword-tag">Concatenation</span>
                    </div>
                </div>

                <div class="content-section">
                    <div class="section-header">
                        <span class="section-icon">üìù</span>
                        <h2 class="section-label">10. Quiz</h2>
                    </div>
                    <div class="quiz-container">
                        <div class="quiz-question"><strong>Q:</strong> You run: <code>SET msg "Hi"; APPEND msg "!"; GET msg</code> - What's the result?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="checkAnswer(this, false)">A) "!"</div>
                            <div class="quiz-option" onclick="checkAnswer(this, true)">B) "Hi!"</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">C) "Hi !"</div>
                            <div class="quiz-option" onclick="checkAnswer(this, false)">D) Error</div>
                        </div>
                        <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                            <strong>‚úÖ Correct: B</strong>
                            <p>APPEND adds to END of existing value. SET creates "Hi", APPEND adds "!" to end ‚Üí "Hi!". No space added automatically - you must include spaces explicitly if needed!</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function getQuestion24Content() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üé¨</span>
                <h2 class="section-label">1. Real Scenario</h2>
            </div>
            <p><strong>Meet Sarah, building a Twitter-like feed.</strong> Her boss asks: "Sarah, users need to see their latest 50 posts in chronological order. Should we query the database every time?" Sarah thinks: "That's too slow... Redis List would be perfect - instant access to ordered data!"</p>
            
            <p>But Sarah is confused: "What exactly IS a Redis List? How is it different from arrays I know in Python?" Let's help her understand!</p>
        </div>

        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üìö</span>
                <h2 class="section-label">2. Actual Definition</h2>
            </div>
            
            <p><strong>Redis List = An ordered collection of strings, implemented as a doubly-linked list.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">üîë Key Characteristics</h4>
                <ul style="margin-left: 20px;">
                    <li><strong>Ordered:</strong> Elements maintain their insertion order</li>
                    <li><strong>Duplicates Allowed:</strong> Same value can appear multiple times</li>
                    <li><strong>Fast at Ends:</strong> O(1) push/pop at head or tail</li>
                    <li><strong>Index Access:</strong> Can access by position (but slower - O(N))</li>
                    <li><strong>Max Size:</strong> 2^32 - 1 elements (~4 billion)</li>
                </ul>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: #00FF88; margin-bottom: 15px;">‚ö° Main Operations</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(0,255,136,0.2);">
                        <th style="padding: 10px; text-align: left;">Command</th>
                        <th style="padding: 10px; text-align: left;">What It Does</th>
                        <th style="padding: 10px; text-align: left;">Time</th>
                    </tr>
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 8px;"><code>LPUSH key val</code></td>
                        <td style="padding: 8px;">Add to HEAD (left)</td>
                        <td style="padding: 8px;">O(1)</td>
                    </tr>
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 8px;"><code>RPUSH key val</code></td>
                        <td style="padding: 8px;">Add to TAIL (right)</td>
                        <td style="padding: 8px;">O(1)</td>
                    </tr>
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 8px;"><code>LPOP key</code></td>
                        <td style="padding: 8px;">Remove from HEAD</td>
                        <td style="padding: 8px;">O(1)</td>
                    </tr>
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 8px;"><code>RPOP key</code></td>
                        <td style="padding: 8px;">Remove from TAIL</td>
                        <td style="padding: 8px;">O(1)</td>
                    </tr>
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 8px;"><code>LRANGE key 0 9</code></td>
                        <td style="padding: 8px;">Get range of elements</td>
                        <td style="padding: 8px;">O(N)</td>
                    </tr>
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 8px;"><code>LLEN key</code></td>
                        <td style="padding: 8px;">Get list length</td>
                        <td style="padding: 8px;">O(1)</td>
                    </tr>
                </table>
            </div>

            <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Think of it like:</strong> A queue at a movie theater. People can join at the back (RPUSH), leave from front (LPOP), or VIPs can jump to front (LPUSH)!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üìä</span>
                <h2 class="section-label">3. Visual Diagram</h2>
            </div>
            
            <div class="diagram-container">
                <div class="diagram-title">Redis List Structure</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis List: Doubly-Linked List</text>
                    
                    <!-- Node 1 -->
                    <rect x="100" y="100" width="150" height="80" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="3" rx="8">
                        <animate attributeName="opacity" values="0.7;1;0.7" dur="3s" repeatCount="indefinite"/>
                    </rect>
                    <text x="175" y="135" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="700">HEAD (Index 0)</text>
                    <text x="175" y="160" text-anchor="middle" fill="#fff" font-size="12">"post3"</text>
                    
                    <!-- Arrow 1 -->
                    <line x1="250" y1="140" x2="295" y2="140" stroke="#00FF88" stroke-width="3" marker-end="url(#arrow)"/>
                    <text x="272" y="130" text-anchor="middle" fill="#00FF88" font-size="10">next</text>
                    
                    <!-- Node 2 -->
                    <rect x="295" y="100" width="150" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="8"/>
                    <text x="370" y="135" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="700">Index 1</text>
                    <text x="370" y="160" text-anchor="middle" fill="#fff" font-size="12">"post2"</text>
                    
                    <!-- Arrow 2 -->
                    <line x1="445" y1="140" x2="490" y2="140" stroke="#00FF88" stroke-width="3" marker-end="url(#arrow)"/>
                    <text x="467" y="130" text-anchor="middle" fill="#00FF88" font-size="10">next</text>
                    
                    <!-- Node 3 -->
                    <rect x="490" y="100" width="150" height="80" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="565" y="135" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="700">TAIL (Index 2)</text>
                    <text x="565" y="160" text-anchor="middle" fill="#fff" font-size="12">"post1"</text>
                    
                    <!-- Back arrows -->
                    <line x1="295" y1="165" x2="250" y2="165" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowblue)"/>
                    <text x="272" y="180" text-anchor="middle" fill="#2196F3" font-size="10">prev</text>
                    
                    <line x1="490" y1="165" x2="445" y2="165" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowblue)"/>
                    <text x="467" y="180" text-anchor="middle" fill="#2196F3" font-size="10">prev</text>
                    
                    <!-- Operations -->
                    <rect x="50" y="230" width="800" height="140" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="260" text-anchor="middle" fill="#fff" font-size="15" font-weight="600">Common Operations</text>
                    
                    <text x="80" y="290" fill="#DC143C" font-size="12" font-weight="600">LPUSH feed "post4"</text>
                    <text x="90" y="310" fill="#888" font-size="10">‚Üí Adds to HEAD (becomes index 0)</text>
                    <text x="90" y="325" fill="#888" font-size="10">‚Üí Result: ["post4", "post3", "post2", "post1"]</text>
                    
                    <text x="480" y="290" fill="#00FF88" font-size="12" font-weight="600">RPUSH feed "post0"</text>
                    <text x="490" y="310" fill="#888" font-size="10">‚Üí Adds to TAIL (last position)</text>
                    <text x="490" y="325" fill="#888" font-size="10">‚Üí Result: ["post3", "post2", "post1", "post0"]</text>
                    
                    <text x="80" y="355" fill="#FFA500" font-size="12" font-weight="600">LRANGE feed 0 1</text>
                    <text x="90" y="350" fill="#888" font-size="10">‚Üí Get first 2 elements: ["post3", "post2"]</text>
                    
                    <!-- Arrow markers -->
                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#2196F3" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üíª</span>
                <h2 class="section-label">4. Code Examples</h2>
            </div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic List Operations</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Redis CLI</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre class="code-content"><code><span class="comment"># Create a list and add elements</span>
<span class="keyword">LPUSH</span> <span class="string">feed</span> <span class="string">"post3"</span> <span class="string">"post2"</span> <span class="string">"post1"</span>
<span class="number">(integer) 3</span>

<span class="comment"># Get all elements (0 to -1 means all)</span>
<span class="keyword">LRANGE</span> <span class="string">feed</span> <span class="number">0</span> <span class="number">-1</span>
<span class="number">1)</span> <span class="string">"post1"</span>  <span class="comment"># Last pushed = first in list</span>
<span class="number">2)</span> <span class="string">"post2"</span>
<span class="number">3)</span> <span class="string">"post3"</span>

<span class="comment"># Get first 10 items</span>
<span class="keyword">LRANGE</span> <span class="string">feed</span> <span class="number">0</span> <span class="number">9</span>

<span class="comment"># Get list length</span>
<span class="keyword">LLEN</span> <span class="string">feed</span>
<span class="number">(integer) 3</span>

<span class="comment"># Remove from head</span>
<span class="keyword">LPOP</span> <span class="string">feed</span>
<span class="string">"post1"</span>

<span class="comment"># Add to tail</span>
<span class="keyword">RPUSH</span> <span class="string">feed</span> <span class="string">"post0"</span>
<span class="number">(integer) 3</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Twitter-Style Feed Implementation</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Python - User Feed System</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">UserFeed</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, user_id):
        <span class="keyword">self</span>.feed_key = <span class="string">f"feed:user:</span>{user_id}<span class="string">"</span>
        <span class="keyword">self</span>.max_posts = <span class="number">1000</span>  <span class="comment"># Keep last 1000 posts</span>
    
    <span class="keyword">def</span> <span class="function">add_post</span>(<span class="keyword">self</span>, post_id, content):
        <span class="string">"""Add new post to user's feed"""</span>
        post_data = json.dumps({
            <span class="string">"post_id"</span>: post_id,
            <span class="string">"content"</span>: content,
            <span class="string">"timestamp"</span>: datetime.now().isoformat()
        })
        
        <span class="comment"># Add to HEAD (newest first)</span>
        r.lpush(<span class="keyword">self</span>.feed_key, post_data)
        
        <span class="comment"># Trim to keep only recent posts</span>
        r.ltrim(<span class="keyword">self</span>.feed_key, <span class="number">0</span>, <span class="keyword">self</span>.max_posts - <span class="number">1</span>)
        
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Added post </span>{post_id}<span class="string"> to feed"</span>)
    
    <span class="keyword">def</span> <span class="function">get_latest_posts</span>(<span class="keyword">self</span>, count=<span class="number">50</span>):
        <span class="string">"""Get latest N posts from feed"""</span>
        posts_json = r.lrange(<span class="keyword">self</span>.feed_key, <span class="number">0</span>, count - <span class="number">1</span>)
        posts = [json.loads(p) <span class="keyword">for</span> p <span class="keyword">in</span> posts_json]
        <span class="keyword">return</span> posts
    
    <span class="keyword">def</span> <span class="function">get_feed_size</span>(<span class="keyword">self</span>):
        <span class="string">"""Get total posts in feed"""</span>
        <span class="keyword">return</span> r.llen(<span class="keyword">self</span>.feed_key)

<span class="comment"># Usage</span>
feed = UserFeed(<span class="number">123</span>)

<span class="comment"># User posts tweets</span>
feed.add_post(<span class="number">1001</span>, <span class="string">"Just learned Redis Lists!"</span>)
feed.add_post(<span class="number">1002</span>, <span class="string">"They're super fast for feeds"</span>)
feed.add_post(<span class="number">1003</span>, <span class="string">"O(1) push/pop is amazing!"</span>)

<span class="comment"># Get latest 50 posts for display</span>
latest = feed.get_latest_posts(<span class="number">50</span>)
<span class="keyword">print</span>(<span class="string">f"üì± Displaying </span>{<span class="function">len</span>(latest)}<span class="string"> posts"</span>)
<span class="keyword">for</span> post <span class="keyword">in</span> latest:
    <span class="keyword">print</span>(<span class="string">f"  - </span>{post['content']}<span class="string">"</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">‚ùì</span>
                <h2 class="section-label">5. Cross Questions</h2>
            </div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why use List instead of database array column?</h4>
                <p><strong>A:</strong> Redis List is 100x faster (in-memory) with O(1) push/pop. Database array needs full row scan, locking, and disk I/O. For real-time feeds, Redis wins dramatically!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can I access middle elements quickly?</h4>
                <p><strong>A:</strong> No! LINDEX 5000 on million-item list is O(N) = slow. Lists are optimized for ends. For middle access, consider Sorted Sets instead.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What's LTRIM used for?</h4>
                <p><strong>A:</strong> Keeping lists bounded! Example: Keep only last 1000 posts in feed. LTRIM feed 0 999 after each LPUSH prevents unlimited growth.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can Lists handle millions of items?</h4>
                <p><strong>A:</strong> Technically yes (max 4 billion), but LRANGE becomes slow. Best practice: Keep lists under 10K items, use pagination, or switch to Sorted Sets for huge datasets.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: LPUSH multiple values - what order?</h4>
                <p><strong>A:</strong> Right-to-left! LPUSH list "A" "B" "C" processes C first, then B, then A ‚Üí ["A","B","C"]. Each value pushed individually from right!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üéØ</span>
                <h2 class="section-label">6. Tricky Questions</h2>
            </div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: What if LPUSH and LPOP happen simultaneously?</h4>
                <p><strong>Answer:</strong> No problem! Redis is single-threaded = operations execute one-at-a-time. Either LPUSH happens first (LPOP gets new item) or LPOP happens first (list becomes shorter). Never corrupted!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Memory usage for 1M items list?</h4>
                <p><strong>Answer:</strong> ~20-40 bytes per item overhead + actual string data. Example: 1M items √ó 100 bytes average = 100MB data + 30MB overhead ‚âà 130MB total. Lists are memory-efficient!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I sort a List?</h4>
                <p><strong>Answer:</strong> Yes with SORT command, but it's slow (O(N log N)) and doesn't modify the list - just returns sorted copy. If you need sorted data frequently, use Sorted Set from the start!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üè¢</span>
                <h2 class="section-label">7. Practical Scenario</h2>
            </div>
            
            <p><strong>Real-World Case: Twitter Timeline Generation</strong></p>
            
            <h4 style="color: var(--primary-color); margin-top: 20px;">The Challenge:</h4>
            <p>Twitter has 300M users. Each user follows ~500 people. When someone tweets, it needs to appear in all followers' feeds INSTANTLY. Database can't handle this!</p>

            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: var(--primary-color);">‚ùå Naive Database Approach (Doesn't Scale):</h4>
                <p>SELECT * FROM tweets WHERE author_id IN (user's_following_list) ORDER BY created_at DESC LIMIT 50</p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Query time: 500ms-2 seconds</li>
                    <li>Database crashes under load</li>
                    <li>Can't handle 300M concurrent users</li>
                </ul>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">‚úÖ Twitter's Redis List Solution (Fan-out Architecture):</h4>
                <p><strong>When user tweets:</strong></p>
                <ol style="margin-left: 20px;">
                    <li>Get tweet author's followers (Set: SMEMBERS followers:user123)</li>
                    <li>For each follower, LPUSH to their feed List</li>
                    <li>Use Celery/Sidekiq to fan-out to millions asynchronously</li>
                </ol>
                
                <p style="margin-top: 15px;"><strong>When user opens app:</strong></p>
                <code style="background: rgba(0,0,0,0.3); padding: 5px; border-radius: 4px; display: block; margin: 10px 0;">LRANGE feed:user456 0 49</code>
                <p>‚Üí Returns 50 tweets in 1-2ms!</p>
                
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>Query time:</strong> 1-2ms (500x faster!)</li>
                    <li><strong>Scalability:</strong> Handles billions of requests</li>
                    <li><strong>Trade-off:</strong> More memory (each user has own List)</li>
                </ul>
            </div>

            <h4 style="color: var(--primary-color); margin-top: 20px;">Performance Numbers:</h4>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                <tr style="background: rgba(220,20,60,0.2);">
                    <th style="padding: 10px;">Metric</th>
                    <th style="padding: 10px;">Database</th>
                    <th style="padding: 10px;">Redis List</th>
                </tr>
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 8px;">Read Time</td>
                    <td style="padding: 8px;">500ms</td>
                    <td style="padding: 8px;">1-2ms</td>
                </tr>
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 8px;">Concurrent Users</td>
                    <td style="padding: 8px;">~10K max</td>
                    <td style="padding: 8px;">Millions</td>
                </tr>
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 8px;">Cost</td>
                    <td style="padding: 8px;">$5K/month</td>
                    <td style="padding: 8px;">$500/month</td>
                </tr>
            </table>

            <p style="margin-top: 20px;"><strong>This is why Twitter, Instagram, Facebook all use Redis Lists for feed generation!</strong></p>
        </div>

        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üí°</span>
                <h2 class="section-label">8. Key Takeaways</h2>
            </div>
            <div class="takeaway-item"><span class="takeaway-icon">üìù</span><p><strong>Ordered collection</strong> - Maintains insertion order, allows duplicates</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>O(1) at ends</strong> - Fast push/pop at HEAD or TAIL</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Perfect for feeds/queues</strong> - Twitter timelines, job queues</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîß</span><p><strong>Use LTRIM</strong> - Keep lists bounded to prevent unlimited growth</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>Slow middle access</strong> - O(N) for LINDEX, optimized for ends only</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Max 4 billion items</strong> - But keep under 10K for best performance</p></div>
        </div>

        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üè∑Ô∏è</span>
                <h2 class="section-label">9. Keywords</h2>
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Redis List</span>
                <span class="keyword-tag">LPUSH</span>
                <span class="keyword-tag">RPUSH</span>
                <span class="keyword-tag">LRANGE</span>
                <span class="keyword-tag">Feed</span>
                <span class="keyword-tag">Queue</span>
                <span class="keyword-tag">Doubly-Linked</span>
                <span class="keyword-tag">O(1)</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üìù</span>
                <h2 class="section-label">10. Quiz</h2>
            </div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> What's the time complexity of LPUSH?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, true)">A) O(1) - Constant time, super fast</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) O(N) - Linear time, depends on list size</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) O(log N) - Logarithmic time</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) O(N¬≤) - Quadratic time</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: A - O(1)</strong>
                    <p>LPUSH adds to HEAD in constant time because Lists are implemented as doubly-linked lists. Just update the head pointer - no need to traverse the list! This makes Lists perfect for high-performance queues and feeds where you're constantly adding/removing from ends.</p>
                </div>
            </div>
        </div>
    `;
}


        function getQuestion25Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Meet Jake, confused developer:</strong> "I used RPUSH to add posts to my feed, but they appear in wrong order! Oldest posts show first, not newest!" His senior dev laughs: "Jake, you need LPUSH! L = Left = HEAD = newest first!"</p>
            <p>Jake is puzzled: "What's the actual difference? When do I use which?" Let's help him understand!</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>LPUSH = Push to LEFT (head) of list</strong> - New items become index 0, existing items shift right</p>
            <p><strong>RPUSH = Push to RIGHT (tail) of list</strong> - New items appended to end, existing items stay in place</p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Key Differences</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Aspect</th><th style="padding: 10px;">LPUSH</th><th style="padding: 10px;">RPUSH</th></tr>
                    <tr><td style="padding: 8px;">Position</td><td>LEFT (head/front)</td><td>RIGHT (tail/end)</td></tr>
                    <tr><td style="padding: 8px;">New Item Index</td><td>Always 0</td><td>Always last (N-1)</td></tr>
                    <tr><td style="padding: 8px;">Order</td><td>Newest first</td><td>Oldest first</td></tr>
                    <tr><td style="padding: 8px;">Use Case</td><td>Feeds (latest first)</td><td>Queues (FIFO)</td></tr>
                    <tr><td style="padding: 8px;">With LRANGE 0 9</td><td>Shows newest 10</td><td>Shows oldest 10</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Common Patterns:</strong></p>
                <ul>
                    <li><strong>LPUSH + LRANGE:</strong> Activity feeds (newest first)</li>
                    <li><strong>RPUSH + LPOP:</strong> Job queues (FIFO - first in, first out)</li>
                    <li><strong>LPUSH + RPOP:</strong> Stack (LIFO - last in, first out)</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">LPUSH vs RPUSH Direction</div>
                <svg viewBox="0 0 900 500" style="max-width: 100%; height: auto;">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">LPUSH vs RPUSH: Which Direction?</text>
                    
                    <!-- LPUSH Example -->
                    <text x="225" y="80" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="600">LPUSH (Add to HEAD)</text>
                    
                    <rect x="50" y="110" width="350" height="60" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="225" y="135" text-anchor="middle" fill="#FFA500" font-size="13">Initial: ["old2", "old1"]</text>
                    
                    <text x="225" y="190" text-anchor="middle" fill="#fff" font-size="12">‚Üì LPUSH feed "new"</text>
                    
                    <rect x="50" y="210" width="350" height="80" fill="rgba(220, 20, 60, 0.3)" stroke="#DC143C" stroke-width="3" rx="6">
                        <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" repeatCount="indefinite"/>
                    </rect>
                    <text x="225" y="240" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="700">Result: ["new", "old2", "old1"]</text>
                    <text x="225" y="260" text-anchor="middle" fill="#00FF88" font-size="11">‚úÖ "new" at position 0 (HEAD)</text>
                    <text x="225" y="280" text-anchor="middle" fill="#888" font-size="10">Perfect for: Activity feeds, recent history</text>
                    
                    <!-- RPUSH Example -->
                    <text x="675" y="80" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">RPUSH (Add to TAIL)</text>
                    
                    <rect x="500" y="110" width="350" height="60" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="675" y="135" text-anchor="middle" fill="#FFA500" font-size="13">Initial: ["old1", "old2"]</text>
                    
                    <text x="675" y="190" text-anchor="middle" fill="#fff" font-size="12">‚Üì RPUSH queue "new"</text>
                    
                    <rect x="500" y="210" width="350" height="80" fill="rgba(0, 255, 136, 0.3)" stroke="#00FF88" stroke-width="3" rx="6">
                        <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" repeatCount="indefinite"/>
                    </rect>
                    <text x="675" y="240" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="700">Result: ["old1", "old2", "new"]</text>
                    <text x="675" y="260" text-anchor="middle" fill="#00FF88" font-size="11">‚úÖ "new" at end (TAIL)</text>
                    <text x="675" y="280" text-anchor="middle" fill="#888" font-size="10">Perfect for: Job queues, task processing</text>
                    
                    <!-- Multiple Push Example -->
                    <rect x="50" y="330" width="800" height="140" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="360" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">‚ö†Ô∏è Important: Multiple Items Order</text>
                    
                    <text x="80" y="390" fill="#DC143C" font-size="12" font-weight="600">LPUSH list "A" "B" "C"</text>
                    <text x="90" y="410" fill="#888" font-size="10">Pushes right-to-left: C first, then B, then A</text>
                    <text x="90" y="430" fill="#00FF88" font-size="11">Result: ["A", "B", "C"]</text>
                    <text x="90" y="448" fill="#666" font-size="9">(Each pushed individually from right to left)</text>
                    
                    <text x="480" y="390" fill="#00FF88" font-size="12" font-weight="600">RPUSH list "A" "B" "C"</text>
                    <text x="490" y="410" fill="#888" font-size="10">Pushes left-to-right: A first, then B, then C</text>
                    <text x="490" y="430" fill="#00FF88" font-size="11">Result: ["A", "B", "C"]</text>
                    <text x="490" y="448" fill="#666" font-size="9">(Same result but different mental model)</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Understanding the Difference</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - LPUSH vs RPUSH</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># RPUSH - items in insertion order</span>
<span class="keyword">RPUSH</span> <span class="string">queue</span> <span class="string">"task1"</span> <span class="string">"task2"</span> <span class="string">"task3"</span>
<span class="keyword">LRANGE</span> <span class="string">queue</span> <span class="number">0</span> <span class="number">-1</span>
<span class="comment"># Result: ["task1", "task2", "task3"]</span>
<span class="comment"># Order: Same as pushed</span>

<span class="comment"># LPUSH - reverse order!</span>
<span class="keyword">LPUSH</span> <span class="string">feed</span> <span class="string">"post1"</span> <span class="string">"post2"</span> <span class="string">"post3"</span>
<span class="keyword">LRANGE</span> <span class="string">feed</span> <span class="number">0</span> <span class="number">-1</span>
<span class="comment"># Result: ["post3", "post2", "post1"]</span>
<span class="comment"># Order: Reversed (newest first)</span>

<span class="comment"># Real-world feed pattern</span>
<span class="keyword">LPUSH</span> <span class="string">timeline:user123</span> <span class="string">"Just posted!"</span>
<span class="keyword">LPUSH</span> <span class="string">timeline:user123</span> <span class="string">"5 minutes ago"</span>
<span class="keyword">LPUSH</span> <span class="string">timeline:user123</span> <span class="string">"NOW - newest!"</span>
<span class="keyword">LRANGE</span> <span class="string">timeline:user123</span> <span class="number">0</span> <span class="number">2</span>
<span class="comment"># Shows: Newest first!</span>
<span class="number">1)</span> <span class="string">"NOW - newest!"</span>
<span class="number">2)</span> <span class="string">"5 minutes ago"</span>
<span class="number">3)</span> <span class="string">"Just posted!"</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: E-commerce Recently Viewed</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Recently Viewed Products</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">RecentlyViewed</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, user_id):
        <span class="keyword">self</span>.key = <span class="string">f"recently_viewed:user:</span>{user_id}<span class="string">"</span>
        <span class="keyword">self</span>.max_items = <span class="number">20</span>
    
    <span class="keyword">def</span> <span class="function">add_product</span>(<span class="keyword">self</span>, product_id):
        <span class="string">"""Add product to recently viewed (newest first)"""</span>
        <span class="comment"># Use LPUSH so newest appears first</span>
        r.lpush(<span class="keyword">self</span>.key, product_id)
        
        <span class="comment"># Keep only last 20 items</span>
        r.ltrim(<span class="keyword">self</span>.key, <span class="number">0</span>, <span class="keyword">self</span>.max_items - <span class="number">1</span>)
        
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Added product </span>{product_id}<span class="string"> to recently viewed"</span>)
    
    <span class="keyword">def</span> <span class="function">get_recent</span>(<span class="keyword">self</span>, count=<span class="number">10</span>):
        <span class="string">"""Get recent products (newest first)"""</span>
        products = r.lrange(<span class="keyword">self</span>.key, <span class="number">0</span>, count - <span class="number">1</span>)
        <span class="keyword">return</span> products

<span class="comment"># Usage</span>
history = RecentlyViewed(<span class="number">456</span>)

<span class="comment"># User browses products</span>
history.add_product(<span class="string">"laptop-123"</span>)
history.add_product(<span class="string">"mouse-456"</span>)
history.add_product(<span class="string">"keyboard-789"</span>)

<span class="comment"># Get recent 5 products</span>
recent = history.get_recent(<span class="number">5</span>)
<span class="keyword">print</span>(<span class="string">"Recently viewed (newest first):"</span>)
<span class="keyword">for</span> idx, product <span class="keyword">in</span> <span class="function">enumerate</span>(recent, <span class="number">1</span>):
    <span class="keyword">print</span>(<span class="string">f"  </span>{idx}<span class="string">. </span>{product}<span class="string">"</span>)

<span class="comment"># Output:</span>
<span class="comment"># 1. keyboard-789 (most recent)</span>
<span class="comment"># 2. mouse-456</span>
<span class="comment"># 3. laptop-123 (oldest)</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: LPUSH multiple items - what order appears?</h4>
                <p><strong>A:</strong> Right-to-left! <code>LPUSH list "A" "B" "C"</code> pushes C first (to head), then B (before C), then A (before B) ‚Üí Result: ["A","B","C"]. Each item pushed individually!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Performance difference between LPUSH and RPUSH?</h4>
                <p><strong>A:</strong> Identical! Both O(1) constant time. Redis Lists are doubly-linked, so both ends are equally fast. Choose based on logic, not performance.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can I use LPUSH and RPUSH on same list?</h4>
                <p><strong>A:</strong> Yes! Mix them freely. Example: LPUSH adds urgent tasks to front, RPUSH adds normal tasks to back. Create priority queue with both!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: For FIFO queue, use LPUSH or RPUSH?</h4>
                <p><strong>A:</strong> RPUSH + LPOP (or LPUSH + RPOP). Add to one end, remove from other = First In First Out. Most common: RPUSH (producer) + BLPOP (consumer).</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: What if I LPUSH to a non-existent key?</h4>
                <p><strong>A:</strong> Creates it automatically! <code>LPUSH newkey "value"</code> on non-existent key creates empty list first, then pushes. No need for initialization!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Why does LPUSH list "1" "2" "3" give ["1","2","3"] not ["3","2","1"]?</h4>
                <p><strong>Answer:</strong> Because Redis processes arguments right-to-left! It's equivalent to three separate commands:</p>
                <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin-top: 10px;">
                    <code>1. LPUSH list "3"  ‚Üí ["3"]</code><br>
                    <code>2. LPUSH list "2"  ‚Üí ["2", "3"]</code><br>
                    <code>3. LPUSH list "1"  ‚Üí ["1", "2", "3"]</code>
                </div>
                <p style="margin-top: 10px;">Each item pushes to HEAD, pushing previous items right. Final order: left-to-right matches input order!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Building a undo/redo system - LPUSH or RPUSH?</h4>
                <p><strong>Answer:</strong> Use LPUSH for undo stack! Each new action pushes to HEAD. LPOP gets most recent action (undo). For redo, maintain second list with LPUSH again. Both stacks use LPUSH + LPOP = LIFO (Last In First Out) behavior!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can negative indices work differently for LPUSH vs RPUSH?</h4>
                <p><strong>Answer:</strong> No! Indices are always from list's perspective. Index -1 = last item regardless of how you pushed. LRANGE key -5 -1 gets last 5 items whether you used LPUSH or RPUSH!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: GitHub Notifications System</strong></p>
            
            <p>GitHub shows your notifications with newest first. How do they implement this with Redis?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: LPUSH Pattern</h4>
                
                <p><strong>When notification arrives:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    LPUSH notifications:user:123 notification_json<br>
                    LTRIM notifications:user:123 0 99  # Keep 100 max
                </code>
                
                <p><strong>When user opens notifications:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    LRANGE notifications:user:123 0 19  # Get latest 20
                </code>
                
                <p><strong>Why LPUSH not RPUSH?</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ LRANGE 0 19 returns newest 20 (what users expect)</li>
                    <li>‚úÖ No need to calculate list length</li>
                    <li>‚úÖ Simple pattern: latest = index 0</li>
                    <li>‚ùå RPUSH would require LRANGE -20 -1 (less intuitive)</li>
                </ul>
            </div>

            <p style="margin-top: 20px;"><strong>Performance:</strong> GitHub handles millions of notifications/sec. LPUSH + LRANGE pattern = 1-2ms response time!</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚¨ÖÔ∏è</span><p><strong>LPUSH = LEFT = HEAD</strong> - New items at position 0</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚û°Ô∏è</span><p><strong>RPUSH = RIGHT = TAIL</strong> - New items at end</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì±</span><p><strong>Feeds use LPUSH</strong> - Shows newest first naturally</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚öôÔ∏è</span><p><strong>Queues use RPUSH</strong> - FIFO with RPUSH + LPOP</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Both O(1)</strong> - Equal performance</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Can mix both</strong> - Create priority queues</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">LPUSH</span><span class="keyword-tag">RPUSH</span><span class="keyword-tag">HEAD</span><span class="keyword-tag">TAIL</span><span class="keyword-tag">Direction</span><span class="keyword-tag">FIFO</span><span class="keyword-tag">LIFO</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> For a feed showing newest posts first, which command?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, true)">A) LPUSH - adds to head (index 0)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) RPUSH - adds to tail</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Either works the same</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Need Sorted Set instead</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: A - LPUSH</strong>
                    <p>LPUSH adds to HEAD (position 0), so newest items appear first when you LRANGE 0 N. This is the standard pattern for activity feeds, notification lists, and any "newest first" display. Twitter, Instagram, Facebook all use LPUSH for feeds!</p>
                </div>
            </div>
        </div>
    `;
}

        function getQuestion26Content() {
            return `<div class="content-section"><div class="section-header"><span class="section-icon">üìö</span><h2>Redis Lists in Production</h2></div><p><strong>1. Twitter Timeline:</strong> LPUSH latest tweets, LRANGE 0 50 for feed</p><p><strong>2. GitHub Job Queue:</strong> RPUSH jobs, workers BLPOP to process</p><p><strong>3. E-commerce "Recently Viewed":</strong> LPUSH product IDs, keep latest 20</p><p><strong>4. Chat Messages:</strong> RPUSH messages, LRANGE for history</p><p><strong>5. Sidekiq (Ruby):</strong> Background job processing with Redis lists</p><p><strong>Pattern:</strong> Producer RPUSH, consumers BLPOP (blocking) for distributed queues</p></div>`;
        }

       // ============================================================
// QUESTION 27: What are blocking list commands?
// ============================================================

function getQuestion27Content() {
    return `
        ${getQuestion27Section1_RealScenario()}
        ${getQuestion27Section2_Definition()}
        ${getQuestion27Section3_Diagrams()}
        ${getQuestion27Section4_CodeExamples()}
        ${getQuestion27Section5_CrossQuestions()}
        ${getQuestion27Section6_TrickyQuestions()}
        ${getQuestion27Section7_PracticalScenarios()}
        ${getQuestion27Section8_KeyTakeaways()}
        ${getQuestion27Section9_Keywords()}
        ${getQuestion27Section10_Quiz()}
    `;
}

function getQuestion27Section1_RealScenario() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üé¨</span>
                <h2 class="section-label">1. Real Scenario</h2>
            </div>
            
            <p><strong>You're building a real-time notification system for a social media platform.</strong> When users post content, millions of followers need to receive notifications instantly. You decide to use Redis Lists as a queue to process these notifications.</p>
            
            <p>Here's the problem: You have 100 worker processes constantly checking for new notification tasks. Each worker runs a loop like this:</p>
            
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Naive Approach (Inefficient)</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre class="code-content"><code><span class="keyword">while</span> <span class="keyword">True</span>:
    task = redis.rpop(<span class="string">"notification_queue"</span>)
    <span class="keyword">if</span> task:
        process_notification(task)
    <span class="keyword">else</span>:
        time.sleep(<span class="number">0.01</span>)  <span class="comment"># Wait 10ms before checking again</span></code></pre>
            </div>
            
            <p><strong>The problem with this approach:</strong> Your 100 workers are hammering Redis with <strong>10,000 requests per second</strong> (100 workers √ó 100 checks/sec), and 99% of those requests return nothing because the queue is empty! This wastes CPU, network bandwidth, and increases Redis load unnecessarily.</p>
            
            <p>Your DevOps team notices Redis CPU spiking to 60% even during quiet periods. The network traffic is crazy high. You think, "There must be a better way to wait for work without constantly polling..."</p>
            
            <p><strong>This is exactly where blocking list commands come to the rescue!</strong> Instead of constantly asking "Is there work? Is there work? Is there work?", workers can simply say "Wake me up when there's work" and go to sleep. Redis handles the waiting efficiently.</p>
        </div>
    `;
}

function getQuestion27Section2_Definition() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üìö</span>
                <h2 class="section-label">2. Actual Definition</h2>
            </div>
            
            <p><strong>Blocking list commands are Redis operations that wait (block) for a specified amount of time until data becomes available in a list, instead of immediately returning if the list is empty.</strong></p>
            
            <p>Think of it like this: Regular list commands are like checking your mailbox every 5 minutes to see if mail arrived. Blocking commands are like sitting by the mailbox and the mail carrier taps your shoulder the moment mail arrives. No wasted trips!</p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 10px;">üéØ Main Blocking Commands:</h4>
                <ul style="margin-top: 10px;">
                    <li><strong>BLPOP</strong> (Blocking Left Pop) - Pop from the left (head) of the list, wait if empty</li>
                    <li><strong>BRPOP</strong> (Blocking Right Pop) - Pop from the right (tail) of the list, wait if empty</li>
                    <li><strong>BRPOPLPUSH</strong> - Atomically pop from one list's right and push to another's left, with blocking</li>
                    <li><strong>BLMOVE</strong> (Redis 6.2+) - Block and move elements between lists in any direction</li>
                    <li><strong>BLMPOP</strong> (Redis 7.0+) - Block and pop multiple elements from multiple lists</li>
                </ul>
            </div>

            <div style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196F3; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: #2196F3; margin-bottom: 10px;">‚è±Ô∏è How Blocking Works:</h4>
                <p><strong>1. Client sends blocking command:</strong> <code>BLPOP queue 30</code> (wait up to 30 seconds)</p>
                <p><strong>2a. If list has data:</strong> Return immediately with the value</p>
                <p><strong>2b. If list is empty:</strong> Redis puts the client to sleep (doesn't consume CPU)</p>
                <p><strong>3. When data arrives:</strong> Redis wakes up the first waiting client and returns the value</p>
                <p><strong>4. If timeout expires:</strong> Return <code>nil</code> to indicate no data arrived</p>
            </div>

            <p><strong>The magic of blocking commands:</strong> They eliminate the need for polling loops! Instead of checking repeatedly, your application just blocks and Redis efficiently manages the waiting. This drastically reduces CPU usage, network traffic, and Redis load.</p>

            <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <strong>‚ö†Ô∏è Key Difference from Regular Commands:</strong>
                <ul style="margin-top: 10px;">
                    <li><code>LPOP queue</code> ‚Üí Returns immediately (nil if empty)</li>
                    <li><code>BLPOP queue 30</code> ‚Üí Waits up to 30 seconds for data</li>
                </ul>
            </div>
        </div>
    `;
}

// RESPONSIVE FIX FOR SECTION 3 - DIAGRAMS
function getQuestion27Section3_Diagrams() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üìä</span>
                <h2 class="section-label">3. Visual Diagrams</h2>
            </div>
            
            <div class="diagram-container">
                <div class="diagram-title">Polling vs Blocking: Resource Usage Comparison</div>
                <svg viewBox="0 0 900 600" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <!-- Title -->
                    <text x="450" y="30" text-anchor="middle" fill="#fff" font-size="16" font-weight="700">Two Approaches to Queue Processing</text>
                    
                    <!-- LEFT SIDE: Polling (Inefficient) -->
                    <text x="220" y="70" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">‚ùå POLLING (RPOP Loop)</text>
                    
                    <!-- Worker -->
                    <rect x="145" y="90" width="150" height="60" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="8"/>
                    <text x="220" y="115" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">Worker Process</text>
                    <text x="220" y="133" text-anchor="middle" fill="#bbb" font-size="11">Constantly checking...</text>
                    
                    <!-- Redis -->
                    <rect x="145" y="190" width="150" height="80" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="2" rx="8"/>
                    <text x="220" y="220" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">‚ö° Redis</text>
                    <text x="220" y="238" text-anchor="middle" fill="#888" font-size="10">Empty Queue</text>
                    <text x="220" y="255" text-anchor="middle" fill="#888" font-size="10">[]</text>
                    
                    <!-- Multiple rapid requests -->
                    <path d="M 220 150 L 220 185" stroke="#FFA500" stroke-width="2" marker-end="url(#arrowOrange)">
                        <animate attributeName="opacity" values="1;0.3;1" dur="0.3s" repeatCount="indefinite"/>
                    </path>
                    <text x="240" y="170" fill="#FFA500" font-size="9">RPOP</text>
                    
                    <path d="M 215 185 L 215 155" stroke="#FF6347" stroke-width="2" marker-end="url(#arrowRed)" stroke-dasharray="2,2">
                        <animate attributeName="opacity" values="1;0.3;1" dur="0.3s" begin="0.15s" repeatCount="indefinite"/>
                    </path>
                    <text x="170" y="170" fill="#FF6347" font-size="9">nil</text>
                    
                    <!-- Waste indicators -->
                    <rect x="145" y="300" width="150" height="130" fill="rgba(255, 0, 0, 0.1)" stroke="#FF0000" stroke-width="2" rx="6"/>
                    <text x="220" y="320" text-anchor="middle" fill="#FF6347" font-size="12" font-weight="600">‚ö†Ô∏è WASTE:</text>
                    <text x="155" y="340" fill="#bbb" font-size="10">‚Ä¢ 100 req/sec/worker</text>
                    <text x="155" y="357" fill="#bbb" font-size="10">‚Ä¢ High CPU usage</text>
                    <text x="155" y="374" fill="#bbb" font-size="10">‚Ä¢ Network spam</text>
                    <text x="155" y="391" fill="#bbb" font-size="10">‚Ä¢ Redis overload</text>
                    <text x="155" y="408" fill="#FF6347" font-size="9" font-weight="600">‚Ä¢ 99% return nil!</text>
                    
                    <!-- Divider -->
                    <line x1="450" y1="60" x2="450" y2="560" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- RIGHT SIDE: Blocking (Efficient) -->
                    <text x="680" y="70" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">‚úÖ BLOCKING (BLPOP)</text>
                    
                    <!-- Worker -->
                    <rect x="605" y="90" width="150" height="60" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="680" y="115" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">Worker Process</text>
                    <text x="680" y="133" text-anchor="middle" fill="#bbb" font-size="11">üò¥ Sleeping...</text>
                    
                    <!-- Redis -->
                    <rect x="605" y="190" width="150" height="80" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="2" rx="8"/>
                    <text x="680" y="220" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">‚ö° Redis</text>
                    <text x="680" y="238" text-anchor="middle" fill="#888" font-size="10">Empty Queue</text>
                    <text x="680" y="252" text-anchor="middle" fill="#888" font-size="9">Waiting: [w1]</text>
                    
                    <!-- Single blocking request -->
                    <path d="M 680 150 L 680 185" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    <text x="700" y="165" fill="#00FF88" font-size="10" font-weight="600">BLPOP 30</text>
                    <text x="700" y="177" fill="#888" font-size="8">(one request)</text>
                    
                    <!-- No response yet - waiting -->
                    <text x="680" y="295" text-anchor="middle" fill="#888" font-size="9" font-style="italic">Worker asleep</text>
                    <text x="680" y="307" text-anchor="middle" fill="#888" font-size="9" font-style="italic">No CPU/network</text>
                    
                    <!-- Producer arrives -->
                    <rect x="780" y="340" width="90" height="45" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="825" y="358" text-anchor="middle" fill="#9C27B0" font-size="11">üì§ Producer</text>
                    <text x="825" y="373" text-anchor="middle" fill="#888" font-size="9">adds task</text>
                    
                    <path d="M 780 365 L 760 240" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)" stroke-dasharray="3,3"/>
                    <text x="770" y="300" fill="#9C27B0" font-size="9">LPUSH</text>
                    
                    <!-- Wake up and return -->
                    <path d="M 675 190 L 675 155" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    <text x="620" y="175" fill="#00FF88" font-size="10" font-weight="600">Returns!</text>
                    <text x="630" y="187" fill="#888" font-size="8">Worker wakes</text>
                    
                    <!-- Efficiency indicators -->
                    <rect x="605" y="410" width="150" height="130" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="680" y="430" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">‚úÖ EFFICIENT:</text>
                    <text x="615" y="450" fill="#bbb" font-size="10">‚Ä¢ 1 request total</text>
                    <text x="615" y="467" fill="#bbb" font-size="10">‚Ä¢ Zero CPU waiting</text>
                    <text x="615" y="484" fill="#bbb" font-size="10">‚Ä¢ No network spam</text>
                    <text x="615" y="501" fill="#bbb" font-size="10">‚Ä¢ Instant wake-up</text>
                    <text x="615" y="518" fill="#00FF88" font-size="9" font-weight="600">‚Ä¢ 100% useful work!</text>
                    
                    <!-- Arrow markers -->
                    <defs>
                        <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#FFA500" />
                        </marker>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#FF6347" />
                        </marker>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                    </defs>
                </svg>
            </div>
            
            <p><strong>Understanding the diagram:</strong></p>
            <ul>
                <li><strong>Left Side (Polling):</strong> Worker constantly sends RPOP commands every 10ms, getting "nil" back 99% of the time. This wastes CPU, network, and Redis resources.</li>
                <li><strong>Right Side (Blocking):</strong> Worker sends ONE BLPOP command and goes to sleep. Redis wakes it up instantly when data arrives. Zero waste!</li>
                <li><strong>Key Insight:</strong> With 100 polling workers, you'd have 10,000 requests/sec. With blocking, you have just 100 initial requests, then silence until work arrives.</li>
            </ul>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <strong>üí° Performance Impact:</strong> Switching from polling to blocking can reduce Redis load by 95-99%, eliminate wasted CPU cycles, and improve response latency since workers wake instantly instead of waiting for the next poll interval.
            </div>

            <div class="diagram-container" style="margin-top: 40px;">
                <div class="diagram-title">BLPOP Timeline - How Blocking Works Internally</div>
                <svg viewBox="0 0 900 380" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <!-- Timeline -->
                    <line x1="50" y1="180" x2="850" y2="180" stroke="#666" stroke-width="2"/>
                    
                    <!-- Time markers -->
                    <text x="50" y="205" text-anchor="middle" fill="#888" font-size="10">t=0s</text>
                    <text x="250" y="205" text-anchor="middle" fill="#888" font-size="10">t=10s</text>
                    <text x="450" y="205" text-anchor="middle" fill="#888" font-size="10">t=20s</text>
                    <text x="650" y="205" text-anchor="middle" fill="#888" font-size="10">t=25s</text>
                    <text x="850" y="205" text-anchor="middle" fill="#888" font-size="10">t=30s</text>
                    
                    <!-- Event 1: Worker sends BLPOP -->
                    <circle cx="50" cy="180" r="7" fill="#2196F3"/>
                    <rect x="50" y="70" width="130" height="70" fill="rgba(33, 150, 243, 0.2)" stroke="#2196F3" stroke-width="2" rx="6"/>
                    <text x="115" y="95" text-anchor="middle" fill="#2196F3" font-size="11" font-weight="600">üî∑ Worker sends:</text>
                    <text x="115" y="110" text-anchor="middle" fill="#fff" font-size="10">BLPOP queue 30</text>
                    <text x="115" y="125" text-anchor="middle" fill="#888" font-size="9">"Wait up to 30sec"</text>
                    <path d="M 115 140 L 50 175" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowBlue2)"/>
                    
                    <!-- Event 2: Worker sleeps -->
                    <rect x="250" y="220" width="130" height="60" fill="rgba(255, 255, 255, 0.05)" stroke="#888" stroke-width="1" rx="6"/>
                    <text x="315" y="242" text-anchor="middle" fill="#888" font-size="11">üò¥ Worker sleeping</text>
                    <text x="315" y="257" text-anchor="middle" fill="#666" font-size="9">Zero CPU usage</text>
                    <text x="315" y="270" text-anchor="middle" fill="#666" font-size="9">No network traffic</text>
                    
                    <!-- Event 3: Data arrives -->
                    <circle cx="650" cy="180" r="7" fill="#9C27B0"/>
                    <rect x="580" y="70" width="130" height="70" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="645" y="95" text-anchor="middle" fill="#9C27B0" font-size="11" font-weight="600">üì§ Data arrives:</text>
                    <text x="645" y="110" text-anchor="middle" fill="#fff" font-size="10">LPUSH queue "task1"</text>
                    <text x="645" y="125" text-anchor="middle" fill="#00FF88" font-size="9">Worker wakes!</text>
                    <path d="M 645 140 L 650 175" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple2)"/>
                    
                    <!-- Event 4: Return value -->
                    <circle cx="700" cy="180" r="7" fill="#00FF88"/>
                    <rect x="680" y="220" width="130" height="60" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="745" y="242" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">‚úÖ Returns:</text>
                    <text x="745" y="257" text-anchor="middle" fill="#fff" font-size="10">["queue", "task1"]</text>
                    <text x="745" y="270" text-anchor="middle" fill="#888" font-size="9">Wait: 25 seconds</text>
                    
                    <!-- Alternative: Timeout scenario -->
                    <circle cx="850" cy="180" r="7" fill="none" stroke="#FF6347" stroke-width="2"/>
                    <text x="850" y="240" text-anchor="middle" fill="#FF6347" font-size="10">If no data by 30s:</text>
                    <text x="850" y="253" text-anchor="middle" fill="#FF6347" font-size="10">Returns nil</text>
                    
                    <!-- Legend -->
                    <rect x="50" y="310" width="800" height="50" fill="rgba(255, 255, 255, 0.03)" stroke="#666" stroke-width="1" rx="4"/>
                    <text x="60" y="330" fill="#00FF88" font-size="10" font-weight="600">Key Points:</text>
                    <text x="60" y="345" fill="#bbb" font-size="9">‚Ä¢ Worker blocks for up to 30 seconds (configurable timeout)</text>
                    <text x="450" y="345" fill="#bbb" font-size="9">‚Ä¢ Wakes instantly when data arrives (25s in this example)</text>
                    
                    <defs>
                        <marker id="arrowBlue2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#2196F3" />
                        </marker>
                        <marker id="arrowPurple2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                    </defs>
                </svg>
            </div>

            <!-- Mobile-friendly summary for small screens -->
            <div style="display: none; background: rgba(220, 20, 60, 0.1); padding: 15px; border-radius: 8px; margin: 20px 0;">
                <p style="font-size: 14px; margin: 0;"><strong>üì± On mobile?</strong> The diagrams show how BLPOP eliminates wasteful polling. Workers "sleep" and wake instantly when data arrives, reducing Redis requests by 99%.</p>
            </div>
            
            <style>
                /* Show mobile summary on small screens */
                @media (max-width: 768px) {
                    .diagram-container svg {
                        min-height: 300px;
                    }
                    .diagram-container + div[style*="display: none"] {
                        display: block !important;
                    }
                }
            </style>
        </div>
    `;
}


function getQuestion27Section4_CodeExamples() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üíª</span>
                <h2 class="section-label">4. Code Examples</h2>
            </div>
            
            <p><strong>Let's see blocking commands in action with real examples:</strong></p>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic BLPOP Usage</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Redis CLI - Basic Blocking</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre class="code-content"><code><span class="comment"># Terminal 1: Consumer waiting for data</span>
<span class="keyword">BLPOP</span> <span class="string">task_queue</span> <span class="number">30</span>
<span class="comment"># This command blocks (waits) for up to 30 seconds</span>
<span class="comment"># Your terminal appears "frozen" but it's just waiting...</span>

<span class="comment"># Terminal 2: Producer adds data (while BLPOP is waiting)</span>
<span class="keyword">LPUSH</span> <span class="string">task_queue</span> <span class="string">"process-payment-12345"</span>
<span class="number">(integer) 1</span>

<span class="comment"># Terminal 1 INSTANTLY wakes up and returns:</span>
<span class="number">1)</span> <span class="string">"task_queue"</span>  <span class="comment"># Which key provided the data</span>
<span class="number">2)</span> <span class="string">"process-payment-12345"</span>  <span class="comment"># The actual value</span>

<span class="comment"># Try again with empty queue:</span>
<span class="keyword">BLPOP</span> <span class="string">task_queue</span> <span class="number">5</span>
<span class="comment"># Waits 5 seconds...</span>
<span class="comment"># After 5 seconds, returns:</span>
<span class="keyword">(nil)</span>  <span class="comment"># Timeout reached, no data arrived</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Python Worker with BLPOP (Efficient Queue Consumer)</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Python - Efficient Worker Implementation</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json
<span class="keyword">import</span> time

r = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>, decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">process_task</span>(task_data):
    <span class="string">"""Process the task (simulate work)"""</span>
    <span class="keyword">print</span>(<span class="string">f"Processing: </span>{task_data}<span class="string">"</span>)
    time.sleep(<span class="number">2</span>)  <span class="comment"># Simulate 2 seconds of work</span>
    <span class="keyword">print</span>(<span class="string">f"Completed: </span>{task_data}<span class="string">"</span>)

<span class="keyword">def</span> <span class="function">efficient_worker</span>():
    <span class="string">"""
    Efficient worker using BLPOP - NO POLLING!
    This worker consumes ZERO CPU when idle
    """</span>
    <span class="keyword">print</span>(<span class="string">"üöÄ Worker started - waiting for tasks..."</span>)
    
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="keyword">try</span>:
            <span class="comment"># BLPOP waits up to 10 seconds for work</span>
            <span class="comment"># Returns: (key_name, value) or None on timeout</span>
            result = r.blpop(<span class="string">'task_queue'</span>, timeout=<span class="number">10</span>)
            
            <span class="keyword">if</span> result:
                queue_name, task_data = result
                <span class="keyword">print</span>(<span class="string">f"‚úÖ Got task from {queue_name}"</span>)
                
                <span class="comment"># Parse and process</span>
                task = json.loads(task_data)
                process_task(task)
            <span class="keyword">else</span>:
                <span class="comment"># Timeout reached - no tasks available</span>
                <span class="keyword">print</span>(<span class="string">"‚è∞ No tasks for 10 seconds, still waiting..."</span>)
                
        <span class="keyword">except</span> <span class="function">KeyboardInterrupt</span>:
            <span class="keyword">print</span>(<span class="string">"\\nüëã Worker shutting down gracefully"</span>)
            <span class="keyword">break</span>
        <span class="keyword">except</span> <span class="function">Exception</span> <span class="keyword">as</span> e:
            <span class="keyword">print</span>(<span class="string">f"‚ùå Error: {e}"</span>)
            time.sleep(<span class="number">1</span>)  <span class="comment"># Brief pause on errors</span>

<span class="comment"># Run the worker</span>
efficient_worker()

<span class="comment"># COMPARISON: Old polling approach (WASTEFUL)</span>
<span class="keyword">def</span> <span class="function">wasteful_worker_polling</span>():
    <span class="string">"""DON'T DO THIS - Wastes resources!"""</span>
    <span class="keyword">while</span> <span class="keyword">True</span>:
        task = r.rpop(<span class="string">'task_queue'</span>)
        <span class="keyword">if</span> task:
            process_task(task)
        <span class="keyword">else</span>:
            time.sleep(<span class="number">0.1</span>)  <span class="comment"># 10 wasteful checks per second!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Multiple Queue Priority with BLPOP</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Python - Priority Queue System</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>, decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">priority_worker</span>():
    <span class="string">"""
    Handle multiple queues with priority:
    BLPOP checks queues left-to-right and processes first available
    """</span>
    <span class="keyword">print</span>(<span class="string">"üéØ Priority worker started"</span>)
    
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="comment"># Check queues in priority order: urgent, normal, low</span>
        <span class="comment"># BLPOP will take from FIRST non-empty queue</span>
        result = r.blpop(
            [<span class="string">'urgent_tasks'</span>, <span class="string">'normal_tasks'</span>, <span class="string">'low_priority_tasks'</span>],
            timeout=<span class="number">30</span>
        )
        
        <span class="keyword">if</span> result:
            queue_name, task = result
            
            <span class="comment"># Different handling based on priority</span>
            <span class="keyword">if</span> queue_name == <span class="string">'urgent_tasks'</span>:
                <span class="keyword">print</span>(<span class="string">f"üö® URGENT: {task}"</span>)
                <span class="comment"># Process immediately with high priority</span>
            <span class="keyword">elif</span> queue_name == <span class="string">'normal_tasks'</span>:
                <span class="keyword">print</span>(<span class="string">f"üìã Normal: {task}"</span>)
                <span class="comment"># Standard processing</span>
            <span class="keyword">else</span>:
                <span class="keyword">print</span>(<span class="string">f"‚è¨ Low priority: {task}"</span>)
                <span class="comment"># Process when nothing else is waiting</span>
        <span class="keyword">else</span>:
            <span class="keyword">print</span>(<span class="string">"üí§ All queues empty for 30 seconds..."</span>)

<span class="comment"># Example: Add tasks to different priority queues</span>
r.lpush(<span class="string">'urgent_tasks'</span>, <span class="string">'process-fraud-alert-999'</span>)
r.lpush(<span class="string">'normal_tasks'</span>, <span class="string">'send-welcome-email-1001'</span>)
r.lpush(<span class="string">'low_priority_tasks'</span>, <span class="string">'cleanup-old-logs'</span>)

<span class="comment"># Worker will always pick urgent_tasks first!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 4: BRPOPLPUSH - Reliable Queue Pattern</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Python - Reliable Processing with Backup Queue</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>, decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">reliable_worker</span>():
    <span class="string">"""
    BRPOPLPUSH ensures tasks aren't lost if worker crashes
    - Pops from main queue
    - Immediately pushes to processing queue
    - If worker crashes, task remains in processing queue for recovery
    """</span>
    <span class="keyword">print</span>(<span class="string">"üõ°Ô∏è Reliable worker started"</span>)
    
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="comment"># Atomically pop from main queue and push to processing queue</span>
        task = r.brpoplpush(
            <span class="string">'main_queue'</span>,        <span class="comment"># Source</span>
            <span class="string">'processing_queue'</span>,  <span class="comment"># Destination (backup)</span>
            timeout=<span class="number">30</span>
        )
        
        <span class="keyword">if</span> task:
            <span class="keyword">print</span>(<span class="string">f"üîß Processing: {task}"</span>)
            
            <span class="keyword">try</span>:
                <span class="comment"># Process the task</span>
                process_complex_task(task)
                
                <span class="comment"># Success! Remove from processing queue</span>
                r.lrem(<span class="string">'processing_queue'</span>, <span class="number">1</span>, task)
                <span class="keyword">print</span>(<span class="string">f"‚úÖ Completed: {task}"</span>)
                
            <span class="keyword">except</span> <span class="function">Exception</span> <span class="keyword">as</span> e:
                <span class="keyword">print</span>(<span class="string">f"‚ùå Failed: {task} - {e}"</span>)
                <span class="comment"># Task remains in processing_queue for manual inspection</span>
                <span class="comment"># or automated retry logic</span>
        <span class="keyword">else</span>:
            <span class="keyword">print</span>(<span class="string">"‚è∞ No tasks for 30 seconds..."</span>)

<span class="keyword">def</span> <span class="function">process_complex_task</span>(task):
    <span class="string">"""Simulate task that might fail"""</span>
    time.sleep(<span class="number">2</span>)
    <span class="comment"># If this crashes, task is still in processing_queue!</span>
    <span class="keyword">if</span> <span class="string">"fail"</span> <span class="keyword">in</span> task:
        <span class="keyword">raise</span> <span class="function">Exception</span>(<span class="string">"Simulated failure"</span>)

<span class="comment"># Recovery function - run on startup to retry failed tasks</span>
<span class="keyword">def</span> <span class="function">recover_failed_tasks</span>():
    <span class="string">"""Move tasks from processing_queue back to main_queue"""</span>
    <span class="keyword">print</span>(<span class="string">"üîÑ Recovering failed tasks..."</span>)
    <span class="keyword">while</span> <span class="keyword">True</span>:
        task = r.rpoplpush(<span class="string">'processing_queue'</span>, <span class="string">'main_queue'</span>)
        <span class="keyword">if</span> <span class="keyword">not</span> task:
            <span class="keyword">break</span>
        <span class="keyword">print</span>(<span class="string">f"‚ôªÔ∏è Recovered: {task}"</span>)

<span class="comment"># Run recovery on startup, then start worker</span>
recover_failed_tasks()
reliable_worker()</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 5: Comparing Performance - Polling vs Blocking</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-lang">Python - Performance Comparison</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time
<span class="keyword">import</span> psutil  <span class="comment"># pip install psutil</span>

r = redis.Redis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>)

<span class="keyword">def</span> <span class="function">measure_resource_usage</span>(func, duration=<span class="number">10</span>):
    <span class="string">"""Measure CPU and network usage of a function"""</span>
    process = psutil.Process()
    
    <span class="comment"># Get initial measurements</span>
    cpu_before = process.cpu_percent()
    net_before = psutil.net_io_counters().bytes_sent
    
    <span class="comment"># Run for specified duration</span>
    start_time = time.time()
    request_count = <span class="number">0</span>
    
    <span class="keyword">while</span> time.time() - start_time < duration:
        func()
        request_count += <span class="number">1</span>
    
    <span class="comment"># Get final measurements</span>
    cpu_after = process.cpu_percent()
    net_after = psutil.net_io_counters().bytes_sent
    
    <span class="keyword">return</span> {
        <span class="string">'cpu_usage'</span>: cpu_after,
        <span class="string">'network_bytes'</span>: net_after - net_before,
        <span class="string">'requests'</span>: request_count
    }

<span class="comment"># Method 1: Polling (inefficient)</span>
<span class="keyword">def</span> <span class="function">polling_check</span>():
    result = r.rpop(<span class="string">'test_queue'</span>)
    <span class="keyword">if</span> <span class="keyword">not</span> result:
        time.sleep(<span class="number">0.01</span>)  <span class="comment"># 10ms sleep</span>

<span class="comment"># Method 2: Blocking (efficient)</span>
<span class="keyword">def</span> <span class="function">blocking_check</span>():
    r.blpop(<span class="string">'test_queue'</span>, timeout=<span class="number">1</span>)

<span class="keyword">print</span>(<span class="string">"Testing POLLING approach..."</span>)
polling_stats = measure_resource_usage(polling_check, duration=<span class="number">10</span>)

<span class="keyword">print</span>(<span class="string">"Testing BLOCKING approach..."</span>)
blocking_stats = measure_resource_usage(blocking_check, duration=<span class="number">10</span>)

<span class="keyword">print</span>(<span class="string">"\\nüìä RESULTS COMPARISON:"</span>)
<span class="keyword">print</span>(<span class="string">f"Polling:  {polling_stats['requests']} requests, CPU: {polling_stats['cpu_usage']}%, Network: {polling_stats['network_bytes']} bytes"</span>)
<span class="keyword">print</span>(<span class="string">f"Blocking: {blocking_stats['requests']} requests, CPU: {blocking_stats['cpu_usage']}%, Network: {blocking_stats['network_bytes']} bytes"</span>)
<span class="keyword">print</span>(<span class="string">f"\\nüí∞ Savings: {((polling_stats['requests'] - blocking_stats['requests']) / polling_stats['requests'] * 100):.1f}% fewer requests!"</span>)

<span class="comment"># Typical output:</span>
<span class="comment"># Polling:  1000 requests, CPU: 15%, Network: 50000 bytes</span>
<span class="comment"># Blocking: 10 requests,  CPU: 1%,  Network: 500 bytes</span>
<span class="comment"># Savings: 99% fewer requests!</span></code></pre>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <strong>‚úÖ Best Practices for Blocking Commands:</strong>
                <ul style="margin-top: 10px;">
                    <li><strong>Always set timeout:</strong> Never use timeout=0 (infinite wait) in production - workers can get stuck</li>
                    <li><strong>Handle nil gracefully:</strong> Timeout returns nil - use it for health checks or logging</li>
                    <li><strong>Multiple queues:</strong> Use BLPOP with multiple keys for priority queue systems</li>
                    <li><strong>Use BRPOPLPUSH:</strong> For reliable processing where task loss is unacceptable</li>
                    <li><strong>Connection pooling:</strong> Each blocking client needs its own connection (can't share)</li>
                </ul>
            </div>
        </div>
    `;
}

// Continue with remaining sections...
// Due to length, I'll provide the rest in the next file


function getQuestion27Section5_CrossQuestions() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">‚ùì</span>
                <h2 class="section-label">5. Cross Questions (Follow-ups)</h2>
            </div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: What happens if multiple workers are blocked waiting on the same queue?</h4>
                <p><strong>A:</strong> Redis maintains a FIFO (First In, First Out) queue of waiting clients. When data arrives, Redis wakes up the <strong>first client that started waiting</strong> and gives it the data. Other clients continue waiting. This ensures fair distribution - workers that have been waiting longest get served first. If you LPUSH two items while three workers are waiting, the first two workers wake up and process the items, while the third worker continues waiting.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can blocking commands cause connection issues or timeouts?</h4>
                <p><strong>A:</strong> Yes, you need to be careful! Each blocking client requires its own dedicated Redis connection because the connection is "occupied" during the block. Connection pool libraries may recycle connections, causing issues. <strong>Solution:</strong> Configure separate connection pools for blocking operations with longer timeouts, or use dedicated connections. Also, make sure your timeout value is less than your network/load balancer timeout (typically 60 seconds) to prevent connection drops.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: How is BLPOP different from RPOP with a timeout in a loop?</h4>
                <p><strong>A:</strong> They're fundamentally different! <code>RPOP</code> in a loop actively polls Redis repeatedly, wasting CPU and network bandwidth. <code>BLPOP</code> tells Redis "wake me when data arrives" and the client goes to sleep - consuming ZERO resources while waiting. Additionally, BLPOP guarantees you wake up the moment data arrives (< 1ms latency), while polling has inherent delay based on your sleep interval (typically 10-100ms). BLPOP is always better for queue processing.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: What timeout value should I use for BLPOP in production?</h4>
                <p><strong>A:</strong> Common practice is <strong>5-30 seconds</strong>. Here's why:</p>
                <ul style="margin-top: 8px;">
                    <li><strong>Too short (< 1s):</strong> Frequent timeout handling adds unnecessary code complexity</li>
                    <li><strong>Too long (> 60s):</strong> Risk of connection timeouts from load balancers/proxies</li>
                    <li><strong>Sweet spot (5-30s):</strong> Long enough to avoid timeout churn, short enough for responsive health checks and graceful shutdowns</li>
                </ul>
                <p style="margin-top: 8px;">Use the timeout return to log heartbeat messages like "No tasks for 30 seconds - worker still alive". Never use timeout=0 (infinite) in production - workers can get stuck forever if there are network issues.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Can I use BLPOP with Redis Cluster?</h4>
                <p><strong>A:</strong> Yes, but with limitations! BLPOP works fine if all keys hash to the same slot. However, if you try <code>BLPOP key1 key2 key3</code> and they're on different cluster nodes, it will fail with a CROSSSLOT error. <strong>Solutions:</strong> (1) Use hash tags to force keys to same slot: <code>BLPOP {priority}:urgent {priority}:normal</code>, or (2) Use separate BLPOP calls for keys on different nodes. For complex priority systems in clusters, consider using Redis Streams instead.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q6: What's the difference between BLPOP and BRPOP?</h4>
                <p><strong>A:</strong> Only the direction of the pop! <code>BLPOP</code> pops from the LEFT (head) of the list, while <code>BRPOP</code> pops from the RIGHT (tail). For queue processing, combine them with the push direction:</p>
                <ul style="margin-top: 8px;">
                    <li><strong>FIFO queue:</strong> LPUSH to add, BRPOP to consume (oldest first)</li>
                    <li><strong>Stack:</strong> LPUSH to add, BLPOP to consume (newest first)</li>
                </ul>
                <p style="margin-top: 8px;">Most queue systems use LPUSH/BRPOP for FIFO ordering. Both BLPOP and BRPOP accept multiple keys and have identical timeout behavior.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q7: How does BRPOPLPUSH help with reliable queue processing?</h4>
                <p><strong>A:</strong> It provides <strong>at-least-once delivery</strong> semantics. When you <code>BRPOPLPUSH source processing</code>, Redis atomically: (1) removes item from source queue, and (2) adds it to processing queue. If your worker crashes while processing, the task remains in the processing queue for recovery. Compare this to regular BLPOP where a crash means the task is lost forever. This pattern is essential for critical tasks like payment processing or order fulfillment where data loss is unacceptable.</p>
            </div>
        </div>
    `;
}

function getQuestion27Section6_TrickyQuestions() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üéØ</span>
                <h2 class="section-label">6. Tricky Questions (Advanced)</h2>
            </div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: If BLPOP is so efficient, why doesn't everyone use it for ALL queue operations?</h4>
                <p><strong>Answer:</strong> Blocking commands have important limitations and trade-offs:</p>
                <ul style="margin-top: 10px;">
                    <li><strong>Connection management:</strong> Each blocking client needs a dedicated connection - can't share connections in a pool during the block</li>
                    <li><strong>Complexity:</strong> Handling timeouts and connection issues adds code complexity</li>
                    <li><strong>Debugging:</strong> Harder to debug - connections appear "hung" even when working correctly</li>
                    <li><strong>Scale limits:</strong> If you have 10,000 workers all blocking, that's 10,000 concurrent Redis connections</li>
                    <li><strong>Not always needed:</strong> For high-throughput queues that are never empty, simple RPOP in a tight loop might be simpler</li>
                </ul>
                <p style="margin-top: 10px;"><strong>Rule of thumb:</strong> Use blocking for queues that are frequently empty (bursty workloads). For queues with consistent load where there's always work available, simple RPOP can be fine and simpler.</p>
                <p><em>Pro tip: Start with blocking - optimize only if you prove it's a bottleneck.</em></p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: What happens if Redis crashes while clients are blocked on BLPOP?</h4>
                <p><strong>Answer:</strong> All blocked clients get disconnected and receive connection errors (not timeout). Your application code must handle this by:</p>
                <ul style="margin-top: 10px;">
                    <li><strong>Catching connection exceptions:</strong> Redis client libraries raise errors like ConnectionError</li>
                    <li><strong>Implementing retry logic:</strong> Reconnect and re-issue BLPOP</li>
                    <li><strong>Exponential backoff:</strong> Don't hammer Redis during restarts</li>
                    <li><strong>Circuit breaker pattern:</strong> Stop retrying if Redis is down for extended periods</li>
                </ul>
                <p style="margin-top: 10px;">Additionally, any data that was LPUSH'd just before the crash but not yet delivered to workers is safely persisted (if AOF is enabled) and will be available after Redis restarts. The blocked clients simply need to reconnect and start waiting again.</p>
                <p><em>Pro tip: Use Redis Sentinel or Cluster for automatic failover to minimize this scenario.</em></p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: How does BLPOP behave with multiple keys of different data types?</h4>
                <p><strong>Answer:</strong> BLPOP requires ALL specified keys to be lists (or non-existent). If any key exists but is NOT a list (e.g., it's a string or hash), BLPOP immediately fails with a WRONGTYPE error - it doesn't wait or skip that key. This is different from GET which just returns different types. Example:</p>
                <div class="code-block" style="margin: 10px 0;">
                    <pre class="code-content"><code><span class="keyword">SET</span> <span class="string">mykey</span> <span class="string">"not-a-list"</span>
<span class="keyword">BLPOP</span> <span class="string">mykey</span> <span class="number">10</span>
<span class="comment"># Error: WRONGTYPE Operation against a key holding the wrong kind of value</span></code></pre>
                </div>
                <p>This can cause production issues if queue key names collide with other data structures. <strong>Solution:</strong> Use clear key naming conventions like <code>queue:*</code> for all list-based queues.</p>
                <p><em>Pro tip: Add type checks in development/testing to catch naming collisions early.</em></p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can BLPOP block indefinitely even with a timeout if data keeps arriving?</h4>
                <p><strong>Answer:</strong> No - this is a common misconception! The timeout in BLPOP is <strong>NOT reset when data arrives</strong>. Here's what actually happens:</p>
                <ul style="margin-top: 10px;">
                    <li><strong>Scenario:</strong> You call <code>BLPOP queue 30</code> at time T=0</li>
                    <li><strong>If data arrives at T=5s:</strong> BLPOP returns immediately with the data</li>
                    <li><strong>If data arrives at T=31s:</strong> Too late! Timeout already triggered at T=30s, returned nil</li>
                </ul>
                <p style="margin-top: 10px;">Each BLPOP call is independent with its own timeout counter. If you want continuous processing, you need a loop that repeatedly calls BLPOP. The timeout is maximum wait time PER CALL, not cumulative.</p>
                <p><em>Pro tip: This is actually a feature - prevents workers from getting stuck forever if something goes wrong.</em></p>
            </div>
        </div>
    `;
}

function getQuestion27Section7_PracticalScenarios() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üè¢</span>
                <h2 class="section-label">7. Practical Scenarios</h2>
            </div>
            
            <h3 style="color: var(--primary-color); margin: 20px 0 10px 0;">Scenario 1: Real-Time Notification System (Microservices Architecture)</h3>
            <p><strong>Problem:</strong> A social media platform has 10 million users. When users post content, 1000s of followers need instant notifications. The notification service has 50 worker processes that need to handle this efficiently.</p>
            
            <p><strong>Before BLPOP (Polling Approach):</strong></p>
            <ul>
                <li>‚ùå 50 workers √ó 100 checks/second = 5,000 Redis requests/sec</li>
                <li>‚ùå During quiet hours: 99% of requests return nothing</li>
                <li>‚ùå Redis CPU: 45% even with no real work</li>
                <li>‚ùå Network bandwidth: 150 MB/hour wasted on empty polls</li>
                <li>‚ùå Latency: 10-50ms delay due to polling interval</li>
            </ul>

            <p><strong>After BLPOP (Blocking Approach):</strong></p>
            <ul>
                <li>‚úÖ Redis requests: 5,000/sec ‚Üí 50/30sec (99.97% reduction!)</li>
                <li>‚úÖ Redis CPU: 45% ‚Üí 2%</li>
                <li>‚úÖ Network bandwidth: 150 MB/hour ‚Üí 2 MB/hour</li>
                <li>‚úÖ Latency: < 1ms (instant wake-up)</li>
                <li>‚úÖ Cost savings: $500/month on Redis infrastructure</li>
            </ul>

            <h3 style="color: var(--primary-color); margin: 30px 0 10px 0;">Scenario 2: E-commerce Order Processing Pipeline</h3>
            <p><strong>Problem:</strong> Orders go through multiple stages: validation ‚Üí payment ‚Üí fulfillment ‚Üí shipping. Each stage has dedicated workers. If payment fails, orders shouldn't be lost.</p>
            
            <p><strong>Solution using BRPOPLPUSH for reliability - ensures zero data loss even if workers crash during processing.</strong></p>

            <h3 style="color: var(--primary-color); margin: 30px 0 10px 0;">Scenario 3: Video Encoding Service (Priority Queue System)</h3>
            <p><strong>Problem:</strong> A video platform encodes uploaded videos in multiple qualities. Premium users get priority, but all videos should eventually process.</p>
            
            <p><strong>Solution using BLPOP with multiple priorities enables dynamic prioritization with starvation prevention. Workers sleep efficiently when all queues are empty.</strong></p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <strong>üí° Real-World Impact:</strong> These patterns are used by companies like Instagram (photo processing), Twitch (live stream encoding), and Airbnb (booking confirmations) to handle millions of tasks per day efficiently and reliably.
            </div>
        </div>
    `;
}

function getQuestion27Section8_KeyTakeaways() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üí°</span>
                <h2 class="section-label">8. Key Takeaways</h2>
            </div>
            
            <div class="takeaway-item">
                <span class="takeaway-icon">‚úÖ</span>
                <p><strong>Blocking commands eliminate polling waste</strong> - BLPOP/BRPOP wait for data instead of constantly checking, reducing Redis load by 95-99%</p>
            </div>
            
            <div class="takeaway-item">
                <span class="takeaway-icon">üí§</span>
                <p><strong>Workers sleep efficiently</strong> - Blocked clients consume zero CPU/network while waiting, Redis wakes them instantly when data arrives</p>
            </div>
            
            <div class="takeaway-item">
                <span class="takeaway-icon">üéØ</span>
                <p><strong>Main commands: BLPOP, BRPOP, BRPOPLPUSH</strong> - All support timeout parameter and multiple keys for priority handling</p>
            </div>

            <div class="takeaway-item">
                <span class="takeaway-icon">‚ö°</span>
                <p><strong>Sub-millisecond wake-up latency</strong> - Workers wake < 1ms after data arrives, faster than any polling interval</p>
            </div>

            <div class="takeaway-item">
                <span class="takeaway-icon">üîê</span>
                <p><strong>BRPOPLPUSH provides reliability</strong> - Atomically moves items to processing queue, preventing data loss on worker crashes</p>
            </div>

            <div class="takeaway-item">
                <span class="takeaway-icon">üéöÔ∏è</span>
                <p><strong>Multiple keys enable priorities</strong> - BLPOP checks keys left-to-right, processes first available for simple priority queues</p>
            </div>

            <div class="takeaway-item">
                <span class="takeaway-icon">‚è±Ô∏è</span>
                <p><strong>Always set reasonable timeouts</strong> - Use 5-30 seconds typically, never 0 (infinite) in production to prevent stuck workers</p>
            </div>

            <div class="takeaway-item">
                <span class="takeaway-icon">üîå</span>
                <p><strong>Each blocking client needs dedicated connection</strong> - Can't share pooled connections during block, plan connection limits accordingly</p>
            </div>
        </div>
    `;
}

function getQuestion27Section9_Keywords() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üè∑Ô∏è</span>
                <h2 class="section-label">9. Keywords & Concepts</h2>
            </div>
            
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">BLPOP</span>
                <span class="keyword-tag">BRPOP</span>
                <span class="keyword-tag">BRPOPLPUSH</span>
                <span class="keyword-tag">BLMOVE</span>
                <span class="keyword-tag">Blocking Operations</span>
                <span class="keyword-tag">Timeout Parameter</span>
                <span class="keyword-tag">Queue Processing</span>
                <span class="keyword-tag">Worker Pattern</span>
                <span class="keyword-tag">Polling vs Blocking</span>
                <span class="keyword-tag">Resource Efficiency</span>
                <span class="keyword-tag">Priority Queues</span>
                <span class="keyword-tag">Reliable Processing</span>
                <span class="keyword-tag">At-Least-Once Delivery</span>
                <span class="keyword-tag">FIFO Order</span>
                <span class="keyword-tag">Connection Management</span>
                <span class="keyword-tag">Atomic Operations</span>
                <span class="keyword-tag">Task Queue</span>
                <span class="keyword-tag">Job Queue</span>
                <span class="keyword-tag">Dead Letter Queue</span>
                <span class="keyword-tag">Processing Queue</span>
            </div>
        </div>
    `;
}

function getQuestion27Section10_Quiz() {
    return `
        <div class="content-section">
            <div class="section-header">
                <span class="section-icon">üìù</span>
                <h2 class="section-label">10. Practice Quiz</h2>
            </div>
            
            <div class="quiz-container">
                <div class="quiz-question">
                    <strong>Question 1:</strong> What is the PRIMARY advantage of BLPOP over RPOP in a loop?
                </div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        A) BLPOP is faster at removing items from lists
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        B) BLPOP can handle larger lists more efficiently
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">
                        C) BLPOP eliminates wasteful polling, reducing CPU and network usage to near-zero while waiting
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        D) BLPOP supports more data types than RPOP
                    </div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct Answer: C</strong>
                    <p><strong>Explanation:</strong> The key advantage is resource efficiency. With RPOP loops, workers constantly poll Redis (e.g., 100 times/second), getting "nil" back when queues are empty - wasting CPU, network, and Redis resources. BLPOP allows workers to "sleep" and Redis wakes them instantly when data arrives, reducing requests by 95-99% while improving response latency.</p>
                </div>
            </div>

            <div class="quiz-container">
                <div class="quiz-question">
                    <strong>Question 2:</strong> You have 3 workers all executing <code>BLPOP myqueue 30</code> on an empty queue. When one item is added with <code>LPUSH myqueue "task1"</code>, what happens?
                </div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        A) All 3 workers receive the same task
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">
                        B) Only the first worker (that started waiting first) receives the task
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        C) A random worker receives the task
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        D) The task is split among all 3 workers
                    </div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct Answer: B</strong>
                    <p><strong>Explanation:</strong> Redis maintains a FIFO queue of waiting clients. When data arrives, Redis wakes up the FIRST client that started waiting and gives it the data. The other two workers continue blocking and waiting. This ensures fair distribution - workers that have waited longest get served first. If you LPUSH two items, the first two waiting workers each get one item.</p>
                </div>
            </div>

            <div class="quiz-container">
                <div class="quiz-question">
                    <strong>Question 3:</strong> What does the timeout value in <code>BLPOP queue 30</code> represent?
                </div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        A) The command will retry every 30 seconds until data arrives
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">
                        B) Maximum time in seconds to wait; returns nil if no data arrives within 30 seconds
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        C) The client will sleep for exactly 30 seconds even if data arrives earlier
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        D) The timeout is reset each time data arrives in other queues
                    </div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct Answer: B</strong>
                    <p><strong>Explanation:</strong> The timeout is the MAXIMUM wait time for this specific BLPOP call. If data arrives before 30 seconds, BLPOP returns immediately with the data. If no data arrives within 30 seconds, it returns nil (timeout). The timeout is NOT reset or extended - each BLPOP call has its own independent timeout period. For continuous processing, wrap BLPOP in a loop.</p>
                </div>
            </div>

            <div class="quiz-container">
                <div class="quiz-question">
                    <strong>Question 4:</strong> Why would you use <code>BRPOPLPUSH source processing 30</code> instead of <code>BLPOP source 30</code>?
                </div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        A) BRPOPLPUSH is faster than BLPOP
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">
                        B) BRPOPLPUSH ensures tasks aren't lost if the worker crashes - tasks move to processing queue atomically
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        C) BRPOPLPUSH can handle multiple queues while BLPOP cannot
                    </div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">
                        D) BRPOPLPUSH doesn't require a timeout parameter
                    </div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct Answer: B</strong>
                    <p><strong>Explanation:</strong> BRPOPLPUSH provides reliable queue processing with at-least-once delivery semantics. It atomically (1) pops from source queue and (2) pushes to processing queue. If your worker crashes while processing, the task remains in the processing queue for recovery. With regular BLPOP, if worker crashes after receiving the task, the task is lost forever. This pattern is critical for financial transactions, order processing, or any operation where data loss is unacceptable.</p>
                </div>
            </div>
        </div>
    `;
}

       function getQuestion28Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Developer Sarah is confused:</strong> "I'm storing user IDs of people who liked a post. Should I use a List or Set?" Her team lead asks: "Can someone like a post twice?" Sarah: "No, of course not!" Lead: "Then you need a Set, not a List!"</p>
            <p>But what's the real difference? Let's break it down!</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis List</strong> = Ordered collection that ALLOWS duplicates. Think of it as an array where order matters and same value can appear multiple times.</p>
            <p><strong>Redis Set</strong> = Unordered collection that ENFORCES uniqueness. No duplicates allowed, no guaranteed order.</p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Key Differences</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Feature</th><th style="padding: 10px;">List</th><th style="padding: 10px;">Set</th></tr>
                    <tr><td style="padding: 8px;">Duplicates</td><td>‚úÖ Allowed</td><td>‚ùå Not allowed</td></tr>
                    <tr><td style="padding: 8px;">Order</td><td>‚úÖ Maintained</td><td>‚ùå No order guarantee</td></tr>
                    <tr><td style="padding: 8px;">Access by Index</td><td>‚úÖ Yes (LINDEX)</td><td>‚ùå No</td></tr>
                    <tr><td style="padding: 8px;">Check Membership</td><td>O(N) slow</td><td>O(1) instant</td></tr>
                    <tr><td style="padding: 8px;">Add Operation</td><td>LPUSH/RPUSH</td><td>SADD</td></tr>
                    <tr><td style="padding: 8px;">Remove Operation</td><td>LPOP/RPOP</td><td>SREM</td></tr>
                    <tr><td style="padding: 8px;">Use Case</td><td>Queue, Timeline</td><td>Tags, Followers</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° When to Use Which:</strong></p>
                <ul>
                    <li><strong>Use List:</strong> Order matters, duplicates OK (feeds, queues, logs)</li>
                    <li><strong>Use Set:</strong> Uniqueness matters, order doesn't (tags, likes, followers)</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">List vs Set: Core Differences</div>
                <svg viewBox="0 0 900 500" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis List vs Set</text>
                    
                    <!-- LIST Example -->
                    <text x="225" y="80" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="600">LIST (Ordered + Duplicates)</text>
                    
                    <rect x="50" y="110" width="350" height="140" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="3" rx="6"/>
                    <text x="225" y="140" text-anchor="middle" fill="#FFA500" font-size="13">RPUSH list "apple" "banana" "apple"</text>
                    
                    <text x="90" y="175" fill="#00FF88" font-size="12" font-weight="600">Result:</text>
                    <rect x="80" y="185" width="70" height="40" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="115" y="210" text-anchor="middle" fill="#fff" font-size="11">apple</text>
                    
                    <rect x="160" y="185" width="70" height="40" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="195" y="210" text-anchor="middle" fill="#fff" font-size="11">banana</text>
                    
                    <rect x="240" y="185" width="70" height="40" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="275" y="210" text-anchor="middle" fill="#fff" font-size="11">apple</text>
                    
                    <text x="320" y="210" fill="#DC143C" font-size="14" font-weight="700">‚úÖ</text>
                    
                    <text x="90" y="245" fill="#888" font-size="10">‚Ä¢ Index 0: "apple"</text>
                    <text x="90" y="260" fill="#888" font-size="10">‚Ä¢ Index 1: "banana"</text>
                    <text x="90" y="275" fill="#888" font-size="10">‚Ä¢ Index 2: "apple" (duplicate OK!)</text>
                    
                    <!-- SET Example -->
                    <text x="675" y="80" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">SET (Unordered + Unique)</text>
                    
                    <rect x="500" y="110" width="350" height="140" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="3" rx="6"/>
                    <text x="675" y="140" text-anchor="middle" fill="#FFA500" font-size="13">SADD set "apple" "banana" "apple"</text>
                    
                    <text x="540" y="175" fill="#00FF88" font-size="12" font-weight="600">Result (only 2 items!):</text>
                    
                    <ellipse cx="600" cy="205" rx="50" ry="30" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2"/>
                    <text x="600" y="210" text-anchor="middle" fill="#fff" font-size="11">banana</text>
                    
                    <ellipse cx="730" cy="205" rx="50" ry="30" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2"/>
                    <text x="730" y="210" text-anchor="middle" fill="#fff" font-size="11">apple</text>
                    
                    <text x="540" y="245" fill="#888" font-size="10">‚Ä¢ "apple" added once (duplicate ignored!)</text>
                    <text x="540" y="260" fill="#888" font-size="10">‚Ä¢ "banana" added once</text>
                    <text x="540" y="275" fill="#888" font-size="10">‚Ä¢ No index - unordered collection</text>
                    
                    <!-- Performance Comparison -->
                    <rect x="50" y="310" width="800" height="160" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="340" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">‚ö° Performance: Membership Check</text>
                    
                    <text x="80" y="370" fill="#DC143C" font-size="13" font-weight="600">LIST: Check if "apple" exists</text>
                    <text x="90" y="390" fill="#FFA500" font-size="11">Must scan entire list: O(N)</text>
                    <text x="90" y="410" fill="#888" font-size="10">For 1M items: ~1,000,000 operations</text>
                    <text x="90" y="430" fill="#FF6347" font-size="12" font-weight="600">‚ùå SLOW for large lists</text>
                    
                    <line x1="450" y1="350" x2="450" y2="460" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <text x="480" y="370" fill="#00FF88" font-size="13" font-weight="600">SET: Check if "apple" exists</text>
                    <text x="490" y="390" fill="#00FF88" font-size="11">Hash table lookup: O(1)</text>
                    <text x="490" y="410" fill="#888" font-size="10">For 1M items: ~1 operation</text>
                    <text x="490" y="430" fill="#00FF88" font-size="12" font-weight="600">‚úÖ INSTANT even for huge sets</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Duplicates Behavior</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Duplicates Test</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># LIST - allows duplicates</span>
<span class="keyword">RPUSH</span> <span class="string">mylist</span> <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"a"</span> <span class="string">"c"</span> <span class="string">"a"</span>
<span class="keyword">LRANGE</span> <span class="string">mylist</span> <span class="number">0</span> <span class="number">-1</span>
<span class="comment"># Result: ["a", "b", "a", "c", "a"]</span>
<span class="comment"># All 5 items stored, including 3 "a"s!</span>

<span class="keyword">LLEN</span> <span class="string">mylist</span>
<span class="number">(integer) 5</span>  <span class="comment"># Length = 5</span>

<span class="comment"># SET - enforces uniqueness</span>
<span class="keyword">SADD</span> <span class="string">myset</span> <span class="string">"a"</span> <span class="string">"b"</span> <span class="string">"a"</span> <span class="string">"c"</span> <span class="string">"a"</span>
<span class="number">(integer) 3</span>  <span class="comment"># Only 3 unique items added!</span>

<span class="keyword">SMEMBERS</span> <span class="string">myset</span>
<span class="comment"># Result: ["a", "b", "c"] (in any order)</span>
<span class="comment"># Duplicates automatically ignored!</span>

<span class="keyword">SCARD</span> <span class="string">myset</span>
<span class="number">(integer) 3</span>  <span class="comment"># Cardinality = 3</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Real-World Use Case - Post Likes System</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Likes System (Why Set > List)</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">PostLikes</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, post_id):
        <span class="keyword">self</span>.key = <span class="string">f"post:</span>{post_id}<span class="string">:likes"</span>
    
    <span class="keyword">def</span> <span class="function">like_post</span>(<span class="keyword">self</span>, user_id):
        <span class="string">"""Add like - SADD prevents duplicate likes automatically!"""</span>
        result = r.sadd(<span class="keyword">self</span>.key, user_id)
        
        <span class="keyword">if</span> result == <span class="number">1</span>:
            <span class="keyword">print</span>(<span class="string">f"‚úÖ User </span>{user_id}<span class="string"> liked the post"</span>)
            <span class="keyword">return</span> <span class="keyword">True</span>
        <span class="keyword">else</span>:
            <span class="keyword">print</span>(<span class="string">f"‚ÑπÔ∏è User </span>{user_id}<span class="string"> already liked this post"</span>)
            <span class="keyword">return</span> <span class="keyword">False</span>
    
    <span class="keyword">def</span> <span class="function">unlike_post</span>(<span class="keyword">self</span>, user_id):
        <span class="string">"""Remove like"""</span>
        result = r.srem(<span class="keyword">self</span>.key, user_id)
        <span class="keyword">return</span> result == <span class="number">1</span>
    
    <span class="keyword">def</span> <span class="function">has_liked</span>(<span class="keyword">self</span>, user_id):
        <span class="string">"""Check if user liked - O(1) instant!"""</span>
        <span class="keyword">return</span> r.sismember(<span class="keyword">self</span>.key, user_id)
    
    <span class="keyword">def</span> <span class="function">get_like_count</span>(<span class="keyword">self</span>):
        <span class="string">"""Get total likes"""</span>
        <span class="keyword">return</span> r.scard(<span class="keyword">self</span>.key)
    
    <span class="keyword">def</span> <span class="function">get_all_likers</span>(<span class="keyword">self</span>):
        <span class="string">"""Get all users who liked"""</span>
        <span class="keyword">return</span> r.smembers(<span class="keyword">self</span>.key)

<span class="comment"># Usage</span>
post = PostLikes(<span class="number">12345</span>)

<span class="comment"># User tries to like post multiple times</span>
post.like_post(<span class="number">101</span>)  <span class="comment"># ‚úÖ Liked</span>
post.like_post(<span class="number">102</span>)  <span class="comment"># ‚úÖ Liked</span>
post.like_post(<span class="number">101</span>)  <span class="comment"># ‚ÑπÔ∏è Already liked (no duplicate!)</span>

<span class="comment"># Check likes</span>
<span class="keyword">print</span>(<span class="string">f"Total likes: </span>{post.get_like_count()}<span class="string">"</span>)  <span class="comment"># 2, not 3!</span>
<span class="keyword">print</span>(<span class="string">f"User 101 liked? </span>{post.has_liked(<span class="number">101</span>)}<span class="string">"</span>)  <span class="comment"># True (instant check!)</span>

<span class="comment"># Why SET is perfect here:</span>
<span class="comment"># 1. Automatically prevents duplicate likes</span>
<span class="comment"># 2. O(1) instant membership check (has user liked?)</span>
<span class="comment"># 3. Easy to get count with SCARD</span>
<span class="comment"># 4. No need to scan entire list!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Can I convert a List to a Set or vice versa?</h4>
                <p><strong>A:</strong> Not directly with a single command! You must read from one and write to the other. For List‚ÜíSet: LRANGE list 0 -1, then SADD for each unique value. For Set‚ÜíList: SMEMBERS set, then RPUSH each member (but order will be random!).</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Memory usage: List vs Set for same data?</h4>
                <p><strong>A:</strong> Set uses more memory per item (needs hash table overhead), BUT if you have many duplicates, Set wins because it only stores unique values once! Example: 1M items with 50% duplicates ‚Üí List: ~1M entries, Set: ~500K entries.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can Sets perform operations Lists can't?</h4>
                <p><strong>A:</strong> Yes! Sets support set operations: SUNION (combine sets), SINTER (common elements), SDIFF (difference). Lists don't have these. Example: "Users who liked post A AND post B" = SINTER likes:postA likes:postB (instant!).</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: For task queue: List or Set?</h4>
                <p><strong>A:</strong> Always List! Task queues need order (FIFO) and might have duplicate tasks (retry same task). Use RPUSH + BLPOP pattern. Sets lose order and prevent duplicate tasks, breaking retry logic.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: What if I need both: order AND uniqueness?</h4>
                <p><strong>A:</strong> Use Sorted Set! It maintains order (by score) AND enforces uniqueness. Or maintain both List + Set: Set for uniqueness check, List for order. Trade-off: double storage vs query simplicity.</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: SADD returns the number of items added. What does SADD set "a" "a" "b" return?</h4>
                <p><strong>Answer:</strong> Returns <code>(integer) 2</code> - not 3! Even though you specified 3 items, only 2 unique items were added ("a" once, "b" once). The duplicate "a" is ignored. Return value = count of NEW members added, not total items in command!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can a List have negative length?</h4>
                <p><strong>Answer:</strong> No! But LLEN always returns ‚â•0. However, LTRIM can make lists appear "negative" if you trim beyond bounds: <code>LTRIM list 10 5</code> (start > end) results in empty list with LLEN=0, not error! Redis silently handles this.</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: SMEMBERS returns unordered. Can I get members in consistent order?</h4>
                <p><strong>Answer:</strong> Nope! Sets are inherently unordered. SMEMBERS might return different order each call (depends on internal hash table). If you need consistent order: (1) Use Sorted Set with scores, or (2) Sort client-side after SMEMBERS. Don't rely on Set order!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Instagram "Double-Tap" Like System</strong></p>
            
            <p>Instagram prevents users from liking the same post twice. How do they implement this efficiently for billions of likes per day?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Redis Sets</h4>
                
                <p><strong>Why Set over List:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ <strong>Automatic deduplication:</strong> SADD ignores duplicate likes</li>
                    <li>‚úÖ <strong>O(1) membership check:</strong> "Did user X like this?" instant</li>
                    <li>‚úÖ <strong>O(1) count:</strong> SCARD gives like count instantly</li>
                    <li>‚ùå <strong>List would require O(N) scan</strong> to check if user already liked</li>
                    <li>‚ùå <strong>List would store duplicates</strong> wasting memory</li>
                </ul>
                
                <p style="margin-top: 15px;"><strong>Performance at Scale:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    Post with 10M likes:<br>
                    ‚Ä¢ List: Check if liked = O(10M) = seconds<br>
                    ‚Ä¢ Set: Check if liked = O(1) = microseconds
                </code>
            </div>

            <p style="margin-top: 20px;"><strong>Result:</strong> Instagram handles billions of likes/day with sub-millisecond response times using Sets!</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìã</span><p><strong>List = Order + Duplicates</strong> - Use for sequences, queues, timelines</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Set = Unique + Unordered</strong> - Use for tags, likes, followers</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Set wins for membership checks</strong> - O(1) vs List's O(N)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî¢</span><p><strong>Lists have indices, Sets don't</strong> - Can't access Set by position</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üö´</span><p><strong>Sets auto-reject duplicates</strong> - SADD same value twice = added once</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Sets support set operations</strong> - UNION, INTERSECT, DIFF (Lists can't)</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">List vs Set</span><span class="keyword-tag">Duplicates</span><span class="keyword-tag">Order</span><span class="keyword-tag">Uniqueness</span><span class="keyword-tag">SADD</span><span class="keyword-tag">RPUSH</span><span class="keyword-tag">SISMEMBER</span><span class="keyword-tag">O(1) vs O(N)</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You're building a "Who viewed my profile" feature. Users can view profiles multiple times but should appear only once in the list. Which data structure?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) List - maintains view order</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Set - prevents duplicate viewers</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) String - stores comma-separated IDs</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Hash - maps viewer to count</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Set</strong>
                    <p>Set is perfect because: (1) Automatically prevents duplicate viewers, (2) O(1) check if specific user viewed profile, (3) Easy to get count with SCARD. List would store same viewer multiple times. If you need view order too, use Sorted Set with timestamp as score!</p>
                </div>
            </div>
        </div>
    `;
}

      function getQuestion29Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Junior dev Mike asks:</strong> "I need to add items to a Redis Set. Do I use SPUSH? SINSERT? SAPPEND?" Senior dev laughs: "None of those exist! It's just SADD - Set ADD. Simple as that!"</p>
            <p>Mike: "But what does it return? How do I know if it worked?" Let's find out!</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>SADD key member [member ...]</strong></p>
            <p>Adds one or more members to a Set. If member already exists, it's ignored (Sets enforce uniqueness). Creates the Set if it doesn't exist.</p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">SADD Behavior</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Scenario</th><th style="padding: 10px;">Return Value</th><th style="padding: 10px;">Meaning</th></tr>
                    <tr><td style="padding: 8px;">Add new member</td><td>1</td><td>1 member added</td></tr>
                    <tr><td style="padding: 8px;">Add existing member</td><td>0</td><td>Already exists, nothing added</td></tr>
                    <tr><td style="padding: 8px;">Add multiple new</td><td>N</td><td>N members added</td></tr>
                    <tr><td style="padding: 8px;">Add mix of new/existing</td><td>N</td><td>Only N new members added</td></tr>
                    <tr><td style="padding: 8px;">Set doesn't exist</td><td>N</td><td>Creates Set, adds N members</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Key Points:</strong></p>
                <ul>
                    <li><strong>Return value:</strong> Number of NEW members actually added (not total members in Set)</li>
                    <li><strong>Duplicates ignored:</strong> SADD set "apple" "apple" "apple" returns 1</li>
                    <li><strong>Auto-create:</strong> SADD creates Set if it doesn't exist</li>
                    <li><strong>Time complexity:</strong> O(1) for each member added</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">How SADD Works Step-by-Step</div>
                <svg viewBox="0 0 900 550" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">SADD: Add Members to Set</text>
                    
                    <!-- Step 1: Empty Set -->
                    <text x="150" y="80" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">Step 1: Initial State</text>
                    <rect x="50" y="100" width="200" height="80" fill="rgba(255, 165, 0, 0.1)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="150" y="135" text-anchor="middle" fill="#888" font-size="12">Set "users" (empty)</text>
                    <text x="150" y="155" text-anchor="middle" fill="#666" font-size="11">{}</text>
                    
                    <!-- Arrow -->
                    <path d="M 150 180 L 150 210" stroke="#DC143C" stroke-width="2" marker-end="url(#arrowRed1)"/>
                    
                    <!-- Step 2: Add First Member -->
                    <text x="150" y="230" text-anchor="middle" fill="#00FF88" font-size="13">SADD users "alice"</text>
                    <rect x="50" y="245" width="200" height="80" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="3" rx="6">
                        <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" repeatCount="indefinite"/>
                    </rect>
                    <text x="150" y="275" text-anchor="middle" fill="#fff" font-size="12">{"alice"}</text>
                    <text x="150" y="295" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">Returns: 1</text>
                    <text x="150" y="310" text-anchor="middle" fill="#888" font-size="10">(1 new member added)</text>
                    
                    <!-- Step 3: Add Another -->
                    <text x="450" y="80" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">Step 2: Add More</text>
                    <rect x="350" y="100" width="200" height="80" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="135" text-anchor="middle" fill="#fff" font-size="11">{"alice"}</text>
                    
                    <path d="M 450 180 L 450 210" stroke="#DC143C" stroke-width="2" marker-end="url(#arrowRed1)"/>
                    
                    <text x="450" y="230" text-anchor="middle" fill="#00FF88" font-size="13">SADD users "bob"</text>
                    <rect x="350" y="245" width="200" height="80" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="3" rx="6">
                        <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" begin="0.5s" repeatCount="indefinite"/>
                    </rect>
                    <text x="450" y="275" text-anchor="middle" fill="#fff" font-size="12">{"alice", "bob"}</text>
                    <text x="450" y="295" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">Returns: 1</text>
                    <text x="450" y="310" text-anchor="middle" fill="#888" font-size="10">(1 new member added)</text>
                    
                    <!-- Step 4: Duplicate -->
                    <text x="750" y="80" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">Step 3: Duplicate</text>
                    <rect x="650" y="100" width="200" height="80" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="750" y="135" text-anchor="middle" fill="#fff" font-size="11">{"alice", "bob"}</text>
                    
                    <path d="M 750 180 L 750 210" stroke="#DC143C" stroke-width="2" marker-end="url(#arrowRed1)"/>
                    
                    <text x="750" y="230" text-anchor="middle" fill="#FFA500" font-size="13">SADD users "alice"</text>
                    <rect x="650" y="245" width="200" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="3" rx="6" stroke-dasharray="5,5">
                        <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" begin="1s" repeatCount="indefinite"/>
                    </rect>
                    <text x="750" y="275" text-anchor="middle" fill="#fff" font-size="12">{"alice", "bob"}</text>
                    <text x="750" y="295" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">Returns: 0</text>
                    <text x="750" y="310" text-anchor="middle" fill="#FF6347" font-size="10">(already exists!)</text>
                    
                    <!-- Multiple Members Example -->
                    <rect x="50" y="370" width="800" height="150" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="400" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">‚ö° Adding Multiple Members at Once</text>
                    
                    <text x="80" y="430" fill="#00FF88" font-size="12" font-weight="600">SADD tags "redis" "database" "cache" "redis"</text>
                    <text x="90" y="455" fill="#888" font-size="11">‚Ä¢ 4 items specified</text>
                    <text x="90" y="475" fill="#888" font-size="11">‚Ä¢ "redis" appears twice (duplicate!)</text>
                    <text x="90" y="495" fill="#00FF88" font-size="12" font-weight="600">Returns: 3</text>
                    <text x="100" y="510" fill="#666" font-size="10">(Only 3 unique members added)</text>
                    
                    <line x1="500" y1="420" x2="500" y2="520" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <text x="520" y="440" fill="#fff" font-size="11">Result Set:</text>
                    <ellipse cx="580" cy="465" rx="45" ry="25" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2"/>
                    <text x="580" y="470" text-anchor="middle" fill="#fff" font-size="10">redis</text>
                    
                    <ellipse cx="660" cy="465" rx="50" ry="25" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2"/>
                    <text x="660" y="470" text-anchor="middle" fill="#fff" font-size="10">database</text>
                    
                    <ellipse cx="750" cy="465" rx="40" ry="25" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2"/>
                    <text x="750" y="470" text-anchor="middle" fill="#fff" font-size="10">cache</text>
                    
                    <text x="650" y="505" text-anchor="middle" fill="#888" font-size="10">3 unique members (duplicate ignored)</text>
                    
                    <defs>
                        <marker id="arrowRed1" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic SADD Usage</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Understanding Return Values</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Add first member</span>
<span class="keyword">SADD</span> <span class="string">fruits</span> <span class="string">"apple"</span>
<span class="number">(integer) 1</span>  <span class="comment"># 1 member added</span>

<span class="comment"># Add same member again</span>
<span class="keyword">SADD</span> <span class="string">fruits</span> <span class="string">"apple"</span>
<span class="number">(integer) 0</span>  <span class="comment"># Already exists, 0 added</span>

<span class="comment"># Add multiple members</span>
<span class="keyword">SADD</span> <span class="string">fruits</span> <span class="string">"banana"</span> <span class="string">"orange"</span> <span class="string">"grape"</span>
<span class="number">(integer) 3</span>  <span class="comment"># 3 new members added</span>

<span class="comment"># Check Set contents</span>
<span class="keyword">SMEMBERS</span> <span class="string">fruits</span>
<span class="number">1)</span> <span class="string">"apple"</span>
<span class="number">2)</span> <span class="string">"banana"</span>
<span class="number">3)</span> <span class="string">"orange"</span>
<span class="number">4)</span> <span class="string">"grape"</span>

<span class="comment"># Add mix of new and existing</span>
<span class="keyword">SADD</span> <span class="string">fruits</span> <span class="string">"apple"</span> <span class="string">"kiwi"</span> <span class="string">"banana"</span> <span class="string">"mango"</span>
<span class="number">(integer) 2</span>  <span class="comment"># Only "kiwi" and "mango" added (apple, banana exist)</span>

<span class="comment"># Count members</span>
<span class="keyword">SCARD</span> <span class="string">fruits</span>
<span class="number">(integer) 6</span>  <span class="comment"># Total unique members</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Tag System Implementation</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Article Tagging System</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">ArticleTags</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, article_id):
        <span class="keyword">self</span>.key = <span class="string">f"article:</span>{article_id}<span class="string">:tags"</span>
    
    <span class="keyword">def</span> <span class="function">add_tags</span>(<span class="keyword">self</span>, *tags):
        <span class="string">"""Add one or more tags to article"""</span>
        <span class="keyword">if</span> <span class="keyword">not</span> tags:
            <span class="keyword">return</span> <span class="number">0</span>
        
        <span class="comment"># SADD returns count of NEW tags added</span>
        added = r.sadd(<span class="keyword">self</span>.key, *tags)
        
        <span class="keyword">if</span> added == <span class="number">0</span>:
            <span class="keyword">print</span>(<span class="string">"‚ÑπÔ∏è All tags already exist"</span>)
        <span class="keyword">elif</span> added < <span class="function">len</span>(tags):
            <span class="keyword">print</span>(<span class="string">f"‚úÖ Added </span>{added}<span class="string"> new tags (</span>{<span class="function">len</span>(tags) - added}<span class="string"> were duplicates)"</span>)
        <span class="keyword">else</span>:
            <span class="keyword">print</span>(<span class="string">f"‚úÖ Added </span>{added}<span class="string"> new tags"</span>)
        
        <span class="keyword">return</span> added
    
    <span class="keyword">def</span> <span class="function">get_tags</span>(<span class="keyword">self</span>):
        <span class="string">"""Get all tags"""</span>
        <span class="keyword">return</span> r.smembers(<span class="keyword">self</span>.key)
    
    <span class="keyword">def</span> <span class="function">has_tag</span>(<span class="keyword">self</span>, tag):
        <span class="string">"""Check if article has specific tag"""</span>
        <span class="keyword">return</span> r.sismember(<span class="keyword">self</span>.key, tag)
    
    <span class="keyword">def</span> <span class="function">tag_count</span>(<span class="keyword">self</span>):
        <span class="string">"""Get number of tags"""</span>
        <span class="keyword">return</span> r.scard(<span class="keyword">self</span>.key)

<span class="comment"># Usage</span>
article = ArticleTags(<span class="number">12345</span>)

<span class="comment"># Add initial tags</span>
article.add_tags(<span class="string">"python"</span>, <span class="string">"redis"</span>, <span class="string">"tutorial"</span>)
<span class="comment"># Output: ‚úÖ Added 3 new tags</span>

<span class="comment"># Try adding some duplicates</span>
article.add_tags(<span class="string">"python"</span>, <span class="string">"database"</span>, <span class="string">"redis"</span>)
<span class="comment"># Output: ‚úÖ Added 1 new tags (2 were duplicates)</span>

<span class="comment"># Check if article has specific tag</span>
<span class="keyword">if</span> article.has_tag(<span class="string">"python"</span>):
    <span class="keyword">print</span>(<span class="string">"This is a Python tutorial!"</span>)

<span class="comment"># Get all tags</span>
<span class="keyword">print</span>(<span class="string">f"Tags: </span>{article.get_tags()}<span class="string">"</span>)
<span class="comment"># Output: Tags: {'python', 'redis', 'tutorial', 'database'}</span>

<span class="keyword">print</span>(<span class="string">f"Total tags: </span>{article.tag_count()}<span class="string">"</span>)
<span class="comment"># Output: Total tags: 4</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Understanding Return Values</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - SADD Return Value Logic</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Test different SADD scenarios</span>
r.delete(<span class="string">"test_set"</span>)  <span class="comment"># Start fresh</span>

<span class="comment"># Scenario 1: Add to non-existent Set</span>
result = r.sadd(<span class="string">"test_set"</span>, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>)
<span class="keyword">print</span>(<span class="string">f"Added to new Set: </span>{result}<span class="string">"</span>)  <span class="comment"># 3</span>

<span class="comment"># Scenario 2: Add all duplicates</span>
result = r.sadd(<span class="string">"test_set"</span>, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>)
<span class="keyword">print</span>(<span class="string">f"All duplicates: </span>{result}<span class="string">"</span>)  <span class="comment"># 0</span>

<span class="comment"># Scenario 3: Mix of new and existing</span>
result = r.sadd(<span class="string">"test_set"</span>, <span class="string">"a"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>, <span class="string">"b"</span>)
<span class="keyword">print</span>(<span class="string">f"Mixed (a,b exist, d,e new): </span>{result}<span class="string">"</span>)  <span class="comment"># 2</span>

<span class="comment"># Scenario 4: Same value multiple times</span>
result = r.sadd(<span class="string">"test_set"</span>, <span class="string">"f"</span>, <span class="string">"f"</span>, <span class="string">"f"</span>)
<span class="keyword">print</span>(<span class="string">f"Same value 3 times: </span>{result}<span class="string">"</span>)  <span class="comment"># 1 (only counted once!)</span>

<span class="comment"># Final Set contents</span>
members = r.smembers(<span class="string">"test_set"</span>)
<span class="keyword">print</span>(<span class="string">f"Final Set: </span>{members}<span class="string">"</span>)
<span class="comment"># {'a', 'b', 'c', 'd', 'e', 'f'} - 6 unique members</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: If SADD returns 0, does it mean the command failed?</h4>
                <p><strong>A:</strong> No! Return 0 means "successfully executed, but 0 NEW members added" - all members already existed. It's not an error, just means the Set already had those members. Command succeeded.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can I SADD to a key that's not a Set?</h4>
                <p><strong>A:</strong> No! If key exists but is a different type (String, List, Hash), SADD fails with WRONGTYPE error. Example: <code>SET mykey "value"</code> then <code>SADD mykey "item"</code> ‚Üí error. Must be a Set or non-existent.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What's the time complexity of SADD with N members?</h4>
                <p><strong>A:</strong> O(N) where N = number of members to add. Each member is O(1) to add (hash table insertion), so adding 3 members = O(3) = O(N). Still very fast even for thousands of members!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can SADD create a Set automatically?</h4>
                <p><strong>A:</strong> Yes! If key doesn't exist, SADD creates an empty Set first, then adds members. No need for initialization like <code>SCREATE</code> (which doesn't exist). Just SADD and Redis handles the rest!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: How do I know if a specific member was added or already existed?</h4>
                <p><strong>A:</strong> Use SISMEMBER first to check, or if adding one member, SADD return tells you: return=1 means added, return=0 means existed. For multiple members, you'd need to check individually with SISMEMBER before SADD.</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: SADD myset "1" "01" "001" - how many members added?</h4>
                <p><strong>Answer:</strong> 3 members! Strings are compared as-is, not converted to numbers. "1", "01", and "001" are three different strings, so all three are added as unique members. Redis doesn't do type conversion for Set membership.</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: If I SADD 1 million members, what happens?</h4>
                <p><strong>Answer:</strong> Redis will try to add all 1M members, but this might: (1) Take several seconds (blocking other commands), (2) Use significant memory, (3) Potentially hit maxmemory limits. Better approach: batch SADD calls (e.g., 1000 members per call) to avoid blocking Redis too long!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can SADD add empty string ""?</h4>
                <p><strong>Answer:</strong> Yes! Empty string is valid Set member. <code>SADD myset ""</code> returns 1, and Set now contains empty string. You can SISMEMBER myset "" to check. Same with spaces <code>" "</code> - valid member!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Stack Overflow Question Tags</strong></p>
            
            <p>When you ask a question on Stack Overflow, you can add up to 5 tags. The system prevents duplicate tags automatically. How do they implement this?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: SADD Perfect for Tagging</h4>
                
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    SADD question:123456:tags "python" "redis" "database"<br>
                    ‚Üí Returns 3 (all added)
                </code>
                
                <p><strong>User tries to add duplicate:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    SADD question:123456:tags "python"<br>
                    ‚Üí Returns 0 (already exists!)
                </code>
                
                <p><strong>Check tag limit before adding:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    SCARD question:123456:tags  # Get current count<br>
                    ‚Üí If &lt; 5, allow SADD<br>
                    ‚Üí If = 5, reject
                </code>
                
                <p><strong>Why SADD is perfect:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Automatically prevents duplicate tags</li>
                    <li>‚úÖ Return value tells if tag was new or duplicate</li>
                    <li>‚úÖ SCARD gives instant tag count for limit checking</li>
                    <li>‚úÖ O(1) for each tag - scales to millions of questions</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ûï</span><p><strong>SADD = Set ADD</strong> - Adds one or more members to Set</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî¢</span><p><strong>Return value = count of NEW members</strong> - Not total in Set</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üö´</span><p><strong>Duplicates ignored automatically</strong> - SADD same member = return 0</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üÜï</span><p><strong>Auto-creates Set if needed</strong> - No initialization required</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>O(1) per member</strong> - Fast even for bulk adds</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Return 0 is success</strong> - Just means members existed already</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">SADD</span><span class="keyword-tag">Set Add</span><span class="keyword-tag">Return Value</span><span class="keyword-tag">Duplicates</span><span class="keyword-tag">SCARD</span><span class="keyword-tag">SISMEMBER</span><span class="keyword-tag">Auto-create</span><span class="keyword-tag">O(1)</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> What does <code>SADD users "alice" "bob" "alice"</code> return?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) 3 (three items specified)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) 2 (only alice and bob unique)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) 1 (alice counted once total)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Error (duplicate detected)</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Returns 2</strong>
                    <p>SADD return value = number of NEW members actually added. Even though 3 items were specified, only "alice" and "bob" are unique members. The duplicate "alice" is automatically ignored. Return value: 2 (not 3, not 1). The Set now contains exactly 2 members: {alice, bob}.</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 30: Real-world use case of Redis Set
// ============================================================

function getQuestion30Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Product manager asks dev team:</strong> "We need to show 'Users who viewed this product also viewed...' Can we use our MySQL database?" Tech lead responds: "That would require complex JOIN queries taking seconds! Let's use Redis Sets instead - instant results!"</p>
            <p>But how exactly do Sets solve this problem?</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Sets excel at tracking unique relationships, memberships, and performing set operations (union, intersection, difference) in real-time.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Top Real-World Use Cases</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Use Case</th><th style="padding: 10px;">Why Set?</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">Tags/Labels</td><td>Unique, no order needed</td><td>Article tags, product categories</td></tr>
                    <tr><td style="padding: 8px;">Likes/Votes</td><td>No duplicate votes, instant check</td><td>Post likes, poll voting</td></tr>
                    <tr><td style="padding: 8px;">Online Users</td><td>Track active users uniquely</td><td>Who's online now</td></tr>
                    <tr><td style="padding: 8px;">Followers/Friends</td><td>Unique relationships</td><td>Social network connections</td></tr>
                    <tr><td style="padding: 8px;">Recommendations</td><td>Set operations (SINTER)</td><td>Similar products/users</td></tr>
                    <tr><td style="padding: 8px;">IP Blacklist</td><td>O(1) membership check</td><td>Ban list, rate limiting</td></tr>
                    <tr><td style="padding: 8px;">Unique Visitors</td><td>Count unique IPs/users</td><td>Analytics, tracking</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° When to Use Sets:</strong></p>
                <ul>
                    <li><strong>Need uniqueness</strong> - Can't have duplicates</li>
                    <li><strong>Fast membership checks</strong> - "Is X in the set?" must be instant (O(1))</li>
                    <li><strong>Set operations</strong> - Find common elements, combine sets, subtract sets</li>
                    <li><strong>Don't care about order</strong> - Sequence doesn't matter</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Real-World Example: Online Store Product Recommendations</div>
                <svg viewBox="0 0 900 600" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">"Customers Who Viewed This Also Viewed..."</text>
                    
                    <!-- Product A Viewers -->
                    <text x="150" y="80" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">Product A: Laptop</text>
                    <rect x="50" y="95" width="200" height="120" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="150" y="115" text-anchor="middle" fill="#DC143C" font-size="11" font-weight="600">viewed_product:123</text>
                    <text x="70" y="140" fill="#fff" font-size="10">‚Ä¢ user_101</text>
                    <text x="70" y="160" fill="#fff" font-size="10">‚Ä¢ user_102</text>
                    <text x="70" y="180" fill="#fff" font-size="10">‚Ä¢ user_103</text>
                    <text x="70" y="200" fill="#fff" font-size="10">‚Ä¢ user_104</text>
                    
                    <!-- Product B Viewers -->
                    <text x="450" y="80" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">Product B: Mouse</text>
                    <rect x="350" y="95" width="200" height="120" fill="rgba(0, 255, 136, 0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="115" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">viewed_product:456</text>
                    <text x="370" y="140" fill="#fff" font-size="10">‚Ä¢ user_102</text>
                    <text x="370" y="160" fill="#fff" font-size="10">‚Ä¢ user_103</text>
                    <text x="370" y="180" fill="#fff" font-size="10">‚Ä¢ user_105</text>
                    <text x="370" y="200" fill="#fff" font-size="10">‚Ä¢ user_106</text>
                    
                    <!-- Product C Viewers -->
                    <text x="750" y="80" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">Product C: Keyboard</text>
                    <rect x="650" y="95" width="200" height="120" fill="rgba(156, 39, 176, 0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="750" y="115" text-anchor="middle" fill="#9C27B0" font-size="11" font-weight="600">viewed_product:789</text>
                    <text x="670" y="140" fill="#fff" font-size="10">‚Ä¢ user_101</text>
                    <text x="670" y="160" fill="#fff" font-size="10">‚Ä¢ user_103</text>
                    <text x="670" y="180" fill="#fff" font-size="10">‚Ä¢ user_104</text>
                    <text x="670" y="200" fill="#fff" font-size="10">‚Ä¢ user_107</text>
                    
                    <!-- Set Operations -->
                    <rect x="50" y="250" width="800" height="300" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="280" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">‚ö° Set Operations for Recommendations</text>
                    
                    <!-- SINTER Example -->
                    <text x="80" y="310" fill="#00FF88" font-size="13" font-weight="600">1. Common viewers (who saw both A and B):</text>
                    <code style="font-family: monospace;">
                        <text x="90" y="330" fill="#FFA500" font-size="11">SINTER viewed_product:123 viewed_product:456</text>
                    </code>
                    <text x="90" y="350" fill="#fff" font-size="10">Result: {user_102, user_103}</text>
                    <text x="90" y="365" fill="#888" font-size="9">‚Üí These 2 users viewed BOTH products</text>
                    
                    <!-- SUNION Example -->
                    <text x="80" y="395" fill="#00FF88" font-size="13" font-weight="600">2. All viewers (anyone who saw A or B):</text>
                    <code style="font-family: monospace;">
                        <text x="90" y="415" fill="#FFA500" font-size="11">SUNION viewed_product:123 viewed_product:456</text>
                    </code>
                    <text x="90" y="435" fill="#fff" font-size="10">Result: {user_101, 102, 103, 104, 105, 106}</text>
                    <text x="90" y="450" fill="#888" font-size="9">‚Üí 6 unique users saw either product</text>
                    
                    <!-- SDIFF Example -->
                    <text x="80" y="480" fill="#00FF88" font-size="13" font-weight="600">3. Exclusive viewers (saw A but NOT B):</text>
                    <code style="font-family: monospace;">
                        <text x="90" y="500" fill="#FFA500" font-size="11">SDIFF viewed_product:123 viewed_product:456</text>
                    </code>
                    <text x="90" y="520" fill="#fff" font-size="10">Result: {user_101, user_104}</text>
                    <text x="90" y="535" fill="#888" font-size="9">‚Üí Recommend product B to these users!</text>
                    
                    <!-- Benefit Box -->
                    <rect x="500" y="300" width="330" height="230" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="665" y="325" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">‚úÖ Why Sets Are Perfect:</text>
                    <text x="520" y="350" fill="#bbb" font-size="10">‚Ä¢ O(1) to add viewer to set</text>
                    <text x="520" y="370" fill="#bbb" font-size="10">‚Ä¢ O(1) to check if user viewed</text>
                    <text x="520" y="390" fill="#bbb" font-size="10">‚Ä¢ SINTER finds common viewers instantly</text>
                    <text x="520" y="410" fill="#bbb" font-size="10">‚Ä¢ No duplicate viewers automatically</text>
                    <text x="520" y="430" fill="#bbb" font-size="10">‚Ä¢ Scales to millions of users</text>
                    <text x="520" y="450" fill="#bbb" font-size="10">‚Ä¢ Real-time recommendations</text>
                    <text x="520" y="475" fill="#FFA500" font-size="11" font-weight="600">SQL alternative = complex JOINs</text>
                    <text x="520" y="495" fill="#FFA500" font-size="11" font-weight="600">taking seconds, not milliseconds!</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Product Recommendation System</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - E-commerce Recommendations</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">ProductRecommendations</span>:
    <span class="keyword">def</span> <span class="function">track_view</span>(<span class="keyword">self</span>, user_id, product_id):
        <span class="string">"""Track that user viewed a product"""</span>
        key = <span class="string">f"viewed:product:</span>{product_id}<span class="string">"</span>
        r.sadd(key, user_id)
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Tracked: User </span>{user_id}<span class="string"> viewed product </span>{product_id}<span class="string">"</span>)
    
    <span class="keyword">def</span> <span class="function">also_viewed</span>(<span class="keyword">self</span>, product_id, limit=<span class="number">5</span>):
        <span class="string">"""Get products often viewed together"""</span>
        key = <span class="string">f"viewed:product:</span>{product_id}<span class="string">"</span>
        viewers = r.smembers(key)
        
        <span class="keyword">if</span> <span class="keyword">not</span> viewers:
            <span class="keyword">return</span> []
        
        <span class="comment"># Find products these viewers also saw</span>
        recommendations = {}
        <span class="keyword">for</span> viewer <span class="keyword">in</span> viewers:
            <span class="comment"># Get all products this viewer saw</span>
            viewed_keys = r.keys(<span class="string">f"viewed:product:*"</span>)
            <span class="keyword">for</span> viewed_key <span class="keyword">in</span> viewed_keys:
                <span class="keyword">if</span> r.sismember(viewed_key, viewer):
                    other_product = viewed_key.split(<span class="string">":"</span>)[<span class="number">2</span>]
                    <span class="keyword">if</span> other_product != product_id:
                        recommendations[other_product] = recommendations.get(other_product, <span class="number">0</span>) + <span class="number">1</span>
        
        <span class="comment"># Sort by frequency, return top N</span>
        sorted_recs = <span class="function">sorted</span>(recommendations.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>], reverse=<span class="keyword">True</span>)
        <span class="keyword">return</span> [prod_id <span class="keyword">for</span> prod_id, count <span class="keyword">in</span> sorted_recs[:limit]]
    
    <span class="keyword">def</span> <span class="function">common_viewers</span>(<span class="keyword">self</span>, product1, product2):
        <span class="string">"""Find users who viewed both products"""</span>
        key1 = <span class="string">f"viewed:product:</span>{product1}<span class="string">"</span>
        key2 = <span class="string">f"viewed:product:</span>{product2}<span class="string">"</span>
        
        <span class="comment"># SINTER returns common members</span>
        common = r.sinter(key1, key2)
        <span class="keyword">return</span> common

<span class="comment"># Usage</span>
recs = ProductRecommendations()

<span class="comment"># Simulate user behavior</span>
recs.track_view(<span class="string">"user_101"</span>, <span class="string">"laptop_123"</span>)
recs.track_view(<span class="string">"user_101"</span>, <span class="string">"mouse_456"</span>)
recs.track_view(<span class="string">"user_102"</span>, <span class="string">"laptop_123"</span>)
recs.track_view(<span class="string">"user_102"</span>, <span class="string">"mouse_456"</span>)
recs.track_view(<span class="string">"user_102"</span>, <span class="string">"keyboard_789"</span>)

<span class="comment"># Find common viewers</span>
common = recs.common_viewers(<span class="string">"laptop_123"</span>, <span class="string">"mouse_456"</span>)
<span class="keyword">print</span>(<span class="string">f"Users who viewed both: </span>{common}<span class="string">"</span>)
<span class="comment"># Output: {'user_101', 'user_102'}</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Online Users Tracking</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Real-Time Active Users</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">OnlineUsers</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>):
        <span class="keyword">self</span>.key = <span class="string">"users:online"</span>
    
    <span class="keyword">def</span> <span class="function">mark_online</span>(<span class="keyword">self</span>, user_id):
        <span class="string">"""Mark user as online"""</span>
        r.sadd(<span class="keyword">self</span>.key, user_id)
        <span class="comment"># Set expiry on user's activity key</span>
        r.setex(<span class="string">f"user:</span>{user_id}<span class="string">:active"</span>, <span class="number">300</span>, <span class="string">"1"</span>)  <span class="comment"># 5 min TTL</span>
    
    <span class="keyword">def</span> <span class="function">mark_offline</span>(<span class="keyword">self</span>, user_id):
        <span class="string">"""Mark user as offline"""</span>
        r.srem(<span class="keyword">self</span>.key, user_id)
    
    <span class="keyword">def</span> <span class="function">is_online</span>(<span class="keyword">self</span>, user_id):
        <span class="string">"""Check if specific user is online - O(1)!"""</span>
        <span class="keyword">return</span> r.sismember(<span class="keyword">self</span>.key, user_id)
    
    <span class="keyword">def</span> <span class="function">count_online</span>(<span class="keyword">self</span>):
        <span class="string">"""Get count of online users"""</span>
        <span class="keyword">return</span> r.scard(<span class="keyword">self</span>.key)
    
    <span class="keyword">def</span> <span class="function">get_all_online</span>(<span class="keyword">self</span>):
        <span class="string">"""Get all online users"""</span>
        <span class="keyword">return</span> r.smembers(<span class="keyword">self</span>.key)
    
    <span class="keyword">def</span> <span class="function">cleanup_stale</span>(<span class="keyword">self</span>):
        <span class="string">"""Remove users who haven't been active"""</span>
        online_users = <span class="keyword">self</span>.get_all_online()
        stale_count = <span class="number">0</span>
        
        <span class="keyword">for</span> user_id <span class="keyword">in</span> online_users:
            <span class="comment"># Check if activity key exists</span>
            <span class="keyword">if</span> <span class="keyword">not</span> r.exists(<span class="string">f"user:</span>{user_id}<span class="string">:active"</span>):
                <span class="keyword">self</span>.mark_offline(user_id)
                stale_count += <span class="number">1</span>
        
        <span class="keyword">return</span> stale_count

<span class="comment"># Usage</span>
online = OnlineUsers()

<span class="comment"># Users come online</span>
online.mark_online(<span class="string">"alice"</span>)
online.mark_online(<span class="string">"bob"</span>)
online.mark_online(<span class="string">"charlie"</span>)

<span class="keyword">print</span>(<span class="string">f"Online users: </span>{online.count_online()}<span class="string">"</span>)  <span class="comment"># 3</span>
<span class="keyword">print</span>(<span class="string">f"Is Alice online? </span>{online.is_online(<span class="string">'alice'</span>)}<span class="string">"</span>)  <span class="comment"># True</span>

<span class="comment"># Bob goes offline</span>
online.mark_offline(<span class="string">"bob"</span>)
<span class="keyword">print</span>(<span class="string">f"Online now: </span>{online.get_all_online()}<span class="string">"</span>)  <span class="comment"># {'alice', 'charlie'}</span>

<span class="comment"># Why Sets are perfect:</span>
<span class="comment"># ‚Ä¢ No duplicate "online" status</span>
<span class="comment"># ‚Ä¢ O(1) to check if user online</span>
<span class="comment"># ‚Ä¢ Instant count with SCARD</span>
<span class="comment"># ‚Ä¢ Easy to show "Who's online" list</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why not use Lists for likes/followers instead of Sets?</h4>
                <p><strong>A:</strong> Lists allow duplicates (user could "like" multiple times) and checking "did user X like this?" requires O(N) scan of entire list. Sets prevent duplicates automatically and provide O(1) membership checks. For 1M likes, Set check = instant, List check = seconds!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can Sets handle millions of members?</h4>
                <p><strong>A:</strong> Yes! Sets use hash tables internally, so operations remain O(1) even with millions of members. Instagram uses Sets to track billions of likes. Memory is the limit, not performance. Each member ~100 bytes, so 1M members ‚âà 100MB.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: How do social networks use Sets for "mutual friends"?</h4>
                <p><strong>A:</strong> Each user has a Set of friends. Mutual friends = SINTER user1:friends user2:friends. Example: Alice has 500 friends, Bob has 600 friends ‚Üí SINTER finds 50 common friends in milliseconds. SQL alternative requires complex JOINs!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Real-world: Rate limiting with Sets?</h4>
                <p><strong>A:</strong> Track unique API requests: SADD rate_limit:user123:2024-01-08:14 request_id. Use SCARD to count requests this hour. If < limit, allow. If ‚â• limit, reject. Set expires after 1 hour. Simple, fast, prevents duplicate counting!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: When would Sets NOT be the right choice?</h4>
                <p><strong>A:</strong> When you need: (1) Order/ranking (use Sorted Set), (2) Duplicate tracking (use List), (3) Numeric calculations (use Strings with INCR), (4) Complex relationships (use Hashes). Sets are for simple membership only!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Twitter has 500M users. How do they track "Online now" without using 500M  Set members?</h4>
                <p><strong>Answer:</strong> They don't store ALL users in one Set! Instead: (1) Only active users (past 5 min) are in "online" Set, (2) Use TTL to auto-remove inactive users, (3) Typical online Set has 1-5M members, not 500M. Sets scale, but smart design reduces size!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I use SINTER on 100 Sets at once?</h4>
                <p><strong>Answer:</strong> Technically yes, but don't! SINTER is O(N*M) where N=smallest Set size, M=number of Sets. With 100 Sets of 1000 members each = millions of operations, blocking Redis for seconds. Limit to 2-5 Sets per SINTER. For more, use Lua scripting or client-side processing!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Sets are unordered. How does Twitter show followers in order?</h4>
                <p><strong>Answer:</strong> Twitter uses TWO data structures: (1) Set for fast "is X following Y?" checks (O(1)), (2) Sorted Set (by timestamp) for ordered follower list. Dual storage trades memory for speed. Alternative: Store only Set, sort client-side when displaying!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: GitHub Repository Stars</strong></p>
            
            <p>GitHub lets users "star" repositories. A popular repo might have 100K+ stars. How do they implement this efficiently?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Sets for Stars</h4>
                
                <p><strong>Data Structure:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    Key: repo:{repo_id}:stars<br>
                    Members: user IDs who starred
                </code>
                
                <p><strong>Operations:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>Star repo:</strong> SADD repo:123:stars user_456 (returns 1 if new star, 0 if already starred)</li>
                    <li><strong>Unstar:</strong> SREM repo:123:stars user_456</li>
                    <li><strong>Check if starred:</strong> SISMEMBER repo:123:stars user_456 (instant!)</li>
                    <li><strong>Get star count:</strong> SCARD repo:123:stars (instant!)</li>
                    <li><strong>Find common stars:</strong> SINTER repo:A:stars repo:B:stars (who starred both?)</li>
                </ul>
                
                <p><strong>Why Sets win:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ No duplicate stars (user can't star twice)</li>
                    <li>‚úÖ O(1) check "did user star this?"</li>
                    <li>‚úÖ O(1) star count for display</li>
                    <li>‚úÖ Set operations find related repos</li>
                    <li>‚úÖ Scales to millions of stars per repo</li>
                </ul>
            </div>

            <p><strong>Performance:</strong> GitHub handles millions of stars/day, all checks complete in < 1ms using Sets!</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üë•</span><p><strong>Perfect for memberships</strong> - Likes, followers, tags, online users</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üö´</span><p><strong>Auto-prevents duplicates</strong> - Can't like twice, can't follow twice</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>O(1) membership checks</strong> - Instant "is X in set?" queries</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Set operations built-in</strong> - SINTER, SUNION, SDIFF for recommendations</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Scales to millions</strong> - Instagram, Twitter, GitHub use for billions of relationships</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üí∞</span><p><strong>Cheaper than SQL JOINs</strong> - Milliseconds vs seconds, less server load</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Likes/Votes</span><span class="keyword-tag">Followers</span><span class="keyword-tag">Tags</span><span class="keyword-tag">Online Users</span><span class="keyword-tag">Recommendations</span><span class="keyword-tag">SINTER</span><span class="keyword-tag">SUNION</span><span class="keyword-tag">Unique</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You need to show "Users who bought this product also bought..." Which Redis approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) List for each product with buyer IDs</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Set for each product, use SINTER to find common buyers</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Sorted Set with purchase timestamps</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Hash mapping product to buyer count</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Set with SINTER</strong>
                    <p>Create Set for each product: <code>bought:product:123 ‚Üí {user_1, user_2, ...}</code>. To find recommendations: SINTER finds buyers who bought BOTH products. Then look up what else they bought. Sets provide O(1) membership checks and fast set operations. Lists would require O(N) scans, Hashes can't do set operations!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 31: What is a Sorted Set?
// ============================================================

function getQuestion31Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Developer Amy is frustrated:</strong> "I'm building a leaderboard. Regular Sets don't have order, Lists allow duplicates and are slow to sort. What do I use?" Tech lead smiles: "You need a Sorted Set - it's like a Set with rankings built-in!"</p>
            <p>But what exactly is a Sorted Set and how does it work?</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>A Sorted Set (ZSET) is a Redis data structure that stores unique members, each associated with a numeric score. Members are automatically sorted by score in ascending order.</strong></p>
            
            <p>Think of it as: <strong>Set (uniqueness) + List (order) + Score (ranking)</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Sorted Set Characteristics</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Feature</th><th style="padding: 10px;">Behavior</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">Members</td><td>Unique (no duplicates)</td><td>Each player ID appears once</td></tr>
                    <tr><td style="padding: 8px;">Score</td><td>Numeric value per member</td><td>Player score: 1500 points</td></tr>
                    <tr><td style="padding: 8px;">Order</td><td>Auto-sorted by score (ascending)</td><td>Lowest score first, highest last</td></tr>
                    <tr><td style="padding: 8px;">Access</td><td>By rank or by score range</td><td>Top 10, scores 1000-2000</td></tr>
                    <tr><td style="padding: 8px;">Update</td><td>ZADD updates score if exists</td><td>New score replaces old</td></tr>
                    <tr><td style="padding: 8px;">Commands</td><td>Z-prefix (ZADD, ZRANGE, etc)</td><td>Z = sorted Set</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Key Differences:</strong></p>
                <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <tr style="background: rgba(0,255,136,0.1);"><th style="padding: 8px; text-align: left;">Feature</th><th style="padding: 8px;">List</th><th style="padding: 8px;">Set</th><th style="padding: 8px;">Sorted Set</th></tr>
                    <tr><td style="padding: 6px;">Duplicates</td><td>‚úÖ Yes</td><td>‚ùå No</td><td>‚ùå No</td></tr>
                    <tr><td style="padding: 6px;">Order</td><td>‚úÖ Insertion</td><td>‚ùå None</td><td>‚úÖ By score</td></tr>
                    <tr><td style="padding: 6px;">Score/Weight</td><td>‚ùå No</td><td>‚ùå No</td><td>‚úÖ Yes</td></tr>
                    <tr><td style="padding: 6px;">Access by Index</td><td>‚úÖ Yes</td><td>‚ùå No</td><td>‚úÖ Yes (rank)</td></tr>
                    <tr><td style="padding: 6px;">Use Case</td><td>Queue</td><td>Tags</td><td>Leaderboard</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Sorted Set Internal Structure</div>
                <svg viewBox="0 0 900 550" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Sorted Set: Members + Scores + Auto-Sorting</text>
                    
                    <!-- Sorted Set Visualization -->
                    <rect x="50" y="60" width="800" height="250" fill="rgba(220, 20, 60, 0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">Game Leaderboard (Sorted Set: "leaderboard")</text>
                    
                    <!-- Member Boxes -->
                    <g id="member1">
                        <rect x="80" y="120" width="140" height="80" fill="rgba(255, 165, 0, 0.3)" stroke="#FFA500" stroke-width="2" rx="6"/>
                        <text x="150" y="145" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">Rank #1</text>
                        <text x="150" y="165" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">player_alice</text>
                        <text x="150" y="185" text-anchor="middle" fill="#FFA500" font-size="12">Score: 2500</text>
                    </g>
                    
                    <g id="member2">
                        <rect x="240" y="120" width="140" height="80" fill="rgba(255, 165, 0, 0.25)" stroke="#FFA500" stroke-width="2" rx="6"/>
                        <text x="310" y="145" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">Rank #2</text>
                        <text x="310" y="165" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">player_bob</text>
                        <text x="310" y="185" text-anchor="middle" fill="#FFA500" font-size="12">Score: 2300</text>
                    </g>
                    
                    <g id="member3">
                        <rect x="400" y="120" width="140" height="80" fill="rgba(255, 165, 0, 0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                        <text x="470" y="145" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">Rank #3</text>
                        <text x="470" y="165" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">player_charlie</text>
                        <text x="470" y="185" text-anchor="middle" fill="#FFA500" font-size="12">Score: 1800</text>
                    </g>
                    
                    <g id="member4">
                        <rect x="560" y="120" width="140" height="80" fill="rgba(255, 165, 0, 0.15)" stroke="#FFA500" stroke-width="2" rx="6"/>
                        <text x="630" y="145" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">Rank #4</text>
                        <text x="630" y="165" text-anchor="middle" fill="#fff" font-size="13" font-weight="700">player_diana</text>
                        <text x="630" y="185" text-anchor="middle" fill="#FFA500" font-size="12">Score: 1500</text>
                    </g>
                    
                    <g id="member5">
                        <rect x="720" y="120" width="110" height="80" fill="rgba(255, 165, 0, 0.1)" stroke="#FFA500" stroke-width="2" rx="6"/>
                        <text x="775" y="145" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">Rank #5</text>
                        <text x="775" y="165" text-anchor="middle" fill="#fff" font-size="12">...</text>
                        <text x="775" y="185" text-anchor="middle" fill="#888" font-size="10">more players</text>
                    </g>
                    
                    <!-- Arrows showing sorting -->
                    <text x="450" y="230" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">‚Üë Automatically sorted by score (highest score = lowest rank) ‚Üë</text>
                    <text x="450" y="250" text-anchor="middle" fill="#888" font-size="10">Updated in real-time when scores change!</text>
                    <text x="450" y="290" text-anchor="middle" fill="#666" font-size="10" font-style="italic">Access by rank: ZRANGE leaderboard 0 2 (top 3) or by score: ZRANGEBYSCORE leaderboard 2000 3000</text>
                    
                    <!-- Operations Examples -->
                    <rect x="50" y="330" width="800" height="200" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="360" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">Common Operations</text>
                    
                    <!-- Left Column -->
                    <text x="80" y="390" fill="#00FF88" font-size="12" font-weight="600">Add/Update Score:</text>
                    <code style="font-family: monospace;">
                        <text x="90" y="410" fill="#FFA500" font-size="10">ZADD leaderboard 2500 "alice"</text>
                    </code>
                    <text x="90" y="425" fill="#888" font-size="9">‚Üí Adds alice with score 2500</text>
                    <text x="90" y="438" fill="#888" font-size="9">‚Üí If alice exists, updates score</text>
                    
                    <text x="80" y="465" fill="#00FF88" font-size="12" font-weight="600">Get Top Players:</text>
                    <code style="font-family: monospace;">
                        <text x="90" y="485" fill="#FFA500" font-size="10">ZRANGE leaderboard 0 9</text>
                    </code>
                    <text x="90" y="500" fill="#888" font-size="9">‚Üí Returns top 10 players</text>
                    <text x="90" y="513" fill="#888" font-size="9">‚Üí Sorted by score (asc)</text>
                    
                    <!-- Right Column -->
                    <text x="480" y="390" fill="#00FF88" font-size="12" font-weight="600">Get Player Rank:</text>
                    <code style="font-family: monospace;">
                        <text x="490" y="410" fill="#FFA500" font-size="10">ZRANK leaderboard "alice"</text>
                    </code>
                    <text x="490" y="425" fill="#888" font-size="9">‚Üí Returns alice's position</text>
                    <text x="490" y="438" fill="#888" font-size="9">‚Üí 0-based index (0 = first)</text>
                    
                    <text x="480" y="465" fill="#00FF88" font-size="12" font-weight="600">Get Score Range:</text>
                    <code style="font-family: monospace;">
                        <text x="490" y="485" fill="#FFA500" font-size="10">ZRANGEBYSCORE leaderboard 2000 3000</text>
                    </code>
                    <text x="490" y="500" fill="#888" font-size="9">‚Üí Players with score 2000-3000</text>
                    <text x="490" y="513" fill="#888" font-size="9">‚Üí Useful for filtering by tier</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Sorted Set Operations</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Sorted Set Basics</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Create game leaderboard</span>
<span class="keyword">ZADD</span> <span class="string">game_scores</span> <span class="number">1500</span> <span class="string">"alice"</span>
<span class="number">(integer) 1</span>  <span class="comment"># 1 member added</span>

<span class="keyword">ZADD</span> <span class="string">game_scores</span> <span class="number">2000</span> <span class="string">"bob"</span> <span class="number">1800</span> <span class="string">"charlie"</span>
<span class="number">(integer) 2</span>  <span class="comment"># 2 members added</span>

<span class="comment"># Get all members with scores (ascending order)</span>
<span class="keyword">ZRANGE</span> <span class="string">game_scores</span> <span class="number">0</span> <span class="number">-1</span> <span class="keyword">WITHSCORES</span>
<span class="number">1)</span> <span class="string">"alice"</span>
<span class="number">2)</span> <span class="string">"1500"</span>
<span class="number">3)</span> <span class="string">"charlie"</span>
<span class="number">4)</span> <span class="string">"1800"</span>
<span class="number">5)</span> <span class="string">"bob"</span>
<span class="number">6)</span> <span class="string">"2000"</span>

<span class="comment"># Get top 3 (highest scores) - use ZREVRANGE for descending</span>
<span class="keyword">ZREVRANGE</span> <span class="string">game_scores</span> <span class="number">0</span> <span class="number">2</span> <span class="keyword">WITHSCORES</span>
<span class="number">1)</span> <span class="string">"bob"</span>     <span class="comment"># Rank 1 (highest)</span>
<span class="number">2)</span> <span class="string">"2000"</span>
<span class="number">3)</span> <span class="string">"charlie"</span> <span class="comment"># Rank 2</span>
<span class="number">4)</span> <span class="string">"1800"</span>
<span class="number">5)</span> <span class="string">"alice"</span>   <span class="comment"># Rank 3</span>
<span class="number">6)</span> <span class="string">"1500"</span>

<span class="comment"># Get alice's score</span>
<span class="keyword">ZSCORE</span> <span class="string">game_scores</span> <span class="string">"alice"</span>
<span class="string">"1500"</span>

<span class="comment"># Get alice's rank (0-based, higher score = lower rank number)</span>
<span class="keyword">ZREVRANK</span> <span class="string">game_scores</span> <span class="string">"alice"</span>
<span class="number">(integer) 2</span>  <span class="comment"># Rank 3 (0-based = 2)</span>

<span class="comment"># Update alice's score</span>
<span class="keyword">ZADD</span> <span class="string">game_scores</span> <span class="number">2500</span> <span class="string">"alice"</span>
<span class="number">(integer) 0</span>  <span class="comment"># 0 = member existed, score updated</span>

<span class="comment"># Now alice is rank 1!</span>
<span class="keyword">ZREVRANK</span> <span class="string">game_scores</span> <span class="string">"alice"</span>
<span class="number">(integer) 0</span>  <span class="comment"># Rank 1 (0-based)</span>

<span class="comment"># Count members</span>
<span class="keyword">ZCARD</span> <span class="string">game_scores</span>
<span class="number">(integer) 3</span>

<span class="comment"># Get members with scores between 1500-2000</span>
<span class="keyword">ZRANGEBYSCORE</span> <span class="string">game_scores</span> <span class="number">1500</span> <span class="number">2000</span>
<span class="number">1)</span> <span class="string">"charlie"</span>
<span class="number">2)</span> <span class="string">"bob"</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Gaming Leaderboard Implementation</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Real-Time Leaderboard</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">GameLeaderboard</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, game_id):
        <span class="keyword">self</span>.key = <span class="string">f"leaderboard:</span>{game_id}<span class="string">"</span>
    
    <span class="keyword">def</span> <span class="function">update_score</span>(<span class="keyword">self</span>, player_id, score):
        <span class="string">"""Add/update player score"""</span>
        r.zadd(<span class="keyword">self</span>.key, {player_id: score})
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Updated </span>{player_id}<span class="string"> score to </span>{score}<span class="string">"</span>)
    
    <span class="keyword">def</span> <span class="function">increment_score</span>(<span class="keyword">self</span>, player_id, points):
        <span class="string">"""Add points to existing score"""</span>
        new_score = r.zincrby(<span class="keyword">self</span>.key, points, player_id)
        <span class="keyword">print</span>(<span class="string">f"‚úÖ </span>{player_id}<span class="string"> earned </span>{points}<span class="string"> points, total: </span>{new_score}<span class="string">"</span>)
        <span class="keyword">return</span> <span class="function">float</span>(new_score)
    
    <span class="keyword">def</span> <span class="function">get_top_players</span>(<span class="keyword">self</span>, count=<span class="number">10</span>):
        <span class="string">"""Get top N players with scores"""</span>
        <span class="comment"># ZREVRANGE gets highest scores first</span>
        players = r.zrevrange(<span class="keyword">self</span>.key, <span class="number">0</span>, count - <span class="number">1</span>, withscores=<span class="keyword">True</span>)
        <span class="keyword">return</span> [(player, <span class="function">int</span>(score)) <span class="keyword">for</span> player, score <span class="keyword">in</span> players]
    
    <span class="keyword">def</span> <span class="function">get_player_rank</span>(<span class="keyword">self</span>, player_id):
        <span class="string">"""Get player's rank (1-based)"""</span>
        rank = r.zrevrank(<span class="keyword">self</span>.key, player_id)
        <span class="keyword">if</span> rank <span class="keyword">is</span> <span class="keyword">None</span>:
            <span class="keyword">return</span> <span class="keyword">None</span>
        <span class="keyword">return</span> rank + <span class="number">1</span>  <span class="comment"># Convert to 1-based</span>
    
    <span class="keyword">def</span> <span class="function">get_player_score</span>(<span class="keyword">self</span>, player_id):
        <span class="string">"""Get player's current score"""</span>
        score = r.zscore(<span class="keyword">self</span>.key, player_id)
        <span class="keyword">return</span> <span class="function">int</span>(score) <span class="keyword">if</span> score <span class="keyword">else</span> <span class="number">0</span>
    
    <span class="keyword">def</span> <span class="function">get_player_stats</span>(<span class="keyword">self</span>, player_id):
        <span class="string">"""Get comprehensive player stats"""</span>
        score = <span class="keyword">self</span>.get_player_score(player_id)
        rank = <span class="keyword">self</span>.get_player_rank(player_id)
        total_players = r.zcard(<span class="keyword">self</span>.key)
        
        <span class="keyword">return</span> {
            <span class="string">'player_id'</span>: player_id,
            <span class="string">'score'</span>: score,
            <span class="string">'rank'</span>: rank,
            <span class="string">'total_players'</span>: total_players,
            <span class="string">'top_percent'</span>: <span class="function">round</span>((rank / total_players) * <span class="number">100</span>, <span class="number">2</span>) <span class="keyword">if</span> rank <span class="keyword">else</span> <span class="number">0</span>
        }

<span class="comment"># Usage</span>
leaderboard = GameLeaderboard(<span class="string">"space_invaders"</span>)

<span class="comment"># Players get scores</span>
leaderboard.update_score(<span class="string">"alice"</span>, <span class="number">1500</span>)
leaderboard.update_score(<span class="string">"bob"</span>, <span class="number">2000</span>)
leaderboard.update_score(<span class="string">"charlie"</span>, <span class="number">1800</span>)
leaderboard.update_score(<span class="string">"diana"</span>, <span class="number">2500</span>)

<span class="comment"># Alice earns more points</span>
leaderboard.increment_score(<span class="string">"alice"</span>, <span class="number">1200</span>)  <span class="comment"># Now 2700!</span>

<span class="comment"># Get top 3</span>
top_players = leaderboard.get_top_players(<span class="number">3</span>)
<span class="keyword">print</span>(<span class="string">"\\nüèÜ Top 3 Players:"</span>)
<span class="keyword">for</span> rank, (player, score) <span class="keyword">in</span> <span class="function">enumerate</span>(top_players, <span class="number">1</span>):
    <span class="keyword">print</span>(<span class="string">f"  {rank}. {player}: {score} points"</span>)

<span class="comment"># Get alice's stats</span>
stats = leaderboard.get_player_stats(<span class="string">"alice"</span>)
<span class="keyword">print</span>(<span class="string">f"\\nüë§ Alice's Stats:"</span>)
<span class="keyword">print</span>(<span class="string">f"  Score: {stats['score']}"</span>)
<span class="keyword">print</span>(<span class="string">f"  Rank: #{stats['rank']} of {stats['total_players']}"</span>)
<span class="keyword">print</span>(<span class="string">f"  Top {stats['top_percent']}% of players"</span>)

<span class="comment"># Output:</span>
<span class="comment"># üèÜ Top 3 Players:</span>
<span class="comment">#   1. alice: 2700 points</span>
<span class="comment">#   2. diana: 2500 points</span>
<span class="comment">#   3. bob: 2000 points</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: What happens if I ZADD same member with different score?</h4>
                <p><strong>A:</strong> Score gets updated! <code>ZADD leaderboard 100 "alice"</code> then <code>ZADD leaderboard 200 "alice"</code> ‚Üí alice now has score 200. ZADD returns 0 (not 1) when updating existing member. Member stays unique, score changes.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can multiple members have the same score?</h4>
                <p><strong>A:</strong> Yes! Scores can be identical. Members with same score are sorted lexicographically (alphabetically) by member name. Example: both "alice" and "bob" have score 100 ‚Üí sorted alphabetically: alice first, bob second.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Performance: How fast is ZADD and ZRANGE?</h4>
                <p><strong>A:</strong> Both O(log N)! Sorted Sets use skip list internally. For 1M members: ZADD takes ~20 operations, ZRANGE for 10 items takes ~30 operations. Much faster than sorting a List (O(N log N)). Scales excellently!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can scores be negative or decimal?</h4>
                <p><strong>A:</strong> Yes to both! Scores are 64-bit IEEE 754 floating point. You can use negative scores (e.g., for priority queues where lower = better), decimals (1.5, 2.75), or very large numbers. Range: ¬±1.7E308.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: ZRANGE vs ZREVRANGE - when to use which?</h4>
                <p><strong>A:</strong> ZRANGE returns ascending order (lowest score first). ZREVRANGE returns descending (highest score first). For leaderboards showing "top players", use ZREVRANGE. For "bottom players" or "lowest prices", use ZRANGE. Both are O(log N + M) where M = items returned.</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I use Sorted Set as a priority queue?</h4>
                <p><strong>Answer:</strong> Yes! Use score as priority (lower score = higher priority). <code>ZPOPMIN</code> (Redis 5.0+) removes and returns member with lowest score. Perfect for task scheduling: urgent tasks get score 1, normal tasks get score 5, low priority get score 10. Always process lowest score first!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: What's the max size of a Sorted Set?</h4>
                <p><strong>Answer:</strong> Theoretically 2^32 - 1 (4 billion members), but practically limited by memory. Each member uses ~40-100 bytes depending on key/member size. For 1M members with 20-byte keys ‚âà 60-100MB. For leaderboards with millions of players, consider sharding or keeping only top N players.</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: How to store timestamps in Sorted Set?</h4>
                <p><strong>Answer:</strong> Use Unix timestamp as score! Example: store user activity with timestamp as score. <code>ZADD activity {timestamp} "user:123"</code>. Then use ZRANGEBYSCORE to find "users active in last hour": <code>ZRANGEBYSCORE activity {now-3600} {now}</code>. Sorted Sets excel at time-based queries!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Reddit Post Rankings</strong></p>
            
            <p>Reddit shows "Hot" posts ranked by a combination of upvotes and time. Posts with more upvotes and newer timestamps rank higher. How do they implement this?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Sorted Set with Calculated Score</h4>
                
                <p><strong>Score Formula:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    score = (upvotes - downvotes) + (timestamp / 100000)
                </code>
                
                <p><strong>Implementation:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    ZADD subreddit:python:hot {score} "post:12345"<br>
                    ZREVRANGE subreddit:python:hot 0 24  # Top 25 posts
                </code>
                
                <p><strong>When user upvotes:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>Increment upvote count</li>
                    <li>Recalculate score</li>
                    <li>ZADD with new score (updates position automatically!)</li>
                </ul>
                
                <p><strong>Benefits:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Real-time ranking updates</li>
                    <li>‚úÖ Automatic sorting by score</li>
                    <li>‚úÖ Get top posts in O(log N)</li>
                    <li>‚úÖ Scales to millions of posts</li>
                    <li>‚úÖ Different algorithms per subreddit</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Set + Order + Score</strong> - Combines uniqueness, sorting, and numeric weights</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üèÜ</span><p><strong>Perfect for leaderboards</strong> - Auto-sorted rankings, instant rank lookup</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>O(log N) operations</strong> - Fast add/update/query even with millions of members</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>ZADD updates scores</strong> - Same member, new score = score updated, position adjusted</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Access by rank or score</strong> - Get top 10 (ZRANGE) or score 100-200 (ZRANGEBYSCORE)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî¢</span><p><strong>Scores are floats</strong> - Support negative, decimal, timestamps</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Sorted Set</span><span class="keyword-tag">ZSET</span><span class="keyword-tag">Score</span><span class="keyword-tag">Rank</span><span class="keyword-tag">ZADD</span><span class="keyword-tag">ZRANGE</span><span class="keyword-tag">ZREVRANGE</span><span class="keyword-tag">Leaderboard</span><span class="keyword-tag">Skip List</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You execute: <code>ZADD scores 100 "alice"</code> then <code>ZADD scores 200 "alice"</code>. What's alice's score?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) 100 (first score kept)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) 200 (score updated)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) 300 (scores added)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Error (duplicate member)</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Score updated to 200</strong>
                    <p>Sorted Sets maintain unique members. When you ZADD an existing member with a new score, the score is updated (not added). Alice remains in the set once but with the new score 200. ZADD returns 0 (not 1) when updating. This makes Sorted Sets perfect for leaderboards where player scores constantly change!</p>
                </div>
            </div>
        </div>
    `;
}

       function getQuestion32Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Developer asks:</strong> "I'm storing user IDs who liked a post. Should I use a Set or Sorted Set?" Senior dev responds: "Do you need to show likes in any particular order?" Developer: "No, just need to count them." Senior: "Then Set! Sorted Set is overkill if you don't need ordering."</p>
            <p>But when DO you need a Sorted Set over a regular Set?</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Set:</strong> Unordered collection of unique members. No scores, no guaranteed order.</p>
            <p><strong>Sorted Set:</strong> Ordered collection of unique members, each with a numeric score. Auto-sorted by score.</p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Key Differences</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Feature</th><th style="padding: 10px;">Set</th><th style="padding: 10px;">Sorted Set</th></tr>
                    <tr><td style="padding: 8px;">Order</td><td>‚ùå None (unordered)</td><td>‚úÖ By score (ascending)</td></tr>
                    <tr><td style="padding: 8px;">Score/Weight</td><td>‚ùå No</td><td>‚úÖ Yes (float)</td></tr>
                    <tr><td style="padding: 8px;">Commands</td><td>S-prefix (SADD, SREM)</td><td>Z-prefix (ZADD, ZREM)</td></tr>
                    <tr><td style="padding: 8px;">Access by Position</td><td>‚ùå No</td><td>‚úÖ Yes (ZRANGE by rank)</td></tr>
                    <tr><td style="padding: 8px;">Range Queries</td><td>‚ùå No</td><td>‚úÖ By score or rank</td></tr>
                    <tr><td style="padding: 8px;">Memory</td><td>Lower (no scores)</td><td>Higher (stores scores)</td></tr>
                    <tr><td style="padding: 8px;">Add Operation</td><td>O(1)</td><td>O(log N)</td></tr>
                    <tr><td style="padding: 8px;">Use Case</td><td>Tags, likes, followers</td><td>Leaderboards, rankings</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° When to Use Which:</strong></p>
                <ul>
                    <li><strong>Use Set:</strong> Need uniqueness only, no ordering (tags, online users, permissions)</li>
                    <li><strong>Use Sorted Set:</strong> Need uniqueness + ranking/ordering (leaderboards, priority queues, time-based data)</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Set vs Sorted Set Comparison</div>
                <svg viewBox="0 0 900 500" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Set vs Sorted Set: Visual Comparison</text>
                    
                    <!-- SET Example -->
                    <text x="225" y="80" text-anchor="middle" fill="#FFA500" font-size="16" font-weight="600">SET (Unordered)</text>
                    
                    <rect x="50" y="100" width="350" height="180" fill="rgba(255, 165, 0, 0.15)" stroke="#FFA500" stroke-width="3" rx="8"/>
                    <text x="225" y="130" text-anchor="middle" fill="#FFA500" font-size="13">SADD post:123:likes user_a user_b user_c</text>
                    
                    <!-- Unordered circles -->
                    <ellipse cx="120" cy="180" rx="45" ry="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2"/>
                    <text x="120" y="185" text-anchor="middle" fill="#fff" font-size="12">user_b</text>
                    
                    <ellipse cx="225" cy="180" rx="45" ry="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2"/>
                    <text x="225" y="185" text-anchor="middle" fill="#fff" font-size="12">user_a</text>
                    
                    <ellipse cx="330" cy="180" rx="45" ry="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2"/>
                    <text x="330" y="185" text-anchor="middle" fill="#fff" font-size="12">user_c</text>
                    
                    <text x="225" y="230" text-anchor="middle" fill="#888" font-size="11">‚ùå No order guarantee</text>
                    <text x="225" y="250" text-anchor="middle" fill="#888" font-size="11">‚ùå No scores</text>
                    <text x="225" y="270" text-anchor="middle" fill="#00FF88" font-size="11">‚úÖ Fast: O(1) operations</text>
                    
                    <!-- SORTED SET Example -->
                    <text x="675" y="80" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">SORTED SET (By Score)</text>
                    
                    <rect x="500" y="100" width="350" height="180" fill="rgba(0, 255, 136, 0.15)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="675" y="130" text-anchor="middle" fill="#00FF88" font-size="13">ZADD leaderboard 100 user_a 200 user_b 150 user_c</text>
                    
                    <!-- Ordered boxes with scores -->
                    <rect x="530" y="150" width="100" height="60" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="580" y="170" text-anchor="middle" fill="#fff" font-size="12">user_a</text>
                    <text x="580" y="190" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">Score: 100</text>
                    <text x="580" y="205" text-anchor="middle" fill="#888" font-size="9">Rank #1</text>
                    
                    <rect x="645" y="150" width="100" height="60" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="695" y="170" text-anchor="middle" fill="#fff" font-size="12">user_c</text>
                    <text x="695" y="190" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">Score: 150</text>
                    <text x="695" y="205" text-anchor="middle" fill="#888" font-size="9">Rank #2</text>
                    
                    <rect x="760" y="150" width="100" height="60" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="810" y="170" text-anchor="middle" fill="#fff" font-size="12">user_b</text>
                    <text x="810" y="190" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">Score: 200</text>
                    <text x="810" y="205" text-anchor="middle" fill="#888" font-size="9">Rank #3</text>
                    
                    <text x="675" y="240" text-anchor="middle" fill="#00FF88" font-size="11">‚úÖ Auto-sorted by score</text>
                    <text x="675" y="260" text-anchor="middle" fill="#00FF88" font-size="11">‚úÖ Access by rank or score range</text>
                    <text x="675" y="275" text-anchor="middle" fill="#888" font-size="11">‚ö†Ô∏è Slower: O(log N) operations</text>
                    
                    <!-- Bottom comparison -->
                    <rect x="50" y="310" width="800" height="170" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="340" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">When to Choose?</text>
                    
                    <text x="80" y="370" fill="#FFA500" font-size="13" font-weight="600">Use SET for:</text>
                    <text x="90" y="390" fill="#bbb" font-size="11">‚Ä¢ Simple membership (likes, tags)</text>
                    <text x="90" y="410" fill="#bbb" font-size="11">‚Ä¢ No need for ordering</text>
                    <text x="90" y="430" fill="#bbb" font-size="11">‚Ä¢ Maximum speed (O(1))</text>
                    <text x="90" y="450" fill="#bbb" font-size="11">‚Ä¢ Lower memory usage</text>
                    <text x="90" y="470" fill="#00FF88" font-size="10" font-weight="600">Example: post likes, user permissions</text>
                    
                    <line x1="450" y1="350" x2="450" y2="480" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <text x="480" y="370" fill="#00FF88" font-size="13" font-weight="600">Use SORTED SET for:</text>
                    <text x="490" y="390" fill="#bbb" font-size="11">‚Ä¢ Rankings/leaderboards</text>
                    <text x="490" y="410" fill="#bbb" font-size="11">‚Ä¢ Need to access by position</text>
                    <text x="490" y="430" fill="#bbb" font-size="11">‚Ä¢ Time-based queries</text>
                    <text x="490" y="450" fill="#bbb" font-size="11">‚Ä¢ Priority queues</text>
                    <text x="490" y="470" fill="#00FF88" font-size="10" font-weight="600">Example: game scores, trending posts</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Same Use Case, Different Approaches</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - When Each Makes Sense</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Scenario 1: Simple Post Likes (Use SET)</span>
<span class="keyword">SADD</span> <span class="string">post:123:likes</span> <span class="string">"user_a"</span> <span class="string">"user_b"</span> <span class="string">"user_c"</span>
<span class="keyword">SISMEMBER</span> <span class="string">post:123:likes</span> <span class="string">"user_a"</span>  <span class="comment"># Check if liked - O(1)</span>
<span class="number">(integer) 1</span>  <span class="comment"># Yes, user_a liked it</span>

<span class="keyword">SCARD</span> <span class="string">post:123:likes</span>  <span class="comment"># Count likes</span>
<span class="number">(integer) 3</span>

<span class="comment"># Perfect! No need for ordering or scores.</span>

<span class="comment"># Scenario 2: Post Likes WITH TIMESTAMPS (Use SORTED SET)</span>
<span class="comment"># Score = timestamp (when they liked it)</span>
<span class="keyword">ZADD</span> <span class="string">post:456:likes_timed</span> <span class="number">1704067200</span> <span class="string">"user_a"</span>
<span class="keyword">ZADD</span> <span class="string">post:456:likes_timed</span> <span class="number">1704070800</span> <span class="string">"user_b"</span>
<span class="keyword">ZADD</span> <span class="string">post:456:likes_timed</span> <span class="number">1704074400</span> <span class="string">"user_c"</span>

<span class="comment"># Get first 2 people who liked (earliest timestamps)</span>
<span class="keyword">ZRANGE</span> <span class="string">post:456:likes_timed</span> <span class="number">0</span> <span class="number">1</span>
<span class="number">1)</span> <span class="string">"user_a"</span>  <span class="comment"># Liked first</span>
<span class="number">2)</span> <span class="string">"user_b"</span>  <span class="comment"># Liked second</span>

<span class="comment"># Get likes in last hour (score range query)</span>
<span class="keyword">ZRANGEBYSCORE</span> <span class="string">post:456:likes_timed</span> <span class="number">1704070800</span> <span class="number">+inf</span>
<span class="number">1)</span> <span class="string">"user_b"</span>
<span class="number">2)</span> <span class="string">"user_c"</span>

<span class="comment"># Sorted Set wins when you need ordering or time-based queries!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Performance Comparison</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Benchmarking Set vs Sorted Set</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Test data: 10,000 members</span>
members = [<span class="string">f"user_</span>{i}<span class="string">"</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">10000</span>)]

<span class="comment"># Benchmark: SET operations</span>
r.delete(<span class="string">"test_set"</span>)
start = time.time()
<span class="keyword">for</span> member <span class="keyword">in</span> members:
    r.sadd(<span class="string">"test_set"</span>, member)
set_add_time = time.time() - start

start = time.time()
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
    r.sismember(<span class="string">"test_set"</span>, <span class="string">f"user_</span>{i}<span class="string">"</span>)
set_check_time = time.time() - start

<span class="comment"># Benchmark: SORTED SET operations</span>
r.delete(<span class="string">"test_zset"</span>)
start = time.time()
<span class="keyword">for</span> i, member <span class="keyword">in</span> <span class="function">enumerate</span>(members):
    r.zadd(<span class="string">"test_zset"</span>, {member: i})
zset_add_time = time.time() - start

start = time.time()
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
    r.zscore(<span class="string">"test_zset"</span>, <span class="string">f"user_</span>{i}<span class="string">"</span>)
zset_check_time = time.time() - start

<span class="keyword">print</span>(<span class="string">"\\nüìä Performance Comparison (10K members):"</span>)
<span class="keyword">print</span>(<span class="string">f"\\nSET:"</span>)
<span class="keyword">print</span>(<span class="string">f"  Add 10K:     </span>{set_add_time:<span class="number">.3</span>f}<span class="string">s"</span>)
<span class="keyword">print</span>(<span class="string">f"  Check 1K:    </span>{set_check_time:<span class="number">.3</span>f}<span class="string">s"</span>)

<span class="keyword">print</span>(<span class="string">f"\\nSORTED SET:"</span>)
<span class="keyword">print</span>(<span class="string">f"  Add 10K:     </span>{zset_add_time:<span class="number">.3</span>f}<span class="string">s"</span>)
<span class="keyword">print</span>(<span class="string">f"  Check 1K:    </span>{zset_check_time:<span class="number">.3</span>f}<span class="string">s"</span>)

<span class="keyword">print</span>(<span class="string">f"\\nüí° Insight:"</span>)
<span class="keyword">print</span>(<span class="string">f"  Set is ~</span>{zset_add_time/set_add_time:<span class="number">.1</span>f}<span class="string">x faster for adds"</span>)
<span class="keyword">print</span>(<span class="string">f"  Both are fast for membership checks (O(1))"</span>)

<span class="comment"># Typical output:</span>
<span class="comment"># SET: Add=0.15s, Check=0.01s</span>
<span class="comment"># SORTED SET: Add=0.35s, Check=0.01s</span>
<span class="comment"># Set is ~2.3x faster for bulk adds!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Can I convert a Set to a Sorted Set?</h4>
                <p><strong>A:</strong> Not directly! Must read Set with SMEMBERS, then ZADD each member with a score to new Sorted Set. Choose scores wisely (timestamps, default value like 0, or based on other data). No built-in conversion command.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Memory usage difference: how much more does Sorted Set use?</h4>
                <p><strong>A:</strong> Sorted Set uses ~2x memory of Set! Each member needs: member string + score (8 bytes) + skip list pointers (~16-24 bytes). For 1M members with 20-byte names: Set ‚âà 40MB, Sorted Set ‚âà 80-100MB. Trade memory for ordering capability!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can I use Sorted Set where I'd use a Set?</h4>
                <p><strong>A:</strong> Technically yes (just set all scores to 0), but wasteful! You'd pay 2x memory and slower O(log N) operations for features you don't use. Always use Set if you don't need ordering. Premature optimization? No - appropriate data structure choice!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Real example where Set ‚Üí Sorted Set migration makes sense?</h4>
                <p><strong>A:</strong> User follows: Start with Set (just track followers). Later, want "following since" feature ‚Üí migrate to Sorted Set with timestamp scores. Or, simple tag cloud ‚Üí weighted tag cloud (popular tags ranked higher). Requirements evolve!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Can Sets and Sorted Sets work together?</h4>
                <p><strong>A:</strong> Yes! Common pattern: Set for fast membership ("is user X a follower?" - O(1)), Sorted Set for ordered display ("show followers by join date"). Dual storage trades memory for query flexibility. Instagram/Twitter likely use both!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: I want unique tags that appear in insertion order. Set or Sorted Set?</h4>
                <p><strong>Answer:</strong> Sorted Set! Use insertion timestamp or counter as score. <code>ZADD tags {counter++} "tag"</code>. ZRANGE returns insertion-order. Can't use Set (no order) or List (allows duplicates). Sorted Set = uniqueness + order. Perfect match!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can Set operations (SINTER, SUNION) work on Sorted Sets?</h4>
                <p><strong>Answer:</strong> Yes! ZINTER and ZUNION exist (Redis 6.2+). They combine Sorted Sets with various score aggregation options (SUM, MIN, MAX). Example: ZUNIONSTORE result 2 zset1 zset2 WEIGHTS 1 2 ‚Üí combines scores. More powerful than Set operations!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Sorted Set with all scores = 0. Is it just a Set now?</h4>
                <p><strong>Answer:</strong> No! Still Sorted Set with O(log N) operations and 2x memory. Members with same score (0) are sorted lexicographically by name. So you DO get ordering (alphabetical), but pay performance cost. If that's what you want, fine. Otherwise, use Set!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Twitter "Who to Follow" Recommendations</strong></p>
            
            <p>Twitter needs to track: (1) Who you follow (fast checks), (2) Suggested accounts ranked by relevance. How do they balance speed and ordering?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Dual Storage Pattern</h4>
                
                <p><strong>Set for following:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    Key: user:123:following<br>
                    Data: Set of user IDs<br>
                    Purpose: O(1) check "Am I following @elonmusk?"
                </code>
                
                <p><strong>Sorted Set for suggestions:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    Key: user:123:suggested_follows<br>
                    Data: Sorted Set (score = relevance/popularity)<br>
                    Purpose: Show top 10 relevant accounts
                </code>
                
                <p><strong>Query patterns:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>Check following:</strong> SISMEMBER user:123:following target_id ‚Üí O(1)</li>
                    <li><strong>Get suggestions:</strong> ZREVRANGE user:123:suggested_follows 0 9 ‚Üí O(log N + 10)</li>
                    <li><strong>Filter suggestions:</strong> Only show accounts not in following Set</li>
                </ul>
                
                <p><strong>Why both?</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Set gives instant membership checks</li>
                    <li>‚úÖ Sorted Set provides ranked recommendations</li>
                    <li>‚úÖ Different use cases, optimal for each</li>
                    <li>‚ö†Ô∏è Uses 2x storage, but queries are perfect</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Set = unordered, Sorted Set = ordered by score</strong> - Main difference</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Set faster: O(1) vs O(log N)</strong> - Use Set when possible</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Sorted Set uses 2x memory</strong> - Stores scores + skip list</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üèÜ</span><p><strong>Sorted Set for rankings</strong> - Leaderboards, priority, time-based</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîç</span><p><strong>Set for membership only</strong> - Tags, likes, permissions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Can use both together</strong> - Dual storage for different query patterns</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Set vs Sorted Set</span><span class="keyword-tag">Ordering</span><span class="keyword-tag">Score</span><span class="keyword-tag">O(1) vs O(log N)</span><span class="keyword-tag">Memory</span><span class="keyword-tag">Skip List</span><span class="keyword-tag">Dual Storage</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You need to track blog post tags AND show "Top 10 Most Used Tags". Which approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Set - store all tags</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Sorted Set - score = usage count</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) List - ordered by usage</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Set + manual sorting in code</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Sorted Set with usage count as score</strong>
                    <p>Use ZINCRBY to increment usage count: <code>ZINCRBY popular_tags 1 "redis"</code>. Then ZREVRANGE popular_tags 0 9 gets top 10 instantly! Sorted Set maintains both uniqueness (no duplicate tags) and ordering (by usage count). Set can't rank, List allows duplicates and needs sorting. Perfect use case for Sorted Set!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 33: What is a score in Sorted Set?
// ============================================================

function getQuestion33Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>New developer asks:</strong> "I added players to a Sorted Set with scores. What ARE these scores? Points? Ranks? IDs?" Senior dev explains: "Scores are just numbers YOU choose to represent whatever makes sense - points, timestamps, priorities, weights. Redis just sorts by them!"</p>
            <p>So what exactly is a score and how should you use it?</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>A score in a Sorted Set is a 64-bit IEEE 754 floating-point number associated with each member that determines its position in the set's ordering.</strong></p>
            
            <p>Think of it as: <strong>The "weight" or "value" that controls where each member sits in the sorted order.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Score Characteristics</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Property</th><th style="padding: 10px;">Details</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">Data Type</td><td>64-bit float</td><td>1.5, 2500, -100</td></tr>
                    <tr><td style="padding: 8px;">Range</td><td>¬±1.7 √ó 10^308</td><td>Very large numbers supported</td></tr>
                    <tr><td style="padding: 8px;">Negatives</td><td>‚úÖ Allowed</td><td>-1000 to 5000</td></tr>
                    <tr><td style="padding: 8px;">Decimals</td><td>‚úÖ Allowed</td><td>98.7, 3.14159</td></tr>
                    <tr><td style="padding: 8px;">Uniqueness</td><td>Many members, same score OK</td><td>Multiple players with score 100</td></tr>
                    <tr><td style="padding: 8px;">Sort Order</td><td>Ascending by default</td><td>-10, 0, 5, 100</td></tr>
                    <tr><td style="padding: 8px;">Meaning</td><td>YOU define!</td><td>Points, time, priority, etc.</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Common Score Meanings:</strong></p>
                <ul>
                    <li><strong>Game points:</strong> 0-999999 (player scores)</li>
                    <li><strong>Timestamps:</strong> Unix time (sort by time)</li>
                    <li><strong>Priority:</strong> 1-10 (1=highest, 10=lowest)</li>
                    <li><strong>Popularity:</strong> View count, like count</li>
                    <li><strong>Relevance:</strong> Algorithm-calculated weight</li>
                    <li><strong>Distance:</strong> Miles from location</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Understanding Scores in Sorted Sets</div>
                <svg viewBox="0 0 900 550" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Score: The Sorting Key</text>
                    
                    <!-- Example 1: Game Scores -->
                    <text x="225" y="80" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">Example 1: Game Scores</text>
                    <rect x="50" y="95" width="350" height="140" fill="rgba(220, 20, 60, 0.1)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    
                    <text x="225" y="120" text-anchor="middle" fill="#888" font-size="11">Score = Player Points</text>
                    
                    <rect x="70" y="135" width="90" height="50" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="115" y="155" text-anchor="middle" fill="#00FF88" font-size="10">Score: 1500</text>
                    <text x="115" y="170" text-anchor="middle" fill="#fff" font-size="11">alice</text>
                    
                    <rect x="175" y="135" width="90" height="50" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="220" y="155" text-anchor="middle" fill="#00FF88" font-size="10">Score: 2000</text>
                    <text x="220" y="170" text-anchor="middle" fill="#fff" font-size="11">bob</text>
                    
                    <rect x="280" y="135" width="90" height="50" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="325" y="155" text-anchor="middle" fill="#00FF88" font-size="10">Score: 2500</text>
                    <text x="325" y="170" text-anchor="middle" fill="#fff" font-size="11">charlie</text>
                    
                    <text x="225" y="210" text-anchor="middle" fill="#888" font-size="10">Sorted: alice(1500) ‚Üí bob(2000) ‚Üí charlie(2500)</text>
                    <text x="225" y="225" text-anchor="middle" fill="#00FF88" font-size="10">‚úÖ Higher score = Better rank</text>
                    
                    <!-- Example 2: Timestamps -->
                    <text x="675" y="80" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">Example 2: Recent Activity</text>
                    <rect x="500" y="95" width="350" height="140" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    
                    <text x="675" y="120" text-anchor="middle" fill="#888" font-size="11">Score = Unix Timestamp</text>
                    
                    <rect x="520" y="135" width="90" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="565" y="150" text-anchor="middle" fill="#FFA500" font-size="9">1704067200</text>
                    <text x="565" y="162" text-anchor="middle" fill="#888" font-size="8">(Jan 1, 2024)</text>
                    <text x="565" y="175" text-anchor="middle" fill="#fff" font-size="11">post_1</text>
                    
                    <rect x="625" y="135" width="90" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="670" y="150" text-anchor="middle" fill="#FFA500" font-size="9">1704153600</text>
                    <text x="670" y="162" text-anchor="middle" fill="#888" font-size="8">(Jan 2, 2024)</text>
                    <text x="670" y="175" text-anchor="middle" fill="#fff" font-size="11">post_2</text>
                    
                    <rect x="730" y="135" width="90" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="775" y="150" text-anchor="middle" fill="#FFA500" font-size="9">1704240000</text>
                    <text x="775" y="162" text-anchor="middle" fill="#888" font-size="8">(Jan 3, 2024)</text>
                    <text x="775" y="175" text-anchor="middle" fill="#fff" font-size="11">post_3</text>
                    
                    <text x="675" y="210" text-anchor="middle" fill="#888" font-size="10">Sorted: oldest ‚Üí newest (by timestamp)</text>
                    <text x="675" y="225" text-anchor="middle" fill="#00FF88" font-size="10">‚úÖ ZREVRANGE gets most recent first</text>
                    
                    <!-- Example 3: Priority Queue -->
                    <rect x="50" y="260" width="800" height="260" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="290" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">Example 3: Priority Queue (Lower Score = Higher Priority)</text>
                    
                    <rect x="80" y="310" width="120" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="140" y="330" text-anchor="middle" fill="#FF6347" font-size="11" font-weight="600">URGENT</text>
                    <text x="140" y="350" text-anchor="middle" fill="#FFA500" font-size="10">Score: 1</text>
                    <text x="140" y="367" text-anchor="middle" fill="#fff" font-size="10">task_critical</text>
                    <text x="140" y="382" text-anchor="middle" fill="#888" font-size="9">Processed first!</text>
                    
                    <rect x="220" y="310" width="120" height="80" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="280" y="330" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">HIGH</text>
                    <text x="280" y="350" text-anchor="middle" fill="#FFA500" font-size="10">Score: 3</text>
                    <text x="280" y="367" text-anchor="middle" fill="#fff" font-size="10">task_important</text>
                    <text x="280" y="382" text-anchor="middle" fill="#888" font-size="9">Processed second</text>
                    
                    <rect x="360" y="310" width="120" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="420" y="330" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">NORMAL</text>
                    <text x="420" y="350" text-anchor="middle" fill="#FFA500" font-size="10">Score: 5</text>
                    <text x="420" y="367" text-anchor="middle" fill="#fff" font-size="10">task_regular</text>
                    <text x="420" y="382" text-anchor="middle" fill="#888" font-size="9">Processed third</text>
                    
                    <rect x="500" y="310" width="120" height="80" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="560" y="330" text-anchor="middle" fill="#9C27B0" font-size="11" font-weight="600">LOW</text>
                    <text x="560" y="350" text-anchor="middle" fill="#FFA500" font-size="10">Score: 8</text>
                    <text x="560" y="367" text-anchor="middle" fill="#fff" font-size="10">task_when_free</text>
                    <text x="560" y="382" text-anchor="middle" fill="#888" font-size="9">Processed last</text>
                    
                    <text x="80" y="420" fill="#00FF88" font-size="12" font-weight="600">Get next task:</text>
                    <code style="font-family: monospace;">
                        <text x="90" y="440" fill="#FFA500" font-size="11">ZPOPMIN task_queue</text>
                    </code>
                    <text x="90" y="460" fill="#888" font-size="10">‚Üí Returns member with LOWEST score</text>
                    <text x="90" y="477" fill="#888" font-size="10">‚Üí In this case: task_critical (score 1)</text>
                    <text x="90" y="494" fill="#00FF88" font-size="10">‚úÖ Lower score = Higher priority!</text>
                    
                    <rect x="500" y="410" width="320" height="100" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="1" rx="4"/>
                    <text x="660" y="433" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">üí° Score Flexibility:</text>
                    <text x="515" y="453" fill="#bbb" font-size="10">‚Ä¢ Score meaning is YOUR choice</text>
                    <text x="515" y="470" fill="#bbb" font-size="10">‚Ä¢ Same Sorted Set structure</text>
                    <text x="515" y="487" fill="#bbb" font-size="10">‚Ä¢ Different use cases</text>
                    <text x="515" y="504" fill="#bbb" font-size="10">‚Ä¢ Redis just sorts by number</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Different Score Meanings</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Score Usage Patterns</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Pattern 1: Score as Points (Leaderboard)</span>
<span class="keyword">ZADD</span> <span class="string">game:scores</span> <span class="number">1500</span> <span class="string">"alice"</span> <span class="number">2000</span> <span class="string">"bob"</span> <span class="number">2500</span> <span class="string">"charlie"</span>
<span class="keyword">ZREVRANGE</span> <span class="string">game:scores</span> <span class="number">0</span> <span class="number">2</span> <span class="keyword">WITHSCORES</span>
<span class="comment"># Top 3: charlie(2500), bob(2000), alice(1500)</span>

<span class="comment"># Pattern 2: Score as Timestamp (Recent Activity)</span>
<span class="keyword">ZADD</span> <span class="string">user:123:activity</span> <span class="number">1704067200</span> <span class="string">"login"</span>
<span class="keyword">ZADD</span> <span class="string">user:123:activity</span> <span class="number">1704070800</span> <span class="string">"post_created"</span>
<span class="keyword">ZADD</span> <span class="string">user:123:activity</span> <span class="number">1704074400</span> <span class="string">"comment_added"</span>

<span class="comment"># Get activities in last hour (current time - 3600)</span>
<span class="keyword">ZRANGEBYSCORE</span> <span class="string">user:123:activity</span> <span class="number">1704070800</span> <span class="number">+inf</span>
<span class="comment"># Returns: post_created, comment_added</span>

<span class="comment"># Pattern 3: Score as Priority (Task Queue)</span>
<span class="keyword">ZADD</span> <span class="string">tasks</span> <span class="number">1</span> <span class="string">"urgent_fix"</span> <span class="number">5</span> <span class="string">"normal_task"</span> <span class="number">10</span> <span class="string">"low_priority"</span>

<span class="comment"># Get highest priority (lowest score)</span>
<span class="keyword">ZPOPMIN</span> <span class="string">tasks</span>
<span class="number">1)</span> <span class="string">"urgent_fix"</span>
<span class="number">2)</span> <span class="string">"1"</span>

<span class="comment"># Pattern 4: Score as Distance (Geo Proximity)</span>
<span class="keyword">ZADD</span> <span class="string">nearby:stores</span> <span class="number">0.5</span> <span class="string">"store_a"</span> <span class="number">1.2</span> <span class="string">"store_b"</span> <span class="number">2.8</span> <span class="string">"store_c"</span>

<span class="comment"># Get stores within 2 miles</span>
<span class="keyword">ZRANGEBYSCORE</span> <span class="string">nearby:stores</span> <span class="number">0</span> <span class="number">2</span>
<span class="comment"># Returns: store_a, store_b (within range)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Dynamic Score Calculation</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Reddit-Style Hot Post Ranking</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time
<span class="keyword">import</span> math

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">calculate_hot_score</span>(upvotes, downvotes, timestamp):
    <span class="string">"""
    Calculate Reddit-style "hot" score
    Combines popularity (votes) with recency (time)
    """</span>
    net_votes = upvotes - downvotes
    
    <span class="comment"># Time decay: older posts score lower</span>
    hours_old = (time.time() - timestamp) / <span class="number">3600</span>
    
    <span class="comment"># Hot score formula</span>
    <span class="keyword">if</span> net_votes > <span class="number">0</span>:
        score = math.log10(<span class="function">max</span>(net_votes, <span class="number">1</span>)) - hours_old / <span class="number">12</span>
    <span class="keyword">else</span>:
        score = -hours_old / <span class="number">12</span>
    
    <span class="keyword">return</span> score

<span class="keyword">class</span> <span class="function">HotPosts</span>:
    <span class="keyword">def</span> <span class="function">add_post</span>(<span class="keyword">self</span>, post_id, upvotes, downvotes, timestamp):
        <span class="string">"""Add post with calculated hot score"""</span>
        score = calculate_hot_score(upvotes, downvotes, timestamp)
        r.zadd(<span class="string">"hot_posts"</span>, {post_id: score})
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Post </span>{post_id}<span class="string"> added with hot score: </span>{score:<span class="number">.3</span>f}<span class="string">"</span>)
    
    <span class="keyword">def</span> <span class="function">upvote_post</span>(<span class="keyword">self</span>, post_id, current_upvotes, downvotes, timestamp):
        <span class="string">"""Recalculate score after upvote"""</span>
        new_score = calculate_hot_score(current_upvotes + <span class="number">1</span>, downvotes, timestamp)
        r.zadd(<span class="string">"hot_posts"</span>, {post_id: new_score})
        <span class="keyword">print</span>(<span class="string">f"üìà Post </span>{post_id}<span class="string"> score updated: </span>{new_score:<span class="number">.3</span>f}<span class="string">"</span>)
    
    <span class="keyword">def</span> <span class="function">get_hot_posts</span>(<span class="keyword">self</span>, count=<span class="number">10</span>):
        <span class="string">"""Get hottest posts (highest scores)"""</span>
        posts = r.zrevrange(<span class="string">"hot_posts"</span>, <span class="number">0</span>, count - <span class="number">1</span>, withscores=<span class="keyword">True</span>)
        <span class="keyword">return</span> [(post, <span class="function">float</span>(score)) <span class="keyword">for</span> post, score <span class="keyword">in</span> posts]

<span class="comment"># Usage</span>
hot = HotPosts()

<span class="comment"># Add posts with different ages and votes</span>
now = time.time()
hot.add_post(<span class="string">"post_1"</span>, upvotes=<span class="number">100</span>, downvotes=<span class="number">10</span>, timestamp=now - <span class="number">3600</span>)      <span class="comment"># 1 hour old</span>
hot.add_post(<span class="string">"post_2"</span>, upvotes=<span class="number">50</span>, downvotes=<span class="number">5</span>, timestamp=now - <span class="number">600</span>)        <span class="comment"># 10 min old</span>
hot.add_post(<span class="string">"post_3"</span>, upvotes=<span class="number">200</span>, downvotes=<span class="number">20</span>, timestamp=now - <span class="number">7200</span>)     <span class="comment"># 2 hours old</span>

<span class="comment"># Get hot posts</span>
<span class="keyword">print</span>(<span class="string">"\\nüî• Hot Posts:"</span>)
<span class="keyword">for</span> rank, (post_id, score) <span class="keyword">in</span> <span class="function">enumerate</span>(hot.get_hot_posts(<span class="number">5</span>), <span class="number">1</span>):
    <span class="keyword">print</span>(<span class="string">f"  {rank}. {post_id} (score: {score:.3f})"</span>)

<span class="comment"># The score combines:
# - Logarithmic vote count (more votes = higher)
# - Time decay (older = lower)
# Result: Recent popular posts rank highest!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Can I change a member's score after adding it?</h4>
                <p><strong>A:</strong> Yes! Just ZADD again with new score. <code>ZADD leaderboard 100 "alice"</code> then <code>ZADD leaderboard 200 "alice"</code> ‚Üí alice now has score 200. ZADD acts as both add and update. Position auto-adjusts!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What happens if multiple members have the same score?</h4>
                <p><strong>A:</strong> They're sorted lexicographically (alphabetically) by member name! Example: alice(100), bob(100), charlie(100) ‚Üí sorted as alice, bob, charlie. Stable, predictable tie-breaking using member strings.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can I increment a score without knowing current value?</h4>
                <p><strong>A:</strong> Yes! Use ZINCRBY: <code>ZINCRBY leaderboard 10 "alice"</code> adds 10 to alice's current score. Works like INCR for strings. Perfect for points/votes where you just need to add, not replace!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Precision: How many decimals can scores have?</h4>
                <p><strong>A:</strong> 64-bit IEEE 754 float = ~15-17 decimal digits of precision. For most uses (game scores, timestamps, priorities), plenty! But for financial calculations requiring exact precision, consider using integers (e.g., cents instead of dollars).</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Can I use infinity as a score?</h4>
                <p><strong>A:</strong> Yes! Redis supports +inf and -inf in ZRANGEBYSCORE queries. Example: <code>ZRANGEBYSCORE myset 100 +inf</code> gets all members with score ‚â• 100. Great for open-ended range queries!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: I need both ascending AND descending order. Two Sorted Sets?</h4>
                <p><strong>Answer:</strong> No! One Sorted Set with two query types: ZRANGE (ascending) and ZREVRANGE (descending). Same data, different access patterns. Don't duplicate! Use negative scores trick if needed (multiply by -1 to reverse sort direction).</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Score as timestamp. What about year 2038 problem?</h4>
                <p><strong>Answer:</strong> No problem! Unix timestamps use 32-bit integers (overflow 2038), but Redis scores are 64-bit floats supporting dates until year 292 billion! Use full Unix timestamp (seconds since 1970) or milliseconds - both work fine.</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I use score to store actual data (not just order)?</h4>
                <p><strong>Answer:</strong> Technically yes (store user ID as score), but BAD idea! Scores should be for ordering only. Why? (1) Floats lose precision for large integers, (2) Can't have duplicate scores (would limit you to unique numbers), (3) Limited to numeric data. Use member string for data, score for ordering!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Hacker News Post Ranking Algorithm</strong></p>
            
            <p>Hacker News shows posts ranked by a "score" that combines upvotes and time. New posts with few votes can outrank old posts with many votes. How do they use Sorted Set scores?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Calculated Score Formula</h4>
                
                <p><strong>The Formula (simplified):</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    score = (upvotes - 1) / (hours_old + 2)^1.8
                </code>
                
                <p><strong>What this means:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>More upvotes</strong> = higher score (numerator)</li>
                    <li><strong>Older posts</strong> = lower score (denominator grows)</li>
                    <li><strong>Power of 1.8</strong> = aggressive time decay</li>
                </ul>
                
                <p><strong>Redis Implementation:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    # When post is submitted
                    score = calculate_score(upvotes=1, age=0)
                    ZADD frontpage {score} "post_id"
                    
                    # When someone upvotes
                    new_score = calculate_score(upvotes=current+1, age=hours)
                    ZADD frontpage {new_score} "post_id"  # Updates position!
                    
                    # Get front page
                    ZREVRANGE frontpage 0 29  # Top 30 posts
                </code>
                
                <p><strong>Why this works:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Recent posts with moderate votes rank high</li>
                    <li>‚úÖ Old viral posts gradually drop</li>
                    <li>‚úÖ Auto-sorted as scores update</li>
                    <li>‚úÖ O(log N) to update any post</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî¢</span><p><strong>Score = sorting number</strong> - YOU define what it means</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>64-bit float</strong> - Supports huge range, negatives, decimals</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Common uses:</strong> Points, timestamps, priorities, weights, distances</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>ZADD updates scores</strong> - Position adjusts automatically</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ûï</span><p><strong>ZINCRBY for increments</strong> - Don't need current value</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üé®</span><p><strong>Score flexibility</strong> - Same structure, endless possibilities</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Score</span><span class="keyword-tag">Float</span><span class="keyword-tag">Ordering</span><span class="keyword-tag">Timestamp</span><span class="keyword-tag">Priority</span><span class="keyword-tag">ZINCRBY</span><span class="keyword-tag">Weight</span><span class="keyword-tag">Ranking</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You have: <code>ZADD tasks 1 "urgent" 5 "normal" 10 "low"</code>. What does <code>ZPOPMIN tasks</code> return?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) "low" (last added)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) "urgent" (lowest score)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) "normal" (middle score)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) All three in order</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Returns "urgent" with score 1</strong>
                    <p>ZPOPMIN removes and returns the member with the LOWEST score. Here, scores are 1, 5, 10. Lowest is 1, so "urgent" is returned. This makes Sorted Sets perfect for priority queues where lower score = higher priority. Common pattern: 1=critical, 5=normal, 10=low. Always process ZPOPMIN first!</p>
                </div>
            </div>
        </div>
    `;
}

        

// ============================================================
// QUESTION 34: Real-world example of Sorted Set usage
// ============================================================

function getQuestion34Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Product manager asks:</strong> "We need a 'Trending Products' page showing items that are popular RIGHT NOW, not just best-sellers from last month. Can we do this?" Engineer responds: "Perfect use case for Redis Sorted Sets! We can track real-time popularity and show top trending items instantly!"</p>
            <p>Let's see how Sorted Sets power real-time trending systems at scale.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Sorted Sets excel at real-time ranking systems where items need to be ordered by a dynamic score that changes frequently - views, popularity, engagement, or any calculated metric.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Real-World Sorted Set Applications</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Platform</th><th style="padding: 10px;">Use Case</th><th style="padding: 10px;">Score Meaning</th></tr>
                    <tr><td style="padding: 8px;">Twitter</td><td>Trending hashtags</td><td>Tweet count + time decay</td></tr>
                    <tr><td style="padding: 8px;">YouTube</td><td>Trending videos</td><td>Views per hour + engagement</td></tr>
                    <tr><td style="padding: 8px;">Reddit</td><td>Hot posts</td><td>Upvotes / age^1.8</td></tr>
                    <tr><td style="padding: 8px;">E-commerce</td><td>Trending products</td><td>Views + purchases + recency</td></tr>
                    <tr><td style="padding: 8px;">News sites</td><td>Popular articles</td><td>Page views in last hour</td></tr>
                    <tr><td style="padding: 8px;">Gaming</td><td>Live leaderboards</td><td>Current score</td></tr>
                    <tr><td style="padding: 8px;">Stock apps</td><td>Biggest movers</td><td>% change today</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Why Sorted Sets for Trending:</strong></p>
                <ul>
                    <li><strong>Auto-sorted:</strong> Update score, position adjusts automatically</li>
                    <li><strong>Real-time:</strong> ZADD updates are instant (O(log N))</li>
                    <li><strong>Top-N queries:</strong> Get top 10/100 without scanning all data</li>
                    <li><strong>Score flexibility:</strong> Combine multiple signals (views, time, engagement)</li>
                    <li><strong>Scalable:</strong> Handles millions of items efficiently</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Twitter Trending Hashtags System</div>
                <svg viewBox="0 0 900 580" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Real-Time Trending System with Sorted Sets</text>
                    
                    <!-- Input Events -->
                    <rect x="50" y="60" width="250" height="150" fill="rgba(255, 165, 0, 0.1)" stroke="#FFA500" stroke-width="2" rx="8"/>
                    <text x="175" y="90" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">üì± User Events (Real-Time)</text>
                    
                    <ellipse cx="120" cy="130" rx="50" ry="25" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2"/>
                    <text x="120" y="135" text-anchor="middle" fill="#fff" font-size="11">#Python</text>
                    <text x="80" y="160" fill="#888" font-size="9">+1 tweet</text>
                    <path d="M 120 155 Q 175 180 230 160" stroke="#00FF88" stroke-width="2" fill="none" marker-end="url(#arrow1)">
                        <animate attributeName="opacity" values="0;1;0" dur="2s" repeatCount="indefinite"/>
                    </path>
                    
                    <ellipse cx="230" cy="130" rx="50" ry="25" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2"/>
                    <text x="230" y="135" text-anchor="middle" fill="#fff" font-size="11">#AI</text>
                    <text x="190" y="160" fill="#888" font-size="9">+1 tweet</text>
                    <path d="M 230 155 Q 275 180 340 160" stroke="#00FF88" stroke-width="2" fill="none" marker-end="url(#arrow1)">
                        <animate attributeName="opacity" values="0;1;0" dur="2s" begin="0.5s" repeatCount="indefinite"/>
                    </path>
                    
                    <!-- Sorted Set -->
                    <rect x="330" y="60" width="240" height="150" fill="rgba(220, 20, 60, 0.15)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">‚ö° Sorted Set: "trending"</text>
                    
                    <rect x="350" y="110" width="200" height="35" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="370" y="127" fill="#fff" font-size="11">#Python</text>
                    <text x="520" y="127" text-anchor="end" fill="#FFA500" font-size="10" font-weight="600">Score: 2847</text>
                    <text x="450" y="140" text-anchor="middle" fill="#888" font-size="8">2847 tweets in last hour</text>
                    
                    <rect x="350" y="155" width="200" height="35" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="370" y="172" fill="#fff" font-size="11">#AI</text>
                    <text x="520" y="172" text-anchor="end" fill="#FFA500" font-size="10" font-weight="600">Score: 1923</text>
                    <text x="450" y="185" text-anchor="middle" fill="#888" font-size="8">1923 tweets in last hour</text>
                    
                    <!-- Query -->
                    <rect x="600" y="60" width="250" height="150" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="725" y="90" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üìä Top Trending</text>
                    
                    <text x="620" y="120" fill="#FFA500" font-size="11" font-weight="600">ZREVRANGE trending 0 9</text>
                    <text x="630" y="140" fill="#fff" font-size="10">1. #Python (2847)</text>
                    <text x="630" y="157" fill="#fff" font-size="10">2. #AI (1923)</text>
                    <text x="630" y="174" fill="#fff" font-size="10">3. #JavaScript (1456)</text>
                    <text x="630" y="191" fill="#888" font-size="9">...top 10 in ~1ms!</text>
                    
                    <path d="M 570 135 L 595 135" stroke="#00FF88" stroke-width="2" marker-end="url(#arrow1)"/>
                    
                    <!-- Score Update Flow -->
                    <rect x="50" y="240" width="800" height="310" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="270" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">How It Works: Real-Time Score Updates</text>
                    
                    <!-- Step 1 -->
                    <text x="80" y="300" fill="#00FF88" font-size="12" font-weight="600">Step 1: User tweets with #Python</text>
                    <rect x="90" y="310" width="350" height="55" fill="rgba(255,165,0,0.1)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="100" y="330" fill="#FFA500" font-size="11">ZINCRBY trending 1 "#Python"</text>
                    <text x="110" y="348" fill="#888" font-size="10">‚Üí Increments #Python score by 1</text>
                    <text x="110" y="362" fill="#888" font-size="10">‚Üí Auto-repositions in ranking (O(log N))</text>
                    
                    <!-- Step 2 -->
                    <text x="480" y="300" fill="#00FF88" font-size="12" font-weight="600">Step 2: Background Job</text>
                    <rect x="490" y="310" width="330" height="55" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="500" y="330" fill="#FFA500" font-size="11">Every 5 minutes: Decay old scores</text>
                    <text x="510" y="348" fill="#888" font-size="10">‚Üí ZINCRBY trending -50 "#OldTopic"</text>
                    <text x="510" y="362" fill="#888" font-size="10">‚Üí Keeps only recent trends active</text>
                    
                    <!-- Step 3 -->
                    <text x="80" y="395" fill="#00FF88" font-size="12" font-weight="600">Step 3: Client requests trending</text>
                    <rect x="90" y="405" width="730" height="70" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="100" y="425" fill="#FFA500" font-size="11">ZREVRANGE trending 0 9 WITHSCORES</text>
                    <text x="110" y="443" fill="#fff" font-size="10">Returns: ["#Python", "2847", "#AI", "1923", "#JavaScript", "1456", ...]</text>
                    <text x="110" y="460" fill="#00FF88" font-size="10">‚úÖ Top 10 trending topics with scores in < 1ms</text>
                    <text x="110" y="472" fill="#888" font-size="9">Works with millions of hashtags, only queries top 10!</text>
                    
                    <!-- Benefits -->
                    <rect x="80" y="490" width="740" height="50" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="450" y="510" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">üí° Why This Scales:</text>
                    <text x="100" y="528" fill="#bbb" font-size="10">‚Ä¢ Millions of tweets/sec ‚Üí Each ZINCRBY takes ~0.1ms | ‚Ä¢ Automatic sorting | ‚Ä¢ Top-N query doesn't scan full dataset</text>
                    
                    <defs>
                        <marker id="arrow1" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: E-commerce Trending Products</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Real-Time Product Trending System</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time
<span class="keyword">import</span> math

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">TrendingProducts</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>):
        <span class="keyword">self</span>.key = <span class="string">"trending:products"</span>
        <span class="keyword">self</span>.views_key = <span class="string">"product:views"</span>
        <span class="keyword">self</span>.purchases_key = <span class="string">"product:purchases"</span>
    
    <span class="keyword">def</span> <span class="function">calculate_trending_score</span>(<span class="keyword">self</span>, product_id):
        <span class="string">"""
        Calculate trending score combining:
        - Views in last hour (weight: 1x)
        - Purchases in last hour (weight: 10x)
        - Time decay
        """</span>
        views = <span class="function">float</span>(r.hget(<span class="keyword">self</span>.views_key, product_id) <span class="keyword">or</span> <span class="number">0</span>)
        purchases = <span class="function">float</span>(r.hget(<span class="keyword">self</span>.purchases_key, product_id) <span class="keyword">or</span> <span class="number">0</span>)
        
        <span class="comment"># Weighted score: purchases are 10x more important</span>
        score = views + (purchases * <span class="number">10</span>)
        
        <span class="keyword">return</span> score
    
    <span class="keyword">def</span> <span class="function">track_view</span>(<span class="keyword">self</span>, product_id):
        <span class="string">"""Track product view"""</span>
        <span class="comment"># Increment view counter</span>
        r.hincrby(<span class="keyword">self</span>.views_key, product_id, <span class="number">1</span>)
        
        <span class="comment"># Update trending score</span>
        score = <span class="keyword">self</span>.calculate_trending_score(product_id)
        r.zadd(<span class="keyword">self</span>.key, {product_id: score})
    
    <span class="keyword">def</span> <span class="function">track_purchase</span>(<span class="keyword">self</span>, product_id):
        <span class="string">"""Track product purchase"""</span>
        <span class="comment"># Increment purchase counter</span>
        r.hincrby(<span class="keyword">self</span>.purchases_key, product_id, <span class="number">1</span>)
        
        <span class="comment"># Update trending score (purchases boost score significantly!)</span>
        score = <span class="keyword">self</span>.calculate_trending_score(product_id)
        r.zadd(<span class="keyword">self</span>.key, {product_id: score})
        
        <span class="keyword">print</span>(<span class="string">f"üî• Product </span>{product_id}<span class="string"> trending score: </span>{score}<span class="string">"</span>)
    
    <span class="keyword">def</span> <span class="function">get_trending</span>(<span class="keyword">self</span>, count=<span class="number">10</span>):
        <span class="string">"""Get top trending products"""</span>
        products = r.zrevrange(<span class="keyword">self</span>.key, <span class="number">0</span>, count - <span class="number">1</span>, withscores=<span class="keyword">True</span>)
        <span class="keyword">return</span> [(prod, <span class="function">int</span>(score)) <span class="keyword">for</span> prod, score <span class="keyword">in</span> products]
    
    <span class="keyword">def</span> <span class="function">decay_scores</span>(<span class="keyword">self</span>, decay_factor=<span class="number">0.9</span>):
        <span class="string">"""
        Decay all trending scores (run hourly)
        This removes stale trends
        """</span>
        products = r.zrange(<span class="keyword">self</span>.key, <span class="number">0</span>, <span class="number">-1</span>)
        
        <span class="keyword">for</span> product_id <span class="keyword">in</span> products:
            current_score = r.zscore(<span class="keyword">self</span>.key, product_id)
            new_score = current_score * decay_factor
            
            <span class="comment"># Remove if score too low</span>
            <span class="keyword">if</span> new_score < <span class="number">1</span>:
                r.zrem(<span class="keyword">self</span>.key, product_id)
            <span class="keyword">else</span>:
                r.zadd(<span class="keyword">self</span>.key, {product_id: new_score})
        
        <span class="comment"># Reset hourly counters</span>
        r.delete(<span class="keyword">self</span>.views_key, <span class="keyword">self</span>.purchases_key)

<span class="comment"># Usage</span>
trending = TrendingProducts()

<span class="comment"># Simulate user activity</span>
<span class="keyword">print</span>(<span class="string">"üì± Tracking user activity...\\n"</span>)

<span class="comment"># Product 123: Many views, few purchases</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">50</span>):
    trending.track_view(<span class="string">"product_123"</span>)
trending.track_purchase(<span class="string">"product_123"</span>)
trending.track_purchase(<span class="string">"product_123"</span>)

<span class="comment"># Product 456: Fewer views, more purchases (hotter!)</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">30</span>):
    trending.track_view(<span class="string">"product_456"</span>)
trending.track_purchase(<span class="string">"product_456"</span>)
trending.track_purchase(<span class="string">"product_456"</span>)
trending.track_purchase(<span class="string">"product_456"</span>)
trending.track_purchase(<span class="string">"product_456"</span>)
trending.track_purchase(<span class="string">"product_456"</span>)

<span class="comment"># Product 789: Just views</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">40</span>):
    trending.track_view(<span class="string">"product_789"</span>)

<span class="comment"># Get trending products</span>
<span class="keyword">print</span>(<span class="string">"\\nüî• Top Trending Products:"</span>)
<span class="keyword">for</span> rank, (product_id, score) <span class="keyword">in</span> <span class="function">enumerate</span>(trending.get_trending(<span class="number">5</span>), <span class="number">1</span>):
    <span class="keyword">print</span>(<span class="string">f"  {rank}. {product_id} (score: {score})"</span>)

<span class="comment"># Output:
# üî• Top Trending Products:
#   1. product_456 (score: 80)  ‚Üê 30 views + 5 purchases * 10
#   2. product_123 (score: 70)  ‚Üê 50 views + 2 purchases * 10
#   3. product_789 (score: 40)  ‚Üê 40 views + 0 purchases</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: YouTube-Style Trending Videos</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Video Trending with Time Decay</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">TrendingVideos</span>:
    <span class="keyword">def</span> <span class="function">add_video</span>(<span class="keyword">self</span>, video_id, views_per_hour, upload_timestamp):
        <span class="string">"""
        Add video with trending score
        Score = views_per_hour / hours_since_upload
        Recent + popular = highest score
        """</span>
        hours_old = (time.time() - upload_timestamp) / <span class="number">3600</span>
        
        <span class="comment"># Prevent division by zero</span>
        hours_old = <span class="function">max</span>(hours_old, <span class="number">1</span>)
        
        <span class="comment"># Trending score: velocity / age</span>
        score = views_per_hour / hours_old
        
        r.zadd(<span class="string">"trending:videos"</span>, {video_id: score})
        <span class="keyword">return</span> score
    
    <span class="keyword">def</span> <span class="function">update_views</span>(<span class="keyword">self</span>, video_id, new_views_per_hour, upload_timestamp):
        <span class="string">"""Update trending score as views change"""</span>
        score = <span class="keyword">self</span>.add_video(video_id, new_views_per_hour, upload_timestamp)
        <span class="keyword">print</span>(<span class="string">f"üìπ Video </span>{video_id}<span class="string"> trending score: </span>{score:<span class="number">.2</span>f}<span class="string">"</span>)
    
    <span class="keyword">def</span> <span class="function">get_trending</span>(<span class="keyword">self</span>, count=<span class="number">10</span>):
        <span class="string">"""Get top trending videos"""</span>
        <span class="keyword">return</span> r.zrevrange(<span class="string">"trending:videos"</span>, <span class="number">0</span>, count - <span class="number">1</span>, withscores=<span class="keyword">True</span>)

<span class="comment"># Usage</span>
trending = TrendingVideos()

now = time.time()

<span class="comment"># Video 1: Old but popular (uploaded 24 hours ago)</span>
trending.add_video(<span class="string">"video_1"</span>, views_per_hour=<span class="number">1000</span>, upload_timestamp=now - <span class="number">86400</span>)

<span class="comment"># Video 2: New and viral! (uploaded 2 hours ago)</span>
trending.add_video(<span class="string">"video_2"</span>, views_per_hour=<span class="number">500</span>, upload_timestamp=now - <span class="number">7200</span>)

<span class="comment"># Video 3: Very new, moderate views (uploaded 1 hour ago)</span>
trending.add_video(<span class="string">"video_3"</span>, views_per_hour=<span class="number">200</span>, upload_timestamp=now - <span class="number">3600</span>)

<span class="keyword">print</span>(<span class="string">"\\nüé¨ Trending Videos:"</span>)
<span class="keyword">for</span> rank, (video_id, score) <span class="keyword">in</span> <span class="function">enumerate</span>(trending.get_trending(<span class="number">5</span>), <span class="number">1</span>):
    <span class="keyword">print</span>(<span class="string">f"  {rank}. {video_id} (score: {float(score):.2f})"</span>)

<span class="comment"># Output:
# üé¨ Trending Videos:
#   1. video_2 (score: 250.00)  ‚Üê 500 views/hr √∑ 2 hours old
#   2. video_3 (score: 200.00)  ‚Üê 200 views/hr √∑ 1 hour old  
#   3. video_1 (score: 41.67)   ‚Üê 1000 views/hr √∑ 24 hours old
#
# Video 2 trends highest: good views + very recent!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: How often should trending scores be recalculated?</h4>
                <p><strong>A:</strong> Depends on volatility! Twitter hashtags: every few seconds (high frequency). E-commerce products: every 5-15 minutes. YouTube trending: hourly. Balance freshness vs compute cost. Use ZINCRBY for incremental updates instead of full recalculation!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What if I need multiple trending lists (by category)?</h4>
                <p><strong>A:</strong> Use separate Sorted Sets! <code>trending:tech</code>, <code>trending:sports</code>, <code>trending:entertainment</code>. Each category gets own rankings. Alternative: single Set with composite keys like <code>tech:article_123</code>, then filter results client-side.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Memory concern: What if Sorted Set grows too large?</h4>
                <p><strong>A:</strong> (1) Use ZREMRANGEBYRANK to keep only top 1000, (2) ZREMRANGEBYSCORE to remove items with score < threshold, (3) Set TTL on entire key for auto-cleanup, (4) Periodic cleanup job to remove stale items. Don't let it grow unbounded!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can I combine multiple signals (views, likes, shares) into one score?</h4>
                <p><strong>A:</strong> Yes! Use weighted formula: <code>score = (views * 1) + (likes * 5) + (shares * 10)</code>. Shares more valuable than likes, likes more than views. Adjust weights based on business logic. Recalculate score whenever any signal changes!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Real-time vs cached trending - which approach?</h4>
                <p><strong>A:</strong> Hybrid! Update scores real-time with ZINCRBY, but cache ZREVRANGE results for 30-60 seconds. Example: cache top 100, serve from cache. Background job updates cache every minute. Users see "near real-time" (good enough!) without hitting Redis for every page load.</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: How does Twitter prevent manipulation of trending hashtags?</h4>
                <p><strong>Answer:</strong> Multiple techniques: (1) Count unique users, not total tweets (prevents one user spamming), (2) Time decay (old tweets don't count), (3) Velocity threshold (must reach certain rate to trend), (4) Geographic filtering (trending in US vs globally), (5) ML to detect bot behavior. Sorted Set holds the scores, but score calculation is sophisticated!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Trending list shows same items for hours. How to force freshness?</h4>
                <p><strong>Answer:</strong> Apply aggressive time decay! Score formula: <code>base_score / (hours_old + 2)^2</code>. The ^2 exponent means scores drop FAST as items age. After 24 hours, even viral content drops 99%. This forces rotation. Also: boost recently added items with recency bonus in score calculation!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Two products same score - how are they ordered?</h4>
                <p><strong>Answer:</strong> Lexicographically (alphabetically) by member string! If products "laptop_123" and "phone_456" both have score 100, laptop sorts first (l < p). To control ties: add tiny random value to scores (100.001, 100.002) or use timestamp as tiebreaker in member name (product_123_1704067200).</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Reddit "Hot" Algorithm Implementation</strong></p>
            
            <p>Reddit's "Hot" tab shows posts that are both popular AND recent. A post with 1000 upvotes from yesterday might rank lower than a post with 100 upvotes from 2 hours ago. How do they implement this with Sorted Sets?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Logarithmic Scoring with Time Penalty</h4>
                
                <p><strong>The "Hot" Formula:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    hot_score = log10(max(|score|, 1)) √ó sign - (age_seconds / 45000)
                </code>
                
                <p><strong>Breaking it down:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>log10(score):</strong> 10 upvotes vs 100 upvotes isn't 10x difference, it's 1 vs 2 (logarithmic)</li>
                    <li><strong>sign:</strong> Positive for upvotes, negative for downvotes</li>
                    <li><strong>age_seconds / 45000:</strong> Each 12.5 hours old = -1 point penalty</li>
                </ul>
                
                <p><strong>What this means:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>Post needs 10x more upvotes to compensate for being 12.5 hours older</li>
                    <li>Very old posts eventually drop off, no matter how many upvotes</li>
                    <li>Recent posts with moderate upvotes can beat old viral posts</li>
                </ul>
                
                <p><strong>Redis Implementation:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    # When post is created
                    score = calculate_hot_score(upvotes=1, downvotes=0, created=now)
                    ZADD subreddit:python:hot {score} "post_id"
                    
                    # When someone votes (recalculate!)
                    new_score = calculate_hot_score(upvotes, downvotes, created)
                    ZADD subreddit:python:hot {new_score} "post_id"
                    
                    # Get hot posts
                    ZREVRANGE subreddit:python:hot 0 24  # Top 25
                </code>
                
                <p><strong>Why it works at scale:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Millions of posts tracked per subreddit</li>
                    <li>‚úÖ Each vote updates one score (O(log N))</li>
                    <li>‚úÖ Fetching top 25 is instant regardless of total posts</li>
                    <li>‚úÖ Natural decay means old posts auto-drop</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî•</span><p><strong>Perfect for trending/ranking</strong> - Auto-sorted, real-time updates</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Score = composite metric</strong> - Combine views, time, engagement</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Top-N queries are instant</strong> - Don't scan entire dataset</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è∞</span><p><strong>Time decay prevents staleness</strong> - Old content naturally drops</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Used by major platforms</strong> - Twitter, YouTube, Reddit rely on this pattern</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Scales to millions</strong> - O(log N) updates handle massive traffic</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Trending</span><span class="keyword-tag">Ranking</span><span class="keyword-tag">Time Decay</span><span class="keyword-tag">ZINCRBY</span><span class="keyword-tag">Real-Time</span><span class="keyword-tag">Popularity</span><span class="keyword-tag">Score Algorithm</span><span class="keyword-tag">Top-N</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You want "trending" to show recent popular items. Which score formula?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Just use view count as score</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) Just use timestamp as score</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">C) Combine: score = views / hours_old</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Random scores to show variety</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: C - Combine views and time</strong>
                    <p>View count alone = old viral content stays forever. Timestamp alone = newest items win regardless of popularity. Combining both gives "velocity": <code>views / hours_old</code> rewards items that are BOTH popular AND recent. Item with 1000 views in 2 hours (score: 500) beats item with 5000 views in 24 hours (score: 208). This is how YouTube, Reddit, and most "trending" systems work!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 35: Why is Hash better than storing JSON as string?
// ============================================================

function getQuestion35Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Junior dev shows code:</strong> "I'm storing user profiles like this: <code>SET user:123 '{"name":"Alice","email":"alice@example.com","age":25}'</code>" Senior dev responds: "That works, but every time you update the email, you have to fetch, parse, modify, and re-save the ENTIRE JSON. Use a Hash instead - update just the email field!"</p>
            <p>But why exactly is Hash better than JSON strings?</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Hash stores field-value pairs under a single key, allowing granular access and updates to individual fields. JSON strings require reading and rewriting the entire value for any change.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Hash vs JSON String Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Operation</th><th style="padding: 10px;">Hash</th><th style="padding: 10px;">JSON String</th></tr>
                    <tr><td style="padding: 8px;">Update 1 field</td><td>HSET (O(1))</td><td>GET + parse + modify + SET (O(N))</td></tr>
                    <tr><td style="padding: 8px;">Read 1 field</td><td>HGET (O(1))</td><td>GET + parse entire JSON</td></tr>
                    <tr><td style="padding: 8px;">Increment counter</td><td>HINCRBY (atomic, O(1))</td><td>GET + parse + modify + SET (race condition!)</td></tr>
                    <tr><td style="padding: 8px;">Memory</td><td>Efficient (per-field)</td><td>Entire string always loaded</td></tr>
                    <tr><td style="padding: 8px;">Network</td><td>Send only changed field</td><td>Send entire JSON</td></tr>
                    <tr><td style="padding: 8px;">Atomicity</td><td>Per-field atomic</td><td>All-or-nothing only</td></tr>
                    <tr><td style="padding: 8px;">Type Safety</td><td>Binary-safe strings</td><td>Must serialize/deserialize</td></tr>
                    <tr><td style="padding: 8px;">Nested Objects</td><td>‚ùå Flat only</td><td>‚úÖ Full nesting</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° When to Use Hash vs JSON:</strong></p>
                <ul>
                    <li><strong>Use Hash:</strong> Flat objects, frequent field updates, atomic operations needed</li>
                    <li><strong>Use JSON String:</strong> Nested objects, always read/write complete object, complex structures</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Hash vs JSON: Field Update Comparison</div>
                <svg viewBox="0 0 900 550" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Updating Email: Hash vs JSON String</text>
                    
                    <!-- HASH Approach -->
                    <text x="225" y="80" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">‚úÖ HASH (Efficient)</text>
                    
                    <rect x="50" y="100" width="350" height="200" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    
                    <text x="225" y="130" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">user:123 (Hash)</text>
                    
                    <rect x="70" y="145" width="140" height="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="85" y="165" fill="#888" font-size="11">name:</text>
                    <text x="180" y="165" text-anchor="end" fill="#fff" font-size="11">"Alice"</text>
                    
                    <rect x="70" y="185" width="140" height="30" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="2" rx="4">
                        <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" repeatCount="indefinite"/>
                    </rect>
                    <text x="85" y="205" fill="#888" font-size="11">email:</text>
                    <text x="180" y="205" text-anchor="end" fill="#fff" font-size="11">"new@email.com"</text>
                    <text x="220" y="205" fill="#00FF88" font-size="10" font-weight="600">‚Üê Updated!</text>
                    
                    <rect x="70" y="225" width="140" height="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="85" y="245" fill="#888" font-size="11">age:</text>
                    <text x="180" y="245" text-anchor="end" fill="#fff" font-size="11">25</text>
                    
                    <text x="80" y="280" fill="#00FF88" font-size="12" font-weight="600">Command:</text>
                    <code style="font-family: monospace;">
                        <text x="90" y="297" fill="#FFA500" font-size="11">HSET user:123 email "new@email.com"</text>
                    </code>
                    
                    <!-- JSON Approach -->
                    <text x="675" y="80" text-anchor="middle" fill="#FF6347" font-size="16" font-weight="600">‚ùå JSON STRING (Inefficient)</text>
                    
                    <rect x="500" y="100" width="350" height="200" fill="rgba(255, 99, 71, 0.1)" stroke="#FF6347" stroke-width="3" rx="8"/>
                    
                    <text x="675" y="130" text-anchor="middle" fill="#FF6347" font-size="13" font-weight="600">user:123 (String)</text>
                    
                    <rect x="520" y="145" width="300" height="100" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="530" y="165" fill="#888" font-size="10">{</text>
                    <text x="540" y="183" fill="#fff" font-size="10">"name": "Alice",</text>
                    <text x="540" y="201" fill="#00FF88" font-size="10">"email": "new@email.com",  ‚Üê Changed</text>
                    <text x="540" y="219" fill="#fff" font-size="10">"age": 25</text>
                    <text x="530" y="237" fill="#888" font-size="10">}</text>
                    
                    <text x="510" y="265" fill="#FF6347" font-size="11" font-weight="600">Must replace ENTIRE string!</text>
                    
                    <text x="510" y="285" fill="#FFA500" font-size="10">1. GET user:123</text>
                    <text x="510" y="298" fill="#FFA500" font-size="10">2. Parse JSON</text>
                    <text x="750" y="285" fill="#FFA500" font-size="10">3. Modify email field</text>
                    <text x="750" y="298" fill="#FFA500" font-size="10">4. Serialize to JSON</text>
                    <text x="630" y="180" fill="#FFA500" font-size="10">5. SET user:123 "{...}"</text>
                    
                    <!-- Bottom Performance Comparison -->
                    <rect x="50" y="330" width="800" height="200" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="360" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">‚ö° Performance Impact</text>
                    
                    <rect x="70" y="380" width="360" height="130" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="250" y="405" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">Hash Advantages</text>
                    <text x="85" y="428" fill="#bbb" font-size="11">‚úÖ Update: 1 command (HSET)</text>
                    <text x="85" y="448" fill="#bbb" font-size="11">‚úÖ Network: ~20 bytes (field + value)</text>
                    <text x="85" y="468" fill="#bbb" font-size="11">‚úÖ CPU: No parsing needed</text>
                    <text x="85" y="488" fill="#bbb" font-size="11">‚úÖ Atomic: HINCRBY for counters</text>
                    <text x="85" y="505" fill="#00FF88" font-size="10" font-weight="600">Perfect for user sessions, profiles</text>
                    
                    <rect x="470" y="380" width="360" height="130" fill="rgba(255,99,71,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="650" y="405" text-anchor="middle" fill="#FF6347" font-size="13" font-weight="600">JSON String Drawbacks</text>
                    <text x="485" y="428" fill="#bbb" font-size="11">‚ùå Update: 5 steps (GET, parse, modify, serialize, SET)</text>
                    <text x="485" y="448" fill="#bbb" font-size="11">‚ùå Network: ~100+ bytes (entire JSON)</text>
                    <text x="485" y="468" fill="#bbb" font-size="11">‚ùå CPU: JSON parse + serialize overhead</text>
                    <text x="485" y="488" fill="#bbb" font-size="11">‚ùå Race conditions: Between GET and SET</text>
                    <text x="485" y="505" fill="#FFA500" font-size="10" font-weight="600">Use only for complex nested objects</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: User Profile - Hash vs JSON</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Performance Comparison</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json
<span class="keyword">import</span> time

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Approach 1: JSON STRING</span>
<span class="keyword">def</span> <span class="function">update_email_json</span>(user_id, new_email):
    <span class="string">"""Update email using JSON string - INEFFICIENT"""</span>
    <span class="comment"># Step 1: GET entire JSON</span>
    user_json = r.get(<span class="string">f"user_json:</span>{user_id}<span class="string">"</span>)
    
    <span class="comment"># Step 2: Parse JSON</span>
    user = json.loads(user_json)
    
    <span class="comment"># Step 3: Modify field</span>
    user[<span class="string">'email'</span>] = new_email
    
    <span class="comment"># Step 4: Serialize back to JSON</span>
    new_json = json.dumps(user)
    
    <span class="comment"># Step 5: SET entire JSON</span>
    r.set(<span class="string">f"user_json:</span>{user_id}<span class="string">"</span>, new_json)

<span class="comment"># Approach 2: HASH</span>
<span class="keyword">def</span> <span class="function">update_email_hash</span>(user_id, new_email):
    <span class="string">"""Update email using Hash - EFFICIENT"""</span>
    <span class="comment"># One command! Updates just the email field</span>
    r.hset(<span class="string">f"user_hash:</span>{user_id}<span class="string">"</span>, <span class="string">"email"</span>, new_email)

<span class="comment"># Setup test data</span>
user_data = {
    <span class="string">"name"</span>: <span class="string">"Alice"</span>,
    <span class="string">"email"</span>: <span class="string">"old@example.com"</span>,
    <span class="string">"age"</span>: <span class="number">25</span>,
    <span class="string">"city"</span>: <span class="string">"New York"</span>,
    <span class="string">"premium"</span>: <span class="keyword">True</span>
}

<span class="comment"># Store as JSON</span>
r.set(<span class="string">"user_json:123"</span>, json.dumps(user_data))

<span class="comment"># Store as Hash</span>
r.hset(<span class="string">"user_hash:123"</span>, mapping=user_data)

<span class="comment"># Benchmark: Update email 1000 times</span>
iterations = <span class="number">1000</span>

<span class="comment"># JSON approach</span>
start = time.time()
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(iterations):
    update_email_json(<span class="number">123</span>, <span class="string">f"email</span>{i}<span class="string">@example.com"</span>)
json_time = time.time() - start

<span class="comment"># Hash approach</span>
start = time.time()
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(iterations):
    update_email_hash(<span class="number">123</span>, <span class="string">f"email</span>{i}<span class="string">@example.com"</span>)
hash_time = time.time() - start

<span class="keyword">print</span>(<span class="string">f"\\nüìä Benchmark Results (</span>{iterations}<span class="string"> updates):"</span>)
<span class="keyword">print</span>(<span class="string">f"JSON String: </span>{json_time:<span class="number">.3</span>f}<span class="string">s"</span>)
<span class="keyword">print</span>(<span class="string">f"Hash:        </span>{hash_time:<span class="number">.3</span>f}<span class="string">s"</span>)
<span class="keyword">print</span>(<span class="string">f"\\nüí° Hash is </span>{json_time/hash_time:<span class="number">.1</span>f}<span class="string">x faster!"</span>)

<span class="comment"># Typical output:
# üìä Benchmark Results (1000 updates):
# JSON String: 0.452s
# Hash:        0.089s
# üí° Hash is 5.1x faster!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Atomic Counter Operations</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Why Hash Wins for Counters</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json
<span class="keyword">from</span> threading <span class="keyword">import</span> Thread

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Approach 1: JSON - RACE CONDITION!</span>
<span class="keyword">def</span> <span class="function">increment_views_json</span>(post_id):
    <span class="string">"""Increment views - JSON has race condition"""</span>
    post_json = r.get(<span class="string">f"post_json:</span>{post_id}<span class="string">"</span>)
    post = json.loads(post_json)
    
    <span class="comment"># PROBLEM: Another thread might modify between GET and SET!</span>
    post[<span class="string">'views'</span>] += <span class="number">1</span>
    
    r.set(<span class="string">f"post_json:</span>{post_id}<span class="string">"</span>, json.dumps(post))

<span class="comment"># Approach 2: HASH - ATOMIC!</span>
<span class="keyword">def</span> <span class="function">increment_views_hash</span>(post_id):
    <span class="string">"""Increment views - Hash is atomic"""</span>
    <span class="comment"># HINCRBY is atomic - no race condition possible!</span>
    r.hincrby(<span class="string">f"post_hash:</span>{post_id}<span class="string">"</span>, <span class="string">"views"</span>, <span class="number">1</span>)

<span class="comment"># Setup test data</span>
r.set(<span class="string">"post_json:1"</span>, json.dumps({<span class="string">"title"</span>: <span class="string">"Test"</span>, <span class="string">"views"</span>: <span class="number">0</span>}))
r.hset(<span class="string">"post_hash:1"</span>, mapping={<span class="string">"title"</span>: <span class="string">"Test"</span>, <span class="string">"views"</span>: <span class="number">0</span>})

<span class="comment"># Simulate concurrent users (100 threads)</span>
threads = []
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">100</span>):
    t = Thread(target=increment_views_json, args=(<span class="number">1</span>,))
    threads.append(t)
    t.start()

<span class="keyword">for</span> t <span class="keyword">in</span> threads:
    t.join()

json_views = json.loads(r.get(<span class="string">"post_json:1"</span>))[<span class="string">'views'</span>]

<span class="comment"># Now with Hash</span>
threads = []
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">100</span>):
    t = Thread(target=increment_views_hash, args=(<span class="number">1</span>,))
    threads.append(t)
    t.start()

<span class="keyword">for</span> t <span class="keyword">in</span> threads:
    t.join()

hash_views = <span class="function">int</span>(r.hget(<span class="string">"post_hash:1"</span>, <span class="string">"views"</span>))

<span class="keyword">print</span>(<span class="string">f"\\nüéØ Concurrent Increment Test:"</span>)
<span class="keyword">print</span>(<span class="string">f"Expected: 100 views"</span>)
<span class="keyword">print</span>(<span class="string">f"JSON String: </span>{json_views}<span class="string"> views ‚ùå (race conditions!)"</span>)
<span class="keyword">print</span>(<span class="string">f"Hash:        </span>{hash_views}<span class="string"> views ‚úÖ (atomic!)"</span>)

<span class="comment"># Typical output:
# üéØ Concurrent Increment Test:
# Expected: 100 views
# JSON String: 87 views ‚ùå (lost 13 updates!)
# Hash:        100 views ‚úÖ (perfect!)</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Can Hash store nested objects like JSON?</h4>
                <p><strong>A:</strong> No! Hash is flat key-value only. For nested objects: (1) Store as JSON string in Hash field, (2) Use separate Hashes (user:123:address with its own fields), or (3) Use flat keys (user:123 with field "address_city", "address_street"). Hash = one level deep only!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Memory: Does Hash use more or less than JSON string?</h4>
                <p><strong>A:</strong> Slightly more overhead per Hash, but saves memory for partial updates! Hash has ~40 bytes overhead per key. For large objects with frequent partial updates, Hash wins overall (no duplicate copies during updates). For small, static objects, JSON string might use less memory.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can I query "all users where age > 25" with Hashes?</h4>
                <p><strong>A:</strong> No! Redis Hashes don't support queries/filtering. Must: (1) Fetch all user Hashes, filter in code (slow!), (2) Maintain secondary indexes (use Sets for "users:age:25", "users:age:26" etc), or (3) Use RediSearch module for complex queries. Hash = simple key-value access only!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: When SHOULD I use JSON strings over Hash?</h4>
                <p><strong>A:</strong> Use JSON when: (1) Nested/complex objects that change together, (2) Always read/write entire object (never partial), (3) Need array/list fields, (4) Object structure varies (dynamic schemas), (5) Integrating with JSON APIs. If frequently updating ONE field in large object ‚Üí Hash wins!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Can I mix Hash and JSON - hybrid approach?</h4>
                <p><strong>A:</strong> Yes! Common pattern: Hash for frequently updated fields (email, last_login, view_count), JSON string in Hash field for complex nested data (preferences, settings). Example: <code>HSET user:123 email "..." settings "{...json...}"</code>. Best of both worlds!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: User has 50 fields. Fetch entire profile or just 3 needed fields?</h4>
                <p><strong>Answer:</strong> Fetch only needed fields with HMGET! <code>HMGET user:123 name email age</code> returns just those 3, not all 50. Hash advantage: granular reads. Don't use HGETALL unless you need everything - saves network bandwidth and parsing time!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I expire individual Hash fields?</h4>
                <p><strong>Answer:</strong> No! TTL applies to entire Hash key, not individual fields. Workaround: (1) Store fields that expire together in separate Hashes with different TTLs, (2) Use field naming with timestamps, cleanup periodically, or (3) Store expirable data as separate keys. Hash expiration = all or nothing!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Hash vs separate keys (user:123:name, user:123:email)?</h4>
                <p><strong>Answer:</strong> Hash is better! Separate keys = (1) Multiple network round-trips (MGET needed), (2) More memory overhead (50 keys vs 1 Hash), (3) Harder to manage expiration, (4) Can't atomic get all fields. Only use separate keys if fields have different TTLs or access patterns. Hash logically groups related data!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: User Session Management</strong></p>
            
            <p>Web application with 10 million active users. Each user session stores: user_id, last_activity, page_views, cart_items_count. Sessions need frequent updates (every page view). Hash vs JSON?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Hash for Session Storage</h4>
                
                <p><strong>Why Hash wins:</strong></p>
                
                <p><strong>Scenario:</strong> User views a page</p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    # Hash approach (2 commands, ~50 bytes network)
                    HINCRBY session:abc123 page_views 1
                    HSET session:abc123 last_activity 1704067200
                </code>
                
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    # JSON approach (5 steps, ~200+ bytes network)
                    GET session:abc123  # Fetch ~200 bytes
                    # Parse JSON in app
                    # Increment page_views
                    # Update last_activity
                    SET session:abc123 "{...}"  # Send ~200 bytes back
                </code>
                
                <p><strong>Impact at scale (10M users, 1000 updates/sec each):</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>Hash:</strong> 2 commands √ó 50 bytes = 100 bytes/update ‚Üí 100GB/sec network</li>
                    <li><strong>JSON:</strong> 400 bytes/update ‚Üí 400GB/sec network</li>
                    <li>‚úÖ Hash saves 75% bandwidth!</li>
                    <li>‚úÖ 4x less Redis CPU (no serialization)</li>
                    <li>‚úÖ Atomic updates (no race conditions)</li>
                </ul>
                
                <p><strong>Code:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    # Update session on each page view
                    pipe = r.pipeline()
                    pipe.hincrby(f"session:{session_id}", "page_views", 1)
                    pipe.hset(f"session:{session_id}", "last_activity", int(time.time()))
                    pipe.expire(f"session:{session_id}", 3600)  # 1 hour TTL
                    pipe.execute()
                </code>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Granular updates</strong> - Change one field without touching others (O(1) vs O(N))</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>Atomic operations</strong> - HINCRBY prevents race conditions unlike JSON</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì°</span><p><strong>Network efficiency</strong> - Send only changed data, not entire object</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üöÄ</span><p><strong>Performance</strong> - 3-5x faster for field updates (no parse/serialize)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ùå</span><p><strong>Flat only</strong> - Can't store nested objects directly (JSON wins there)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Use Hash for:</strong> User profiles, sessions, frequently updated objects</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Hash vs JSON</span><span class="keyword-tag">HSET</span><span class="keyword-tag">HGET</span><span class="keyword-tag">HINCRBY</span><span class="keyword-tag">Granular Update</span><span class="keyword-tag">Atomic</span><span class="keyword-tag">Performance</span><span class="keyword-tag">Session</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You need to increment a view counter 1000 times/sec. Which is safer and faster?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) JSON: GET, parse, increment, SET</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Hash: HINCRBY views 1</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Both equally safe and fast</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Use separate String key with INCR</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Hash HINCRBY</strong>
                    <p>HINCRBY is atomic (one operation) and fast (O(1)). JSON approach requires GET+parse+modify+SET = 4 operations with race condition risk between GET and SET. At 1000/sec, you'd lose updates with JSON! While separate String with INCR works, Hash groups related data better. For counters in objects, Hash HINCRBY is the optimal choice: atomic, fast, groups data logically.</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 36: Practical use case of Redis Hash
// ============================================================

function getQuestion36Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Product manager asks:</strong> "We need a shopping cart. Users add/remove items, change quantities, and checkout. Where do we store this?" Developer responds: "Perfect for Redis Hash! Cart ID is the key, product IDs are fields, quantities are values. Lightning fast cart operations!"</p>
            <p>Let's explore how Redis Hashes power real-world shopping carts.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Hash is ideal for representing objects with multiple fields that need independent access and updates - shopping carts, user profiles, product catalogs, session data, and configuration settings.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Common Hash Use Cases</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Use Case</th><th style="padding: 10px;">Key</th><th style="padding: 10px;">Fields</th></tr>
                    <tr><td style="padding: 8px;">Shopping Cart</td><td>cart:user_123</td><td>product_id ‚Üí quantity</td></tr>
                    <tr><td style="padding: 8px;">User Profile</td><td>user:456</td><td>name, email, age, city</td></tr>
                    <tr><td style="padding: 8px;">User Session</td><td>session:abc</td><td>user_id, login_time, ip</td></tr>
                    <tr><td style="padding: 8px;">Product Info</td><td>product:789</td><td>name, price, stock, category</td></tr>
                    <tr><td style="padding: 8px;">Rate Limiting</td><td>rate:user_123:2024-01-09</td><td>api_calls, last_reset</td></tr>
                    <tr><td style="padding: 8px;">Cache Object</td><td>cache:article_111</td><td>title, body, author, tags</td></tr>
                    <tr><td style="padding: 8px;">Configuration</td><td>config:app</td><td>max_upload, timeout, theme</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Why Hash is Perfect:</strong></p>
                <ul>
                    <li><strong>Logical grouping:</strong> Related data under one key</li>
                    <li><strong>Partial access:</strong> Read/update individual fields without affecting others</li>
                    <li><strong>Atomic operations:</strong> HINCRBY for counters, HSETNX for "set if not exists"</li>
                    <li><strong>Memory efficient:</strong> Optimized encoding for small Hashes</li>
                    <li><strong>Simple to query:</strong> HGETALL, HGET, HMGET - intuitive field access</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Shopping Cart Implementation with Redis Hash</div>
                <svg viewBox="0 0 900 550" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">E-Commerce Shopping Cart System</text>
                    
                    <!-- Cart Structure -->
                    <rect x="50" y="60" width="800" height="200" fill="rgba(220, 20, 60, 0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">üõí Hash Key: cart:user_12345</text>
                    
                    <!-- Cart Items -->
                    <rect x="80" y="110" width="220" height="120" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="190" y="135" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Product: laptop_789</text>
                    <rect x="100" y="145" width="160" height="70" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="110" y="165" fill="#888" font-size="11">Field:</text>
                    <text x="230" y="165" text-anchor="end" fill="#fff" font-size="11">laptop_789</text>
                    <text x="110" y="185" fill="#888" font-size="11">Value (qty):</text>
                    <text x="230" y="185" text-anchor="end" fill="#FFA500" font-size="12" font-weight="600">2</text>
                    <text x="110" y="205" fill="#00FF88" font-size="10">‚úÖ 2 laptops in cart</text>
                    
                    <rect x="330" y="110" width="220" height="120" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="440" y="135" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Product: mouse_456</text>
                    <rect x="350" y="145" width="160" height="70" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="360" y="165" fill="#888" font-size="11">Field:</text>
                    <text x="480" y="165" text-anchor="end" fill="#fff" font-size="11">mouse_456</text>
                    <text x="360" y="185" fill="#888" font-size="11">Value (qty):</text>
                    <text x="480" y="185" text-anchor="end" fill="#FFA500" font-size="12" font-weight="600">5</text>
                    <text x="360" y="205" fill="#00FF88" font-size="10">‚úÖ 5 mice in cart</text>
                    
                    <rect x="580" y="110" width="220" height="120" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="690" y="135" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Product: keyboard_123</text>
                    <rect x="600" y="145" width="160" height="70" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="610" y="165" fill="#888" font-size="11">Field:</text>
                    <text x="730" y="165" text-anchor="end" fill="#fff" font-size="11">keyboard_123</text>
                    <text x="610" y="185" fill="#888" font-size="11">Value (qty):</text>
                    <text x="730" y="185" text-anchor="end" fill="#FFA500" font-size="12" font-weight="600">1</text>
                    <text x="610" y="205" fill="#00FF88" font-size="10">‚úÖ 1 keyboard in cart</text>
                    
                    <!-- Operations -->
                    <rect x="50" y="280" width="800" height="250" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="310" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">‚ö° Cart Operations</text>
                    
                    <!-- Add to Cart -->
                    <text x="80" y="340" fill="#00FF88" font-size="12" font-weight="600">1. Add Item to Cart:</text>
                    <code style="font-family: monospace;">
                        <text x="90" y="360" fill="#FFA500" font-size="11">HSET cart:user_12345 laptop_789 2</text>
                    </code>
                    <text x="100" y="377" fill="#888" font-size="10">‚Üí Sets laptop quantity to 2</text>
                    <text x="100" y="392" fill="#888" font-size="10">‚Üí Overwrites if exists, creates if new</text>
                    
                    <!-- Update Quantity -->
                    <text x="80" y="420" fill="#00FF88" font-size="12" font-weight="600">2. Increase Quantity:</text>
                    <code style="font-family: monospace;">
                        <text x="90" y="440" fill="#FFA500" font-size="11">HINCRBY cart:user_12345 mouse_456 3</text>
                    </code>
                    <text x="100" y="457" fill="#888" font-size="10">‚Üí Adds 3 to current quantity</text>
                    <text x="100" y="472" fill="#888" font-size="10">‚Üí If mouse_456 had qty 2, now it's 5</text>
                    
                    <!-- Get Cart -->
                    <text x="480" y="340" fill="#00FF88" font-size="12" font-weight="600">3. Get All Cart Items:</text>
                    <code style="font-family: monospace;">
                        <text x="490" y="360" fill="#FFA500" font-size="11">HGETALL cart:user_12345</text>
                    </code>
                    <text x="500" y="377" fill="#fff" font-size="10">Returns: {</text>
                    <text x="510" y="391" fill="#fff" font-size="10">"laptop_789": "2",</text>
                    <text x="510" y="405" fill="#fff" font-size="10">"mouse_456": "5",</text>
                    <text x="510" y="419" fill="#fff" font-size="10">"keyboard_123": "1"</text>
                    <text x="500" y="433" fill="#fff" font-size="10">}</text>
                    
                    <!-- Remove Item -->
                    <text x="480" y="460" fill="#00FF88" font-size="12" font-weight="600">4. Remove Item:</text>
                    <code style="font-family: monospace;">
                        <text x="490" y="480" fill="#FFA500" font-size="11">HDEL cart:user_12345 keyboard_123</text>
                    </code>
                    <text x="500" y="497" fill="#888" font-size="10">‚Üí Deletes keyboard from cart</text>
                    
                    <!-- Benefits Box -->
                    <rect x="70" y="500" width="760" height="20" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="1" rx="4"/>
                    <text x="450" y="515" text-anchor="middle" fill="#00FF88" font-size="11">‚úÖ Fast ‚Ä¢ Atomic ‚Ä¢ Single key = logical cart ‚Ä¢ Auto-expires with TTL ‚Ä¢ Scales to millions of users</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Complete Shopping Cart System</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Production-Ready Cart Implementation</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">ShoppingCart</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, user_id):
        <span class="keyword">self</span>.key = <span class="string">f"cart:</span>{user_id}<span class="string">"</span>
        <span class="keyword">self</span>.ttl = <span class="number">86400</span> * <span class="number">7</span>  <span class="comment"># 7 days</span>
    
    <span class="keyword">def</span> <span class="function">add_item</span>(<span class="keyword">self</span>, product_id, quantity=<span class="number">1</span>):
        <span class="string">"""Add product to cart or update quantity"""</span>
        <span class="comment"># HINCRBY adds to existing or creates new</span>
        new_qty = r.hincrby(<span class="keyword">self</span>.key, product_id, quantity)
        
        <span class="comment"># Reset cart expiration on activity</span>
        r.expire(<span class="keyword">self</span>.key, <span class="keyword">self</span>.ttl)
        
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Added </span>{quantity}<span class="string"> √ó </span>{product_id}<span class="string"> (total: </span>{new_qty}<span class="string">)"</span>)
        <span class="keyword">return</span> <span class="function">int</span>(new_qty)
    
    <span class="keyword">def</span> <span class="function">remove_item</span>(<span class="keyword">self</span>, product_id):
        <span class="string">"""Remove product from cart"""</span>
        removed = r.hdel(<span class="keyword">self</span>.key, product_id)
        
        <span class="keyword">if</span> removed:
            <span class="keyword">print</span>(<span class="string">f"üóëÔ∏è Removed </span>{product_id}<span class="string"> from cart"</span>)
            <span class="keyword">return</span> <span class="keyword">True</span>
        <span class="keyword">else</span>:
            <span class="keyword">print</span>(<span class="string">f"‚ùå </span>{product_id}<span class="string"> not in cart"</span>)
            <span class="keyword">return</span> <span class="keyword">False</span>
    
    <span class="keyword">def</span> <span class="function">update_quantity</span>(<span class="keyword">self</span>, product_id, quantity):
        <span class="string">"""Set exact quantity for product"""</span>
        <span class="keyword">if</span> quantity <= <span class="number">0</span>:
            <span class="keyword">return</span> <span class="keyword">self</span>.remove_item(product_id)
        
        r.hset(<span class="keyword">self</span>.key, product_id, quantity)
        r.expire(<span class="keyword">self</span>.key, <span class="keyword">self</span>.ttl)
        <span class="keyword">print</span>(<span class="string">f"üîÑ Updated </span>{product_id}<span class="string"> quantity to </span>{quantity}<span class="string">"</span>)
    
    <span class="keyword">def</span> <span class="function">get_items</span>(<span class="keyword">self</span>):
        <span class="string">"""Get all items in cart"""</span>
        items = r.hgetall(<span class="keyword">self</span>.key)
        <span class="comment"># Convert quantities to integers</span>
        <span class="keyword">return</span> {product_id: <span class="function">int</span>(qty) <span class="keyword">for</span> product_id, qty <span class="keyword">in</span> items.items()}
    
    <span class="keyword">def</span> <span class="function">get_item_count</span>(<span class="keyword">self</span>):
        <span class="string">"""Get number of unique items"""</span>
        <span class="keyword">return</span> r.hlen(<span class="keyword">self</span>.key)
    
    <span class="keyword">def</span> <span class="function">get_total_quantity</span>(<span class="keyword">self</span>):
        <span class="string">"""Get total number of items (sum of quantities)"""</span>
        items = <span class="keyword">self</span>.get_items()
        <span class="keyword">return</span> <span class="function">sum</span>(items.values())
    
    <span class="keyword">def</span> <span class="function">clear</span>(<span class="keyword">self</span>):
        <span class="string">"""Empty the cart"""</span>
        r.delete(<span class="keyword">self</span>.key)
        <span class="keyword">print</span>(<span class="string">"üóëÔ∏è Cart cleared"</span>)
    
    <span class="keyword">def</span> <span class="function">exists</span>(<span class="keyword">self</span>):
        <span class="string">"""Check if cart exists"""</span>
        <span class="keyword">return</span> r.exists(<span class="keyword">self</span>.key) == <span class="number">1</span>

<span class="comment"># Usage Example</span>
cart = ShoppingCart(user_id=<span class="string">"user_12345"</span>)

<span class="comment"># Add items</span>
cart.add_item(<span class="string">"laptop_789"</span>, quantity=<span class="number">1</span>)
cart.add_item(<span class="string">"mouse_456"</span>, quantity=<span class="number">2</span>)
cart.add_item(<span class="string">"keyboard_123"</span>, quantity=<span class="number">1</span>)

<span class="comment"># Add more of same item</span>
cart.add_item(<span class="string">"mouse_456"</span>, quantity=<span class="number">3</span>)  <span class="comment"># Now 5 total</span>

<span class="comment"># View cart</span>
<span class="keyword">print</span>(<span class="string">f"\\nüõí Cart Contents:"</span>)
<span class="keyword">for</span> product_id, qty <span class="keyword">in</span> cart.get_items().items():
    <span class="keyword">print</span>(<span class="string">f"  ‚Ä¢ {product_id}: {qty}"</span>)

<span class="keyword">print</span>(<span class="string">f"\\nUnique items: {cart.get_item_count()}"</span>)
<span class="keyword">print</span>(<span class="string">f"Total items: {cart.get_total_quantity()}"</span>)

<span class="comment"># Update quantity</span>
cart.update_quantity(<span class="string">"laptop_789"</span>, <span class="number">2</span>)

<span class="comment"># Remove item</span>
cart.remove_item(<span class="string">"keyboard_123"</span>)

<span class="comment"># Final cart</span>
<span class="keyword">print</span>(<span class="string">f"\\nüì¶ Final Cart: {cart.get_items()}"</span>)

<span class="comment"># Output:
# ‚úÖ Added 1 √ó laptop_789 (total: 1)
# ‚úÖ Added 2 √ó mouse_456 (total: 2)
# ‚úÖ Added 1 √ó keyboard_123 (total: 1)
# ‚úÖ Added 3 √ó mouse_456 (total: 5)
# 
# üõí Cart Contents:
#   ‚Ä¢ laptop_789: 1
#   ‚Ä¢ mouse_456: 5
#   ‚Ä¢ keyboard_123: 1
# 
# Unique items: 3
# Total items: 7
# üîÑ Updated laptop_789 quantity to 2
# üóëÔ∏è Removed keyboard_123 from cart
# 
# üì¶ Final Cart: {'laptop_789': 2, 'mouse_456': 5}</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: User Session Storage</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Session Management with Hash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time
<span class="keyword">import</span> json

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">class</span> <span class="function">UserSession</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, session_id):
        <span class="keyword">self</span>.key = <span class="string">f"session:</span>{session_id}<span class="string">"</span>
        <span class="keyword">self</span>.ttl = <span class="number">3600</span>  <span class="comment"># 1 hour</span>
    
    <span class="keyword">def</span> <span class="function">create</span>(<span class="keyword">self</span>, user_id, username, ip_address):
        <span class="string">"""Create new session"""</span>
        session_data = {
            <span class="string">'user_id'</span>: user_id,
            <span class="string">'username'</span>: username,
            <span class="string">'ip_address'</span>: ip_address,
            <span class="string">'login_time'</span>: <span class="function">int</span>(time.time()),
            <span class="string">'page_views'</span>: <span class="number">0</span>,
            <span class="string">'last_activity'</span>: <span class="function">int</span>(time.time())
        }
        
        r.hset(<span class="keyword">self</span>.key, mapping=session_data)
        r.expire(<span class="keyword">self</span>.key, <span class="keyword">self</span>.ttl)
        
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Session created for {username}"</span>)
    
    <span class="keyword">def</span> <span class="function">track_activity</span>(<span class="keyword">self</span>):
        <span class="string">"""Track page view and update last activity"""</span>
        pipe = r.pipeline()
        pipe.hincrby(<span class="keyword">self</span>.key, <span class="string">'page_views'</span>, <span class="number">1</span>)
        pipe.hset(<span class="keyword">self</span>.key, <span class="string">'last_activity'</span>, <span class="function">int</span>(time.time()))
        pipe.expire(<span class="keyword">self</span>.key, <span class="keyword">self</span>.ttl)  <span class="comment"># Reset TTL</span>
        results = pipe.execute()
        
        page_views = results[<span class="number">0</span>]
        <span class="keyword">print</span>(<span class="string">f"üìä Page view </span>{page_views}<span class="string">"</span>)
    
    <span class="keyword">def</span> <span class="function">get_session</span>(<span class="keyword">self</span>):
        <span class="string">"""Get all session data"""</span>
        <span class="keyword">return</span> r.hgetall(<span class="keyword">self</span>.key)
    
    <span class="keyword">def</span> <span class="function">get_field</span>(<span class="keyword">self</span>, field):
        <span class="string">"""Get specific session field"""</span>
        <span class="keyword">return</span> r.hget(<span class="keyword">self</span>.key, field)
    
    <span class="keyword">def</span> <span class="function">is_active</span>(<span class="keyword">self</span>):
        <span class="string">"""Check if session exists"""</span>
        <span class="keyword">return</span> r.exists(<span class="keyword">self</span>.key) == <span class="number">1</span>
    
    <span class="keyword">def</span> <span class="function">logout</span>(<span class="keyword">self</span>):
        <span class="string">"""Destroy session"""</span>
        r.delete(<span class="keyword">self</span>.key)
        <span class="keyword">print</span>(<span class="string">"üëã Session destroyed"</span>)

<span class="comment"># Usage</span>
session = UserSession(session_id=<span class="string">"abc123xyz"</span>)

<span class="comment"># User logs in</span>
session.create(
    user_id=<span class="string">"user_789"</span>,
    username=<span class="string">"alice"</span>,
    ip_address=<span class="string">"192.168.1.100"</span>
)

<span class="comment"># User browses pages</span>
session.track_activity()
time.sleep(<span class="number">1</span>)
session.track_activity()
time.sleep(<span class="number">1</span>)
session.track_activity()

<span class="comment"># Get session info</span>
<span class="keyword">print</span>(<span class="string">f"\\nüìã Session Data:"</span>)
session_data = session.get_session()
<span class="keyword">for</span> field, value <span class="keyword">in</span> session_data.items():
    <span class="keyword">print</span>(<span class="string">f"  {field}: {value}"</span>)

<span class="comment"># Check specific field</span>
username = session.get_field(<span class="string">'username'</span>)
<span class="keyword">print</span>(<span class="string">f"\\nLogged in as: {username}"</span>)

<span class="comment"># Output:
# ‚úÖ Session created for alice
# üìä Page view 1
# üìä Page view 2
# üìä Page view 3
# 
# üìã Session Data:
#   user_id: user_789
#   username: alice
#   ip_address: 192.168.1.100
#   login_time: 1704067200
#   page_views: 3
#   last_activity: 1704067202
# 
# Logged in as: alice</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Cart has 1000 items. Should I use Hash or separate keys?</h4>
                <p><strong>A:</strong> Hash! Advantages: (1) Single key = logical grouping, (2) HGETALL fetches all in one command, (3) Atomic operations on entire cart, (4) One TTL for whole cart. Separate keys would need MGET (1000 commands!), complex expiration management, no atomicity. Hash is perfect for this!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: How to implement "cart total price" in real-time?</h4>
                <p><strong>A:</strong> Two approaches: (1) Calculate on-demand: HGETALL cart, fetch product prices, multiply qty √ó price, sum up, or (2) Store total in Hash field: on each cart update, recalculate total and HSET cart total_price. Approach 2 faster for reads, approach 1 always accurate if prices change!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: User abandons cart. How long should it persist?</h4>
                <p><strong>A:</strong> E-commerce best practice: 7-30 days with EXPIRE. Reset TTL on each cart modification (EXPIRE after HSET). After expiration, optionally save to database for "recover abandoned cart" emails. Redis = active carts, DB = historical/abandoned carts!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can I store product details (name, price, image) in cart Hash?</h4>
                <p><strong>A:</strong> Bad idea! Cart should store only product_id ‚Üí quantity. Fetch product details from separate product:ID Hashes or database. Why? (1) Product data can change (price updates), (2) Duplicate data across all carts (memory waste), (3) Cart updates shouldn't touch product data. Separation of concerns!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Multiple users add same product simultaneously. Race condition?</h4>
                <p><strong>A:</strong> No! Each user has their own cart Hash (cart:user_123, cart:user_456). No sharing = no race conditions. Even if same product, different cart keys. HINCRBY is atomic within a single Hash, so concurrent updates to ONE user's cart are also safe!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: User adds item, then product goes out of stock. How to handle?</h4>
                <p><strong>Answer:</strong> Cart stores product_id ‚Üí qty only. At checkout: (1) HGETALL cart, (2) For each product_id, check stock in DB/Redis, (3) If out of stock, notify user, remove from cart with HDEL. Cart is "intent to buy", not "reservation". Validate inventory at checkout, not at add-to-cart time!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: How to merge carts when user logs in after anonymous browsing?</h4>
                <p><strong>Answer:</strong> Two carts exist: cart:anonymous_xyz and cart:user_123. Merge: (1) HGETALL cart:anonymous_xyz, (2) For each item, HINCRBY cart:user_123 product_id qty (adds quantities!), (3) DELETE cart:anonymous_xyz. Result: user's cart contains both anonymous + logged-in items with combined quantities!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Should I store cart items as "product_id" or "product_id:variant_id"?</h4>
                <p><strong>Answer:</strong> Use composite field! "laptop_789:color_red:size_15inch" as field name. Each variant = separate field. Why? User might want same laptop in different colors. Alternative: nested structure, but Hash is flat. Composite keys = simple and effective for variants!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Amazon Shopping Cart at Scale</strong></p>
            
            <p>Amazon handles millions of shopping carts simultaneously. Users add items, change quantities, abandon carts, return days later. How does Redis Hash power this?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Hash-Based Cart Architecture</h4>
                
                <p><strong>Data Structure:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    Key: cart:user_{user_id}
                    Fields: {product_id}:{variant} ‚Üí quantity
                    TTL: 30 days (reset on each update)
                </code>
                
                <p><strong>Why Hash works at Amazon scale:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>10M active carts:</strong> Each cart = 1 Hash key, avg 5 items = 5 fields ‚Üí 50M fields total, manageable!</li>
                    <li><strong>Add item:</strong> HINCRBY cart:user_123 laptop_789 1 (0.1ms)</li>
                    <li><strong>Update quantity:</strong> HSET cart:user_123 laptop_789 3 (0.1ms)</li>
                    <li><strong>Remove item:</strong> HDEL cart:user_123 laptop_789 (0.1ms)</li>
                    <li><strong>Get cart:</strong> HGETALL cart:user_123 returns all items (1ms for 20 items)</li>
                </ul>
                
                <p><strong>Advanced features:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>Cart abandonment:</strong> Background job finds carts with TTL < 7 days, triggers email</li>
                    <li><strong>Save for later:</strong> Separate Hash: cart:user_123:saved, move with HMOVE pattern</li>
                    <li><strong>Recently viewed:</strong> Another Hash tracking last 20 products viewed</li>
                    <li><strong>Recommendations:</strong> Sorted Set based on cart contents + ML scores</li>
                </ul>
                
                <p><strong>Performance at scale:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ 100K cart operations/second on single Redis instance</li>
                    <li>‚úÖ Sub-millisecond response times</li>
                    <li>‚úÖ Auto-expiration reduces memory usage</li>
                    <li>‚úÖ Atomic operations prevent cart corruption</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõí</span><p><strong>Perfect for carts</strong> - Product ID ‚Üí Quantity mapping, logical grouping</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üë§</span><p><strong>User sessions</strong> - Store login time, page views, preferences</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Atomic operations</strong> - HINCRBY for quantities, no race conditions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¶</span><p><strong>Single key</strong> - All related data grouped, easy to manage</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è∞</span><p><strong>TTL management</strong> - Expire entire cart, reset on activity</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Production proven</strong> - Amazon, eBay use Hashes for carts at massive scale</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Shopping Cart</span><span class="keyword-tag">Hash</span><span class="keyword-tag">HSET</span><span class="keyword-tag">HINCRBY</span><span class="keyword-tag">Session</span><span class="keyword-tag">TTL</span><span class="keyword-tag">Atomic</span><span class="keyword-tag">E-commerce</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Shopping cart implementation: user adds 2 laptops, then adds 3 more. Which command?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) HSET cart:user_123 laptop 5</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) HINCRBY cart:user_123 laptop 3</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) HSET cart:user_123 laptop +3</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) HADD cart:user_123 laptop 3</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - HINCRBY cart:user_123 laptop 3</strong>
                    <p>HINCRBY adds to existing value. If laptop was 2, HINCRBY laptop 3 makes it 5. HSET would overwrite with 5 (losing original 2). HADD doesn't exist. "+3" syntax doesn't work with HSET. HINCRBY is perfect for cart operations: add quantity to whatever's already there. Works even if field doesn't exist (treats as 0)!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 37: What is Redis Persistence?
// ============================================================

function getQuestion37Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Ops engineer panics:</strong> "Our Redis server just crashed! We lost all the cached data! Shopping carts, sessions, everything gone!" Senior engineer responds: "Did you enable Redis persistence? Redis is in-memory but CAN save to disk. Without persistence, yes, all data is lost on restart."</p>
            <p>So what exactly is Redis persistence and why is it critical?</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Persistence is the ability to save in-memory data to disk, allowing data recovery after server restarts, crashes, or failures. Redis offers two persistence mechanisms: RDB (snapshots) and AOF (append-only file).</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Redis Persistence Options</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Method</th><th style="padding: 10px;">What It Does</th><th style="padding: 10px;">File Type</th></tr>
                    <tr><td style="padding: 8px;">RDB (Snapshot)</td><td>Saves entire dataset at intervals</td><td>dump.rdb</td></tr>
                    <tr><td style="padding: 8px;">AOF (Append-Only)</td><td>Logs every write command</td><td>appendonly.aof</td></tr>
                    <tr><td style="padding: 8px;">Hybrid (RDB+AOF)</td><td>Both methods together</td><td>Both files</td></tr>
                    <tr><td style="padding: 8px;">None</td><td>Pure cache, no persistence</td><td>No files</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Why Persistence Matters:</strong></p>
                <ul>
                    <li><strong>Data safety:</strong> Survive server crashes, power failures</li>
                    <li><strong>Faster restarts:</strong> Load data from disk instead of rebuilding from database</li>
                    <li><strong>Disaster recovery:</strong> Backup and restore capabilities</li>
                    <li><strong>Development:</strong> Save state between development sessions</li>
                </ul>
            </div>

            <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>‚ö†Ô∏è Trade-offs:</strong></p>
                <ul>
                    <li><strong>Without persistence:</strong> Faster (no disk I/O), but data loss on restart</li>
                    <li><strong>With persistence:</strong> Data safety, but some performance overhead</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Redis Persistence: Memory to Disk</div>
                <svg viewBox="0 0 900 550" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">How Redis Saves Data to Disk</text>
                    
                    <!-- In-Memory Data -->
                    <rect x="50" y="60" width="250" height="150" fill="rgba(220, 20, 60, 0.2)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="175" y="90" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">üì¶ Redis In-Memory Data</text>
                    
                    <ellipse cx="120" cy="130" rx="50" ry="30" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2"/>
                    <text x="120" y="135" text-anchor="middle" fill="#fff" font-size="11">Keys: 1M</text>
                    
                    <ellipse cx="230" cy="130" rx="50" ry="30" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2"/>
                    <text x="230" y="135" text-anchor="middle" fill="#fff" font-size="11">Data: 5GB</text>
                    
                    <text x="175" y="175" text-anchor="middle" fill="#888" font-size="11">‚ö° Fast: All in RAM</text>
                    <text x="175" y="195" text-anchor="middle" fill="#FF6347" font-size="11">‚ö†Ô∏è Lost on restart!</text>
                    
                    <!-- RDB Persistence -->
                    <rect x="350" y="60" width="250" height="150" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="475" y="90" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üíæ RDB: Snapshots</text>
                    
                    <rect x="370" y="110" width="210" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="475" y="135" text-anchor="middle" fill="#fff" font-size="11">dump.rdb</text>
                    <text x="475" y="155" text-anchor="middle" fill="#888" font-size="10">Full dataset snapshot</text>
                    <text x="475" y="172" text-anchor="middle" fill="#888" font-size="10">Saved every 60 seconds</text>
                    
                    <path d="M 300 135 L 345 135" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)">
                        <animate attributeName="opacity" values="0;1;0" dur="3s" repeatCount="indefinite"/>
                    </path>
                    
                    <!-- AOF Persistence -->
                    <rect x="650" y="60" width="250" height="150" fill="rgba(156, 39, 176, 0.1)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="775" y="90" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="600">üìù AOF: Command Log</text>
                    
                    <rect x="670" y="110" width="210" height="80" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="775" y="130" text-anchor="middle" fill="#fff" font-size="10">appendonly.aof</text>
                    <text x="775" y="147" text-anchor="middle" fill="#888" font-size="9">SET user:1 "alice"</text>
                    <text x="775" y="162" text-anchor="middle" fill="#888" font-size="9">HSET cart:2 prod 3</text>
                    <text x="775" y="177" text-anchor="middle" fill="#888" font-size="9">ZADD scores 100 "bob"</text>
                    
                    <path d="M 300 135 L 300 80 L 645 80" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)">
                        <animate attributeName="opacity" values="0;1;0" dur="2s" repeatCount="indefinite"/>
                    </path>
                    
                    <!-- Bottom: Recovery Process -->
                    <rect x="50" y="240" width="800" height="280" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="270" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">üîÑ Data Recovery After Crash</text>
                    
                    <!-- Crash -->
                    <rect x="80" y="290" width="200" height="100" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="180" y="315" text-anchor="middle" fill="#FF6347" font-size="13" font-weight="600">üí• Redis Crashes</text>
                    <text x="180" y="340" text-anchor="middle" fill="#888" font-size="11">All data in memory lost</text>
                    <text x="180" y="360" fill="#FF6347" font-size="11">‚ùå user:1 = GONE</text>
                    <text x="180" y="375" fill="#FF6347" font-size="11">‚ùå cart:2 = GONE</text>
                    
                    <!-- Recovery RDB -->
                    <rect x="320" y="290" width="220" height="100" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="430" y="315" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üîÑ Restart: Load RDB</text>
                    <text x="430" y="340" text-anchor="middle" fill="#888" font-size="11">Read dump.rdb from disk</text>
                    <text x="430" y="360" fill="#00FF88" font-size="10">‚úÖ Restores snapshot</text>
                    <text x="430" y="375" fill="#FFA500" font-size="10">‚ö†Ô∏è May lose 60s of data</text>
                    
                    <!-- Recovery AOF -->
                    <rect x="580" y="290" width="220" height="100" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="690" y="315" text-anchor="middle" fill="#9C27B0" font-size="13" font-weight="600">üîÑ Restart: Replay AOF</text>
                    <text x="690" y="340" text-anchor="middle" fill="#888" font-size="11">Execute commands from AOF</text>
                    <text x="690" y="360" fill="#00FF88" font-size="10">‚úÖ Nearly zero data loss</text>
                    <text x="690" y="375" fill="#888" font-size="10">‚è±Ô∏è Slower to load</text>
                    
                    <path d="M 280 340 L 315 340" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <path d="M 280 340 L 280 365 L 575 365" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    
                    <!-- Comparison -->
                    <rect x="80" y="410" width="740" height="100" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="450" y="435" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">üìä Which Persistence Method?</text>
                    
                    <text x="100" y="460" fill="#00FF88" font-size="11" font-weight="600">RDB (Snapshot):</text>
                    <text x="110" y="478" fill="#bbb" font-size="10">‚Ä¢ Fast to load (compact)</text>
                    <text x="110" y="493" fill="#bbb" font-size="10">‚Ä¢ Lower disk I/O</text>
                    <text x="300" y="478" fill="#FFA500" font-size="10">‚Ä¢ Can lose minutes of data</text>
                    <text x="300" y="493" fill="#FFA500" font-size="10">‚Ä¢ Not for critical data</text>
                    
                    <text x="500" y="460" fill="#9C27B0" font-size="11" font-weight="600">AOF (Log):</text>
                    <text x="510" y="478" fill="#bbb" font-size="10">‚Ä¢ Minimal data loss (1s)</text>
                    <text x="510" y="493" fill="#bbb" font-size="10">‚Ä¢ Better durability</text>
                    <text x="680" y="478" fill="#FFA500" font-size="10">‚Ä¢ Slower restart</text>
                    <text x="680" y="493" fill="#FFA500" font-size="10">‚Ä¢ Larger files</text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Enabling RDB Persistence</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis Configuration - redis.conf</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># RDB Snapshot Configuration</span>

<span class="comment"># Save snapshot if:</span>
<span class="comment"># - At least 1 key changed in 900 seconds (15 min)</span>
<span class="keyword">save</span> <span class="number">900</span> <span class="number">1</span>

<span class="comment"># - At least 10 keys changed in 300 seconds (5 min)</span>
<span class="keyword">save</span> <span class="number">300</span> <span class="number">10</span>

<span class="comment"># - At least 10000 keys changed in 60 seconds (1 min)</span>
<span class="keyword">save</span> <span class="number">60</span> <span class="number">10000</span>

<span class="comment"># Snapshot filename</span>
<span class="keyword">dbfilename</span> dump.rdb

<span class="comment"># Directory where snapshot is saved</span>
<span class="keyword">dir</span> /var/lib/redis/

<span class="comment"># Compress snapshot? (reduces size, uses CPU)</span>
<span class="keyword">rdbcompression</span> yes

<span class="comment"># Add checksum for corruption detection</span>
<span class="keyword">rdbchecksum</span> yes

<span class="comment"># Stop writes if snapshot fails (safety)</span>
<span class="keyword">stop-writes-on-bgsave-error</span> yes</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Enabling AOF Persistence</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis Configuration - redis.conf</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># AOF Configuration</span>

<span class="comment"># Enable AOF persistence</span>
<span class="keyword">appendonly</span> yes

<span class="comment"># AOF filename</span>
<span class="keyword">appendfilename</span> <span class="string">"appendonly.aof"</span>

<span class="comment"># Sync frequency (how often to write to disk)</span>
<span class="comment"># Options: always, everysec, no</span>
<span class="keyword">appendfsync</span> everysec

<span class="comment"># always:   Sync after EVERY command (safest, slowest)</span>
<span class="comment"># everysec: Sync once per second (good balance) ‚Üê RECOMMENDED</span>
<span class="comment"># no:       Let OS decide (fastest, least safe)</span>

<span class="comment"># Rewrite AOF when it gets too large</span>
<span class="keyword">auto-aof-rewrite-percentage</span> <span class="number">100</span>
<span class="keyword">auto-aof-rewrite-min-size</span> <span class="number">64mb</span>

<span class="comment"># Don't fsync during rewrite (performance)</span>
<span class="keyword">no-appendfsync-on-rewrite</span> no</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Manual Snapshot Commands</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Triggering Persistence</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Trigger RDB snapshot NOW (blocks Redis until done)</span>
<span class="keyword">SAVE</span>
<span class="string">OK</span>

<span class="comment"># Trigger RDB snapshot in BACKGROUND (doesn't block)</span>
<span class="keyword">BGSAVE</span>
<span class="string">Background saving started</span>

<span class="comment"># Trigger AOF rewrite (compact AOF file)</span>
<span class="keyword">BGREWRITEAOF</span>
<span class="string">Background append only file rewriting started</span>

<span class="comment"># Check last save time</span>
<span class="keyword">LASTSAVE</span>
<span class="number">(integer) 1704067200</span>  <span class="comment"># Unix timestamp</span>

<span class="comment"># Get persistence stats</span>
<span class="keyword">INFO</span> persistence
<span class="comment"># Shows: last_save_time, changes_since_last_save, rdb_bgsave_in_progress, etc.</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Can I use both RDB and AOF together?</h4>
                <p><strong>A:</strong> Yes! This is called "hybrid persistence" (default in Redis 7+). RDB provides fast restarts, AOF provides durability. On restart, Redis uses AOF if it exists (more complete data). Best of both worlds, but uses more disk space!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Does persistence slow down Redis?</h4>
                <p><strong>A:</strong> Slightly! RDB uses BGSAVE (fork process, COW = copy-on-write), which can spike memory. AOF adds disk I/O per write. With <code>appendfsync everysec</code>, impact is minimal (~5-10% overhead). For pure cache use case, disable persistence for maximum speed!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What happens if disk runs out of space during save?</h4>
                <p><strong>A:</strong> With <code>stop-writes-on-bgsave-error yes</code> (default), Redis stops accepting writes to prevent data loss! Error: "MISCONF Redis is configured to save RDB snapshots, but it is currently not able to persist on disk". Fix disk space, then writes resume!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: How much data can I lose with RDB vs AOF?</h4>
                <p><strong>A:</strong> RDB: Can lose up to save interval (e.g., 60 seconds of writes). AOF with <code>everysec</code>: Max 1 second of data. AOF with <code>always</code>: Nearly zero loss (but slower). Trade-off: durability vs performance!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Should I use persistence for cache-only workloads?</h4>
                <p><strong>A:</strong> Usually no! If data is cached from database and can be regenerated, disable persistence for best performance. Enable persistence only if: (1) Data is primary source, (2) Regeneration is expensive, or (3) Fast restart needed after deployments.</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Redis forks for BGSAVE. What if I don't have 2x memory?</h4>
                <p><strong>Answer:</strong> Copy-on-write (COW) to the rescue! Fork creates virtual copy, not real copy. Memory is shared until pages are modified. If 50% of data changes during save, you need 1.5x memory (not 2x). Linux overcommit helps. Still, monitor with <code>INFO memory</code> and ensure some headroom!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: AOF file grows to 10GB but dataset is only 1GB. Why?</h4>
                <p><strong>Answer:</strong> AOF logs ALL commands, including deletes and overwrites! If you SET same key 1000 times, AOF has 1000 entries. Solution: AOF rewrite (BGREWRITEAOF or auto-rewrite) creates new AOF with current state only. 10GB ‚Üí 1GB after rewrite. Configure <code>auto-aof-rewrite-percentage 100</code>!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: I have RDB+AOF. Which file is used on restart?</h4>
                <p><strong>Answer:</strong> AOF takes priority! Redis checks: (1) Is AOF enabled and file exists? Load AOF (most complete). (2) No AOF? Load RDB. (3) Neither? Start empty. AOF is authoritative because it has latest writes. RDB is fallback/fast-restart backup!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Site Session Storage</strong></p>
            
            <p>Online store with 100K concurrent users. Sessions stored in Redis (user ID, cart, preferences). Question: Enable persistence or not?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Hybrid Approach</h4>
                
                <p><strong>Decision factors:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>Session loss impact:</strong> Users log out = bad UX (cart lost!)</li>
                    <li><strong>Data regeneration:</strong> Can't regenerate sessions</li>
                    <li><strong>Acceptable loss:</strong> Maybe 1 second of sessions OK</li>
                </ul>
                
                <p><strong>Recommended config:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    # Use AOF for durability<br>
                    appendonly yes<br>
                    appendfsync everysec  # Balance: 1s data loss OK<br>
                    <br>
                    # Keep RDB for fast restarts<br>
                    save 900 1<br>
                    save 300 10<br>
                    save 60 10000
                </code>
                
                <p><strong>What this achieves:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Max 1 second of sessions lost on crash</li>
                    <li>‚úÖ Fast restart from RDB snapshot</li>
                    <li>‚úÖ AOF fills in last minute of data</li>
                    <li>‚úÖ Performance impact: ~5-10%</li>
                </ul>
                
                <p><strong>Alternative for pure cache:</strong> If sessions backed by database and can reload, disable persistence for 20% better performance!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>RDB = Snapshots</strong> - Fast to load, but can lose minutes of data</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìù</span><p><strong>AOF = Command log</strong> - Better durability (1s loss), slower restart</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Hybrid = Best of both</strong> - Default in Redis 7+, recommended</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Trade-off exists</strong> - Durability vs performance (~5-10% overhead)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Choose based on use case</strong> - Critical data = AOF, Cache only = None</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîß</span><p><strong>Monitor disk space!</strong> - Full disk = Redis stops writes</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Persistence</span><span class="keyword-tag">RDB</span><span class="keyword-tag">AOF</span><span class="keyword-tag">BGSAVE</span><span class="keyword-tag">Snapshot</span><span class="keyword-tag">durability</span><span class="keyword-tag">dump.rdb</span><span class="keyword-tag">appendonly</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Your Redis crashes. You had RDB saving every 60 seconds. How much data could you lose?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) No data (fully saved)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Up to 60 seconds of writes</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Everything (no persistence)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Only 1 second (AOF default)</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Up to 60 seconds of writes</strong>
                    <p>RDB creates snapshots at intervals (every 60s in this case). If Redis crashes at second 59, all writes since the last snapshot (59 seconds ago) are lost. This is why RDB is good for caches but risky for critical data. For better durability, use AOF (max 1s loss with <code>everysec</code>) or hybrid RDB+AOF!</p>
                </div>
            </div>
        </div>
    `;
}

// ============================================================
// QUESTION 38: What is the difference between RDB and AOF?
// ============================================================

function getQuestion38Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Dev asks:</strong> "My boss says 'enable Redis persistence.' Should I use RDB or AOF?" Senior dev: "Depends! RDB is like taking photos of your data every hour. AOF is like recording a video of every action. Need fast restarts? RDB. Need to lose almost no data? AOF. Need both? Use hybrid!"</p>
            <p>Let's break down the key differences.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>RDB (Redis Database) creates point-in-time snapshots of your entire dataset at configured intervals. AOF (Append Only File) logs every write operation as they happen, creating a replay log.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">RDB vs AOF: Head-to-Head</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Feature</th><th style="padding: 10px;">RDB</th><th style="padding: 10px;">AOF</th></tr>
                    <tr><td style="padding: 8px;">What it saves</td><td>Full dataset snapshot</td><td>Every write command</td></tr>
                    <tr><td style="padding: 8px;">File format</td><td>Binary (compact)</td><td>Text commands</td></tr>
                    <tr><td style="padding: 8px;">File size</td><td>Smaller (compressed)</td><td>Larger (grows over time)</td></tr>
                    <tr><td style="padding: 8px;">Save frequency</td><td>Minutes (save 60 1)</td><td>Every command or every 1s</td></tr>
                    <tr><td style="padding: 8px;">Data loss on crash</td><td>Minutes of data</td><td>1 second max (everysec)</td></tr>
                    <tr><td style="padding: 8px;">Restart speed</td><td>Fast (load snapshot)</td><td>Slow (replay commands)</td></tr>
                    <tr><td style="padding: 8px;">CPU usage</td><td>Spike during fork</td><td>Constant (low)</td></tr>
                    <tr><td style="padding: 8px;">Disk I/O</td><td>Burst (during save)</td><td>Continuous (writes)</td></tr>
                    <tr><td style="padding: 8px;">Use case</td><td>Backups, fast restarts</td><td>Durability, critical data</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">RDB vs AOF: Different Approaches</div>
                <svg viewBox="0 0 900 500" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">How RDB and AOF Work Differently</text>
                    
                    <!-- RDB Side -->
                    <rect x="50" y="60" width="380" height="400" fill="rgba(0,255,136,0.05)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="240" y="90" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">RDB: Periodic Snapshots</text>
                    
                    <!-- Timeline -->
                    <line x1="80" y1="150" x2="400" y2="150" stroke="#666" stroke-width="2"/>
                    <text x="80" y="140" fill="#888" font-size="10">T=0s</text>
                    <text x="230" y="140" fill="#888" font-size="10">T=60s</text>
                    <text x="370" y="140" fill="#888" font-size="10">T=120s</text>
                    
                    <!-- Operations -->
                    <circle cx="100" cy="150" r="4" fill="#DC143C"/>
                    <text x="105" y="175" fill="#fff" font-size="9">SET key1 "a"</text>
                    
                    <circle cx="140" cy="150" r="4" fill="#DC143C"/>
                    <text x="145" y="175" fill="#fff" font-size="9">SET key2 "b"</text>
                    
                    <circle cx="180" cy="150" r="4" fill="#DC143C"/>
                    <text x="185" y="175" fill="#fff" font-size="9">SET key3 "c"</text>
                    
                    <!-- Snapshot 1 -->
                    <rect x="220" y="130" width="50" height="40" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="3" rx="4">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/>
                    </rect>
                    <text x="245" y="155" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">SAVE!</text>
                    
                    <circle cx="300" cy="150" r="4" fill="#DC143C"/>
                    <text x="305" y="175" fill="#fff" font-size="9">DEL key1</text>
                    
                    <circle cx="340" cy="150" r="4" fill="#DC143C"/>
                    <text x="345" y="175" fill="#fff" font-size="9">SET key4 "d"</text>
                    
                    <!-- Snapshot 2 -->
                    <rect x="370" y="130" width="50" height="40" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="3" rx="4">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" begin="1s" repeatCount="indefinite"/>
                    </rect>
                    <text x="395" y="155" text-anchor="middle" fill="#fff" font-size="10" font-weight="600">SAVE!</text>
                    
                    <!-- RDB File -->
                    <rect x="80" y="220" width="320" height="100" fill="rgba(0,0,0,0.3)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="240" y="245" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">dump.rdb (Snapshot at T=60s)</text>
                    <text x="100" y="270" fill="#fff" font-size="11">key1 ‚Üí "a"</text>
                    <text x="100" y="290" fill="#fff" font-size="11">key2 ‚Üí "b"</text>
                    <text x="100" y="310" fill="#fff" font-size="11">key3 ‚Üí "c"</text>
                    
                    <text x="100" y="350" fill="#00FF88" font-size="10">‚úÖ Compact, fast to load</text>
                    <text x="100" y="370" fill="#FFA500" font-size="10">‚ö†Ô∏è Loses operations after T=60s</text>
                    <text x="100" y="390" fill="#888" font-size="9">If crash at T=115s ‚Üí lose 55s of data!</text>
                    
                    <!-- AOF Side -->
                    <rect x="470" y="60" width="380" height="400" fill="rgba(156,39,176,0.05)" stroke="#9C27B0" stroke-width="2" rx="8"/>
                    <text x="660" y="90" text-anchor="middle" fill="#9C27B0" font-size="16" font-weight="600">AOF: Every Command Logged</text>
                    
                    <!-- Timeline -->
                    <line x1="500" y1="150" x2="820" y2="150" stroke="#666" stroke-width="2"/>
                    <text x="500" y="140" fill="#888" font-size="10">Commands executed</text>
                    
                    <!-- Each command logged -->
                    <path d="M 520 150 L 540 130" stroke="#9C27B0" stroke-width="2">
                        <animate attributeName="opacity" values="0;1" dur="0.5s" repeatCount="1"/>
                    </path>
                    <text x="545" y="125" fill="#fff" font-size="9">Logged!</text>
                    
                    <path d="M 580 150 L 600 130" stroke="#9C27B0" stroke-width="2">
                        <animate attributeName="opacity" values="0;1" dur="0.5s" begin="0.5s" repeatCount="1"/>
                    </path>
                    <text x="605" y="125" fill="#fff" font-size="9">Logged!</text>
                    
                    <path d="M 640 150 L 660 130" stroke="#9C27B0" stroke-width="2">
                        <animate attributeName="opacity" values="0;1" dur="0.5s" begin="1s" repeatCount="1"/>
                    </path>
                    <text x="665" y="125" fill="#fff" font-size="9">Logged!</text>
                    
                    <!-- AOF File -->
                    <rect x="500" y="220" width="320" height="140" fill="rgba(0,0,0,0.3)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="660" y="245" text-anchor="middle" fill="#9C27B0" font-size="13" font-weight="600">appendonly.aof (All Commands)</text>
                    <text x="520" y="270" fill="#fff" font-size="10">SET key1 "a"</text>
                    <text x="520" y="288" fill="#fff" font-size="10">SET key2 "b"</text>
                    <text x="520" y="306" fill="#fff" font-size="10">SET key3 "c"</text>
                    <text x="520" y="324" fill="#fff" font-size="10">DEL key1</text>
                    <text x="520" y="342" fill="#fff" font-size="10">SET key4 "d"</text>
                    
                    <text x="520" y="385" fill="#00FF88" font-size="10">‚úÖ Max 1s data loss (everysec)</text>
                    <text x="520" y="405" fill="#FFA500" font-size="10">‚ö†Ô∏è Larger file, slower restart</text>
                    <text x="520" y="425" fill="#888" font-size="9">Replay all commands on restart</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: RDB Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - RDB Setup</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># RDB: Good for backups, fast restarts</span>

<span class="comment"># Save if 1 key changed in 900s (15 min)</span>
<span class="keyword">save</span> <span class="number">900</span> <span class="number">1</span>

<span class="comment"># Save if 10 keys changed in 300s (5 min)</span>
<span class="keyword">save</span> <span class="number">300</span> <span class="number">10</span>

<span class="comment"># Save if 10000 keys changed in 60s</span>
<span class="keyword">save</span> <span class="number">60</span> <span class="number">10000</span>

<span class="keyword">dbfilename</span> dump.rdb
<span class="keyword">dir</span> /var/lib/redis/

<span class="comment"># Compress? Yes (saves disk space)</span>
<span class="keyword">rdbcompression</span> yes

<span class="comment"># Checksum? Yes (detect corruption)</span>
<span class="keyword">rdbchecksum</span> yes

<span class="comment"># Use case: Cache that can tolerate 1-5 min data loss</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: AOF Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - AOF Setup</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># AOF: Good for durability, critical data</span>

<span class="keyword">appendonly</span> yes
<span class="keyword">appendfilename</span> <span class="string">"appendonly.aof"</span>

<span class="comment"># How often to fsync? (write to disk)</span>
<span class="keyword">appendfsync</span> everysec  <span class="comment"># ‚Üê RECOMMENDED</span>

<span class="comment"># Options explained:</span>
<span class="comment"># - always:   Every command (super safe, slow)</span>
<span class="comment"># - everysec: Every second (good balance)</span>
<span class="comment"># - no:       OS decides (fast, risky)</span>

<span class="comment"># Auto-rewrite when AOF gets 2x original size</span>
<span class="keyword">auto-aof-rewrite-percentage</span> <span class="number">100</span>
<span class="keyword">auto-aof-rewrite-min-size</span> <span class="number">64mb</span>

<span class="comment"># Use case: Sessions, carts, critical app data</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Hybrid Configuration (Best Practice)</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - RDB + AOF Together</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Hybrid: Best of both worlds (Default Redis 7+)</span>

<span class="comment"># Enable both!</span>
<span class="keyword">save</span> <span class="number">900</span> <span class="number">1</span>
<span class="keyword">save</span> <span class="number">300</span> <span class="number">10</span>
<span class="keyword">save</span> <span class="number">60</span> <span class="number">10000</span>

<span class="keyword">appendonly</span> yes
<span class="keyword">appendfsync</span> everysec

<span class="comment"># On restart:</span>
<span class="comment"># 1. Load RDB (fast, gets 99% of data)</span>
<span class="comment"># 2. Replay AOF (fills in last minute)</span>
<span class="comment"># Result: Fast restart + minimal data loss!</span>

<span class="comment"># Benefits:</span>
<span class="comment"># ‚úÖ RDB provides fast restart</span>
<span class="comment"># ‚úÖ AOF provides durability</span>
<span class="comment"># ‚úÖ Best production setup</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Which is faster: RDB or AOF restart?</h4>
                <p><strong>A:</strong> RDB is 5-10x faster! RDB loads binary snapshot directly. AOF must replay every command (millions of commands = slow). For 1GB dataset: RDB load = 5 seconds, AOF load = 30-60 seconds. This is why hybrid is smart!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can AOF file become corrupted?</h4>
                <p><strong>A:</strong> Yes, especially if disk full or crash during write! Use <code>redis-check-aof --fix appendonly.aof</code> to repair. It truncates file at first corruption point. Some data lost but recovers Redis. Always monitor disk space!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Memory usage: Does RDB or AOF use more?</h4>
                <p><strong>A:</strong> During save: RDB spikes (fork = copy-on-write), AOF steady (continuous writes). Disk space: AOF file larger (text commands vs binary snapshot). Rewrite compacts AOF. Overall: RDB = burst memory, AOF = more disk!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Should I disable RDB if using AOF?</h4>
                <p><strong>A:</strong> No! Keep both (hybrid). RDB provides fast backups and quick restarts. AOF provides durability. They complement each other. Only disable if: pure cache (no persistence needed) or storage-constrained (AOF only then).</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: What happens if both RDB and AOF files exist on restart?</h4>
                <p><strong>A:</strong> Redis loads AOF (takes priority as it's more complete). Loads RDB only if AOF disabled or file missing. Check logs: "DB loaded from append only file" vs "DB loaded from disk". AOF = authoritative!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: AOF with <code>appendfsync always</code> - truly zero data loss?</h4>
                <p><strong>Answer:</strong> Almost, but not guaranteed! While every command is fsynced immediately, power failure during fsync OR disk controller cache (write buffer) can still lose data. For true zero loss: battery-backed disk controller + <code>always</code> + monitoring. Still, it's 99.99% safe!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: RDB save happens every 60s. Can I lose 61+ seconds of data?</h4>
                <p><strong>Answer:</strong> Yes! If BGSAVE is running and takes 5 seconds to complete, crash at T=64s means: last successful save was T=0, BGSAVE started at T=60, crashed before completion ‚Üí 64 seconds lost! Monitor save duration with <code>INFO persistence</code>.</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Can I convert RDB to AOF or vice versa?</h4>
                <p><strong>Answer:</strong> Yes! RDB ‚Üí AOF: Enable <code>appendonly yes</code>, Redis creates AOF from current dataset. AOF ‚Üí RDB: Just trigger BGSAVE. Both exist? You have hybrid! No manual conversion needed - Redis handles it dynamically!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Choosing Persistence for Different Services</strong></p>
            
            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Service 1: Page Cache (Read-Heavy)</h4>
                <p><strong>Data:</strong> HTML fragments, API responses cached from database</p>
                <p><strong>Persistence choice:</strong> RDB only or NONE</p>
                <p><strong>Why:</strong> Data can be regenerated from DB. Fast restart nice but not critical. RDB every 15 min for convenience, or disable entirely for max speed.</p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    save 900 1  # Optional, for faster restart<br>
                    appendonly no  # No need for durability
                </code>
            </div>

            <div style="background: rgba(156, 39, 176, 0.1); border-left: 3px solid #9C27B0; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #9C27B0;">Service 2: Shopping Carts (Critical Data)</h4>
                <p><strong>Data:</strong> User carts, can't regenerate, losing = bad UX</p>
                <p><strong>Persistence choice:</strong> AOF + RDB (Hybrid)</p>
                <p><strong>Why:</strong> Can't lose carts! AOF every 1s acceptable. RDB for fast restart. Worth 10% performance cost.</p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    save 300 10  # RDB backup<br>
                    appendonly yes<br>
                    appendfsync everysec  # Max 1s loss OK
                </code>
            </div>

            <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #FFA500;">Service 3: Financial Transactions (Zero Loss)</h4>
                <p><strong>Data:</strong> Transaction IDs, payment states - cannot lose ANY data</p>
                <p><strong>Persistence choice:</strong> AOF with <code>always</code> + RDB backup</p>
                <p><strong>Why:</strong> Every transaction must be durable. <code>appendfsync always</code> despite performance hit. RDB as secondary backup.</p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
                    save 300 1  # RDB backup<br>
                    appendonly yes<br>
                    appendfsync always  # Zero tolerance!
                </code>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì∏</span><p><strong>RDB = Snapshots</strong> - Fast, compact, but can lose minutes</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìù</span><p><strong>AOF = Command log</strong> - Durable, max 1s loss, slower restart</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Hybrid = Production choice</strong> - Fast restarts + durability</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>RDB faster restart</strong> - 5-10x quicker than AOF replay</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>AOF larger files</strong> - Text commands vs binary snapshot</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Choose by use case</strong> - Cache=RDB, Critical=AOF, Production=Both</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">RDB vs AOF</span><span class="keyword-tag">Snapshot</span><span class="keyword-tag">Command Log</span><span class="keyword-tag">appendfsync</span><span class="keyword-tag">BGSAVE</span><span class="keyword-tag">Durability</span><span class="keyword-tag">Hybrid</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You need minimal data loss (<1s) AND fast restarts. Which setup?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) RDB only (fast restart)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) AOF only (minimal loss)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">C) RDB + AOF hybrid</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) No persistence (fastest)</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: C - RDB + AOF Hybrid</strong>
                    <p>Hybrid gives you BOTH benefits! RDB provides fast restart (loads snapshot quickly), while AOF ensures minimal data loss (max 1s with <code>everysec</code>). On restart, Redis loads RDB first (fast!) then replays AOF to catch up last minute. This is the default in Redis 7+ and recommended for production. Only trade-off: uses more disk space for both files.</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 39: What is Pipelining in Redis?
// ============================================================

function getQuestion39Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Developer complains:</strong> "I need to SET 10,000 keys. Each command takes 1ms round-trip. That's 10 seconds! Too slow!" Senior dev: "Use pipelining! Send all 10,000 commands at once, wait for responses together. 10 seconds becomes 100ms. Redis processes them all without waiting for network!"</p>
            <p>So what is pipelining and why is it so fast?</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Pipelining allows sending multiple commands to the server without waiting for replies, then reading all replies at once. This eliminates network round-trip time (RTT) overhead between commands.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Sequential vs Pipelined</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Aspect</th><th style="padding: 10px;">Sequential</th><th style="padding: 10px;">Pipelined</th></tr>
                    <tr><td style="padding: 8px;">Commands sent</td><td>One at a time</td><td>Batch all together</td></tr>
                    <tr><td style="padding: 8px;">Wait for reply</td><td>After each command</td><td>After all commands</td></tr>
                    <tr><td style="padding: 8px;">RTT overhead</td><td>N commands = N RTTs</td><td>N commands = 1 RTT</td></tr>
                    <tr><td style="padding: 8px;">Time for 1000 cmds</td><td>1000ms (1ms RTT each)</td><td>~10ms (1 RTT total)</td></tr>
                    <tr><td style="padding: 8px;">Network packets</td><td>Many small packets</td><td>Fewer large packets</td></tr>
                    <tr><td style="padding: 8px;">Atomicity</td><td>No guarantee</td><td>No guarantee</td></tr>
                    <tr><td style="padding: 8px;">Best for</td><td>Interactive queries</td><td>Bulk operations</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Why Pipelining is Fast:</strong></p>
                <ul>
                    <li><strong>Eliminates RTT:</strong> Round-trip time is often 0.5-2ms (network latency)</li>
                    <li><strong>Batch processing:</strong> Redis processes commands in sequence without network delays</li>
                    <li><strong>Less overhead:</strong> Fewer TCP packets = less CPU, less bandwidth</li>
                    <li><strong>Massive speedup:</strong> 10-100x faster for bulk operations</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Sequential vs Pipelined Execution</div>
                <svg viewBox="0 0 900 520" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Network Round-Trip Comparison</text>
                    
                    <!-- Sequential (Slow) -->
                    <rect x="50" y="60" width="380" height="200" fill="rgba(255, 69, 0, 0.1)" stroke="#FF6347" stroke-width="3" rx="8"/>
                    <text x="240" y="90" text-anchor="middle" fill="#FF6347" font-size="16" font-weight="600">‚ùå Sequential (Slow)</text>
                    
                    <!-- Command 1 -->
                    <text x="70" y="120" fill="#FFA500" font-size="11">Command 1: SET key1 "a"</text>
                    <path d="M 70 125 L 200 125" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <text x="210" y="120" fill="#888" font-size="9">1ms RTT ‚Üí</text>
                    <path d="M 300 125 L 170 125" stroke="#DC143C" stroke-width="2" marker-end="url(#arrowRed)"/>
                    <text x="310" y="120" fill="#888" font-size="9">‚Üê Reply: OK</text>
                    
                    <!-- Command 2 -->
                    <text x="70" y="155" fill="#FFA500" font-size="11">Command 2: SET key2 "b"</text>
                    <path d="M 70 160 L 200 160" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <text x="210" y="155" fill="#888" font-size="9">1ms RTT ‚Üí</text>
                    <path d="M 300 160 L 170 160" stroke="#DC143C" stroke-width="2" marker-end="url(#arrowRed)"/>
                    <text x="310" y="155" fill="#888" font-size="9">‚Üê Reply: OK</text>
                    
                    <!-- Command 3 -->
                    <text x="70" y="190" fill="#FFA500" font-size="11">Command 3: SET key3 "c"</text>
                    <path d="M 70 195 L 200 195" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <text x="210" y="190" fill="#888" font-size="9">1ms RTT ‚Üí</text>
                    <path d="M 300 195 L 170 195" stroke="#DC143C" stroke-width="2" marker-end="url(#arrowRed)"/>
                    <text x="310" y="190" fill="#888" font-size="9">‚Üê Reply: OK</text>
                    
                    <rect x="70" y="210" width="340" height="40" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="240" y="235" text-anchor="middle" fill="#FF6347" font-size="12" font-weight="600">Total Time: 3ms (3 RTTs)</text>
                    
                    <!-- Pipelined (Fast) -->
                    <rect x="470" y="60" width="380" height="200" fill="rgba(0, 255, 136, 0.1)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="660" y="90" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">‚úÖ Pipelined (Fast)</text>
                    
                    <!-- All commands sent together -->
                    <rect x="490" y="110" width="200" height="70" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="590" y="130" text-anchor="middle" fill="#fff" font-size="10">Send all at once:</text>
                    <text x="500" y="148" fill="#FFA500" font-size="9">SET key1 "a"</text>
                    <text x="500" y="163" fill="#FFA500" font-size="9">SET key2 "b"</text>
                    <text x="500" y="178" fill="#FFA500" font-size="9">SET key3 "c"</text>
                    
                    <path d="M 690 145 L 780 145" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)">
                        <animate attributeName="stroke-dasharray" values="0,1000;1000,0" dur="2s" repeatCount="indefinite"/>
                    </path>
                    <text x="720" y="135" fill="#888" font-size="9">1ms RTT ‚Üí</text>
                    
                    <!-- All replies together -->
                    <rect x="700" y="165" width="130" height="60" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="765" y="185" text-anchor="middle" fill="#fff" font-size="10">Replies:</text>
                    <text x="710" y="202" fill="#00FF88" font-size="9">OK</text>
                    <text x="710" y="217" fill="#00FF88" font-size="9">OK</text>
                    
                    <path d="M 700 195 L 610 195" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)">
                        <animate attributeName="stroke-dasharray" values="0,1000;1000,0" dur="2s" begin="1s" repeatCount="indefinite"/>
                    </path>
                    
                    <rect x="490" y="210" width="340" height="40" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="660" y="235" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Total Time: 1ms (1 RTT only!)</text>
                    
                    <!-- Bottom comparison -->
                    <rect x="50" y="280" width="800" height="220" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="310" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">Performance Comparison: 1000 Commands</text>
                    
                    <rect x="80" y="330" width="360" height="150" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="260" y="355" text-anchor="middle" fill="#FF6347" font-size="13" font-weight="600">Sequential Execution</text>
                    <text x="100" y="380" fill="#bbb" font-size="11">1000 commands √ó 1ms RTT each</text>
                    <text x="100" y="400" fill="#FF6347" font-size="20" font-weight="700">= 1000ms (1 second)</text>
                    <text x="100" y="425" fill="#888" font-size="10">Plus: Command processing time</text>
                    <text x="100" y="445" fill="#888" font-size="10">Network: 2000 packets (send + receive each)</text>
                    <text x="100" y="465" fill="#FF6347" font-size="11">‚ùå Too slow for bulk operations!</text>
                    
                    <rect x="460" y="330" width="360" height="150" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="640" y="355" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">Pipelined Execution</text>
                    <text x="480" y="380" fill="#bbb" font-size="11">1000 commands in 1 batch</text>
                    <text x="480" y="400" fill="#00FF88" font-size="20" font-weight="700">= 10ms total!</text>
                    <text x="480" y="425" fill="#888" font-size="10">Plus: Same command processing time</text>
                    <text x="480" y="445" fill="#888" font-size="10">Network: 2 packets (1 send, 1 receive)</text>
                    <text x="480" y="465" fill="#00FF88" font-size="11">‚úÖ 100x faster than sequential!</text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Without vs With Pipeline</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Performance Comparison</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis()

<span class="comment"># WITHOUT Pipeline (Sequential)</span>
<span class="keyword">def</span> <span class="function">sequential_set</span>(count):
    start = time.time()
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(count):
        r.set(<span class="string">f"key:</span>{i}<span class="string">"</span>, <span class="string">f"value</span>{i}<span class="string">"</span>)
    <span class="keyword">return</span> time.time() - start

<span class="comment"># WITH Pipeline (Batched)</span>
<span class="keyword">def</span> <span class="function">pipelined_set</span>(count):
    start = time.time()
    pipe = r.pipeline()
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(count):
        pipe.set(<span class="string">f"key:</span>{i}<span class="string">"</span>, <span class="string">f"value</span>{i}<span class="string">"</span>)
    pipe.execute()  <span class="comment"># Send all at once!</span>
    <span class="keyword">return</span> time.time() - start

<span class="comment"># Benchmark</span>
count = <span class="number">10000</span>

seq_time = sequential_set(count)
pipe_time = pipelined_set(count)

<span class="keyword">print</span>(<span class="string">f"\\nüìä Setting </span>{count}<span class="string"> keys:"</span>)
<span class="keyword">print</span>(<span class="string">f"Sequential: </span>{seq_time:<span class="number">.3</span>f}<span class="string">s"</span>)
<span class="keyword">print</span>(<span class="string">f"Pipelined:  </span>{pipe_time:<span class="number">.3</span>f}<span class="string">s"</span>)
<span class="keyword">print</span>(<span class="string">f"\\n‚ö° Pipeline is </span>{seq_time/pipe_time:<span class="number">.1</span>f}<span class="string">x faster!"</span>)

<span class="comment"># Typical output:
# üìä Setting 10000 keys:
# Sequential: 8.234s
# Pipelined:  0.087s
# ‚ö° Pipeline is 94.6x faster!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Mixed Commands in Pipeline</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Different Operations Together</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Create pipeline</span>
pipe = r.pipeline()

<span class="comment"># Queue multiple different commands</span>
pipe.set(<span class="string">"user:1:name"</span>, <span class="string">"Alice"</span>)
pipe.set(<span class="string">"user:1:email"</span>, <span class="string">"alice@example.com"</span>)
pipe.hset(<span class="string">"user:1:profile"</span>, <span class="string">"age"</span>, <span class="number">25</span>)
pipe.sadd(<span class="string">"users:online"</span>, <span class="string">"user:1"</span>)
pipe.zadd(<span class="string">"leaderboard"</span>, {<span class="string">"Alice"</span>: <span class="number">100</span>})
pipe.incr(<span class="string">"stats:users"</span>)
pipe.expire(<span class="string">"user:1:session"</span>, <span class="number">3600</span>)

<span class="comment"># Execute all at once!</span>
results = pipe.execute()

<span class="keyword">print</span>(<span class="string">"‚úÖ Pipeline executed!"</span>)
<span class="keyword">print</span>(<span class="string">f"Results: {results}"</span>)
<span class="comment"># Output: [True, True, 1, 1, 1, 1, True]
# Each result corresponds to each command in order</span>

<span class="comment"># Reading with pipeline</span>
pipe = r.pipeline()
pipe.get(<span class="string">"user:1:name"</span>)
pipe.hget(<span class="string">"user:1:profile"</span>, <span class="string">"age"</span>)
pipe.zscore(<span class="string">"leaderboard"</span>, <span class="string">"Alice"</span>)
pipe.get(<span class="string">"stats:users"</span>)

results = pipe.execute()
name, age, score, user_count = results

<span class="keyword">print</span>(<span class="string">f"\\nüìã Retrieved data:"</span>)
<span class="keyword">print</span>(<span class="string">f"Name: {name}"</span>)
<span class="keyword">print</span>(<span class="string">f"Age: {age}"</span>)
<span class="keyword">print</span>(<span class="string">f"Score: {score}"</span>)
<span class="keyword">print</span>(<span class="string">f"Total users: {user_count}"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Error Handling in Pipeline</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Handling Errors</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Setup some data</span>
r.set(<span class="string">"counter"</span>, <span class="number">10</span>)
r.set(<span class="string">"string_val"</span>, <span class="string">"hello"</span>)

<span class="comment"># Pipeline with intentional error</span>
pipe = r.pipeline()
pipe.incr(<span class="string">"counter"</span>)         <span class="comment"># Works: 10 ‚Üí 11</span>
pipe.incr(<span class="string">"string_val"</span>)     <span class="comment"># ERROR: can't increment string!</span>
pipe.set(<span class="string">"new_key"</span>, <span class="string">"value"</span>)  <span class="comment"># Still executes!</span>

<span class="keyword">try</span>:
    results = pipe.execute()
<span class="keyword">except</span> redis.exceptions.ResponseError <span class="keyword">as</span> e:
    <span class="keyword">print</span>(<span class="string">f"‚ùå Error in pipeline: {e}"</span>)
    <span class="comment"># Pipeline stops at error, returns partial results</span>

<span class="comment"># Better: Check each result</span>
pipe = r.pipeline()
pipe.incr(<span class="string">"counter"</span>)
pipe.incr(<span class="string">"string_val"</span>)
pipe.set(<span class="string">"new_key"</span>, <span class="string">"value"</span>)

results = pipe.execute(raise_on_error=<span class="keyword">False</span>)

<span class="keyword">for</span> i, result <span class="keyword">in</span> <span class="function">enumerate</span>(results):
    <span class="keyword">if</span> <span class="function">isinstance</span>(result, redis.exceptions.ResponseError):
        <span class="keyword">print</span>(<span class="string">f"‚ùå Command {i} failed: {result}"</span>)
    <span class="keyword">else</span>:
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Command {i} succeeded: {result}"</span>)

<span class="comment"># Output:
# ‚úÖ Command 0 succeeded: 11
# ‚ùå Command 1 failed: WRONGTYPE Operation against...
# ‚úÖ Command 2 succeeded: True</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Is pipelining the same as transactions (MULTI/EXEC)?</h4>
                <p><strong>A:</strong> No! Pipeline = speed optimization (batching), no atomicity. MULTI/EXEC = atomicity guarantee (all or nothing). You CAN combine them: use pipeline for speed + MULTI/EXEC for atomicity! Pipeline sends commands together, transactions execute commands atomically.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: How many commands can I put in one pipeline?</h4>
                <p><strong>A:</strong> No hard limit, but practical limit: ~10,000-100,000 commands. More = higher memory on client/server to buffer. Best practice: batch in chunks (e.g., 1000 at a time). Monitor memory with <code>INFO memory</code> if pipelining millions!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What if one command in pipeline fails?</h4>
                <p><strong>A:</strong> Other commands STILL execute! Pipeline doesn't stop on error. Results array contains error objects for failed commands. This differs from transactions (MULTI/EXEC) where ALL commands execute or none do. Handle with <code>raise_on_error=False</code>!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can pipeline commands depend on previous pipeline results?</h4>
                <p><strong>A:</strong> No! Pipeline sends all commands before receiving any results. You can't do: SET key1 "x", then GET key1, then use that value. Commands are independent. For dependent commands, use Lua scripts or separate calls!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Does pipelining affect other clients?</h4>
                <p><strong>A:</strong> Minimal! Redis processes pipeline commands sequentially (not parallel), but no RTT delays between them. Other clients' commands are interleaved normally. Pipeline doesn't "lock" Redis - it's just efficient batching!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: I pipeline 10,000 SET commands. Are they atomic?</h4>
                <p><strong>Answer:</strong> NO! Pipeline does NOT provide atomicity. Between your commands, other clients' commands can execute. If you need atomicity, use MULTI/EXEC inside pipeline: <code>pipe.multi(); pipe.set(...); pipe.exec()</code>. Pipeline = speed, MULTI/EXEC = atomicity!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Pipelining 1M commands crashes my Redis. Why?</h4>
                <p><strong>Answer:</strong> Memory! Pipeline buffers ALL commands before sending, and Redis buffers ALL results before replying. 1M commands √ó average size = huge memory spike. Solution: batch in chunks (e.g., 10,000 per pipeline). Always chunk large operations!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I pipeline read commands like GET, HGETALL?</h4>
                <p><strong>Answer:</strong> Absolutely! Pipeline works for ANY commands - reads, writes, mixed. Great for bulk reads: <code>pipe.get("key1"); pipe.get("key2"); ...</code>. Even faster than MGET for different key types (GET, HGET, ZGET mixed). Pipeline = universal optimization!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Importing 1 Million Users from CSV</strong></p>
            
            <p>E-commerce site needs to import 1M user records from CSV into Redis. Each user: SET user:{id}:name, HSET user:{id}:profile, SADD users:all. Sequential = hours. How to do it in minutes?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Chunked Pipeline Import</h4>
                
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
import redis<br>
import csv<br>
<br>
r = redis.Redis()<br>
BATCH_SIZE = 5000  # Commands per pipeline<br>
<br>
pipe = r.pipeline()<br>
count = 0<br>
<br>
with open('users.csv') as f:<br>
&nbsp;&nbsp;&nbsp;&nbsp;reader = csv.DictReader(f)<br>
&nbsp;&nbsp;&nbsp;&nbsp;for row in reader:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id = row['id']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Add to pipeline<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe.set(f"user:{user_id}:name", row['name'])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe.hset(f"user:{user_id}:profile", mapping=row)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe.sadd("users:all", user_id)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count += 3  # 3 commands per user<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Execute every 5000 commands<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if count >= BATCH_SIZE:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe.execute()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe = r.pipeline()  # Fresh pipeline<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(f"Imported {count} users...")<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;# Execute remaining<br>
&nbsp;&nbsp;&nbsp;&nbsp;if count > 0:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe.execute()
                </code>
                
                <p><strong>Performance:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>Sequential:</strong> 1M users √ó 3 commands √ó 1ms RTT = 3,000 seconds (50 minutes!)</li>
                    <li><strong>Pipelined:</strong> 1M users √∑ 5000 batch √ó 10ms = 2,000ms (2 minutes!)</li>
                    <li>‚úÖ 25x faster with pipelining!</li>
                </ul>
                
                <p><strong>Why chunk at 5000?</strong> Balances memory usage vs RTT savings. Too large = memory spike, too small = more RTTs. Sweet spot: 1,000-10,000 commands.</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Eliminates RTT overhead</strong> - Send all commands, receive all replies together</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üöÄ</span><p><strong>10-100x faster</strong> - For bulk operations, massive speedup</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ùå</span><p><strong>Not atomic</strong> - Use MULTI/EXEC if you need atomicity</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Chunk large batches</strong> - Don't pipeline millions at once (memory!)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîß</span><p><strong>Works for all commands</strong> - Reads, writes, mixed operations</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìà</span><p><strong>Production essential</strong> - Use for imports, exports, bulk updates</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Pipeline</span><span class="keyword-tag">RTT</span><span class="keyword-tag">Batching</span><span class="keyword-tag">Performance</span><span class="keyword-tag">Bulk Operations</span><span class="keyword-tag">execute()</span><span class="keyword-tag">Network</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You need to SET 1000 keys. Network RTT = 2ms. How much time savings with pipeline vs sequential?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) 10ms faster</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) 100ms faster</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">C) ~2000ms faster (2 seconds)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) No difference (same time)</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: C - About 2000ms (2 seconds) faster</strong>
                    <p>Sequential: 1000 commands √ó 2ms RTT each = 2000ms total. Pipelined: 1 batch √ó 2ms RTT = 2ms total (plus processing). Savings = 2000ms - 2ms ‚âà 2 seconds! The speedup is HUGE because we eliminate 999 network round-trips. This is why pipeline is essential for bulk operations!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 40: What are Redis Transactions (MULTI/EXEC)?
// ============================================================

function getQuestion40Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Banking app developer:</strong> "I need to transfer $100 from Alice to Bob. That's two operations: deduct from Alice, add to Bob. What if Redis crashes between them? Bob gets money but Alice's balance doesn't decrease!" Senior dev: "Use MULTI/EXEC transactions! All commands execute together atomically - all succeed or all fail!"</p>
            <p>Let's understand Redis transactions.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Transactions (MULTI/EXEC) queue multiple commands and execute them as a single atomic unit. All commands execute sequentially without interruption from other clients.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Transaction Commands</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Command</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Returns</th></tr>
                    <tr><td style="padding: 8px;">MULTI</td><td>Start transaction</td><td>OK</td></tr>
                    <tr><td style="padding: 8px;">Commands...</td><td>Queue commands</td><td>QUEUED (each)</td></tr>
                    <tr><td style="padding: 8px;">EXEC</td><td>Execute all</td><td>Array of results</td></tr>
                    <tr><td style="padding: 8px;">DISCARD</td><td>Cancel transaction</td><td>OK</td></tr>
                    <tr><td style="padding: 8px;">WATCH key</td><td>Optimistic locking</td><td>OK</td></tr>
                    <tr><td style="padding: 8px;">UNWATCH</td><td>Remove watches</td><td>OK</td></tr>
                </table>
            </div>

            <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>‚ö†Ô∏è Important Differences from SQL Transactions:</strong></p>
                <ul>
                    <li><strong>No rollback:</strong> If command fails during EXEC, others still execute!</li>
                    <li><strong>Commands queued:</strong> Not executed until EXEC</li>
                    <li><strong>All or nothing:</strong> Either all commands execute or none (if WATCH fails)</li>
                    <li><strong>Isolation:</strong> No other client commands run between your commands</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">MULTI/EXEC Transaction Flow</div>
                <svg viewBox="0 0 900 500" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Transaction Lifecycle</text>
                    
                    <!-- Step 1: MULTI -->
                    <rect x="50" y="70" width="180" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="140" y="100" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">1. Start Transaction</text>
                    <text x="140" y="125" text-anchor="middle" fill="#FFA500" font-size="12">MULTI</text>
                    <text x="140" y="143" text-anchor="middle" fill="#888" font-size="10">Returns: OK</text>
                    
                    <path d="M 230 110 L 265 110" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    
                    <!-- Step 2: Queue Commands -->
                    <rect x="265" y="70" width="180" height="80" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="355" y="100" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="600">2. Queue Commands</text>
                    <text x="355" y="120" text-anchor="middle" fill="#FFA500" font-size="11">DECRBY alice 100</text>
                    <text x="355" y="135" text-anchor="middle" fill="#888" font-size="9">QUEUED</text>
                    <text x="355" y="148" text-anchor="middle" fill="#888" font-size="9">(not executed yet!)</text>
                    
                    <path d="M 445 110 L 480 110" stroke="#9C27B0" stroke-width="3" marker-end="url(#arrowPurple)"/>
                    
                    <!-- Step 3: EXEC -->
                    <rect x="480" y="70" width="180" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="570" y="100" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">3. Execute All</text>
                    <text x="570" y="125" text-anchor="middle" fill="#FFA500" font-size="12">EXEC</text>
                    <text x="570" y="143" text-anchor="middle" fill="#00FF88" font-size="10">‚úÖ Atomic execution!</text>
                    
                    <!-- Detailed Flow -->
                    <rect x="50" y="180" width="800" height="290" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="210" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">Complete Transaction Example: Bank Transfer</text>
                    
                    <!-- Without Transaction (Problem) -->
                    <rect x="70" y="230" width="360" height="220" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="250" y="255" text-anchor="middle" fill="#FF6347" font-size="13" font-weight="600">‚ùå Without Transaction (Race Condition)</text>
                    
                    <text x="85" y="280" fill="#FFA500" font-size="11">1. DECRBY alice:balance 100</text>
                    <text x="95" y="297" fill="#888" font-size="9">‚Üí Alice: $1000 ‚Üí $900 ‚úì</text>
                    
                    <text x="85" y="320" fill="#FF6347" font-size="11" font-weight="600">üí• CRASH or other client intervenes!</text>
                    
                    <text x="85" y="343" fill="#FFA500" font-size="11">2. INCRBY bob:balance 100</text>
                    <text x="95" y="360" fill="#888" font-size="9">‚Üí Bob: $500 ‚Üí $600 ‚úì</text>
                    
                    <rect x="85" y="375" width="330" height="60" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="250" y="395" text-anchor="middle" fill="#FF6347" font-size="11" font-weight="600">‚ùå PROBLEM:</text>
                    <text x="100" y="413" fill="#fff" font-size="10">Alice lost $100, Bob didn't get it!</text>
                    <text x="100" y="428" fill="#fff" font-size="10">Or: Bob got $100, Alice still has $1000!</text>
                    
                    <!-- With Transaction (Solution) -->
                    <rect x="450" y="230" width="380" height="220" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="640" y="255" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">‚úÖ With Transaction (Atomic)</text>
                    
                    <text x="465" y="280" fill="#00FF88" font-size="11" font-weight="600">MULTI</text>
                    <text x="475" y="297" fill="#888" font-size="9">OK</text>
                    
                    <text x="465" y="318" fill="#FFA500" font-size="11">DECRBY alice:balance 100</text>
                    <text x="475" y="335" fill="#888" font-size="9">QUEUED (not executed)</text>
                    
                    <text x="465" y="356" fill="#FFA500" font-size="11">INCRBY bob:balance 100</text>
                    <text x="475" y="373" fill="#888" font-size="9">QUEUED (not executed)</text>
                    
                    <text x="465" y="394" fill="#DC143C" font-size="11" font-weight="600">EXEC</text>
                    <text x="475" y="411" fill="#00FF88" font-size="9">Both execute together! ‚úì</text>
                    
                    <rect x="465" y="420" width="350" height="20" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="1" rx="4"/>
                    <text x="640" y="435" text-anchor="middle" fill="#00FF88" font-size="10">‚úÖ GUARANTEED: Both succeed or both fail</text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Transaction</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Simple MULTI/EXEC</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Setup balances</span>
r.set(<span class="string">"alice:balance"</span>, <span class="number">1000</span>)
r.set(<span class="string">"bob:balance"</span>, <span class="number">500</span>)

<span class="comment"># Transfer $100: Alice ‚Üí Bob</span>
pipe = r.pipeline()  <span class="comment"># Pipeline with transaction</span>

pipe.multi()  <span class="comment"># Start transaction</span>
pipe.decrby(<span class="string">"alice:balance"</span>, <span class="number">100</span>)
pipe.incrby(<span class="string">"bob:balance"</span>, <span class="number">100</span>)
results = pipe.execute()  <span class="comment"># Execute atomically!</span>

<span class="keyword">print</span>(<span class="string">f"Results: {results}"</span>)  <span class="comment"># [900, 600]</span>
<span class="keyword">print</span>(<span class="string">f"Alice: ${r.get('alice:balance')}"</span>)  <span class="comment"># 900</span>
<span class="keyword">print</span>(<span class="string">f"Bob: ${r.get('bob:balance')}"</span>)      <span class="comment"># 600</span>

<span class="comment"># ‚úÖ Guaranteed: Both commands executed together!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: WATCH for Optimistic Locking</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Preventing Race Conditions with WATCH</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">safe_transfer</span>(from_key, to_key, amount):
    <span class="string">"""Transfer with WATCH to prevent race conditions"""</span>
    
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="keyword">try</span>:
            <span class="comment"># Watch the balance - transaction fails if it changes</span>
            r.watch(from_key)
            
            <span class="comment"># Check balance</span>
            balance = <span class="function">int</span>(r.get(from_key) <span class="keyword">or</span> <span class="number">0</span>)
            
            <span class="keyword">if</span> balance < amount:
                r.unwatch()  <span class="comment"># Cancel watch</span>
                <span class="keyword">return</span> <span class="keyword">False</span>, <span class="string">"Insufficient funds"</span>
            
            <span class="comment"># Start transaction</span>
            pipe = r.pipeline()
            pipe.multi()
            pipe.decrby(from_key, amount)
            pipe.incrby(to_key, amount)
            pipe.execute()
            
            <span class="keyword">return</span> <span class="keyword">True</span>, <span class="string">"Transfer successful"</span>
            
        <span class="keyword">except</span> redis.WatchError:
            <span class="comment"># Balance changed between WATCH and EXEC!</span>
            <span class="comment"># Retry the transaction</span>
            <span class="keyword">print</span>(<span class="string">"‚ö†Ô∏è Balance changed, retrying..."</span>)
            <span class="keyword">continue</span>

<span class="comment"># Usage</span>
r.set(<span class="string">"alice:balance"</span>, <span class="number">1000</span>)
r.set(<span class="string">"bob:balance"</span>, <span class="number">500</span>)

success, msg = safe_transfer(<span class="string">"alice:balance"</span>, <span class="string">"bob:balance"</span>, <span class="number">100</span>)
<span class="keyword">print</span>(<span class="string">f"\\n{msg}"</span>)

<span class="comment"># WATCH ensures if another client modifies alice:balance
# between our READ and EXEC, transaction fails and retries!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: DISCARD to Cancel</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Canceling Transaction</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Start transaction</span>
<span class="keyword">MULTI</span>
<span class="string">OK</span>

<span class="comment"># Queue commands</span>
<span class="keyword">SET</span> <span class="string">key1</span> <span class="string">"value1"</span>
<span class="string">QUEUED</span>

<span class="keyword">SET</span> <span class="string">key2</span> <span class="string">"value2"</span>
<span class="string">QUEUED</span>

<span class="comment"># Oh wait, I changed my mind!</span>
<span class="keyword">DISCARD</span>
<span class="string">OK</span>

<span class="comment"># Commands were NOT executed</span>
<span class="keyword">GET</span> <span class="string">key1</span>
<span class="string">(nil)</span>  <span class="comment"># Not set!</span>

<span class="keyword">GET</span> <span class="string">key2</span>
<span class="string">(nil)</span>  <span class="comment"># Not set!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Can I rollback a Redis transaction like SQL?</h4>
                <p><strong>A:</strong> NO! Redis has no rollback. If command 2 fails during EXEC, command 1 and 3 still execute! This is BY DESIGN - Redis philosophy: errors are programming bugs (fix code), not runtime issues. Use WATCH + retry for race conditions!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What's the difference between Pipeline and Transaction?</h4>
                <p><strong>A:</strong> Pipeline = SPEED (batch commands, eliminate RTT), NO atomicity. Transaction = ATOMICITY (all or nothing), commands execute without interruption. You can combine: Pipeline with MULTI/EXEC gives both speed AND atomicity!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: How does WATCH work exactly?</h4>
                <p><strong>A:</strong> WATCH monitors keys. If ANY of them change before EXEC, entire transaction aborts (returns nil). It's optimistic locking: assume no conflicts, retry if conflict detected. Pattern: WATCH ‚Üí read ‚Üí check ‚Üí MULTI ‚Üí modify ‚Üí EXEC!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can I use GET inside MULTI/EXEC block?</h4>
                <p><strong>A:</strong> Yes, but you can't USE the result! Commands are queued, not executed. GET returns "QUEUED", not the value. For conditional logic, use WATCH before MULTI, read values, then decide whether to proceed!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: What if Redis crashes during EXEC?</h4>
                <p><strong>A:</strong> With AOF persistence: partial transaction in log, Redis recovers or discards incomplete transaction. With RDB: last snapshot might not include transaction. For critical data, use AOF with <code>appendfsync always</code>!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Command has syntax error in MULTI block. When does it fail?</h4>
                <p><strong>Answer:</strong> Two cases: (1) Syntax error detected immediately (before EXEC): transaction aborts, nothing executes. (2) Runtime error (wrong type): discovered during EXEC, that command fails but others execute! No rollback!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: I WATCH 5 keys. One changes. Which commands fail?</h4>
                <p><strong>Answer:</strong> ALL commands fail! EXEC returns nil, entire transaction aborted. WATCH is all-or-nothing - any watched key changes = whole transaction canceled. That's why you retry in loop until successful!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I nest transactions (MULTI inside MULTI)?</h4>
                <p><strong>Answer:</strong> NO! Redis returns error "ERR MULTI calls can not be nested". One transaction at a time per client. For complex logic, use Lua scripts (atomic + can have logic) instead of transactions!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Inventory Reservation</strong></p>
            
            <p>User adds item to cart. Must: (1) Check stock, (2) Reserve item, (3) Update cart. All must be atomic to prevent overselling!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: WATCH + MULTI/EXEC Pattern</h4>
                
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0; font-size: 11px;">
def reserve_item(user_id, product_id, quantity):<br>
&nbsp;&nbsp;&nbsp;&nbsp;stock_key = f"product:{product_id}:stock"<br>
&nbsp;&nbsp;&nbsp;&nbsp;cart_key = f"cart:{user_id}"<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;while True:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# WATCH stock (optimistic lock)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.watch(stock_key)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Check stock BEFORE transaction<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stock = int(r.get(stock_key) or 0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if stock < quantity:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.unwatch()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return False, "Out of stock"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Atomic reservation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe = r.pipeline()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe.multi()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe.decrby(stock_key, quantity)  # Reduce stock<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe.hincrby(cart_key, product_id, quantity)  # Add to cart<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pipe.execute()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return True, "Reserved successfully"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except redis.WatchError:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Stock changed, retry!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue
                </code>
                
                <p><strong>Why this works:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ WATCH prevents race: if stock changes, transaction aborts</li>
                    <li>‚úÖ Atomic execution: stock decrease + cart add together</li>
                    <li>‚úÖ Retry logic: handles concurrent reservations</li>
                    <li>‚úÖ No overselling: stock check before transaction</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>MULTI/EXEC = Atomic</strong> - All commands execute together, no interruption</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ùå</span><p><strong>No rollback!</strong> - Different from SQL, failed commands don't undo others</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üëÅÔ∏è</span><p><strong>WATCH for CAS</strong> - Optimistic locking prevents race conditions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¶</span><p><strong>Commands queued</strong> - Not executed until EXEC</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Combine with Pipeline</strong> - Get atomicity + speed together</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>Retry pattern</strong> - Loop with WATCH when conflicts possible</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">MULTI</span><span class="keyword-tag">EXEC</span><span class="keyword-tag">WATCH</span><span class="keyword-tag">DISCARD</span><span class="keyword-tag">Atomic</span><span class="keyword-tag">Transaction</span><span class="keyword-tag">Optimistic Locking</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You MULTI, queue 3 commands, second fails during EXEC. What happens?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) All 3 commands fail (rollback)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Commands 1 and 3 succeed, 2 fails</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Transaction retries automatically</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) EXEC returns error, nothing executes</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Commands 1 and 3 succeed, command 2 fails</strong>
                    <p>Redis transactions do NOT rollback! If a command fails during EXEC (runtime error like WRONGTYPE), that command fails but others execute normally. This is different from SQL. Only syntax errors (detected before EXEC) abort the entire transaction. Always validate data types before transactions to avoid partial failures!</p>
                </div>
            </div>
        </div>
    `;
}


function getQuestion41Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Alert comes in:</strong> "Redis memory 100% full! Application returning errors: OOM command not allowed!" Developer panics: "We set maxmemory but didn't configure eviction policy! Redis is refusing all writes!" Solution: Configure eviction policy to automatically delete old/unused keys when memory is full.</p>
            <p>So what are eviction policies and which should you use?</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis eviction policy determines which keys to delete when maxmemory limit is reached. Redis offers 8 policies ranging from "no eviction" to "LRU/LFU eviction of all keys or only keys with TTL."</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">All 8 Eviction Policies</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Policy</th><th style="padding: 10px;">What Gets Evicted</th><th style="padding: 10px;">Best For</th></tr>
                    <tr><td style="padding: 8px;">noeviction</td><td>Nothing! Returns errors</td><td>Never want data loss</td></tr>
                    <tr><td style="padding: 8px;">allkeys-lru</td><td>Least recently used key</td><td>Cache (most common!)</td></tr>
                    <tr><td style="padding: 8px;">allkeys-lfu</td><td>Least frequently used</td><td>Popularity-based cache</td></tr>
                    <tr><td style="padding: 8px;">allkeys-random</td><td>Random key</td><td>All keys equal importance</td></tr>
                    <tr><td style="padding: 8px;">volatile-lru</td><td>LRU from keys with TTL</td><td>Mix: cache + critical data</td></tr>
                    <tr><td style="padding: 8px;">volatile-lfu</td><td>LFU from keys with TTL</td><td>Popular cached items</td></tr>
                    <tr><td style="padding: 8px;">volatile-ttl</td><td>Keys expiring soonest</td><td>Time-sensitive data</td></tr>
                    <tr><td style="padding: 8px;">volatile-random</td><td>Random from keys with TTL</td><td>Simple eviction</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Decision Guide:</strong></p>
                <ul>
                    <li><strong>Pure cache:</strong> allkeys-lru (safest default)</li>
                    <li><strong>Mixed data:</strong> volatile-lru (only evict cached data with TTL)</li>
                    <li><strong>Never evict:</strong> noeviction (app handles errors)</li>
                    <li><strong>Popular content:</strong> allkeys-lfu (video streaming, CDN)</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Eviction Policy Decision Tree</div>
                <svg viewBox="0 0 900 550" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Which Eviction Policy Should I Use?</text>
                    
                    <!-- Start -->
                    <rect x="350" y="60" width="200" height="50" fill="rgba(220,20,60,0.3)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#fff" font-size="14" font-weight="600">Memory Full!</text>
                    
                    <path d="M 450 110 L 450 145" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    
                    <!-- Decision 1 -->
                    <rect x="300" y="145" width="300" height="60" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="450" y="170" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">Can we delete keys?</text>
                    
                    <!-- No Path -->
                    <path d="M 300 175 L 150 175" stroke="#FF6347" stroke-width="2" marker-end="url(#arrowRed)"/>
                    <text x="220" y="170" text-anchor="middle" fill="#FF6347" font-size="11">NO</text>
                    
                    <rect x="50" y="150" width="100" height="50" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="100" y="180" text-anchor="middle" fill="#FF6347" font-size="12" font-weight="600">noeviction</text>
                    <text x="100" y="235" text-anchor="middle" fill="#888" font-size="9">Returns errors on writes</text>
                    
                    <!-- Yes Path -->
                    <path d="M 450 205 L 450 245" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    <text x="470" y="225" fill="#00FF88" font-size="11">YES</text>
                    
                    <!-- Decision 2 -->
                    <rect x="300" y="245" width="300" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="450" y="270" text-anchor="middle" fill="#9C27B0" font-size="13" font-weight="600">All keys or only TTL keys?</text>
                    
                    <!-- All keys path -->
                    <path d="M 300 275 L 200 275 L 200 335" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <text x="240" y="270" fill="#00FF88" font-size="11">All keys</text>
                    
                    <rect x="100" y="335" width="200" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="200" y="360" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">allkeys-* policies</text>
                    <text x="120" y="382" fill="#bbb" font-size="10">‚Ä¢ allkeys-lru (most common)</text>
                    <text x="120" y="398" fill="#bbb" font-size="10">‚Ä¢ allkeys-lfu (popularity)</text>
                    <text x="120" y="414" fill="#bbb" font-size="10">‚Ä¢ allkeys-random</text>
                    
                    <!-- TTL keys path -->
                    <path d="M 600 275 L 700 275 L 700 335" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    <text x="660" y="270" fill="#9C27B0" font-size="11">Only TTL</text>
                    
                    <rect x="600" y="335" width="200" height="80" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="700" y="360" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">volatile-* policies</text>
                    <text x="620" y="382" fill="#bbb" font-size="10">‚Ä¢ volatile-lru (time-based)</text>
                    <text x="620" y="398" fill="#bbb" font-size="10">‚Ä¢ volatile-lfu (popularity)</text>
                    <text x="620" y="414" fill="#bbb" font-size="10">‚Ä¢ volatile-ttl (expire soon)</text>
                    
                    <!-- Recommendations -->
                    <rect x="50" y="440" width="800" height="90" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="465" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">üí° Recommendations</text>
                    
                    <text x="70" y="490" fill="#00FF88" font-size="11" font-weight="600">‚úÖ Pure cache (all data can be evicted):</text>
                    <text x="80" y="507" fill="#bbb" font-size="10">Use allkeys-lru ‚Üí Evicts least recently used, works great!</text>
                    
                    <text x="470" y="490" fill="#9C27B0" font-size="11" font-weight="600">‚úÖ Mixed (cache + critical data):</text>
                    <text x="480" y="507" fill="#bbb" font-size="10">Use volatile-lru ‚Üí Only evicts cached items with TTL</text>
                    <text x="480" y="520" fill="#888" font-size="9">(Set TTL on cache, not on critical data!)</text>
                    
                    <defs>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - Eviction Policy Setup</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Set memory limit (required!)</span>
<span class="keyword">maxmemory</span> <span class="number">2gb</span>

<span class="comment"># Set eviction policy</span>
<span class="keyword">maxmemory-policy</span> allkeys-lru

<span class="comment"># How many keys to sample for LRU/LFU (default: 5)</span>
<span class="keyword">maxmemory-samples</span> <span class="number">5</span>

<span class="comment"># Options for maxmemory-policy:</span>
<span class="comment"># - noeviction         (default, returns errors)</span>
<span class="comment"># - allkeys-lru        (best for pure cache)</span>
<span class="comment"># - allkeys-lfu        (best for popularity-based)</span>
<span class="comment"># - allkeys-random</span>
<span class="comment"># - volatile-lru       (only evict keys with TTL)</span>
<span class="comment"># - volatile-lfu</span>
<span class="comment"># - volatile-ttl       (evict soonest expiring)</span>
<span class="comment"># - volatile-random</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Runtime Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Change Policy On-The-Fly</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Check current policy</span>
<span class="keyword">CONFIG GET</span> maxmemory-policy
<span class="number">1)</span> <span class="string">"maxmemory-policy"</span>
<span class="number">2)</span> <span class="string">"noeviction"</span>

<span class="comment"># Change to allkeys-lru</span>
<span class="keyword">CONFIG SET</span> maxmemory-policy allkeys-lru
<span class="string">OK</span>

<span class="comment"># Check memory usage</span>
<span class="keyword">INFO</span> memory
<span class="comment"># Look for:</span>
<span class="comment"># used_memory: 1500000000  (1.5GB)</span>
<span class="comment"># maxmemory: 2000000000    (2GB limit)</span>
<span class="comment"># evicted_keys: 12543      (keys evicted so far)</span>

<span class="comment"># Monitor evictions in real-time</span>
<span class="keyword">INFO</span> stats | grep evicted
<span class="comment"># evicted_keys:12543</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Mixed Data Strategy</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Cache vs Critical Data Pattern</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Configure for mixed workload</span>
r.config_set(<span class="string">'maxmemory'</span>, <span class="string">'2gb'</span>)
r.config_set(<span class="string">'maxmemory-policy'</span>, <span class="string">'volatile-lru'</span>)

<span class="comment"># Critical data: NO TTL (never evicted!)</span>
r.set(<span class="string">'user:123:balance'</span>, <span class="number">1000</span>)  <span class="comment"># No TTL = safe</span>
r.hset(<span class="string">'user:123:profile'</span>, <span class="string">'email'</span>, <span class="string">'alice@example.com'</span>)

<span class="comment"># Cached data: WITH TTL (can be evicted)</span>
r.setex(<span class="string">'cache:product:456'</span>, <span class="number">3600</span>, <span class="string">'Product data...'</span>)  <span class="comment"># 1 hour TTL</span>
r.setex(<span class="string">'cache:api:response'</span>, <span class="number">300</span>, <span class="string">'API result...'</span>)    <span class="comment"># 5 min TTL</span>

<span class="comment"># With volatile-lru policy:</span>
<span class="comment"># ‚úÖ User balance NEVER evicted (no TTL)</span>
<span class="comment"># ‚úÖ Product cache CAN be evicted (has TTL)</span>
<span class="comment"># Perfect separation!</span>

<span class="keyword">print</span>(<span class="string">f"\\n‚úÖ Critical data protected"</span>)
<span class="keyword">print</span>(<span class="string">f"‚úÖ Cache can be evicted when needed"</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: What happens with noeviction when memory is full?</h4>
                <p><strong>A:</strong> Redis returns errors for write commands! GET still works, but SET/HSET/ZADD fail with "OOM command not allowed when used memory > maxmemory". Reads work, writes fail. Must delete keys manually or increase maxmemory!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What if I use volatile-lru but NO keys have TTL?</h4>
                <p><strong>A:</strong> Acts like noeviction! If no keys with TTL exist, Redis can't evict anything, returns errors on writes. Always ensure cached keys have TTL if using volatile-* policies. Check with <code>INFO keyspace</code> for keys with expire!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: How does Redis implement "approximate" LRU?</h4>
                <p><strong>A:</strong> Redis samples N keys (default 5) and evicts the least recently used from sample. Not true LRU (would need to track all keys), but close enough and much faster! Increase maxmemory-samples for more accurate LRU at cost of CPU.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can eviction delete keys I just set?</h4>
                <p><strong>A:</strong> Theoretically yes! If you SET a key when memory is 99.9% full, and Redis immediately needs space, your key could be evicted. Practically rare - set appropriate maxmemory and monitor usage. Keep 20% headroom recommended!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: How to monitor evictions in production?</h4>
                <p><strong>A:</strong> <code>INFO stats</code> shows evicted_keys counter. Monitor this metric! If evictions spike: (1) Increase maxmemory, (2) Add more Redis instances, or (3) Optimize data (remove unnecessary keys). Alert if eviction rate > threshold!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: I set maxmemory but memory usage exceeds it. Why?</h4>
                <p><strong>Answer:</strong> maxmemory is approximate! Includes: (1) Dataset memory, (2) Replication buffer, (3) Client buffers, (4) Fragmentation. Actual memory can be 20-30% higher! Monitor used_memory_rss (resident set size) not just used_memory. Set maxmemory to 70-80% of available RAM!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: allkeys-lru vs volatile-lru - performance difference?</h4>
                <p><strong>Answer:</strong> Minimal! Both sample same number of keys. Difference: allkeys-lru samples from ALL keys, volatile-lru only from keys with TTL. If 50% have TTL, volatile-lru has smaller pool. No real performance impact - choose based on use case!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I have different eviction policies for different databases?</h4>
                <p><strong>Answer:</strong> NO! Eviction policy is instance-wide, applies to ALL databases (DB0, DB1, etc). If you need different policies, use separate Redis instances. Or use key namespacing with volatile-* and control which keys get TTL!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce with Sessions + Product Cache</strong></p>
            
            <p>Online store stores: (1) User sessions (critical, can't lose!), (2) Product data cache (can regenerate from DB). Both in same Redis. Memory: 8GB limit. How to configure?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: volatile-lru Strategy</h4>
                
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
# redis.conf<br>
maxmemory 8gb<br>
maxmemory-policy volatile-lru<br>
maxmemory-samples 5
                </code>
                
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0; font-size: 11px;">
# Application code<br>
<br>
# Sessions: NO TTL (never evicted!)<br>
SET session:abc123 "{user_id: 456, cart: [...]}"<br>
EXPIRE session:abc123 3600  # TTL for expiration, NOT eviction<br>
<br>
# Product cache: WITH SHORT TTL (can be evicted)<br>
SETEX cache:product:789 300 "{name: 'Laptop', price: 999}"<br>
<br>
# With volatile-lru:<br>
# - Sessions have TTL but won't be evicted (refreshed often)<br>
# - Product cache has TTL and CAN be evicted if memory full<br>
# - Result: Sessions protected, cache regenerates from DB
                </code>
                
                <p><strong>Why this works:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Sessions have TTL (for auto-cleanup) but actively used ‚Üí not evicted</li>
                    <li>‚úÖ Product cache has TTL ‚Üí eligible for eviction</li>
                    <li>‚úÖ LRU means least-used cache evicted first</li>
                    <li>‚úÖ Sessions safe, cache can regenerate</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>8 policies available</strong> - noeviction, allkeys-*, volatile-*</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>allkeys-lru most common</strong> - Best default for pure cache</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÄ</span><p><strong>volatile-lru for mixed data</strong> - Protect critical, evict cache</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>noeviction returns errors</strong> - Stops writes when full</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor evicted_keys</strong> - Track via INFO stats</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Set maxmemory to 70-80% of RAM</strong> - Leave headroom for overhead</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Eviction</span><span class="keyword-tag">maxmemory</span><span class="keyword-tag">LRU</span><span class="keyword-tag">LFU</span><span class="keyword-tag">noeviction</span><span class="keyword-tag">allkeys-lru</span><span class="keyword-tag">volatile-lru</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You use volatile-lru but store critical data without TTL. What happens when memory is full?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Critical data gets evicted (LRU)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) Redis evicts all data</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">C) Redis returns errors (like noeviction)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Redis switches to allkeys-lru</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: C - Redis returns errors (like noeviction)</strong>
                    <p>volatile-lru ONLY evicts keys with TTL. If no keys have TTL (or all TTL keys already evicted), Redis can't evict anything ‚Üí acts like noeviction ‚Üí returns "OOM" errors on writes. This is why it's perfect for mixed data: set TTL on cache (evictable), no TTL on critical data (protected). Always ensure some keys have TTL when using volatile-* policies!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 42: LRU vs LFU - What's the Difference?
// ============================================================

function getQuestion42Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Cache architect asks:</strong> "We're caching videos. Some users watch the same popular videos repeatedly (high frequency). Others watch random videos once (recent but low frequency). Should we evict by recency (LRU) or by frequency (LFU)?" The answer determines which videos stay cached!</p>
            <p>Let's understand LRU vs LFU eviction.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>LRU (Least Recently Used) evicts keys based on access time - oldest access goes first. LFU (Least Frequently Used) evicts keys based on access count - fewest accesses go first.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">LRU vs LFU Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Aspect</th><th style="padding: 10px;">LRU</th><th style="padding: 10px;">LFU</th></tr>
                    <tr><td style="padding: 8px;">Evicts based on</td><td>When last accessed</td><td>How many times accessed</td></tr>
                    <tr><td style="padding: 8px;">Tracks</td><td>Time of last access</td><td>Access count</td></tr>
                    <tr><td style="padding: 8px;">Best for</td><td>Time-sensitive data</td><td>Popularity-based data</td></tr>
                    <tr><td style="padding: 8px;">Example use</td><td>Session cache</td><td>Video streaming</td></tr>
                    <tr><td style="padding: 8px;">Protects</td><td>Recently accessed</td><td>Frequently accessed</td></tr>
                    <tr><td style="padding: 8px;">Vulnerability</td><td>One-time burst keeps it</td><td>Old popular items stay forever</td></tr>
                    <tr><td style="padding: 8px;">Implementation</td><td>Timestamp per key</td><td>Counter per key</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° When to Use Which:</strong></p>
                <ul>
                    <li><strong>LRU:</strong> User sessions, recent searches, shopping carts (recency matters)</li>
                    <li><strong>LFU:</strong> Popular content, trending videos, hot products (frequency matters)</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">LRU vs LFU Eviction Behavior</div>
                <svg viewBox="0 0 900 480" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Different Eviction Strategies</text>
                    
                    <!-- LRU Example -->
                    <rect x="50" y="60" width="380" height="180" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="240" y="90" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">LRU: Least Recently Used</text>
                    
                    <text x="70" y="120" fill="#FFA500" font-size="12" font-weight="600">Cache State (4 keys max):</text>
                    
                    <rect x="70" y="135" width="150" height="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="90" y="155" fill="#fff" font-size="11">video_1</text>
                    <text x="200" y="155" text-anchor="end" fill="#888" font-size="9">10 min ago</text>
                    
                    <rect x="70" y="170" width="150" height="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="90" y="190" fill="#fff" font-size="11">video_2</text>
                    <text x="200" y="190" text-anchor="end" fill="#888" font-size="9">5 min ago</text>
                    
                    <rect x="70" y="205" width="150" height="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="90" y="225" fill="#fff" font-size="11">video_3</text>
                    <text x="200" y="225" text-anchor="end" fill="#888" font-size="9">2 min ago</text>
                    
                    <rect x="240" y="135" width="170" height="100" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="325" y="160" text-anchor="middle" fill="#FF6347" font-size="12" font-weight="600">Memory Full!</text>
                    <text x="325" y="180" text-anchor="middle" fill="#fff" font-size="11">Need: video_4</text>
                    <text x="250" y="200" fill="#888" font-size="10">Evict: video_1</text>
                    <text x="250" y="215" fill="#888" font-size="9">(oldest access)</text>
                    
                    <!-- LFU Example -->
                    <rect x="470" y="60" width="380" height="180" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="660" y="90" text-anchor="middle" fill="#9C27B0" font-size="16" font-weight="600">LFU: Least Frequently Used</text>
                    
                    <text x="490" y="120" fill="#FFA500" font-size="12" font-weight="600">Cache State (4 keys max):</text>
                    
                    <rect x="490" y="135" width="150" height="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="510" y="155" fill="#fff" font-size="11">video_1</text>
                    <text x="620" y="155" text-anchor="end" fill="#888" font-size="9">100 views</text>
                    
                    <rect x="490" y="170" width="150" height="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="510" y="190" fill="#fff" font-size="11">video_2</text>
                    <text x="620" y="190" text-anchor="end" fill="#888" font-size="9">50 views</text>
                    
                    <rect x="490" y="205" width="150" height="30" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="510" y="225" fill="#fff" font-size="11">video_3</text>
                    <text x="620" y="225" text-anchor="end" fill="#888" font-size="9">5 views</text>
                    
                    <rect x="660" y="135" width="170" height="100" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="745" y="160" text-anchor="middle" fill="#FF6347" font-size="12" font-weight="600">Memory Full!</text>
                    <text x="745" y="180" text-anchor="middle" fill="#fff" font-size="11">Need: video_4</text>
                    <text x="670" y="200" fill="#888" font-size="10">Evict: video_3</text>
                    <text x="670" y="215" fill="#888" font-size="9">(fewest views)</text>
                    
                    <!-- Comparison Bottom -->
                    <rect x="50" y="260" width="800" height="200" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="290" text-anchor="middle" fill="#DC143C" font-size="15" font-weight="700">Real-World Scenario: Video Streaming Cache</text>
                    
                    <rect x="70" y="310" width="360" height="130" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="250" y="335" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">With LRU</text>
                    <text x="85" y="358" fill="#bbb" font-size="11">User watches viral video once</text>
                    <text x="95" y="375" fill="#888" font-size="10">‚Üí Video cached (recent!)</text>
                    <text x="95" y="390" fill="#888" font-size="10">‚Üí Stays in cache for a while</text>
                    <text x="85" y="410" fill="#FFA500" font-size="11">Problem: One-time views take space</text>
                    <text x="85" y="427" fill="#888" font-size="10">Popular content might be evicted!</text>
                    
                    <rect x="470" y="310" width="360" height="130" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="650" y="335" text-anchor="middle" fill="#9C27B0" font-size="13" font-weight="600">With LFU</text>
                    <text x="485" y="358" fill="#bbb" font-size="11">User watches viral video once</text>
                    <text x="495" y="375" fill="#888" font-size="10">‚Üí Video cached (1 view)</text>
                    <text x="495" y="390" fill="#888" font-size="10">‚Üí Quickly evicted (low count)</text>
                    <text x="485" y="410" fill="#00FF88" font-size="11">Benefit: Popular videos stay cached</text>
                    <text x="485" y="427" fill="#888" font-size="10">Trending content always available!</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - LRU vs LFU</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># LRU Configuration (most common)</span>
<span class="keyword">maxmemory</span> <span class="number">2gb</span>
<span class="keyword">maxmemory-policy</span> allkeys-lru
<span class="keyword">maxmemory-samples</span> <span class="number">5</span>  <span class="comment"># Sample 5 keys, evict oldest</span>

<span class="comment"># LFU Configuration (for popular content)</span>
<span class="keyword">maxmemory</span> <span class="number">2gb</span>
<span class="keyword">maxmemory-policy</span> allkeys-lfu
<span class="keyword">maxmemory-samples</span> <span class="number">5</span>  <span class="comment"># Sample 5 keys, evict least frequent</span>

<span class="comment"># LFU Tuning (Redis 4.0+)</span>
<span class="keyword">lfu-log-factor</span> <span class="number">10</span>  <span class="comment"># Counter increment rate</span>
<span class="keyword">lfu-decay-time</span> <span class="number">1</span>   <span class="comment"># Decay time in minutes</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Checking Key Access Info</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Inspecting LRU/LFU Data</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Get detailed object info</span>
<span class="keyword">OBJECT</span> <span class="keyword">IDLETIME</span> <span class="string">mykey</span>
<span class="number">(integer) 300</span>  <span class="comment"># Seconds since last access (for LRU)</span>

<span class="keyword">OBJECT</span> <span class="keyword">FREQ</span> <span class="string">mykey</span>
<span class="number">(integer) 5</span>  <span class="comment"># Access frequency 0-255 (for LFU)</span>

<span class="comment"># Example: Find least recently used key</span>
<span class="keyword">SCAN</span> <span class="number">0</span> <span class="keyword">MATCH</span> <span class="string">cache:*</span>
<span class="comment"># Then check IDLETIME for each key</span>

<span class="comment"># Example: Find least frequently used key</span>
<span class="keyword">OBJECT</span> <span class="keyword">FREQ</span> <span class="string">cache:video:1</span>  <span class="comment"># 50</span>
<span class="keyword">OBJECT</span> <span class="keyword">FREQ</span> <span class="string">cache:video:2</span>  <span class="comment"># 200 (more popular!)</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Is Redis LRU true LRU or approximate?</h4>
                <p><strong>A:</strong> Approximate! True LRU would track ALL keys in order (expensive). Redis samples N keys (default 5) and evicts oldest from sample. Close enough for most cases, much faster. Increase maxmemory-samples for better accuracy at cost of CPU.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can LFU have "pollution" from old popular items?</h4>
                <p><strong>A:</strong> Yes! Item popular 6 months ago still has high count. Solution: LFU decay (lfu-decay-time). Counters gradually decrease over time. Old popularity fades, recent popularity matters more. Tune based on use case!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Which uses more memory - LRU or LFU?</h4>
                <p><strong>A:</strong> About the same! LRU stores last access timestamp (8 bytes). LFU stores counter (1 byte) + decay timestamp. Minimal difference. Choose based on access pattern, not memory!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Can I mix LRU and LFU in same Redis?</h4>
                <p><strong>A:</strong> No per-key policy! Instance-wide only. Workaround: Use separate Redis instances with different policies, or use volatile-lru/volatile-lfu with key namespacing and selective TTLs.</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: How to choose between LRU and LFU for my use case?</h4>
                <p><strong>A:</strong> Ask: "Is recency or frequency more important?" Sessions/carts = LRU (recent matters). Videos/products = LFU (popularity matters). When unsure, start with LRU (safer default, works for most cases).</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Key accessed once per day for 100 days. LRU vs LFU?</h4>
                <p><strong>Answer:</strong> LRU: Recent (last access yesterday) = probably kept. LFU: High count (100 accesses) = definitely kept! LFU better protects this key. But if pattern changes (no more accesses), LFU keeps it forever without decay!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Does accessing a key with GET update its LRU/LFU data?</h4>
                <p><strong>Answer:</strong> Yes! Any read command (GET, HGET, ZRANGE, etc.) updates access time (LRU) and increments counter (LFU). Even SCAN updates! Only DEBUG commands don't update. Every normal access counts!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Switch from LRU to LFU. What happens to counters?</h4>
                <p><strong>Answer:</strong> Counters reset to 0! When you change policy, all keys start fresh with LFU counter = 5 (not 0). Previously popular keys lose their advantage. Switch during low-traffic period or gradually with new instances!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Netflix Video Streaming Cache</strong></p>
            
            <p>Netflix caches video chunks. Some shows go viral (watched by millions). Others watched by few users. Which eviction: LRU or LFU?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: LFU with Decay</h4>
                
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0;">
maxmemory-policy allkeys-lfu<br>
lfu-log-factor 10<br>
lfu-decay-time 1  # 1 minute decay
                </code>
                
                <p><strong>Why LFU?</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Popular shows (viewed millions of times) stay cached</li>
                    <li>‚úÖ Unpopular shows evicted quickly (low view count)</li>
                    <li>‚úÖ Trending content naturally rises in cache</li>
                </ul>
                
                <p><strong>Why decay?</strong></p>
                <ul style="margin-left: 20px;">
                    <li>Last month's viral show gradually drops count</li>
                    <li>This month's trending show takes priority</li>
                    <li>Prevents "cache pollution" from old hits</li>
                </ul>
                
                <p><strong>Results:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>Cache hit rate: 95%+ (popular content always cached)</li>
                    <li>Storage efficient: Unpopular = evicted immediately</li>
                    <li>Self-optimizing: Trends automatically prioritized</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è∞</span><p><strong>LRU = Time-based</strong> - Evicts oldest access (recency matters)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>LFU = Count-based</strong> - Evicts lowest count (frequency matters)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>LRU default choice</strong> - Works for most cases (sessions, carts)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üé¨</span><p><strong>LFU for popularity</strong> - Videos, products, trending content</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚öôÔ∏è</span><p><strong>Both approximate</strong> - Redis samples keys, not perfect but fast</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîß</span><p><strong>LFU needs decay</strong> - Prevent old popular items from staying forever</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">LRU</span><span class="keyword-tag">LFU</span><span class="keyword-tag">Eviction</span><span class="keyword-tag">Recency</span><span class="keyword-tag">Frequency</span><span class="keyword-tag">allkeys-lru</span><span class="keyword-tag">allkeys-lfu</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You cache product pages. Popular products viewed 1000s of times, others just once. Best policy?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) allkeys-lru (recency matters)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) allkeys-lfu (frequency matters)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) allkeys-random (treat equal)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) noeviction (keep all)</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - allkeys-lfu</strong>
                    <p>Popular products viewed 1000s of times should stay cached! LFU keeps high-frequency items. One-time viewed products (low count) get evicted quickly, making room for popular items. Perfect for e-commerce where 20% of products get 80% of views. LRU would evict popular items if not viewed recently. LFU = frequency-based = perfect for popularity caching!</p>
                </div>
            </div>
        </div>
    `;
}
// ============================================================


// ============================================================
// QUESTION 43: What is Redis Pub/Sub?
// ============================================================

function getQuestion43Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Developer asks:</strong> "We need to broadcast live sports scores to all connected users. Do I query database constantly?" Architect responds: "Use Redis Pub/Sub! Publisher sends score updates to a channel, all subscribers receive instantly. No polling, no database load. Real-time messaging!"</p>
            <p>Let's understand Redis Pub/Sub.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Pub/Sub is a messaging pattern where publishers send messages to channels without knowing subscribers. Subscribers listen to channels and receive all messages published while connected. Messages are fire-and-forget (not persisted).</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Pub/Sub Commands</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Command</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">PUBLISH</td><td>Send message to channel</td><td>PUBLISH news "Breaking!"</td></tr>
                    <tr><td style="padding: 8px;">SUBSCRIBE</td><td>Listen to channel(s)</td><td>SUBSCRIBE news sports</td></tr>
                    <tr><td style="padding: 8px;">PSUBSCRIBE</td><td>Pattern subscribe</td><td>PSUBSCRIBE news.*</td></tr>
                    <tr><td style="padding: 8px;">UNSUBSCRIBE</td><td>Stop listening</td><td>UNSUBSCRIBE news</td></tr>
                    <tr><td style="padding: 8px;">PUBSUB CHANNELS</td><td>List active channels</td><td>PUBSUB CHANNELS news*</td></tr>
                    <tr><td style="padding: 8px;">PUBSUB NUMSUB</td><td>Count subscribers</td><td>PUBSUB NUMSUB news</td></tr>
                </table>
            </div>

            <div style="background: rgba(255, 165, 0, 0.1); border-left: 3px solid #FFA500; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>‚ö†Ô∏è Critical Pub/Sub Characteristics:</strong></p>
                <ul>
                    <li><strong>Fire-and-forget:</strong> Messages NOT persisted (no history!)</li>
                    <li><strong>Subscriber must be online:</strong> Offline = missed messages</li>
                    <li><strong>No acknowledgment:</strong> Publisher doesn't know if anyone received</li>
                    <li><strong>Real-time only:</strong> Can't replay past messages</li>
                </ul>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Best Use Cases:</strong></p>
                <ul>
                    <li><strong>Chat applications:</strong> Broadcast messages to rooms</li>
                    <li><strong>Live notifications:</strong> Real-time alerts</li>
                    <li><strong>Dashboards:</strong> Live metrics updates</li>
                    <li><strong>Gaming:</strong> Player actions broadcast</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Pub/Sub Message Flow</div>
                <svg viewBox="0 0 900 520" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Pub/Sub Architecture</text>
                    
                    <!-- Publisher -->
                    <rect x="50" y="180" width="180" height="100" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="140" y="210" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üì§ Publisher</text>
                    <text x="140" y="235" text-anchor="middle" fill="#FFA500" font-size="11">Sports Score Service</text>
                    <text x="140" y="255" text-anchor="middle" fill="#888" font-size="10">PUBLISH sports:live</text>
                    <text x="140" y="270" text-anchor="middle" fill="#888" font-size="10">"Lakers 98 - Warriors 95"</text>
                    
                    <!-- Channel -->
                    <rect x="350" y="60" width="200" height="400" fill="rgba(220,20,60,0.15)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="600">üì¢ Channel: sports:live</text>
                    
                    <ellipse cx="450" cy="230" rx="80" ry="80" fill="rgba(220,20,60,0.3)" stroke="#DC143C" stroke-width="2">
                        <animate attributeName="r" values="80;90;80" dur="2s" repeatCount="indefinite"/>
                    </ellipse>
                    <text x="450" y="225" text-anchor="middle" fill="#fff" font-size="12" font-weight="600">Message</text>
                    <text x="450" y="245" text-anchor="middle" fill="#888" font-size="10">Broadcasting...</text>
                    
                    <path d="M 230 230 L 340 230" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)">
                        <animate attributeName="stroke-dasharray" values="0,1000;1000,0" dur="2s" repeatCount="indefinite"/>
                    </path>
                    
                    <!-- Subscribers -->
                    <rect x="670" y="60" width="180" height="80" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="760" y="85" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">üë§ Subscriber 1</text>
                    <text x="760" y="105" text-anchor="middle" fill="#888" font-size="9">Web App User</text>
                    <text x="760" y="120" text-anchor="middle" fill="#00FF88" font-size="9">‚úÖ Received!</text>
                    
                    <path d="M 550 150 L 665 95" stroke="#DC143C" stroke-width="2" marker-end="url(#arrowRed)">
                        <animate attributeName="opacity" values="0;1;0" dur="2s" repeatCount="indefinite"/>
                    </path>
                    
                    <rect x="670" y="160" width="180" height="80" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="760" y="185" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">üë§ Subscriber 2</text>
                    <text x="760" y="205" text-anchor="middle" fill="#888" font-size="9">Mobile App User</text>
                    <text x="760" y="220" text-anchor="middle" fill="#00FF88" font-size="9">‚úÖ Received!</text>
                    
                    <path d="M 550 230 L 665 200" stroke="#DC143C" stroke-width="2" marker-end="url(#arrowRed)">
                        <animate attributeName="opacity" values="0;1;0" dur="2s" begin="0.5s" repeatCount="indefinite"/>
                    </path>
                    
                    <rect x="670" y="260" width="180" height="80" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="760" y="285" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">üë§ Subscriber 3</text>
                    <text x="760" y="305" text-anchor="middle" fill="#888" font-size="9">Desktop App User</text>
                    <text x="760" y="320" text-anchor="middle" fill="#00FF88" font-size="9">‚úÖ Received!</text>
                    
                    <path d="M 550 270 L 665 295" stroke="#DC143C" stroke-width="2" marker-end="url(#arrowRed)">
                        <animate attributeName="opacity" values="0;1;0" dur="2s" begin="1s" repeatCount="indefinite"/>
                    </path>
                    
                    <rect x="670" y="360" width="180" height="80" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="760" y="385" text-anchor="middle" fill="#FF6347" font-size="12" font-weight="600">üë§ Offline User</text>
                    <text x="760" y="405" text-anchor="middle" fill="#888" font-size="9">Not subscribed</text>
                    <text x="760" y="420" text-anchor="middle" fill="#FF6347" font-size="9">‚ùå Message lost!</text>
                    
                    <!-- Key Points -->
                    <rect x="50" y="300" width="280" height="160" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="190" y="325" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="700">üìù Key Characteristics</text>
                    <text x="65" y="350" fill="#00FF88" font-size="11">‚úÖ One-to-many broadcast</text>
                    <text x="65" y="370" fill="#00FF88" font-size="11">‚úÖ Real-time delivery</text>
                    <text x="65" y="390" fill="#00FF88" font-size="11">‚úÖ Decoupled publisher/subscriber</text>
                    <text x="65" y="415" fill="#FFA500" font-size="11">‚ö†Ô∏è No message persistence</text>
                    <text x="65" y="435" fill="#FFA500" font-size="11">‚ö†Ô∏è Offline = missed messages</text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Pub/Sub</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Publisher and Subscriber</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time
<span class="keyword">import</span> threading

<span class="comment"># Publisher (sends messages)</span>
<span class="keyword">def</span> <span class="function">publisher</span>():
    r = redis.Redis()
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">5</span>):
        message = <span class="string">f"Score update {i}: Lakers {90+i} - Warriors {85+i}"</span>
        r.publish(<span class="string">'sports:live'</span>, message)
        <span class="keyword">print</span>(<span class="string">f"üì§ Published: {message}"</span>)
        time.sleep(<span class="number">2</span>)

<span class="comment"># Subscriber (receives messages)</span>
<span class="keyword">def</span> <span class="function">subscriber</span>():
    r = redis.Redis(decode_responses=<span class="keyword">True</span>)
    pubsub = r.pubsub()
    
    <span class="comment"># Subscribe to channel</span>
    pubsub.subscribe(<span class="string">'sports:live'</span>)
    
    <span class="keyword">print</span>(<span class="string">"üëÇ Subscriber listening..."</span>)
    
    <span class="comment"># Listen for messages</span>
    <span class="keyword">for</span> message <span class="keyword">in</span> pubsub.listen():
        <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'message'</span>:
            <span class="keyword">print</span>(<span class="string">f"üì© Received: {message['data']}"</span>)

<span class="comment"># Run in separate threads</span>
sub_thread = threading.Thread(target=subscriber, daemon=<span class="keyword">True</span>)
sub_thread.start()

time.sleep(<span class="number">1</span>)  <span class="comment"># Let subscriber connect</span>

publisher()

<span class="comment"># Output:
# üëÇ Subscriber listening...
# üì§ Published: Score update 0: Lakers 90 - Warriors 85
# üì© Received: Score update 0: Lakers 90 - Warriors 85
# üì§ Published: Score update 1: Lakers 91 - Warriors 86
# üì© Received: Score update 1: Lakers 91 - Warriors 86
# ...</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Pattern Subscriptions</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Wildcard Pattern Matching</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)
pubsub = r.pubsub()

<span class="comment"># Subscribe to pattern (wildcard)</span>
pubsub.psubscribe(<span class="string">'sports:*'</span>)  <span class="comment"># Matches sports:live, sports:nba, etc</span>

<span class="keyword">print</span>(<span class="string">"Listening to sports:* channels..."</span>)

<span class="comment"># In another terminal/process, publish to various channels:</span>
<span class="comment"># PUBLISH sports:live "Lakers winning!"</span>
<span class="comment"># PUBLISH sports:nba "Bulls vs Heat"</span>
<span class="comment"># PUBLISH sports:nfl "Cowboys touchdown"</span>
<span class="comment"># PUBLISH news:tech "AI breakthrough"  ‚Üê Won't match!</span>

<span class="keyword">for</span> message <span class="keyword">in</span> pubsub.listen():
    <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'pmessage'</span>:  <span class="comment"># Pattern message</span>
        channel = message[<span class="string">'channel'</span>]
        data = message[<span class="string">'data'</span>]
        <span class="keyword">print</span>(<span class="string">f"üì© [{channel}] {data}"</span>)

<span class="comment"># Output:
# üì© [sports:live] Lakers winning!
# üì© [sports:nba] Bulls vs Heat
# üì© [sports:nfl] Cowboys touchdown
# (news:tech not received - doesn't match pattern)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Chat Room Implementation</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Simple Chat with Pub/Sub</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> threading

<span class="keyword">class</span> <span class="function">ChatRoom</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="keyword">self</span>, room_name, username):
        <span class="keyword">self</span>.r = redis.Redis(decode_responses=<span class="keyword">True</span>)
        <span class="keyword">self</span>.room = <span class="string">f"chat:{room_name}"</span>
        <span class="keyword">self</span>.username = username
        <span class="keyword">self</span>.pubsub = <span class="keyword">self</span>.r.pubsub()
    
    <span class="keyword">def</span> <span class="function">join</span>(<span class="keyword">self</span>):
        <span class="string">"""Join chat room"""</span>
        <span class="keyword">self</span>.pubsub.subscribe(<span class="keyword">self</span>.room)
        <span class="keyword">self</span>.send(<span class="string">f"{self.username} joined the room"</span>)
        
        <span class="comment"># Start listening thread</span>
        listener = threading.Thread(target=<span class="keyword">self</span>.listen, daemon=<span class="keyword">True</span>)
        listener.start()
        
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Joined {self.room}"</span>)
    
    <span class="keyword">def</span> <span class="function">send</span>(<span class="keyword">self</span>, message):
        <span class="string">"""Send message to room"""</span>
        full_message = <span class="string">f"{self.username}: {message}"</span>
        <span class="keyword">self</span>.r.publish(<span class="keyword">self</span>.room, full_message)
    
    <span class="keyword">def</span> <span class="function">listen</span>(<span class="keyword">self</span>):
        <span class="string">"""Listen for messages"""</span>
        <span class="keyword">for</span> message <span class="keyword">in</span> <span class="keyword">self</span>.pubsub.listen():
            <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'message'</span>:
                <span class="keyword">print</span>(<span class="string">f"üí¨ {message['data']}"</span>)
    
    <span class="keyword">def</span> <span class="function">leave</span>(<span class="keyword">self</span>):
        <span class="string">"""Leave chat room"""</span>
        <span class="keyword">self</span>.send(<span class="string">f"{self.username} left the room"</span>)
        <span class="keyword">self</span>.pubsub.unsubscribe()

<span class="comment"># Usage</span>
chat = ChatRoom(<span class="string">"lobby"</span>, <span class="string">"Alice"</span>)
chat.join()

<span class="comment"># Send messages</span>
chat.send(<span class="string">"Hello everyone!"</span>)
chat.send(<span class="string">"How's it going?"</span>)

<span class="comment"># Other users (in separate processes) would see:
# üí¨ Alice: Hello everyone!
# üí¨ Alice: How's it going?</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: What happens if no one is subscribed when I PUBLISH?</h4>
                <p><strong>A:</strong> Message is lost! Publisher doesn't know (or care) if anyone is listening. Returns number of subscribers who received it, but doesn't block or retry. Fire-and-forget messaging!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can subscriber reconnect and get missed messages?</h4>
                <p><strong>A:</strong> NO! Messages are not persisted. If subscriber disconnects, all messages sent during disconnect are lost. For persistence, use Redis Streams instead of Pub/Sub!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Pub/Sub vs Streams - when to use which?</h4>
                <p><strong>A:</strong> Pub/Sub: Real-time, ephemeral, no persistence (chat, notifications). Streams: Persistent, can replay, consumer groups (order processing, event logs). Pub/Sub = fire-and-forget, Streams = durable messaging!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: Does SUBSCRIBE block the Redis connection?</h4>
                <p><strong>A:</strong> YES! Once subscribed, connection enters "pub/sub mode" - can ONLY use pub/sub commands (SUBSCRIBE, UNSUBSCRIBE, PUBLISH). Can't run GET, SET, etc. Use separate connection for normal Redis commands!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: How many channels can one client subscribe to?</h4>
                <p><strong>A:</strong> Unlimited! Can subscribe to thousands of channels in one connection. Pattern subscriptions (PSUBSCRIBE) can match many channels with one command. Performance impact minimal - channels are lightweight!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can publisher get acknowledgment that message was received?</h4>
                <p><strong>Answer:</strong> NO! PUBLISH returns number of subscribers, but doesn't confirm they processed it. Subscriber could disconnect immediately after receive. For guaranteed delivery, use Redis Streams with XACK acknowledgments!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: I PSUBSCRIBE to news.* and SUBSCRIBE to news.tech. Do I get news.tech twice?</h4>
                <p><strong>Answer:</strong> YES! Receive same message twice - once from pattern match, once from specific subscription. Each subscription is independent. Can filter duplicates client-side or avoid overlapping subscriptions!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Does Pub/Sub work across Redis Cluster nodes?</h4>
                <p><strong>Answer:</strong> YES! Messages published on ANY node broadcast to ALL nodes. Subscriber on Node A receives messages published on Node B. Global channel namespace across cluster. But adds inter-node network overhead!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Live Sports Scores Dashboard</strong></p>
            
            <p>ESPN-style dashboard showing live scores for multiple games. 10,000 users watching. How to broadcast updates efficiently without database overload?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Redis Pub/Sub Architecture</h4>
                
                <p><strong>Architecture:</strong></p>
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0; font-size: 10px;">
[Score Service] ‚Üí PUBLISH sports:game:123 "Lakers 98"<br>
                ‚Üí PUBLISH sports:game:456 "Bulls 87"<br>
                ‚Üì<br>
[Redis Pub/Sub]<br>
                ‚Üì<br>
[10,000 Web Clients] ‚Üê SUBSCRIBE sports:game:*
                </code>
                
                <p><strong>Implementation:</strong></p>
                <ul style="margin-left: 20px;">
                    <li><strong>Score updates:</strong> Every 10 seconds, PUBLISH to sports:game:{id}</li>
                    <li><strong>Web clients:</strong> WebSocket connects, SUBSCRIBE to games they're watching</li>
                    <li><strong>No polling:</strong> Updates pushed instantly to subscribers</li>
                    <li><strong>Scalable:</strong> 10K clients, single Redis handles easily</li>
                </ul>
                
                <p><strong>Benefits:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Real-time (sub-second latency)</li>
                    <li>‚úÖ No database load (0 queries per update!)</li>
                    <li>‚úÖ Scales horizontally (add Redis instances)</li>
                    <li>‚úÖ Simple implementation (few lines of code)</li>
                </ul>
                
                <p><strong>Limitations handled:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>User disconnects? Automatically unsubscribed, no cleanup needed</li>
                    <li>Missed update? Refresh page shows current score from DB</li>
                    <li>Not critical if message lost (next update in 10 seconds)</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì°</span><p><strong>One-to-many broadcast</strong> - Publisher doesn't know subscribers</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî•</span><p><strong>Fire-and-forget</strong> - No persistence, offline = missed messages</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Real-time</strong> - Instant delivery to all subscribers</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Pattern matching</strong> - PSUBSCRIBE with wildcards</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Best for ephemeral data</strong> - Chat, notifications, live updates</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>For persistence: use Streams</strong> - Not Pub/Sub</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Pub/Sub</span><span class="keyword-tag">PUBLISH</span><span class="keyword-tag">SUBSCRIBE</span><span class="keyword-tag">PSUBSCRIBE</span><span class="keyword-tag">Fire-and-forget</span><span class="keyword-tag">Real-time</span><span class="keyword-tag">Messaging</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> You need message queue with persistence and replay. Use Pub/Sub or Streams?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Pub/Sub (messaging feature)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Streams (persistent with replay)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Both work equally</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Use Lists instead</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Streams</strong>
                    <p>Pub/Sub is fire-and-forget - messages NOT persisted! If consumer offline = missed forever. Streams persist messages, support replay from any point, have consumer groups, and XACK acknowledgments. For durable messaging with persistence, ALWAYS use Streams. Pub/Sub is for ephemeral real-time messaging only (chat, notifications where missed messages OK).</p>
                </div>
            </div>
        </div>
    `;
}

// ============================================================
// QUESTION 44: What are Redis Streams?
// ============================================================

function getQuestion44Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Developer frustrated:</strong> "We use Pub/Sub for order processing but lose messages when service restarts! Lists work but multiple workers grab same order!" Architect: "Use Redis Streams! Persistent like Lists + consumer groups for load balancing + acknowledgments so nothing is lost!"</p>
            <p>Redis Streams = message queue done right.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Streams is an append-only log data structure that supports consumer groups for parallel processing, message acknowledgment, and persistent storage. Think Kafka but simpler and built into Redis.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Core Stream Commands</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Command</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">XADD</td><td>Add message</td><td>XADD orders * id 123 amt 99</td></tr>
                    <tr><td style="padding: 8px;">XREAD</td><td>Read messages</td><td>XREAD COUNT 10 STREAMS orders 0</td></tr>
                    <tr><td style="padding: 8px;">XLEN</td><td>Stream length</td><td>XLEN orders</td></tr>
                    <tr><td style="padding: 8px;">XGROUP CREATE</td><td>Create consumer group</td><td>XGROUP CREATE orders workers 0</td></tr>
                    <tr><td style="padding: 8px;">XREADGROUP</td><td>Read as group</td><td>XREADGROUP GROUP workers c1 STREAMS orders ></td></tr>
                    <tr><td style="padding: 8px;">XACK</td><td>Acknowledge</td><td>XACK orders workers 1234-0</td></tr>
                    <tr><td style="padding: 8px;">XTRIM</td><td>Limit size</td><td>XTRIM orders MAXLEN 1000</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Why Streams vs Other Patterns:</strong></p>
                <ul>
                    <li><strong>vs Pub/Sub:</strong> Streams persist (Pub/Sub ephemeral)</li>
                    <li><strong>vs Lists:</strong> Streams have consumer groups (Lists don't)</li>
                    <li><strong>vs Sorted Sets:</strong> Streams optimized for append-only logs</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Stream with Consumer Groups</div>
                <svg viewBox="0 0 900 500" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Stream: Order Processing</text>
                    
                    <!-- Stream -->
                    <rect x="50" y="70" width="800" height="120" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="100" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">üìú Stream: orders (Append-Only Log)</text>
                    
                    <rect x="80" y="120" width="120" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="140" y="140" text-anchor="middle" fill="#fff" font-size="10">1234-0</text>
                    <text x="140" y="157" text-anchor="middle" fill="#888" font-size="9">order_id: 101</text>
                    
                    <rect x="220" y="120" width="120" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="280" y="140" text-anchor="middle" fill="#fff" font-size="10">1235-0</text>
                    <text x="280" y="157" text-anchor="middle" fill="#888" font-size="9">order_id: 102</text>
                    
                    <rect x="360" y="120" width="120" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="420" y="140" text-anchor="middle" fill="#fff" font-size="10">1236-0</text>
                    <text x="420" y="157" text-anchor="middle" fill="#888" font-size="9">order_id: 103</text>
                    
                    <rect x="500" y="120" width="120" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="560" y="140" text-anchor="middle" fill="#fff" font-size="10">1237-0</text>
                    <text x="560" y="157" text-anchor="middle" fill="#888" font-size="9">order_id: 104</text>
                    
                    <rect x="640" y="120" width="120" height="50" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="4">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/>
                    </rect>
                    <text x="700" y="140" text-anchor="middle" fill="#9C27B0" font-size="10">NEW ‚Üí</text>
                    <text x="700" y="157" text-anchor="middle" fill="#888" font-size="9">XADD here</text>
                    
                    <!-- Consumer Group 1 -->
                    <rect x="50" y="220" width="380" height="120" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="240" y="245" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">Consumer Group: payment-processors</text>
                    
                    <rect x="70" y="260" width="150" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="145" y="280" text-anchor="middle" fill="#fff" font-size="11">Consumer 1</text>
                    <text x="145" y="297" text-anchor="middle" fill="#888" font-size="9">Processing: 1234-0</text>
                    <text x="145" y="312" text-anchor="middle" fill="#FFA500" font-size="9">Payment service</text>
                    
                    <rect x="250" y="260" width="150" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="325" y="280" text-anchor="middle" fill="#fff" font-size="11">Consumer 2</text>
                    <text x="325" y="297" text-anchor="middle" fill="#888" font-size="9">Processing: 1235-0</text>
                    <text x="325" y="312" text-anchor="middle" fill="#FFA500" font-size="9">Payment service</text>
                    
                    <path d="M 140 190 L 140 255" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <path d="M 280 190 L 325 255" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    
                    <!-- Consumer Group 2 -->
                    <rect x="470" y="220" width="380" height="120" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="8"/>
                    <text x="660" y="245" text-anchor="middle" fill="#9C27B0" font-size="13" font-weight="600">Consumer Group: shipping-service</text>
                    
                    <rect x="490" y="260" width="340" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="4"/>
                    <text x="660" y="280" text-anchor="middle" fill="#fff" font-size="11">Consumer 1</text>
                    <text x="660" y="297" text-anchor="middle" fill="#888" font-size="9">Reads ALL orders independently!</text>
                    <text x="660" y="312" text-anchor="middle" fill="#FFA500" font-size="9">Creates shipments</text>
                    
                    <path d="M 420 190 L 660 255" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    
                    <!-- Key Benefits -->
                    <rect x="50" y="360" width="800" height="120" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="385" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">üéØ How It Works</text>
                    
                    <text x="70" y="410" fill="#00FF88" font-size="11" font-weight="600">‚úÖ Persistent:</text>
                    <text x="80" y="427" fill="#bbb" font-size="10">Messages saved to disk, survive restarts</text>
                    
                    <text x="300" y="410" fill="#9C27B0" font-size="11" font-weight="600">‚úÖ Consumer Groups:</text>
                    <text x="310" y="427" fill="#bbb" font-size="10">Load balance across multiple consumers</text>
                    
                    <text x="70" y="450" fill="#FFA500" font-size="11" font-weight="600">‚úÖ Acknowledgments:</text>
                    <text x="80" y="467" fill="#bbb" font-size="10">XACK confirms processing (no duplicates)</text>
                    
                    <text x="300" y="450" fill="#DC143C" font-size="11" font-weight="600">‚úÖ Replay:</text>
                    <text x="310" y="467" fill="#bbb" font-size="10">Can read from any point in stream</text>
                    
                    <text x="530" y="450" fill="#00FF88" font-size="11" font-weight="600">‚úÖ Independent Groups:</text>
                    <text x="540" y="467" fill="#bbb" font-size="10">Each group reads ALL messages separately</text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Producer - Adding Messages</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - XADD to Stream</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Add messages to stream</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">5</span>):
    order_id = <span class="number">1000</span> + i
    amount = <span class="number">99.99</span> + i
    
    <span class="comment"># XADD stream_name * field1 value1 field2 value2</span>
    <span class="comment"># * = auto-generate ID (timestamp-sequence)</span>
    message_id = r.xadd(
        <span class="string">'orders'</span>,
        {
            <span class="string">'order_id'</span>: order_id,
            <span class="string">'amount'</span>: amount,
            <span class="string">'status'</span>: <span class="string">'pending'</span>
        }
    )
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Added order {order_id}, Message ID: {message_id}"</span>)
    time.sleep(<span class="number">0.5</span>)

<span class="comment"># Check stream length</span>
length = r.xlen(<span class="string">'orders'</span>)
<span class="keyword">print</span>(<span class="string">f"\\nüìä Stream has {length} messages"</span>)

<span class="comment"># Output:
# ‚úÖ Added order 1000, Message ID: 1704067200000-0
# ‚úÖ Added order 1001, Message ID: 1704067200500-0
# ...
# üìä Stream has 5 messages</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Consumer Groups</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Consumer Group Pattern</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Create consumer group (do once)</span>
<span class="keyword">try</span>:
    r.xgroup_create(<span class="string">'orders'</span>, <span class="string">'payment-processors'</span>, id=<span class="string">'0'</span>)
    <span class="keyword">print</span>(<span class="string">"‚úÖ Consumer group created"</span>)
<span class="keyword">except</span> redis.exceptions.ResponseError:
    <span class="keyword">print</span>(<span class="string">"‚ÑπÔ∏è Consumer group already exists"</span>)

<span class="comment"># Consumer function</span>
<span class="keyword">def</span> <span class="function">process_orders</span>(consumer_name):
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="comment"># Read from group (> means "new messages only")</span>
        messages = r.xreadgroup(
            groupname=<span class="string">'payment-processors'</span>,
            consumername=consumer_name,
            streams={<span class="string">'orders'</span>: <span class="string">'>'</span>},
            count=<span class="number">1</span>,
            block=<span class="number">5000</span>  <span class="comment"># Wait 5 seconds if no messages</span>
        )
        
        <span class="keyword">if</span> messages:
            <span class="keyword">for</span> stream_name, stream_messages <span class="keyword">in</span> messages:
                <span class="keyword">for</span> message_id, data <span class="keyword">in</span> stream_messages:
                    <span class="keyword">print</span>(<span class="string">f"[{consumer_name}] Processing: {data}"</span>)
                    
                    <span class="comment"># Process payment...</span>
                    time.sleep(<span class="number">1</span>)
                    
                    <span class="comment"># Acknowledge message</span>
                    r.xack(<span class="string">'orders'</span>, <span class="string">'payment-processors'</span>, message_id)
                    <span class="keyword">print</span>(<span class="string">f"[{consumer_name}] ‚úÖ ACK {message_id}"</span>)
        <span class="keyword">else</span>:
            <span class="keyword">print</span>(<span class="string">f"[{consumer_name}] No messages, waiting..."</span>)

<span class="comment"># Run consumer</span>
process_orders(<span class="string">'worker-1'</span>)

<span class="comment"># Output:
# [worker-1] Processing: {'order_id': '1000', 'amount': '99.99', 'status': 'pending'}
# [worker-1] ‚úÖ ACK 1704067200000-0
# [worker-1] Processing: {'order_id': '1001', 'amount': '100.99', 'status': 'pending'}
# ...</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Trimming Stream</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Limit Stream Size</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis()

<span class="comment"># Trim to max 1000 messages (approximate)</span>
r.xtrim(<span class="string">'orders'</span>, maxlen=<span class="number">1000</span>, approximate=<span class="keyword">True</span>)

<span class="comment"># Or add with trimming automatically</span>
r.xadd(
    <span class="string">'orders'</span>,
    {<span class="string">'order_id'</span>: <span class="number">2000</span>},
    maxlen=<span class="number">1000</span>  <span class="comment"># Keep last 1000 only</span>
)

<span class="comment"># Trim by time (keep last 7 days)</span>
seven_days_ago = <span class="function">int</span>(time.time() - <span class="number">7</span>*<span class="number">24</span>*<span class="number">3600</span>) * <span class="number">1000</span>
r.xtrim(<span class="string">'orders'</span>, minid=<span class="string">f"{seven_days_ago}-0"</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: What's the message ID format in Streams?</h4>
                <p><strong>A:</strong> Auto-generated as "timestamp-sequence". Example: 1704067200000-0 means timestamp (ms) + sequence number. Ensures uniqueness and chronological ordering. Can specify custom ID but usually use * for auto!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What if consumer crashes before XACK?</h4>
                <p><strong>A:</strong> Message goes to Pending Entries List (PEL). Use XPENDING to see unacknowledged messages. XCLAIM to reassign stuck messages to other consumers. Built-in failure recovery!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can I read old messages or only new ones?</h4>
                <p><strong>A:</strong> Both! XREAD from specific ID or 0 (beginning). XREADGROUP with > = new messages only, or specific ID = replay from that point. Full replay capability!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: How do consumer groups differ from Pub/Sub?</h4>
                <p><strong>A:</strong> Consumer groups load-balance (each message to ONE consumer). Pub/Sub broadcasts (ALL subscribers get ALL messages). Groups for work distribution, Pub/Sub for notifications!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Can multiple consumer groups read same stream?</h4>
                <p><strong>A:</strong> Yes! Each group reads independently. Perfect for: Group A = payment processing, Group B = shipping, Group C = analytics. All read same orders, process differently!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Stream grows to 100GB. How to manage?</h4>
                <p><strong>Answer:</strong> Use XTRIM! Options: (1) MAXLEN to keep last N messages, (2) MINID to trim by time, (3) Add with maxlen parameter for auto-trimming. Monitor with XLEN and trim periodically. Consider archiving to database before trimming!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Consumer processes same message twice?</h4>
                <p><strong>Answer:</strong> Without XACK, yes! Pattern: Read message ‚Üí Process ‚Üí XACK. If crash before XACK, message reprocessed. Solution: Idempotent processing (check if already processed) OR ensure XACK after successful processing!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Why use Streams instead of Lists for queue?</h4>
                <p><strong>Answer:</strong> Lists: Simple but no consumer groups (multiple consumers = duplicate processing). Streams: Consumer groups + acknowledgments + persistence + replay + multiple groups reading same data. Streams = production-grade queuing!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Order Processing</strong></p>
            
            <p>Orders need: (1) Payment processing, (2) Inventory update, (3) Shipping label, (4) Email notification. Each service independent. How to coordinate?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Stream with Multiple Consumer Groups</h4>
                
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0; font-size: 10px;">
# Order Service: XADD orders * order_id 123 total 199.99<br>
<br>
# 4 Consumer Groups (all read same stream!):<br>
Group 1: payment-service (2 workers)<br>
Group 2: inventory-service (3 workers)<br>
Group 3: shipping-service (2 workers)<br>
Group 4: notification-service (1 worker)<br>
<br>
Each group: XREADGROUP ‚Üí Process ‚Üí XACK
                </code>
                
                <p><strong>Benefits:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Each service processes independently</li>
                    <li>‚úÖ Load balanced within each service (multiple workers)</li>
                    <li>‚úÖ If payment worker crashes ‚Üí other payment worker picks up</li>
                    <li>‚úÖ One order ‚Üí All 4 services process it</li>
                    <li>‚úÖ Persistent: Survives restarts</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìú</span><p><strong>Append-only log</strong> - Like Kafka, persistent message storage</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üë•</span><p><strong>Consumer groups</strong> - Load balance across multiple consumers</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>XACK acknowledgments</strong> - No message loss</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Replay capability</strong> - Read from any point in stream</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Multiple groups</strong> - Different services read same stream</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Production-ready</strong> - Better than Lists/Pub/Sub for queuing</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Streams</span><span class="keyword-tag">XADD</span><span class="keyword-tag">XREAD</span><span class="keyword-tag">XREADGROUP</span><span class="keyword-tag">XACK</span><span class="keyword-tag">Consumer Groups</span><span class="keyword-tag">Message Queue</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need persistent message queue with parallel processing. Use Pub/Sub, Lists, or Streams?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Pub/Sub (real-time messaging)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) Lists (simple queue)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">C) Streams (consumer groups + persistence)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Sorted Sets (ordered data)</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: C - Streams</strong>
                    <p>Pub/Sub: Not persistent (fire-and-forget). Lists: No consumer groups (duplicate processing). Streams: Persistent + consumer groups + acknowledgments + parallel processing! Perfect for order processing, event sourcing, durable queues. Consumer groups ensure each message processed once by group, multiple workers share load. This is exactly what Streams were designed for!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 45: What is Redis Cluster?
// ============================================================

function getQuestion45Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>CTO challenge:</strong> "Our Redis has 500GB data. Can't fit in one server! Adding RAM costs $10K/month!" Engineer: "Use Redis Cluster! Distribute data across 10 servers - each holds 50GB. Horizontal scaling! Add nodes = more capacity. Automatic sharding by hash slots!"</p>
            <p>Redis Cluster = scaling out, not up.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Cluster distributes data across multiple Redis nodes using hash slots (16,384 total). Each node owns a subset of slots. Client calculates slot from key, connects to correct node. Provides horizontal scaling and automatic failover.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Cluster Key Concepts</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Concept</th><th style="padding: 10px;">Description</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">Hash Slots</td><td>16,384 total slots</td><td>CRC16(key) % 16384</td></tr>
                    <tr><td style="padding: 8px;">Node Distribution</td><td>Each node owns slots</td><td>Node1: 0-5460 (5461 slots)</td></tr>
                    <tr><td style="padding: 8px;">MOVED</td><td>Key in wrong node</td><td>MOVED 3999 127.0.0.1:7002</td></tr>
                    <tr><td style="padding: 8px;">ASK</td><td>Slot migrating</td><td>ASK 3999 127.0.0.1:7002</td></tr>
                    <tr><td style="padding: 8px;">Hash Tags</td><td>Force same slot</td><td>{user}:profile, {user}:cart</td></tr>
                    <tr><td style="padding: 8px;">Resharding</td><td>Move slots online</td><td>No downtime</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Cluster vs Sentinel:</strong></p>
                <ul>
                    <li><strong>Cluster:</strong> Horizontal scaling (more capacity) + HA</li>
                    <li><strong>Sentinel:</strong> Just HA (automatic failover), no scaling</li>
                    <li><strong>Can combine:</strong> Cluster + Sentinel for each master</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Redis Cluster Architecture</div>
                <svg viewBox="0 0 900 520" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">3-Node Cluster with Hash Slot Distribution</text>
                    
                    <!-- Client -->
                    <rect x="350" y="60" width="200" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="450" y="85" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üì± Client</text>
                    <text x="450" y="105" text-anchor="middle" fill="#888" font-size="10">GET user:123</text>
                    
                    <!-- Hash Slot Calculation -->
                    <rect x="300" y="140" width="300" height="50" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="450" y="160" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">CRC16("user:123") % 16384 = 4523</text>
                    <text x="450" y="180" text-anchor="middle" fill="#888" font-size="10">Slot 4523 ‚Üí Node 1</text>
                    
                    <path d="M 450 120 L 450 135" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    
                    <!-- Nodes -->
                    <rect x="50" y="220" width="250" height="140" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="175" y="245" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">üñ•Ô∏è Node 1 (Master)</text>
                    <text x="175" y="265" text-anchor="middle" fill="#fff" font-size="11">127.0.0.1:7001</text>
                    <rect x="70" y="275" width="210" height="70" fill="rgba(220,20,60,0.3)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="175" y="295" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Slots: 0-5460</text>
                    <text x="175" y="315" text-anchor="middle" fill="#888" font-size="10">(5,461 slots)</text>
                    <text x="175" y="335" text-anchor="middle" fill="#FFA500" font-size="10">Owns slot 4523 ‚úì</text>
                    
                    <path d="M 450 190 L 175 215" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)">
                        <animate attributeName="opacity" values="0;1;0" dur="2s" repeatCount="indefinite"/>
                    </path>
                    
                    <rect x="325" y="220" width="250" height="140" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="245" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="600">üñ•Ô∏è Node 2 (Master)</text>
                    <text x="450" y="265" text-anchor="middle" fill="#fff" font-size="11">127.0.0.1:7002</text>
                    <rect x="345" y="275" width="210" height="70" fill="rgba(156,39,176,0.3)" stroke="#9C27B0" stroke-width="2" rx="4"/>
                    <text x="450" y="295" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">Slots: 5461-10922</text>
                    <text x="450" y="315" text-anchor="middle" fill="#888" font-size="10">(5,462 slots)</text>
                    <text x="450" y="335" text-anchor="middle" fill="#888" font-size="10">Different slot range</text>
                    
                    <rect x="600" y="220" width="250" height="140" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="725" y="245" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üñ•Ô∏è Node 3 (Master)</text>
                    <text x="725" y="265" text-anchor="middle" fill="#fff" font-size="11">127.0.0.1:7003</text>
                    <rect x="620" y="275" width="210" height="70" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="725" y="295" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Slots: 10923-16383</text>
                    <text x="725" y="315" text-anchor="middle" fill="#888" font-size="10">(5,461 slots)</text>
                    <text x="725" y="335" text-anchor="middle" fill="#888" font-size="10">Different slot range</text>
                    
                    <!-- Benefits -->
                    <rect x="50" y="380" width="800" height="120" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="405" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">üéØ How Cluster Provides Scaling</text>
                    
                    <text x="70" y="430" fill="#00FF88" font-size="11" font-weight="600">‚úÖ Horizontal Scaling:</text>
                    <text x="80" y="447" fill="#bbb" font-size="10">3 nodes √ó 100GB = 300GB total capacity</text>
                    <text x="80" y="462" fill="#bbb" font-size="10">Add node 4 ‚Üí 400GB capacity (linear)</text>
                    
                    <text x="400" y="430" fill="#FFA500" font-size="11" font-weight="600">‚úÖ Automatic Sharding:</text>
                    <text x="410" y="447" fill="#bbb" font-size="10">Client calculates slot ‚Üí routes to node</text>
                    <text x="410" y="462" fill="#bbb" font-size="10">No single point of failure</text>
                    
                    <text x="70" y="485" fill="#DC143C" font-size="11" font-weight="600">‚úÖ Resharding Online:</text>
                    <text x="80" y="502" fill="#bbb" font-size="10">Move slots between nodes (no downtime)</text>
                    
                    <text x="400" y="485" fill="#9C27B0" font-size="11" font-weight="600">‚úÖ High Availability:</text>
                    <text x="410" y="502" fill="#bbb" font-size="10">Each master can have replicas (auto-failover)</text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Cluster Commands</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Cluster Info</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Get cluster state</span>
<span class="keyword">CLUSTER INFO</span>
cluster_state:ok
cluster_slots_assigned:16384
cluster_known_nodes:3

<span class="comment"># List all nodes</span>
<span class="keyword">CLUSTER NODES</span>
07c37dfeb...  127.0.0.1:7001  master - 0 1699 connected 0-5460
3c249f66c...  127.0.0.1:7002  master - 0 1700 connected 5461-10922
44e22c86a...  127.0.0.1:7003  master - 0 1701 connected 10923-16383

<span class="comment"># Which slot for a key?</span>
<span class="keyword">CLUSTER KEYSLOT</span> <span class="string">user:123</span>
<span class="number">(integer) 4523</span>  <span class="comment"># This goes to Node 1 (0-5460)</span>

<span class="comment"># How many keys in a slot?</span>
<span class="keyword">CLUSTER COUNTKEYSINSLOT</span> <span class="number">4523</span>
<span class="number">(integer) 145</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Python Client</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Connecting to Cluster</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">from</span> rediscluster <span class="keyword">import</span> RedisCluster

<span class="comment"># Define cluster nodes</span>
startup_nodes = [
    {<span class="string">"host"</span>: <span class="string">"127.0.0.1"</span>, <span class="string">"port"</span>: <span class="string">"7001"</span>},
    {<span class="string">"host"</span>: <span class="string">"127.0.0.1"</span>, <span class="string">"port"</span>: <span class="string">"7002"</span>},
    {<span class="string">"host"</span>: <span class="string">"127.0.0.1"</span>, <span class="string">"port"</span>: <span class="string">"7003"</span>}
]

<span class="comment"># Connect (client handles redirects automatically!)</span>
rc = RedisCluster(startup_nodes=startup_nodes, decode_responses=<span class="keyword">True</span>)

<span class="comment"># Use normally - client handles slot routing</span>
rc.set(<span class="string">"user:123"</span>, <span class="string">"Alice"</span>)  <span class="comment"># Auto-routes to Node 1</span>
rc.set(<span class="string">"user:456"</span>, <span class="string">"Bob"</span>)    <span class="comment"># Auto-routes to Node 2</span>

value = rc.get(<span class="string">"user:123"</span>)
<span class="keyword">print</span>(<span class="string">f"Value: {value}"</span>)  <span class="comment"># Alice</span>

<span class="comment"># Multi-key operations - only work if same slot!</span>
<span class="comment"># This FAILS (different slots):</span>
<span class="comment"># rc.mget("user:123", "user:456")  # ERROR!</span>

<span class="comment"># This WORKS (hash tags force same slot):</span>
rc.set(<span class="string">"{user}:123:profile"</span>, <span class="string">"Profile data"</span>)
rc.set(<span class="string">"{user}:123:cart"</span>, <span class="string">"Cart data"</span>)
<span class="comment"># Both use CRC16("{user}") ‚Üí same slot!</span>
values = rc.mget(<span class="string">"{user}:123:profile"</span>, <span class="string">"{user}:123:cart"</span>)
<span class="keyword">print</span>(values)  <span class="comment"># Works!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Hash Tags</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Forcing Same Slot</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Without hash tags (different slots)</span>
<span class="keyword">CLUSTER KEYSLOT</span> <span class="string">user:123:profile</span>
<span class="number">(integer) 4523</span>

<span class="keyword">CLUSTER KEYSLOT</span> <span class="string">user:123:cart</span>
<span class="number">(integer) 8901</span>  <span class="comment"># Different slot!</span>

<span class="comment"># With hash tags {user} (same slot!)</span>
<span class="keyword">CLUSTER KEYSLOT</span> <span class="string">{user}:123:profile</span>
<span class="number">(integer) 5474</span>  <span class="comment"># Uses CRC16("{user}")</span>

<span class="keyword">CLUSTER KEYSLOT</span> <span class="string">{user}:123:cart</span>
<span class="number">(integer) 5474</span>  <span class="comment"># Same slot! Can use MGET</span>

<span class="keyword">CLUSTER KEYSLOT</span> <span class="string">{user}:456:profile</span>
<span class="number">(integer) 5474</span>  <span class="comment"># ALL {user} keys ‚Üí same slot</span>

<span class="comment"># Now multi-key operations work:</span>
<span class="keyword">MGET</span> <span class="string">{user}:123:profile</span> <span class="string">{user}:123:cart</span>
<span class="comment"># Success! Both in same slot</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why exactly 16,384 hash slots?</h4>
                <p><strong>A:</strong> Trade-off! Enough slots for good distribution, small enough for efficient heartbeat messages (each node sends bitmap of owned slots). 16,384 = 2KB bitmap. More slots = larger network overhead. Perfect balance!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What's MOVED vs ASK redirect?</h4>
                <p><strong>A:</strong> MOVED: Slot permanently moved to another node (client updates cache). ASK: Slot currently migrating (temporary, don't cache). Client handles both automatically with cluster-aware client!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can I run transactions across multiple nodes?</h4>
                <p><strong>A:</strong> NO! MULTI/EXEC only works within single slot. Use hash tags to force related keys into same slot: {user}:123:* all go to same node, then transactions work!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: How to add a node to running cluster?</h4>
                <p><strong>A:</strong> (1) Start new node, (2) CLUSTER MEET to join cluster, (3) Reshard slots to new node (redis-cli --cluster reshard). Resharding is online - no downtime. Cluster rebalances automatically!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Cluster vs Sentinel - when to use which?</h4>
                <p><strong>A:</strong> Need capacity? Cluster (horizontal scaling). Need only HA? Sentinel (simpler, automatic failover). Need both? Cluster WITH Sentinel! Each cluster master can have Sentinel-managed replicas!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Node failure - what happens to its slots?</h4>
                <p><strong>Answer:</strong> If node has replica: Replica promoted (slots still available). If no replica: Cluster enters FAIL state for those slots (writes blocked). Best practice: Always run replicas (min 3 masters + 3 replicas for HA)!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Can I use SELECT db in cluster mode?</h4>
                <p><strong>Answer:</strong> NO! Cluster only supports database 0. SELECT command disabled. All keys go to DB 0, distributed by hash slot. Use key prefixes instead of databases: "app1:user:123", "app2:user:123"!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Resharding causes downtime?</h4>
                <p><strong>Answer:</strong> NO downtime! Slots migrated one by one while cluster serves requests. Keys moved with MIGRATE command. ASK redirects during migration. Once done, MOVED redirects. Clients auto-updated. 100% uptime resharding!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Social Media Platform - 1TB User Data</strong></p>
            
            <p>1 billion users, each user has: profile, posts, followers. Total: 1TB data. Single Redis maxes at 200GB. Need horizontal scaling!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: 10-Node Redis Cluster</h4>
                
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0; font-size: 10px;">
# 10 nodes √ó 100GB each = 1TB capacity<br>
# Each node: 1,638 hash slots (16,384 / 10)<br>
<br>
# Hash tag strategy:<br>
{user:123}:profile   ‚Üí Slot 4523 ‚Üí Node 1<br>
{user:123}:posts     ‚Üí Slot 4523 ‚Üí Node 1 (same!)<br>
{user:123}:followers ‚Üí Slot 4523 ‚Üí Node 1 (same!)<br>
<br>
# All data for user:123 on same node ‚Üí fast queries!
                </code>
                
                <p><strong>Benefits:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>‚úÖ Linear scaling: 10 nodes = 10x capacity</li>
                    <li>‚úÖ User data co-located (hash tags)</li>
                    <li>‚úÖ Add node ‚Üí automatic rebalancing</li>
                    <li>‚úÖ Each node: replicas for HA</li>
                </ul>
                
                <p><strong>Growth path:</strong></p>
                <ul style="margin-left: 20px;">
                    <li>Year 1: 10 nodes (1TB)</li>
                    <li>Year 2: Add 5 nodes ‚Üí 15 nodes (1.5TB)</li>
                    <li>Year 3: Add 5 more ‚Üí 20 nodes (2TB)</li>
                    <li>Resharding online, zero downtime!</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìà</span><p><strong>Horizontal scaling</strong> - Add nodes = more capacity (linear)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>16,384 hash slots</strong> - CRC16(key) % 16384 determines node</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Automatic sharding</strong> - Client routes to correct node</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üè∑Ô∏è</span><p><strong>Hash tags</strong> - {user}:* forces keys to same slot</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Online resharding</strong> - Move slots with zero downtime</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõ°Ô∏è</span><p><strong>vs Sentinel</strong> - Cluster = scaling, Sentinel = HA only</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Cluster</span><span class="keyword-tag">Hash Slots</span><span class="keyword-tag">Sharding</span><span class="keyword-tag">Horizontal Scaling</span><span class="keyword-tag">MOVED</span><span class="keyword-tag">Hash Tags</span><span class="keyword-tag">Resharding</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Dataset = 500GB, single Redis maxes at 100GB. Need scaling. Use Cluster or Sentinel?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Sentinel (automatic failover)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Cluster (horizontal scaling)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Both provide same features</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Just upgrade to bigger server</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Redis Cluster</strong>
                    <p>Sentinel only provides HA (automatic failover), NOT capacity scaling! For 500GB across 100GB nodes, need 5+ nodes = horizontal scaling = Redis Cluster. Cluster distributes data via hash slots. Each node holds subset. 5 nodes √ó 100GB = 500GB total. Sentinel can't do this - it just monitors master-replica and promotes replica on failure. For scaling: Cluster!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 46: What is Lua Scripting in Redis?
// ============================================================

function getQuestion46Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Developer problem:</strong> "I need to check balance, deduct amount, and update timestamp - all atomically! MULTI/EXEC can't check values first." Architect: "Use Lua scripting! Write logic in Lua, Redis executes atomically. Check balance in script, if OK then deduct. All or nothing!"</p>
            <p>Lua scripting = transactions with conditional logic.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Lua scripting allows executing custom logic on the server atomically. Scripts run in Redis process, have access to all commands, and execute without interruption. Like stored procedures for Redis.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Lua Commands</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Command</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">EVAL</td><td>Execute script</td><td>EVAL "return 1+1" 0</td></tr>
                    <tr><td style="padding: 8px;">EVALSHA</td><td>Execute cached script</td><td>EVALSHA abc123 0</td></tr>
                    <tr><td style="padding: 8px;">SCRIPT LOAD</td><td>Cache script</td><td>SCRIPT LOAD "return 1"</td></tr>
                    <tr><td style="padding: 8px;">redis.call()</td><td>Run Redis command</td><td>redis.call('SET', 'k', 'v')</td></tr>
                    <tr><td style="padding: 8px;">redis.pcall()</td><td>Protected call</td><td>redis.pcall('GET', 'k')</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Why Lua Scripting:</strong></p>
                <ul>
                    <li><strong>Atomic with logic:</strong> Check then modify (MULTI/EXEC can't)</li>
                    <li><strong>Reduce network:</strong> Multiple commands in one round-trip</li>
                    <li><strong>Server-side logic:</strong> Complex operations without roundtrips</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Lua Script Execution Flow</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Atomic Lua Script Execution</text>
                    
                    <rect x="50" y="80" width="180" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="140" y="105" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üì± Client</text>
                    <text x="140" y="125" text-anchor="middle" fill="#888" font-size="10">Sends Lua script</text>
                    
                    <path d="M 230 110 L 320 110" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    
                    <rect x="320" y="60" width="260" height="300" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">üñ•Ô∏è Redis (Atomic Execution)</text>
                    
                    <rect x="340" y="110" width="220" height="50" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="450" y="135" text-anchor="middle" fill="#9C27B0" font-size="11" font-weight="600">1. Check balance ‚â• amount</text>
                    
                    <path d="M 450 160 L 450 175" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    
                    <rect x="340" y="175" width="220" height="50" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="450" y="200" text-anchor="middle" fill="#9C27B0" font-size="11" font-weight="600">2. If yes: DECRBY balance</text>
                    
                    <path d="M 450 225 L 450 240" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    
                    <rect x="340" y="240" width="220" height="50" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="450" y="265" text-anchor="middle" fill="#9C27B0" font-size="11" font-weight="600">3. SET last_updated</text>
                    
                    <path d="M 450 290 L 450 305" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    
                    <rect x="340" y="305" width="220" height="45" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="450" y="325" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">‚úÖ All atomic!</text>
                    <text x="450" y="342" text-anchor="middle" fill="#888" font-size="9">No other client can interrupt</text>
                    
                    <path d="M 580 110 L 670 110" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    
                    <rect x="670" y="80" width="180" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="760" y="105" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üìä Result</text>
                    <text x="760" y="125" text-anchor="middle" fill="#888" font-size="10">Success or Error</text>
                    
                    <rect x="50" y="370" width="800" height="35" fill="rgba(255,165,0,0.1)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="450" y="392" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">‚ö° Key Benefit: Check-then-modify in ONE atomic operation (MULTI/EXEC can't do this!)</text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Lua Script</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Simple EVAL</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Simple script</span>
script = <span class="string">"""
return "Hello from Lua!"
"""</span>

result = r.eval(script, <span class="number">0</span>)
<span class="keyword">print</span>(result)  <span class="comment"># Hello from Lua!</span>

<span class="comment"># Script with Redis commands</span>
script = <span class="string">"""
redis.call('SET', 'mykey', 'myvalue')
return redis.call('GET', 'mykey')
"""</span>

result = r.eval(script, <span class="number">0</span>)
<span class="keyword">print</span>(result)  <span class="comment"># myvalue</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Atomic Balance Deduction</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Check-and-Set Pattern</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Check balance then deduct atomically</span>
deduct_script = <span class="string">"""
local balance_key = KEYS[1]
local amount = tonumber(ARGV[1])

local balance = tonumber(redis.call('GET', balance_key) or 0)

if balance >= amount then
    redis.call('DECRBY', balance_key, amount)
    return 1  -- Success
else
    return 0  -- Insufficient funds
end
"""</span>

r.set(<span class="string">'user:123:balance'</span>, <span class="number">1000</span>)

result = r.eval(deduct_script, <span class="number">1</span>, <span class="string">'user:123:balance'</span>, <span class="number">100</span>)

<span class="keyword">if</span> result == <span class="number">1</span>:
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Deducted! New: {r.get('user:123:balance')}"</span>)
<span class="keyword">else</span>:
    <span class="keyword">print</span>(<span class="string">"‚ùå Insufficient funds"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Rate Limiting</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Fixed Window Rate Limiter</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># 10 requests per minute</span>
rate_limit_script = <span class="string">"""
local key = KEYS[1]
local limit = tonumber(ARGV[1])
local window = tonumber(ARGV[2])

local current = tonumber(redis.call('GET', key) or 0)

if current < limit then
    redis.call('INCR', key)
    if current == 0 then
        redis.call('EXPIRE', key, window)
    end
    return 1  -- Allowed
else
    return 0  -- Rate limited
end
"""</span>

<span class="keyword">def</span> <span class="function">make_request</span>(user_id):
    key = <span class="string">f"ratelimit:{user_id}"</span>
    allowed = r.eval(rate_limit_script, <span class="number">1</span>, key, <span class="number">10</span>, <span class="number">60</span>)
    <span class="keyword">return</span> allowed == <span class="number">1</span>

<span class="comment"># Test</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">12</span>):
    <span class="keyword">if</span> make_request(<span class="string">'user123'</span>):
        <span class="keyword">print</span>(<span class="string">f"Request {i+1}: ‚úÖ"</span>)
    <span class="keyword">else</span>:
        <span class="keyword">print</span>(<span class="string">f"Request {i+1}: ‚ùå Rate limited"</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: EVAL vs EVALSHA - difference?</h4>
                <p><strong>A:</strong> EVAL sends full script every time. EVALSHA uses cached script (via SCRIPT LOAD). EVALSHA faster (less network). Use EVALSHA for repeated scripts, EVAL for one-time!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: redis.call() vs redis.pcall()?</h4>
                <p><strong>A:</strong> redis.call() stops script on error. redis.pcall() returns error as Lua error object, script continues. Use pcall() when you want to handle errors in Lua!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can Lua scripts access multiple databases?</h4>
                <p><strong>A:</strong> No! Scripts can't use SELECT. All operations in same database. Ensures atomicity and prevents cross-database issues!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q4: What if script runs forever?</h4>
                <p><strong>A:</strong> Redis blocks! Scripts must finish quickly (milliseconds). Long-running scripts block ALL clients. Monitor with lua-time-limit config. SCRIPT KILL terminates non-writing scripts!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q5: Can Lua have rollback like SQL?</h4>
                <p><strong>A:</strong> NO! Like MULTI/EXEC, no rollback. If script fails midway, partial changes remain. Write defensive scripts: check everything before modifying!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Script modifies 100 keys. Atomic?</h4>
                <p><strong>Answer:</strong> YES! Entire script executes without interruption. All 100 keys modified atomically. Other clients blocked. This is why scripts must be fast!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I use random() in scripts?</h4>
                <p><strong>Answer:</strong> Yes but CAREFULLY! Random must be deterministic for replication. Redis provides redis.replicate_commands() for non-deterministic scripts. Otherwise replicas diverge!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Script cache survives restart?</h4>
                <p><strong>Answer:</strong> NO! Cache cleared on restart. Must reload scripts. Best practice: Use SCRIPT EXISTS before EVALSHA, fallback to EVAL if not cached!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Distributed Lock with Lua</strong></p>
            <p>Multiple workers need exclusive access. Use Redis distributed lock. Must be atomic: check if locked, if not acquire!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Lua Lock Script</h4>
                
                <code style="display: block; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; margin: 10px 0; font-size: 10px;">
local lock_key = KEYS[1]<br>
local token = ARGV[1]<br>
local ttl = tonumber(ARGV[2])<br>
<br>
if redis.call('EXISTS', lock_key) == 0 then<br>
&nbsp;&nbsp;redis.call('SET', lock_key, token, 'EX', ttl)<br>
&nbsp;&nbsp;return 1  -- Lock acquired<br>
else<br>
&nbsp;&nbsp;return 0  -- Already locked<br>
end
                </code>
                
                <p><strong>Benefits:</strong> ‚úÖ Atomic check-and-set ‚úÖ TTL prevents deadlock ‚úÖ Token ensures only owner unlocks</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>Atomic with logic</strong> - Check then modify (MULTI/EXEC can't)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Server-side execution</strong> - No network round-trips</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>EVALSHA for performance</strong> - Cache repeated scripts</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>No rollback</strong> - Like MULTI/EXEC</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>Must be fast</strong> - Blocks Redis during execution</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Production uses</strong> - Rate limiting, locks, atomic ops</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Lua</span><span class="keyword-tag">EVAL</span><span class="keyword-tag">EVALSHA</span><span class="keyword-tag">redis.call</span><span class="keyword-tag">Atomic</span><span class="keyword-tag">Scripting</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need to check value then modify atomically. Use MULTI/EXEC or Lua?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) MULTI/EXEC (atomic)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Lua script (check + modify)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) WATCH + MULTI/EXEC</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Pipeline</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Lua script</strong>
                    <p>MULTI/EXEC can't check values - commands queued, not executed until EXEC! Lua perfect: read value, check condition, modify if OK - all atomic! This is THE use case for Lua scripting!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 47: What is Redis Sentinel?
// ============================================================

function getQuestion47Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Production down!</strong> "Redis master crashed at 3 AM! Manual failover took 30 minutes - lost thousands in revenue!" CTO: "Implement Redis Sentinel! Automatic failover in seconds. Sentinels monitor master, detect failure, promote replica automatically. No human intervention needed!"</p>
            <p>Sentinel = high availability without manual intervention.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Sentinel provides high availability through automatic monitoring, notification, and failover. Sentinel processes monitor Redis instances, detect failures, and automatically promote replicas to master when needed.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Sentinel Responsibilities</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Function</th><th style="padding: 10px;">Description</th><th style="padding: 10px;">Benefit</th></tr>
                    <tr><td style="padding: 8px;">Monitoring</td><td>Checks if master/replicas alive</td><td>Detects failures fast</td></tr>
                    <tr><td style="padding: 8px;">Notification</td><td>Alerts admins via API/scripts</td><td>Ops team informed</td></tr>
                    <tr><td style="padding: 8px;">Automatic Failover</td><td>Promotes replica to master</td><td>&lt;30 sec recovery</td></tr>
                    <tr><td style="padding: 8px;">Configuration Provider</td><td>Clients discover current master</td><td>Apps stay connected</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Sentinel vs Cluster:</strong></p>
                <ul>
                    <li><strong>Sentinel:</strong> High availability (failover), no data partitioning</li>
                    <li><strong>Cluster:</strong> Horizontal scaling + HA, data sharded across nodes</li>
                    <li><strong>Can combine:</strong> Sentinel for each Cluster master!</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Sentinel Automatic Failover</div>
                <svg viewBox="0 0 900 480" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Sentinel Architecture</text>
                    
                    <!-- Sentinels -->
                    <rect x="50" y="60" width="150" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="125" y="85" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">üëÅÔ∏è Sentinel 1</text>
                    <text x="125" y="105" text-anchor="middle" fill="#888" font-size="9">Monitors all</text>
                    
                    <rect x="225" y="60" width="150" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="300" y="85" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">üëÅÔ∏è Sentinel 2</text>
                    <text x="300" y="105" text-anchor="middle" fill="#888" font-size="9">Monitors all</text>
                    
                    <rect x="400" y="60" width="150" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="475" y="85" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">üëÅÔ∏è Sentinel 3</text>
                    <text x="475" y="105" text-anchor="middle" fill="#888" font-size="9">Monitors all</text>
                    
                    <!-- Master (Failed) -->
                    <rect x="150" y="180" width="200" height="80" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="3" rx="8"/>
                    <text x="250" y="210" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">‚ùå Master (FAILED)</text>
                    <text x="250" y="230" text-anchor="middle" fill="#888" font-size="10">Crashed at 3:00 AM</text>
                    <text x="250" y="245" text-anchor="middle" fill="#FF6347" font-size="9">Sentinels detect failure</text>
                    
                    <!-- Replicas -->
                    <rect x="450" y="180" width="180" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="540" y="210" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üì¶ Replica 1</text>
                    <text x="540" y="230" text-anchor="middle" fill="#888" font-size="10">Healthy, synced</text>
                    <text x="540" y="245" text-anchor="middle" fill="#00FF88" font-size="9">‚Üí Promoted to Master!</text>
                    
                    <rect x="670" y="180" width="180" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="760" y="210" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üì¶ Replica 2</text>
                    <text x="760" y="230" text-anchor="middle" fill="#888" font-size="10">Healthy, synced</text>
                    <text x="760" y="245" text-anchor="middle" fill="#888" font-size="9">Stays as replica</text>
                    
                    <!-- Arrows from Sentinels -->
                    <path d="M 125 120 L 250 175" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5"/>
                    <path d="M 300 120 L 540 175" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- Failover Process -->
                    <rect x="50" y="300" width="800" height="160" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="325" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">‚ö° Automatic Failover Process</text>
                    
                    <text x="70" y="350" fill="#FFA500" font-size="11" font-weight="600">1. Detection (10 sec):</text>
                    <text x="80" y="367" fill="#bbb" font-size="10">Sentinels can't reach master</text>
                    
                    <text x="70" y="390" fill="#FFA500" font-size="11" font-weight="600">2. Quorum (5 sec):</text>
                    <text x="80" y="407" fill="#bbb" font-size="10">Majority agree master is down</text>
                    
                    <text x="70" y="430" fill="#FFA500" font-size="11" font-weight="600">3. Failover (10 sec):</text>
                    <text x="80" y="447" fill="#bbb" font-size="10">Elect & promote best replica</text>
                    
                    <text x="450" y="350" fill="#00FF88" font-size="11" font-weight="600">4. Reconfigure:</text>
                    <text x="460" y="367" fill="#bbb" font-size="10">Other replicas point to new master</text>
                    
                    <text x="450" y="390" fill="#00FF88" font-size="11" font-weight="600">5. Notify Clients:</text>
                    <text x="460" y="407" fill="#bbb" font-size="10">Apps connect to new master</text>
                    
                    <text x="450" y="430" fill="#DC143C" font-size="11" font-weight="600">Total Time: ~25 seconds!</text>
                    <text x="460" y="447" fill="#888" font-size="10">vs 30 min manual intervention</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Sentinel Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">sentinel.conf - Basic Setup</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Monitor master</span>
<span class="keyword">sentinel monitor</span> mymaster <span class="number">127.0.0.1</span> <span class="number">6379</span> <span class="number">2</span>

<span class="comment"># 2 = quorum (how many sentinels must agree)</span>
<span class="comment"># Need at least 2 sentinels to declare master down</span>

<span class="comment"># How long master unresponsive = down (ms)</span>
<span class="keyword">sentinel down-after-milliseconds</span> mymaster <span class="number">5000</span>

<span class="comment"># Failover timeout</span>
<span class="keyword">sentinel failover-timeout</span> mymaster <span class="number">60000</span>

<span class="comment"># Password if Redis requires AUTH</span>
<span class="keyword">sentinel auth-pass</span> mymaster <span class="string">your_password</span>

<span class="comment"># Run: redis-sentinel /path/to/sentinel.conf</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Python Client with Sentinel</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Auto-Connect to Current Master</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">from</span> redis.sentinel <span class="keyword">import</span> Sentinel

<span class="comment"># Connect to Sentinel cluster</span>
sentinel = Sentinel([
    (<span class="string">'sentinel1'</span>, <span class="number">26379</span>),
    (<span class="string">'sentinel2'</span>, <span class="number">26379</span>),
    (<span class="string">'sentinel3'</span>, <span class="number">26379</span>)
], socket_timeout=<span class="number">0.1</span>)

<span class="comment"># Get master connection (auto-discovers current master!)</span>
master = sentinel.master_for(<span class="string">'mymaster'</span>, socket_timeout=<span class="number">0.1</span>)

<span class="comment"># Get replica connection (for reads)</span>
replica = sentinel.slave_for(<span class="string">'mymaster'</span>, socket_timeout=<span class="number">0.1</span>)

<span class="comment"># Use normally - failover handled automatically!</span>
master.set(<span class="string">'key'</span>, <span class="string">'value'</span>)  <span class="comment"># Write to master</span>
value = replica.get(<span class="string">'key'</span>)   <span class="comment"># Read from replica</span>

<span class="keyword">print</span>(<span class="string">f"Value: {value}"</span>)  <span class="comment"># If master fails, client auto-reconnects!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Sentinel Commands</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Query Sentinel</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Connect to Sentinel (port 26379 by default)</span>
redis-cli -p <span class="number">26379</span>

<span class="comment"># Get master info</span>
<span class="keyword">SENTINEL</span> get-master-addr-by-name mymaster
<span class="number">1)</span> <span class="string">"127.0.0.1"</span>
<span class="number">2)</span> <span class="string">"6379"</span>

<span class="comment"># List all masters</span>
<span class="keyword">SENTINEL</span> masters

<span class="comment"># Get replicas</span>
<span class="keyword">SENTINEL</span> replicas mymaster

<span class="comment"># Manual failover (for testing)</span>
<span class="keyword">SENTINEL</span> failover mymaster

<span class="comment"># Check Sentinel status</span>
<span class="keyword">SENTINEL</span> ckquorum mymaster</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why 3+ Sentinels recommended?</h4>
                <p><strong>A:</strong> Need quorum for failover! 2 Sentinels = if 1 fails, no majority. 3 Sentinels = 2 can still agree (quorum=2). Odd numbers prevent split-brain. Production: 3 minimum, 5 ideal!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Sentinel vs Cluster - when to use which?</h4>
                <p><strong>A:</strong> Need capacity? Cluster (shards data). Need only HA? Sentinel (simpler). Can combine: Sentinel monitors each Cluster master for ultimate reliability!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What happens to old master after recovery?</h4>
                <p><strong>A:</strong> Becomes replica! When old master comes back, Sentinel reconfigures it as replica of new master. Prevents split-brain. Old master syncs and serves reads!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Quorum=2 with 2 Sentinels. One Sentinel dies. Failover possible?</h4>
                <p><strong>Answer:</strong> NO! Need 2 Sentinels to reach quorum but only 1 alive. Master failure = NO automatic failover. This is why 3+ Sentinels critical!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Can Sentinels run on same server as Redis?</h4>
                <p><strong>Answer:</strong> Technically yes but BAD idea! Server dies = lose both Redis + Sentinel. Deploy Sentinels on separate machines for true HA!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Platform HA</strong></p>
            <p>Online store can't afford downtime. Need automatic failover. How to ensure Redis always available?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Sentinel Setup</h4>
                <p><strong>Architecture:</strong> 1 Master + 2 Replicas + 3 Sentinels (different servers)</p>
                <p><strong>Benefits:</strong> ‚úÖ Automatic failover &lt;30 sec ‚úÖ Apps auto-reconnect ‚úÖ No manual intervention ‚úÖ 99.9% uptime</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõ°Ô∏è</span><p><strong>High availability</strong> - Automatic failover in seconds</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üëÅÔ∏è</span><p><strong>Monitoring</strong> - Detects failures automatically</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Auto-promotes replica</strong> - No human needed</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">3Ô∏è‚É£</span><p><strong>3+ Sentinels minimum</strong> - For quorum</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚öñÔ∏è</span><p><strong>vs Cluster</strong> - Sentinel=HA, Cluster=scaling</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Production essential</strong> - 99.9% uptime guaranteed</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Sentinel</span><span class="keyword-tag">High Availability</span><span class="keyword-tag">Failover</span><span class="keyword-tag">Monitoring</span><span class="keyword-tag">Quorum</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Master crashes. Need automatic failover. Use Sentinel or Cluster?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, true)">A) Sentinel (automatic HA)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) Cluster (sharding + HA)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Replication only</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Manual failover</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: A - Sentinel</strong>
                    <p>Sentinel specifically designed for automatic failover! Detects master failure, promotes replica in ~30 seconds. Cluster also has HA but adds complexity if you don't need sharding. For pure HA: Sentinel perfect!</p>
                </div>
            </div>
        </div>
    `;
}




// ============================================================
// QUESTION 48: What is Redis Replication?
// ============================================================

function getQuestion48Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Performance bottleneck:</strong> "Single Redis handling 10,000 reads/sec - CPU maxed at 100%! Can't scale vertically anymore." Solution: "Add read replicas! Master handles writes, 3 replicas distribute reads. Same 10K reads now split across 4 servers = 2,500 reads each. 4x read capacity!"</p>
            <p>Replication = horizontal read scaling.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis replication creates exact copies (replicas) of a master instance. Master handles writes, replicas sync asynchronously and serve reads. Provides read scaling and data redundancy.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Replication Characteristics</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Aspect</th><th style="padding: 10px;">Details</th><th style="padding: 10px;">Impact</th></tr>
                    <tr><td style="padding: 8px;">Sync Type</td><td>Asynchronous</td><td>Fast writes, slight lag</td></tr>
                    <tr><td style="padding: 8px;">Replica Mode</td><td>Read-only (default)</td><td>Prevents inconsistency</td></tr>
                    <tr><td style="padding: 8px;">Topology</td><td>1 Master, N Replicas</td><td>Linear read scaling</td></tr>
                    <tr><td style="padding: 8px;">Data Transfer</td><td>Full sync then incremental</td><td>Efficient bandwidth</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Use Cases:</strong></p>
                <ul>
                    <li><strong>Read scaling:</strong> Distribute reads across replicas</li>
                    <li><strong>Data redundancy:</strong> Replicas as live backups</li>
                    <li><strong>Geographic distribution:</strong> Replicas in different regions</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Master-Replica Architecture</div>
                <svg viewBox="0 0 900 450" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Replication: Read Scaling</text>
                    
                    <rect x="350" y="60" width="200" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">üñ•Ô∏è Master</text>
                    <text x="450" y="110" text-anchor="middle" fill="#FFA500" font-size="11">Handles ALL writes</text>
                    <text x="450" y="125" text-anchor="middle" fill="#888" font-size="9">Port 6379</text>
                    
                    <path d="M 450 140 L 200 200" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    <path d="M 450 140 L 450 200" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    <path d="M 450 140 L 700 200" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    
                    <text x="300" y="170" fill="#9C27B0" font-size="10">Async sync</text>
                    
                    <rect x="100" y="200" width="180" height="70" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="190" y="225" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">üì¶ Replica 1</text>
                    <text x="190" y="245" text-anchor="middle" fill="#888" font-size="9">Handles reads</text>
                    <text x="190" y="260" text-anchor="middle" fill="#00FF88" font-size="9">Port 6380</text>
                    
                    <rect x="360" y="200" width="180" height="70" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="225" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">üì¶ Replica 2</text>
                    <text x="450" y="245" text-anchor="middle" fill="#888" font-size="9">Handles reads</text>
                    <text x="450" y="260" text-anchor="middle" fill="#00FF88" font-size="9">Port 6381</text>
                    
                    <rect x="620" y="200" width="180" height="70" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="710" y="225" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">üì¶ Replica 3</text>
                    <text x="710" y="245" text-anchor="middle" fill="#888" font-size="9">Handles reads</text>
                    <text x="710" y="260" text-anchor="middle" fill="#00FF88" font-size="9">Port 6382</text>
                    
                    <rect x="50" y="300" width="800" height="130" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="325" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">Traffic Distribution</text>
                    
                    <text x="70" y="350" fill="#FFA500" font-size="11" font-weight="600">Writes (1,000/sec):</text>
                    <text x="80" y="367" fill="#DC143C" font-size="10">‚Üí ALL to Master only</text>
                    
                    <text x="70" y="390" fill="#00FF88" font-size="11" font-weight="600">Reads (10,000/sec):</text>
                    <text x="80" y="407" fill="#00FF88" font-size="10">‚Üí Split: 2,500 each replica</text>
                    
                    <text x="450" y="350" fill="#DC143C" font-size="11" font-weight="600">Result:</text>
                    <text x="460" y="367" fill="#bbb" font-size="10">Master: 1K writes + sync</text>
                    <text x="460" y="382" fill="#bbb" font-size="10">Each replica: 2.5K reads</text>
                    <text x="460" y="397" fill="#00FF88" font-size="10">4x read capacity! ‚úÖ</text>
                    
                    <text x="460" y="420" fill="#FFA500" font-size="9">Replication lag: Usually &lt;100ms</text>
                    
                    <defs>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Setup Replication</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Make Server a Replica</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># On replica server</span>
<span class="keyword">REPLICAOF</span> <span class="string">master-host</span> <span class="number">6379</span>

<span class="comment"># Check replication status</span>
<span class="keyword">INFO</span> replication
role:slave
master_host:master-host
master_port:<span class="number">6379</span>
master_link_status:up
master_sync_in_progress:<span class="number">0</span>

<span class="comment"># Stop being a replica (become master)</span>
<span class="keyword">REPLICAOF</span> NO ONE</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Python Read Scaling</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Write to Master, Read from Replicas</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> random

<span class="comment"># Master for writes</span>
master = redis.Redis(host=<span class="string">'master-host'</span>, port=<span class="number">6379</span>)

<span class="comment"># Replica pool for reads</span>
replicas = [
    redis.Redis(host=<span class="string">'replica1'</span>, port=<span class="number">6379</span>),
    redis.Redis(host=<span class="string">'replica2'</span>, port=<span class="number">6379</span>),
    redis.Redis(host=<span class="string">'replica3'</span>, port=<span class="number">6379</span>)
]

<span class="keyword">def</span> <span class="function">write_data</span>(key, value):
    <span class="string">"""Always write to master"""</span>
    master.set(key, value)

<span class="keyword">def</span> <span class="function">read_data</span>(key):
    <span class="string">"""Load balance reads across replicas"""</span>
    replica = random.choice(replicas)
    <span class="keyword">return</span> replica.get(key)

<span class="comment"># Usage</span>
write_data(<span class="string">'user:123'</span>, <span class="string">'Alice'</span>)  <span class="comment"># ‚Üí Master</span>
value = read_data(<span class="string">'user:123'</span>)       <span class="comment"># ‚Üí Random replica</span>
<span class="keyword">print</span>(value)  <span class="comment"># Alice</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - Replica Configuration</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Set master</span>
<span class="keyword">replicaof</span> <span class="string">master-host</span> <span class="number">6379</span>

<span class="comment"># Master password (if AUTH enabled)</span>
<span class="keyword">masterauth</span> <span class="string">master_password</span>

<span class="comment"># Replica read-only (default: yes)</span>
<span class="keyword">replica-read-only</span> yes

<span class="comment"># Serve stale data if master link down</span>
<span class="keyword">replica-serve-stale-data</span> yes

<span class="comment"># Replication backlog size (for partial resync)</span>
<span class="keyword">repl-backlog-size</span> <span class="number">1mb</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Is replication synchronous or asynchronous?</h4>
                <p><strong>A:</strong> Asynchronous! Master doesn't wait for replica ACK before returning to client. Fast writes, but slight replication lag (usually <100ms). For sync replication, use WAIT command!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can replicas accept writes?</h4>
                <p><strong>A:</strong> NO by default (replica-read-only yes)! Prevents data inconsistency. Can disable but dangerous - replica writes won't sync to master or other replicas. Keep read-only!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What's replication lag?</h4>
                <p><strong>A:</strong> Time between master write and replica sync. Normally milliseconds. Check with INFO replication (master_repl_offset vs slave_repl_offset). High lag = network issues or slow replica!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Write to master, immediately read from replica. Data there?</h4>
                <p><strong>Answer:</strong> Maybe not! Async replication = slight lag. Solution: (1) Read from master after write, (2) Use WAIT command for sync, or (3) Accept eventual consistency!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can replicas have replicas (chained)?</h4>
                <p><strong>Answer:</strong> YES! Replica can have sub-replicas. Reduces master load but increases total lag. Master ‚Üí Replica1 (10ms) ‚Üí Replica2 (10ms) = 20ms total lag. Use sparingly!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: News Website - 100K Concurrent Readers</strong></p>
            <p>News site: 100K readers, 10 writers. Single Redis can't handle read load. How to scale?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Master + 5 Replicas</h4>
                <p><strong>Architecture:</strong> 1 Master (writes) + 5 Replicas (reads) + Load balancer</p>
                <p><strong>Result:</strong> ‚úÖ Master: 10 writes/sec ‚úÖ Each replica: 20K reads/sec ‚úÖ Total: 100K reads handled! ‚úÖ Cost: 6 servers vs scaling master to monster size</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìà</span><p><strong>Read scaling</strong> - N replicas = Nx read capacity</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Asynchronous</strong> - Fast writes, slight lag acceptable</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>Read-only replicas</strong> - Prevents inconsistency</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Full + partial sync</strong> - Efficient data transfer</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Live backups</strong> - Replicas as redundancy</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåç</span><p><strong>Geographic distribution</strong> - Replicas in multiple regions</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Replication</span><span class="keyword-tag">Master-Replica</span><span class="keyword-tag">REPLICAOF</span><span class="keyword-tag">Async</span><span class="keyword-tag">Read Scaling</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> 10K reads/sec overwhelms single Redis. Need horizontal scaling. Best solution?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, true)">A) Add read replicas</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) Upgrade to bigger server</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Use Redis Cluster</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Add caching layer</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: A - Add read replicas</strong>
                    <p>Read replicas perfect for read-heavy workloads! 3 replicas = 3x read capacity. Master handles writes, replicas distribute reads. Cluster is for data sharding (when dataset doesn't fit in one server). For read scaling: replication!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 49: What are Redis Modules?
// ============================================================

function getQuestion49Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Developer frustrated:</strong> "Need full-text search in Redis. Native commands can't do complex queries like 'find all products with laptop AND price 500-1000'!" Architect: "Load RediSearch module! Extends Redis with search indexing, filters, ranking. Need JSON? RedisJSON module gives native JSON operations!"</p>
            <p>Modules = supercharge Redis with specialized features.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Modules extend Redis functionality with new commands and data types. Load dynamically without recompiling Redis. Popular modules: RediSearch (search), RedisJSON (JSON), RedisGraph (graphs), RedisTimeSeries (time-series), RedisBloom (probabilistic).</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Popular Redis Modules</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Module</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Use Case</th></tr>
                    <tr><td style="padding: 8px;">RediSearch</td><td>Full-text search, indexing</td><td>Product search, autocomplete</td></tr>
                    <tr><td style="padding: 8px;">RedisJSON</td><td>Native JSON data type</td><td>Store/query documents</td></tr>
                    <tr><td style="padding: 8px;">RedisGraph</td><td>Graph database</td><td>Social networks, relationships</td></tr>
                    <tr><td style="padding: 8px;">RedisTimeSeries</td><td>Time-series data</td><td>Metrics, IoT, analytics</td></tr>
                    <tr><td style="padding: 8px;">RedisBloom</td><td>Probabilistic filters</td><td>Deduplication, membership</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° When to Use Modules vs External Tools:</strong></p>
                <ul>
                    <li><strong>Use RediSearch:</strong> Data already in Redis, simple-medium queries</li>
                    <li><strong>Use Elasticsearch:</strong> Complex analytics, huge datasets</li>
                    <li><strong>Use RedisJSON:</strong> Store JSON docs in Redis cache</li>
                    <li><strong>Use MongoDB:</strong> Primary JSON database with complex queries</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Redis Modules Architecture</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Core + Modules = Extended Capabilities</text>
                    
                    <rect x="250" y="70" width="400" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="100" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="600">üñ•Ô∏è Redis Core</text>
                    <text x="450" y="125" text-anchor="middle" fill="#888" font-size="11">Strings, Lists, Sets, Hashes, Sorted Sets...</text>
                    
                    <path d="M 450 150 L 175 195" stroke="#9C27B0" stroke-width="2"/>
                    <path d="M 450 150 L 355 195" stroke="#9C27B0" stroke-width="2"/>
                    <path d="M 450 150 L 535 195" stroke="#9C27B0" stroke-width="2"/>
                    <path d="M 450 150 L 715 195" stroke="#9C27B0" stroke-width="2"/>
                    
                    <rect x="80" y="200" width="180" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="170" y="225" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üîç RediSearch</text>
                    <text x="170" y="245" text-anchor="middle" fill="#888" font-size="9">FT.CREATE, FT.SEARCH</text>
                    
                    <rect x="270" y="200" width="180" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="360" y="225" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üìÑ RedisJSON</text>
                    <text x="360" y="245" text-anchor="middle" fill="#888" font-size="9">JSON.SET, JSON.GET</text>
                    
                    <rect x="460" y="200" width="180" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="550" y="225" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üï∏Ô∏è RedisGraph</text>
                    <text x="550" y="245" text-anchor="middle" fill="#888" font-size="9">GRAPH.QUERY</text>
                    
                    <rect x="650" y="200" width="180" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="740" y="225" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üìà TimeSeries</text>
                    <text x="740" y="245" text-anchor="middle" fill="#888" font-size="9">TS.ADD, TS.RANGE</text>
                    
                    <rect x="50" y="290" width="800" height="110" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="315" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">Loading Modules</text>
                    
                    <text x="70" y="340" fill="#FFA500" font-size="11" font-weight="600">At Startup (redis.conf):</text>
                    <text x="80" y="357" fill="#bbb" font-size="10">loadmodule /path/to/redisearch.so</text>
                    
                    <text x="70" y="380" fill="#00FF88" font-size="11" font-weight="600">Runtime (CLI):</text>
                    <text x="80" y="397" fill="#bbb" font-size="10">MODULE LOAD /path/to/redisjson.so</text>
                    
                    <text x="450" y="340" fill="#9C27B0" font-size="11" font-weight="600">List Modules:</text>
                    <text x="460" y="357" fill="#bbb" font-size="10">MODULE LIST</text>
                    
                    <text x="450" y="380" fill="#DC143C" font-size="11" font-weight="600">Unload:</text>
                    <text x="460" y="397" fill="#bbb" font-size="10">MODULE UNLOAD search</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: RediSearch - Product Catalog</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Full-Text Search</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Create search index</span>
<span class="keyword">FT.CREATE</span> products ON HASH PREFIX <span class="number">1</span> product: SCHEMA 
    title TEXT WEIGHT <span class="number">2.0</span>
    description TEXT 
    price NUMERIC SORTABLE
    category TAG

<span class="comment"># Add products (as hashes)</span>
<span class="keyword">HSET</span> product:<span class="number">1</span> title <span class="string">"Gaming Laptop Pro"</span> 
    description <span class="string">"High performance laptop for gaming"</span>
    price <span class="number">1200</span> category <span class="string">"electronics"</span>

<span class="keyword">HSET</span> product:<span class="number">2</span> title <span class="string">"Office Laptop"</span>
    description <span class="string">"Business laptop for professionals"</span>
    price <span class="number">800</span> category <span class="string">"electronics"</span>

<span class="comment"># Search: "laptop" with price filter</span>
<span class="keyword">FT.SEARCH</span> products <span class="string">"laptop @price:[700 1000]"</span>
<span class="comment"># Returns: product:2 (Office Laptop)</span>

<span class="comment"># Complex query: gaming AND sort by price</span>
<span class="keyword">FT.SEARCH</span> products <span class="string">"gaming laptop"</span> SORTBY price ASC
<span class="comment"># Returns: product:1</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: RedisJSON - User Profiles</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - JSON Operations</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Set entire JSON document</span>
<span class="keyword">JSON.SET</span> user:<span class="number">123</span> $ <span class="string">'{
  "name": "Alice",
  "age": 30,
  "email": "alice@example.com",
  "preferences": {
    "theme": "dark",
    "language": "en"
  },
  "tags": ["premium", "verified"]
}'</span>

<span class="comment"># Get specific path</span>
<span class="keyword">JSON.GET</span> user:<span class="number">123</span> $.name
<span class="comment"># ["Alice"]</span>

<span class="comment"># Update nested field</span>
<span class="keyword">JSON.SET</span> user:<span class="number">123</span> $.preferences.theme <span class="string">"light"</span>

<span class="comment"># Array operations</span>
<span class="keyword">JSON.ARRAPPEND</span> user:<span class="number">123</span> $.tags <span class="string">"early-adopter"</span>
<span class="keyword">JSON.GET</span> user:<span class="number">123</span> $.tags
<span class="comment"># [["premium","verified","early-adopter"]]</span>

<span class="comment"># Increment numeric field</span>
<span class="keyword">JSON.NUMINCRBY</span> user:<span class="number">123</span> $.age <span class="number">1</span>
<span class="comment"># Age now 31</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Python with Modules</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Using RediSearch</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">from</span> redis <span class="keyword">import</span> Redis
<span class="keyword">from</span> redis.commands.search.field <span class="keyword">import</span> TextField, NumericField
<span class="keyword">from</span> redis.commands.search.indexDefinition <span class="keyword">import</span> IndexDefinition

r = Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Create index</span>
index = r.ft(<span class="string">"products"</span>)
index.create_index([
    TextField(<span class="string">"title"</span>, weight=<span class="number">2.0</span>),
    NumericField(<span class="string">"price"</span>)
], definition=IndexDefinition(prefix=[<span class="string">"product:"</span>]))

<span class="comment"># Add products</span>
r.hset(<span class="string">"product:1"</span>, mapping={
    <span class="string">"title"</span>: <span class="string">"Gaming Laptop"</span>,
    <span class="string">"price"</span>: <span class="number">1200</span>
})

<span class="comment"># Search</span>
results = index.search(<span class="string">"laptop @price:[1000 1500]"</span>)
<span class="keyword">for</span> doc <span class="keyword">in</span> results.docs:
    <span class="keyword">print</span>(<span class="string">f"{doc.title}: ${doc.price}"</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: When to use RediSearch vs Elasticsearch?</h4>
                <p><strong>A:</strong> RediSearch: Data already in Redis, simple-medium queries, sub-millisecond latency. Elasticsearch: Complex analytics, massive datasets (TB+), advanced ML features. RediSearch 10x faster for cached data!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: RedisJSON vs storing JSON as strings?</h4>
                <p><strong>A:</strong> RedisJSON: Query/update specific fields (JSON.GET $.user.name). Strings: Store whole document, no partial access. RedisJSON more memory efficient for large docs with frequent partial updates!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Do modules affect Redis performance?</h4>
                <p><strong>A:</strong> Minimal impact! Modules run in Redis process (no network overhead). Well-written modules efficient. Monitor: Memory usage may increase. RediSearch indexes use extra RAM but queries are FAST!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can modules work with Redis Cluster?</h4>
                <p><strong>Answer:</strong> YES with limitations! Module commands must operate on keys in same hash slot. RediSearch can work across cluster but some aggregations limited. RedisJSON works fine (operates on single keys)!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Modules persist after restart?</h4>
                <p><strong>Answer:</strong> Data persists (if RDB/AOF enabled), but modules don't auto-reload! Must reload with MODULE LOAD or add to redis.conf: loadmodule /path/to/module.so. Production: Always configure in redis.conf!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Product Search</strong></p>
            <p>Store has 100K products cached in Redis. Need: (1) Search by title/description, (2) Filter by price/category, (3) Sort by price/rating. Native Redis can't do complex queries - would need to scan all products!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: RediSearch Module</h4>
                <p><strong>Implementation:</strong> Create FT.CREATE index on product hashes. Index title (text), price (numeric), category (tag).</p>
                <p><strong>Results:</strong> ‚úÖ Full-text search: "gaming laptop" ‚úÖ Price filters: @price:[500 1000] ‚úÖ Category filters: @category:{electronics} ‚úÖ Sort by price/rating ‚úÖ Query time: &lt;5ms (vs 100ms scanning) ‚úÖ All in Redis - no external search engine!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîå</span><p><strong>Extend functionality</strong> - Add features without forking Redis</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîç</span><p><strong>RediSearch</strong> - Full-text search, filters, aggregations</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìÑ</span><p><strong>RedisJSON</strong> - Native JSON with path operations</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>RedisTimeSeries</strong> - Time-series data, downsampling</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Load dynamically</strong> - MODULE LOAD or loadmodule config</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Use when</strong> - Data already in Redis, need specialized ops</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Modules</span><span class="keyword-tag">RediSearch</span><span class="keyword-tag">RedisJSON</span><span class="keyword-tag">MODULE LOAD</span><span class="keyword-tag">Extensions</span><span class="keyword-tag">FT.SEARCH</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need full-text search on 50K products with price filters. What's the best Redis approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Use KEYS pattern matching</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Load RediSearch module</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Use Sorted Sets for sorting</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Scan all products in app code</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Load RediSearch module</strong>
                    <p>RediSearch PERFECT for this! Full-text search + numeric filters + sorting - all in Redis with sub-millisecond latency. KEYS blocks server (terrible for production). Sorted Sets can't do text search. Scanning 50K products in app = slow and wasteful. RediSearch indexes enable instant queries!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 50: What is Redis Stack?
// ============================================================

function getQuestion50Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>DevOps headache:</strong> "Need Redis + Search + JSON + TimeSeries + Graph. Installing each module separately is painful - compatibility issues, version mismatches!" Solution: "Use Redis Stack! All popular modules pre-bundled + RedisInsight GUI. One Docker image, everything included. Production-ready out of the box!"</p>
            <p>Redis Stack = batteries included.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Stack is a complete Redis distribution that bundles Redis OSS with popular modules (Search, JSON, Graph, TimeSeries, Bloom) plus RedisInsight management GUI. Single installation for full capabilities.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">What's Included in Redis Stack</h4>
                <p><strong>‚úÖ Redis OSS:</strong> Core Redis engine<br>
                <strong>‚úÖ RediSearch:</strong> Full-text search, indexing<br>
                <strong>‚úÖ RedisJSON:</strong> Native JSON data type<br>
                <strong>‚úÖ RedisGraph:</strong> Graph database<br>
                <strong>‚úÖ RedisTimeSeries:</strong> Time-series data<br>
                <strong>‚úÖ RedisBloom:</strong> Probabilistic data structures<br>
                <strong>‚úÖ RedisInsight:</strong> GUI for management, monitoring</p>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Redis Stack vs Redis OSS:</strong></p>
                <ul>
                    <li><strong>OSS:</strong> Core Redis only, manual module installation</li>
                    <li><strong>Stack:</strong> All modules + GUI pre-installed</li>
                    <li><strong>Use Stack for:</strong> Rapid prototyping, full-feature apps</li>
                    <li><strong>Use OSS for:</strong> Minimal footprint, specific needs only</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Redis Stack Components</div>
                <svg viewBox="0 0 900 380" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Stack = All-in-One Solution</text>
                    
                    <rect x="150" y="60" width="600" height="250" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="3" rx="10"/>
                    <text x="450" y="90" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="600">üì¶ Redis Stack</text>
                    
                    <rect x="180" y="110" width="120" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="240" y="140" text-anchor="middle" fill="#00FF88" font-size="11">Redis OSS</text>
                    
                    <rect x="320" y="110" width="120" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="380" y="140" text-anchor="middle" fill="#00FF88" font-size="11">RediSearch</text>
                    
                    <rect x="460" y="110" width="120" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="520" y="140" text-anchor="middle" fill="#00FF88" font-size="11">RedisJSON</text>
                    
                    <rect x="600" y="110" width="120" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="660" y="140" text-anchor="middle" fill="#00FF88" font-size="11">RedisGraph</text>
                    
                    <rect x="180" y="180" width="120" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="240" y="210" text-anchor="middle" fill="#00FF88" font-size="11">TimeSeries</text>
                    
                    <rect x="320" y="180" width="120" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="380" y="210" text-anchor="middle" fill="#00FF88" font-size="11">RedisBloom</text>
                    
                    <rect x="460" y="180" width="260" height="50" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="590" y="210" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">üñ•Ô∏è RedisInsight GUI</text>
                    
                    <rect x="180" y="250" width="540" height="40" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="450" y="275" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">One Install ‚Ä¢ Zero Configuration ‚Ä¢ Production Ready</text>
                    
                    <text x="450" y="340" text-anchor="middle" fill="#00FF88" font-size="13">Docker: redis/redis-stack | Port 6379: Redis | Port 8001: RedisInsight</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Quick Start with Docker</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Docker - One Command Install</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Run Redis Stack (includes all modules + GUI)</span>
docker run -d -p <span class="number">6379</span>:<span class="number">6379</span> -p <span class="number">8001</span>:<span class="number">8001</span> redis/redis-stack

<span class="comment"># Redis available at: localhost:6379</span>
<span class="comment"># RedisInsight GUI at: http://localhost:8001</span>

<span class="comment"># Connect and use any module immediately!</span>
redis-cli

<span class="comment"># RediSearch works</span>
<span class="keyword">FT.CREATE</span> idx SCHEMA title TEXT

<span class="comment"># RedisJSON works</span>
<span class="keyword">JSON.SET</span> doc $ <span class="string">'{"hello":"world"}'</span>

<span class="comment"># Everything available out of the box!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Using All Capabilities</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Document Database with Search</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Store JSON documents (RedisJSON)</span>
r.execute_command(<span class="string">'JSON.SET'</span>, <span class="string">'product:1'</span>, <span class="string">'$'</span>, <span class="string">'''{
  "title": "Gaming Laptop",
  "price": 1200,
  "specs": {"ram": "16GB", "storage": "512GB SSD"}
}'''</span>)

<span class="comment"># Create search index (RediSearch)</span>
r.execute_command(
    <span class="string">'FT.CREATE'</span>, <span class="string">'products'</span>,
    <span class="string">'ON'</span>, <span class="string">'JSON'</span>,
    <span class="string">'SCHEMA'</span>, 
    <span class="string">'$.title'</span>, <span class="string">'AS'</span>, <span class="string">'title'</span>, <span class="string">'TEXT'</span>,
    <span class="string">'$.price'</span>, <span class="string">'AS'</span>, <span class="string">'price'</span>, <span class="string">'NUMERIC'</span>
)

<span class="comment"># Search JSON documents!</span>
results = r.execute_command(<span class="string">'FT.SEARCH'</span>, <span class="string">'products'</span>, <span class="string">'laptop'</span>)
<span class="keyword">print</span>(results)

<span class="comment"># RedisJSON + RediSearch = Document database!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Redis Stack free or commercial?</h4>
                <p><strong>A:</strong> Free for development! Production licensing depends on modules used. RediSearch, RedisJSON etc. have dual licensing (RSAL/SSPL). Check Redis website for current licensing. Redis OSS always free!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can I disable modules I don't need?</h4>
                <p><strong>A:</strong> Yes! MODULE UNLOAD or don't use them. Unused modules have minimal overhead. For truly minimal install, use Redis OSS and load only what you need!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: RedisInsight - what can it do?</h4>
                <p><strong>A:</strong> Web GUI for: Browse keys, run commands, monitor performance, visualize data, profile queries. Great for development, debugging. Access at port 8001!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Redis Stack vs Redis Enterprise?</h4>
                <p><strong>Answer:</strong> Stack: Free distribution with modules. Enterprise: Commercial product with Active-Active geo-distribution, auto-tiering, support. Stack for dev/small prod. Enterprise for mission-critical large scale!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I upgrade from Redis OSS to Stack?</h4>
                <p><strong>Answer:</strong> YES! Stack includes Redis OSS. Your data compatible. Just install Stack, point to existing RDB/AOF. Modules add capabilities without breaking existing commands!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Rapid Prototype to Production</strong></p>
            <p>Startup building product catalog with search. Need: JSON storage, full-text search, time-series analytics (views tracking). Don't want to manage multiple databases!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Redis Stack</h4>
                <p><strong>Implementation:</strong> docker run redis/redis-stack. Use RedisJSON for products, RediSearch for queries, RedisTimeSeries for analytics.</p>
                <p><strong>Benefits:</strong> ‚úÖ One database for everything ‚úÖ 5-minute setup ‚úÖ Sub-ms queries ‚úÖ RedisInsight for debugging ‚úÖ Scale later if needed</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¶</span><p><strong>All-in-one</strong> - Redis + all popular modules bundled</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üöÄ</span><p><strong>Instant start</strong> - One Docker command, production-ready</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üñ•Ô∏è</span><p><strong>RedisInsight included</strong> - GUI for management</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üÜì</span><p><strong>Free for dev</strong> - Check licensing for production</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Perfect for prototyping</strong> - Try all features quickly</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>vs OSS</strong> - Convenience vs minimal footprint</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Redis Stack</span><span class="keyword-tag">All-in-One</span><span class="keyword-tag">RedisInsight</span><span class="keyword-tag">Bundled</span><span class="keyword-tag">docker</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need Redis + Search + JSON for prototype. Want fastest setup. What to use?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Redis OSS + manual module install</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Redis Stack Docker image</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Redis Enterprise</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Compile from source</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Redis Stack Docker image</strong>
                    <p>Redis Stack perfect for prototyping! One docker run command = Redis + all modules + GUI. Everything pre-configured, works immediately. OSS requires manual module installation. Enterprise overkill for prototype. Stack = fastest path from idea to working app!</p>
                </div>
            </div>
        </div>
    `;
}




// ============================================================
// QUESTION 51: Redis Data Types - When to Use Which?
// ============================================================

function getQuestion51Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Developer confused:</strong> "Should I use Hash or separate String keys for user profiles? Set or List for tags? Sorted Set or List for recent items?" Architect: "Choose by access pattern! Hash for related fields (fewer keys), Set for uniqueness, Sorted Set for ordering. Data structure = how you query!"</p>
            <p>Right data type = 10x performance boost.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis provides 9 native data types, each optimized for specific access patterns. Choose based on how you query data, not just what it looks like. String for simple values, Hash for objects, Set for uniqueness, Sorted Set for rankings, List for ordered sequences.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Decision Tree: Which Data Type?</h4>
                <p><strong>Need ordering?</strong> ‚Üí List (insertion order) or Sorted Set (by score)<br>
                <strong>Need uniqueness?</strong> ‚Üí Set (unordered) or Sorted Set (with scores)<br>
                <strong>Related fields?</strong> ‚Üí Hash (object-like)<br>
                <strong>Simple value?</strong> ‚Üí String<br>
                <strong>Counting unique?</strong> ‚Üí HyperLogLog (approximate)<br>
                <strong>Location data?</strong> ‚Üí Geospatial<br>
                <strong>Binary flags?</strong> ‚Üí Bitmap<br>
                <strong>Message queue?</strong> ‚Üí Stream</p>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Common Mistakes:</strong></p>
                <ul>
                    <li>‚ùå Using user:123:name, user:123:email (separate keys) ‚Üí ‚úÖ Use Hash!</li>
                    <li>‚ùå Using List for unique values ‚Üí ‚úÖ Use Set!</li>
                    <li>‚ùå Using Set for ranked data ‚Üí ‚úÖ Use Sorted Set!</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Data Type Selection Guide</div>
                <svg viewBox="0 0 900 450" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">Choose Data Type by Access Pattern</text>
                    
                    <rect x="50" y="50" width="170" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="135" y="75" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">String</text>
                    <text x="135" y="95" text-anchor="middle" fill="#888" font-size="9">Cache, counters, flags</text>
                    
                    <rect x="240" y="50" width="170" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="325" y="75" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Hash</text>
                    <text x="325" y="95" text-anchor="middle" fill="#888" font-size="9">Objects, user profiles</text>
                    
                    <rect x="430" y="50" width="170" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="515" y="75" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">List</text>
                    <text x="515" y="95" text-anchor="middle" fill="#888" font-size="9">Queue, timeline, stack</text>
                    
                    <rect x="620" y="50" width="170" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="705" y="75" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Set</text>
                    <text x="705" y="95" text-anchor="middle" fill="#888" font-size="9">Tags, unique visitors</text>
                    
                    <rect x="50" y="130" width="170" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="135" y="155" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">Sorted Set</text>
                    <text x="135" y="175" text-anchor="middle" fill="#888" font-size="9">Leaderboard, rankings</text>
                    
                    <rect x="240" y="130" width="170" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="325" y="155" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">Stream</text>
                    <text x="325" y="175" text-anchor="middle" fill="#888" font-size="9">Message queue, log</text>
                    
                    <rect x="430" y="130" width="170" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="515" y="155" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">HyperLogLog</text>
                    <text x="515" y="175" text-anchor="middle" fill="#888" font-size="9">Unique count (approx)</text>
                    
                    <rect x="620" y="130" width="170" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="705" y="155" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">Geospatial</text>
                    <text x="705" y="175" text-anchor="middle" fill="#888" font-size="9">Location, radius search</text>
                    
                    <rect x="50" y="230" width="800" height="200" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="255" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">Use Case Examples</text>
                    
                    <text x="70" y="280" fill="#00FF88" font-size="11" font-weight="600">String:</text>
                    <text x="80" y="295" fill="#bbb" font-size="10">SET session:abc "user_data"</text>
                    
                    <text x="70" y="315" fill="#00FF88" font-size="11" font-weight="600">Hash (Better!):</text>
                    <text x="80" y="330" fill="#bbb" font-size="10">HSET user:123 name Alice age 30</text>
                    <text x="80" y="345" fill="#888" font-size="9">vs SET user:123:name Alice, SET user:123:age 30</text>
                    
                    <text x="70" y="365" fill="#9C27B0" font-size="11" font-weight="600">Sorted Set:</text>
                    <text x="80" y="380" fill="#bbb" font-size="10">ZADD leaderboard 1000 Alice 950 Bob</text>
                    <text x="80" y="395" fill="#bbb" font-size="10">ZRANGE leaderboard 0 9 WITHSCORES</text>
                    
                    <text x="450" y="280" fill="#00FF88" font-size="11" font-weight="600">Set (Unique):</text>
                    <text x="460" y="295" fill="#bbb" font-size="10">SADD user:123:tags premium verified</text>
                    <text x="460" y="310" fill="#bbb" font-size="10">SISMEMBER user:123:tags premium</text>
                    
                    <text x="450" y="330" fill="#9C27B0" font-size="11" font-weight="600">List (Ordered):</text>
                    <text x="460" y="345" fill="#bbb" font-size="10">LPUSH timeline post3 post2 post1</text>
                    <text x="460" y="360" fill="#bbb" font-size="10">LRANGE timeline 0 9</text>
                    
                    <text x="450" y="380" fill="#FFA500" font-size="11" font-weight="600">Rule: Access pattern > data shape!</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Hash vs Separate Strings</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - User Profile Comparison</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
r = redis.Redis()

<span class="comment"># ‚ùå BAD: Separate string keys</span>
r.set(<span class="string">'user:123:name'</span>, <span class="string">'Alice'</span>)
r.set(<span class="string">'user:123:email'</span>, <span class="string">'alice@ex.com'</span>)
r.set(<span class="string">'user:123:age'</span>, <span class="number">30</span>)
<span class="comment"># 3 keys = 3x memory overhead</span>

<span class="comment"># ‚úÖ GOOD: Use Hash</span>
r.hset(<span class="string">'user:123'</span>, mapping={
    <span class="string">'name'</span>: <span class="string">'Alice'</span>,
    <span class="string">'email'</span>: <span class="string">'alice@ex.com'</span>,
    <span class="string">'age'</span>: <span class="number">30</span>
})
<span class="comment"># 1 key = less memory, faster retrieval</span>

<span class="comment"># Get all fields at once</span>
user = r.hgetall(<span class="string">'user:123'</span>)
<span class="keyword">print</span>(user)  <span class="comment"># {'name': 'Alice', 'email': '...', 'age': '30'}</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Choosing Collection Type</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Different Use Cases</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
r = redis.Redis()

<span class="comment"># Set: Unique tags (no duplicates)</span>
r.sadd(<span class="string">'user:tags'</span>, <span class="string">'python'</span>, <span class="string">'redis'</span>, <span class="string">'python'</span>)  <span class="comment"># Only stored once</span>
tags = r.smembers(<span class="string">'user:tags'</span>)  <span class="comment"># {'python', 'redis'}</span>

<span class="comment"># List: Timeline (order matters, duplicates OK)</span>
r.lpush(<span class="string">'timeline'</span>, <span class="string">'post3'</span>, <span class="string">'post2'</span>, <span class="string">'post1'</span>)
recent = r.lrange(<span class="string">'timeline'</span>, <span class="number">0</span>, <span class="number">9</span>)  <span class="comment"># Last 10 posts</span>

<span class="comment"># Sorted Set: Leaderboard (ordered by score)</span>
r.zadd(<span class="string">'leaderboard'</span>, {<span class="string">'Alice'</span>: <span class="number">1000</span>, <span class="string">'Bob'</span>: <span class="number">950</span>, <span class="string">'Carol'</span>: <span class="number">1050</span>})
top3 = r.zrevrange(<span class="string">'leaderboard'</span>, <span class="number">0</span>, <span class="number">2</span>, withscores=<span class="keyword">True</span>)
<span class="comment"># [('Carol', 1050.0), ('Alice', 1000.0), ('Bob', 950.0)]</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: When Hash vs separate String keys?</h4>
                <p><strong>A:</strong> Hash: Related fields queried together (user profile). Strings: Independent values (session tokens). Hash uses less memory (one key overhead vs many) and HGETALL faster than many GETs!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Set vs List - how to choose?</h4>
                <p><strong>A:</strong> Set: Need uniqueness (tags, followers). List: Need order or duplicates (timeline, queue). Set: O(1) membership check. List: O(N) search but O(1) push/pop!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Why use Sorted Set over List for rankings?</h4>
                <p><strong>A:</strong> Sorted Set: Automatic ordering by score, O(log N) insert/update, ZREVRANGE for top-N. List: Must manually sort, no score concept. Sorted Set = built-in rankings!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I change data type of existing key?</h4>
                <p><strong>Answer:</strong> NO! DEL then recreate. Key type is permanent. "user:123" can't be String then Hash. Design carefully upfront!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: 1 million user profiles. Hash or Strings?</h4>
                <p><strong>Answer:</strong> Hashes! 1M hashes uses ~40% less memory than 3M strings (name, email, age per user). Hash ziplist encoding super efficient. Always Hash for objects!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Social Media App Data Modeling</strong></p>
            <p>Need: User profiles, follower lists, post timeline, trending hashtags, post rankings. Which data types?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Mix of Data Types</h4>
                <p><strong>‚úÖ Hash:</strong> user:123 (name, email, bio)<br>
                <strong>‚úÖ Set:</strong> user:123:followers (unique user IDs)<br>
                <strong>‚úÖ List:</strong> user:123:timeline (recent posts, FIFO)<br>
                <strong>‚úÖ Sorted Set:</strong> trending:hashtags (by count)<br>
                <strong>‚úÖ Sorted Set:</strong> posts:ranked (by likes/score)</p>
                <p><strong>Result:</strong> Right tool for each job = optimal performance!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Choose by access pattern</strong> - How you query matters</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¶</span><p><strong>Hash for objects</strong> - Less memory, grouped fields</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî¢</span><p><strong>Set for uniqueness</strong> - No duplicates, fast membership</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Sorted Set for rankings</strong> - Automatic ordering by score</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìù</span><p><strong>List for sequences</strong> - Order matters, queue/stack</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>Type is permanent</strong> - Design carefully upfront!</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Data Types</span><span class="keyword-tag">Hash</span><span class="keyword-tag">Set</span><span class="keyword-tag">Sorted Set</span><span class="keyword-tag">List</span><span class="keyword-tag">Decision</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Storing user profile: name, email, age. Best data type?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) 3 separate String keys</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Hash with 3 fields</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) List with 3 elements</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Set with 3 members</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Hash with 3 fields</strong>
                    <p>Hash perfect for objects with related fields! HSET user:123 name Alice email ... One key vs three, less memory, get all fields with HGETALL. Strings work but wasteful. List/Set wrong - those are collections, not objects!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 52: Redis Performance Optimization
// ============================================================

function getQuestion52Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Production nightmare:</strong> "Redis suddenly slow! KEYS * command taking 5 seconds, blocking everything! Deleting big keys freezes server!" DevOps: "Never use KEYS in production - use SCAN! Never DEL big keys - use UNLINK! Pipeline commands! Use connection pooling! Monitor with SLOWLOG!"</p>
            <p>Performance optimization = 100x faster Redis.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis performance optimization involves: (1) Using non-blocking commands (SCAN not KEYS, UNLINK not DEL), (2) Pipelining multiple commands, (3) Connection pooling, (4) Proper data modeling, (5) Memory optimization, (6) Monitoring with SLOWLOG.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Critical Optimizations</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">‚ùå DON'T</th><th style="padding: 10px;">‚úÖ DO</th><th style="padding: 10px;">Impact</th></tr>
                    <tr><td style="padding: 8px;">KEYS *</td><td>SCAN 0 MATCH *</td><td>No blocking</td></tr>
                    <tr><td style="padding: 8px;">DEL bigkey</td><td>UNLINK bigkey</td><td>Async delete</td></tr>
                    <tr><td style="padding: 8px;">1000 GET calls</td><td>1 pipeline</td><td>100x faster</td></tr>
                    <tr><td style="padding: 8px;">New connection/req</td><td>Connection pool</td><td>No handshake</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Golden Rules:</strong></p>
                <ul>
                    <li><strong>Never block:</strong> SCAN not KEYS, UNLINK not DEL</li>
                    <li><strong>Batch operations:</strong> Pipeline or MGET/MSET</li>
                    <li><strong>Monitor:</strong> SLOWLOG catches slow commands</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Pipeline vs Sequential Commands</div>
                <svg viewBox="0 0 900 380" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">Pipelining: 100x Performance Boost</text>
                    
                    <text x="150" y="60" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">‚ùå Sequential (SLOW)</text>
                    <rect x="50" y="80" width="200" height="220" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    
                    <text x="150" y="110" text-anchor="middle" fill="#FFA500" font-size="11">1000 commands</text>
                    <text x="70" y="135" fill="#bbb" font-size="9">GET key1 ‚Üí wait 1ms</text>
                    <text x="70" y="150" fill="#bbb" font-size="9">GET key2 ‚Üí wait 1ms</text>
                    <text x="70" y="165" fill="#bbb" font-size="9">GET key3 ‚Üí wait 1ms</text>
                    <text x="150" y="185" text-anchor="middle" fill="#888" font-size="9">...</text>
                    <text x="70" y="200" fill="#bbb" font-size="9">GET key1000 ‚Üí wait 1ms</text>
                    
                    <rect x="60" y="220" width="180" height="60" fill="rgba(255,69,0,0.3)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="150" y="245" text-anchor="middle" fill="#FF6347" font-size="12" font-weight="600">Total: 1000ms</text>
                    <text x="150" y="265" text-anchor="middle" fill="#888" font-size="10">(1000 round-trips!)</text>
                    
                    <text x="450" y="170" text-anchor="middle" fill="#DC143C" font-size="24">VS</text>
                    
                    <text x="700" y="60" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">‚úÖ Pipeline (FAST)</text>
                    <rect x="600" y="80" width="200" height="220" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    
                    <text x="700" y="110" text-anchor="middle" fill="#00FF88" font-size="11">1000 commands batched</text>
                    <text x="620" y="135" fill="#bbb" font-size="9">pipe.get('key1')</text>
                    <text x="620" y="150" fill="#bbb" font-size="9">pipe.get('key2')</text>
                    <text x="620" y="165" fill="#bbb" font-size="9">pipe.get('key3')</text>
                    <text x="700" y="185" text-anchor="middle" fill="#888" font-size="9">...</text>
                    <text x="620" y="200" fill="#bbb" font-size="9">pipe.execute() ‚Üê ONE call</text>
                    
                    <rect x="610" y="220" width="180" height="60" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="700" y="245" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Total: ~10ms</text>
                    <text x="700" y="265" text-anchor="middle" fill="#888" font-size="10">(1 round-trip!)</text>
                    
                    <rect x="50" y="320" width="800" height="40" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="345" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">Pipeline = 100x faster! Always batch when possible!</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: SCAN not KEYS</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Non-Blocking Iteration</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
r = redis.Redis()

<span class="comment"># ‚ùå BAD: KEYS blocks entire server!</span>
<span class="comment"># keys = r.keys('user:*')  # DON'T DO THIS IN PRODUCTION!</span>

<span class="comment"># ‚úÖ GOOD: SCAN doesn't block</span>
cursor = <span class="number">0</span>
keys = []
<span class="keyword">while</span> <span class="keyword">True</span>:
    cursor, batch = r.scan(cursor, match=<span class="string">'user:*'</span>, count=<span class="number">100</span>)
    keys.extend(batch)
    <span class="keyword">if</span> cursor == <span class="number">0</span>:
        <span class="keyword">break</span>

<span class="keyword">print</span>(<span class="string">f"Found {len(keys)} keys without blocking!"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Pipeline for Bulk Operations</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - 100x Faster Batch</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis()

<span class="comment"># ‚ùå BAD: 1000 round-trips</span>
start = time.time()
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
    r.set(<span class="string">f'key:{i}'</span>, i)
<span class="keyword">print</span>(<span class="string">f"Sequential: {time.time() - start:.2f}s"</span>)  <span class="comment"># ~1.0s</span>

<span class="comment"># ‚úÖ GOOD: 1 round-trip</span>
start = time.time()
pipe = r.pipeline()
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
    pipe.set(<span class="string">f'key:{i}'</span>, i)
pipe.execute()
<span class="keyword">print</span>(<span class="string">f"Pipeline: {time.time() - start:.2f}s"</span>)  <span class="comment"># ~0.01s (100x faster!)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: UNLINK not DEL</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Async Delete</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
r = redis.Redis()

<span class="comment"># Create big key (10M items)</span>
big_set = <span class="string">'bigkey'</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">10_000_000</span>):
    r.sadd(big_set, i)

<span class="comment"># ‚ùå BAD: DEL blocks for seconds!</span>
<span class="comment"># r.delete(big_set)  # Server frozen!</span>

<span class="comment"># ‚úÖ GOOD: UNLINK is async (instant)</span>
r.unlink(big_set)  <span class="comment"># Returns immediately, deletes in background</span>
<span class="keyword">print</span>(<span class="string">"Deleted without blocking!"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 4: Connection Pooling</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Reuse Connections</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

<span class="comment"># ‚ùå BAD: New connection each time</span>
<span class="comment"># r = redis.Redis()  # Creates new connection!</span>

<span class="comment"># ‚úÖ GOOD: Connection pool (reuse)</span>
pool = redis.ConnectionPool(
    host=<span class="string">'localhost'</span>,
    port=<span class="number">6379</span>,
    max_connections=<span class="number">50</span>,  <span class="comment"># Pool size</span>
    decode_responses=<span class="keyword">True</span>
)

r = redis.Redis(connection_pool=pool)

<span class="comment"># All requests reuse pooled connections</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
    r.get(<span class="string">f'key:{i}'</span>)  <span class="comment"># No connection overhead!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why is KEYS * so dangerous in production?</h4>
                <p><strong>A:</strong> KEYS blocks Redis (single-threaded!) while scanning ALL keys. 1M keys = server frozen for seconds. ALL clients blocked. Use SCAN (iterates without blocking)!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: When to use pipeline vs MGET?</h4>
                <p><strong>A:</strong> MGET: Multiple GETs only. Pipeline: ANY commands mixed (SET, GET, ZADD). Pipeline more flexible. Both reduce round-trips!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: How to find slow commands?</h4>
                <p><strong>A:</strong> SLOWLOG GET 10 shows slowest commands. Configure slowlog-log-slower-than (microseconds). Monitor which commands need optimization!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Pipeline guarantees atomicity?</h4>
                <p><strong>Answer:</strong> NO! Pipeline batches network round-trips but commands NOT atomic. For atomicity use MULTI/EXEC or Lua script. Pipeline = performance, MULTI = atomicity!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: UNLINK always better than DEL?</h4>
                <p><strong>Answer:</strong> Almost! UNLINK async (non-blocking) for big keys. Small keys: DEL fine. Rule: UNLINK for keys >1MB or >10K items. Monitor memory to detect big keys!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Cache Optimization</strong></p>
            <p>Problem: Loading 100 products takes 100ms (1ms per GET). Deleting expired cache freezes server. How to optimize?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Multiple Optimizations</h4>
                <p><strong>1. Pipeline reads:</strong> pipe.get() 100 products ‚Üí 1ms total (100x faster!)<br>
                <strong>2. UNLINK for deletes:</strong> Expired cache deleted async<br>
                <strong>3. Connection pool:</strong> 50 connections reused<br>
                <strong>4. SCAN for cleanup:</strong> Find expired keys without blocking</p>
                <p><strong>Result:</strong> ‚úÖ 100ms ‚Üí 1ms page load ‚úÖ No server freezes ‚úÖ Happy customers!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Never KEYS</strong> - Always SCAN (non-blocking)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üöÄ</span><p><strong>Pipeline everything</strong> - Batch commands, 100x faster</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üóëÔ∏è</span><p><strong>UNLINK big keys</strong> - Async delete, no blocking</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Connection pooling</strong> - Reuse connections</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor SLOWLOG</strong> - Find performance bottlenecks</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Benchmark</strong> - Measure before/after optimizations</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Performance</span><span class="keyword-tag">Pipeline</span><span class="keyword-tag">SCAN</span><span class="keyword-tag">UNLINK</span><span class="keyword-tag">Optimization</span><span class="keyword-tag">SLOWLOG</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Loading 1000 keys takes 1 second. How to make it 100x faster?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Use KEYS instead of GET</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Use pipeline to batch GETs</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Add more RAM</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Use MULTI/EXEC</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Use pipeline</strong>
                    <p>Pipeline batches 1000 GETs into ONE round-trip! 1000 separate GETs = 1000ms network overhead. Pipeline = ~10ms total. 100x faster! KEYS wrong (not for loading values). RAM doesn't help (network is bottleneck). MULTI/EXEC adds overhead. Pipeline = THE optimization for bulk reads!</p>
                </div>
            </div>
        </div>
    `;
}




// ============================================================
// QUESTION 53: Redis Security Best Practices
// ============================================================

function getQuestion53Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Security breach:</strong> "Redis exposed to internet with no password! Attacker executed FLUSHALL, wiped entire database! CONFIG GET dumped all data!" CISO: "Enable AUTH! Bind to private IP only! Disable dangerous commands! Use ACL for fine-grained permissions! Enable TLS for network encryption!"</p>
            <p>Security = first line of defense.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis security involves: (1) Authentication (requirepass/ACL), (2) Network security (bind address, protected mode, firewall), (3) Command filtering (rename/disable dangerous commands), (4) Encryption (TLS/SSL), (5) Running as non-root user.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Security Layers</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Layer</th><th style="padding: 10px;">Protection</th><th style="padding: 10px;">How</th></tr>
                    <tr><td style="padding: 8px;">Authentication</td><td>Password/ACL</td><td>requirepass, ACL SETUSER</td></tr>
                    <tr><td style="padding: 8px;">Network</td><td>Limit access</td><td>bind 127.0.0.1, firewall</td></tr>
                    <tr><td style="padding: 8px;">Commands</td><td>Disable dangerous</td><td>rename-command FLUSHALL ""</td></tr>
                    <tr><td style="padding: 8px;">Encryption</td><td>TLS/SSL</td><td>tls-port 6379</td></tr>
                    <tr><td style="padding: 8px;">User</td><td>Non-root</td><td>Run as redis user</td></tr>
                </table>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border-left: 3px solid #FF6347; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>‚ö†Ô∏è Common Vulnerabilities:</strong></p>
                <ul>
                    <li><strong>No password:</strong> Default Redis has NO auth (wide open!)</li>
                    <li><strong>Bind 0.0.0.0:</strong> Exposed to internet</li>
                    <li><strong>Dangerous commands enabled:</strong> FLUSHALL, CONFIG, KEYS</li>
                    <li><strong>No encryption:</strong> Data transmitted in clear text</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Redis Security Layers</div>
                <svg viewBox="0 0 900 450" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Defense in Depth: Multiple Security Layers</text>
                    
                    <!-- Layer 1: Network -->
                    <rect x="100" y="60" width="700" height="70" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="3" rx="8"/>
                    <text x="450" y="85" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">üåê Layer 1: Network Security</text>
                    <text x="450" y="105" text-anchor="middle" fill="#888" font-size="10">bind 127.0.0.1 (private only) | Firewall rules | protected-mode yes</text>
                    
                    <!-- Layer 2: Authentication -->
                    <rect x="130" y="140" width="640" height="70" fill="rgba(255,165,0,0.1)" stroke="#FFA500" stroke-width="3" rx="8"/>
                    <text x="450" y="165" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">üîê Layer 2: Authentication</text>
                    <text x="450" y="185" text-anchor="middle" fill="#888" font-size="10">requirepass strong_password | ACL for fine-grained permissions</text>
                    
                    <!-- Layer 3: Command Filtering -->
                    <rect x="160" y="220" width="580" height="70" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="245" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">‚ö° Layer 3: Command Filtering</text>
                    <text x="450" y="265" text-anchor="middle" fill="#888" font-size="10">Disable/rename: FLUSHALL, CONFIG, KEYS, DEBUG</text>
                    
                    <!-- Layer 4: Encryption -->
                    <rect x="190" y="300" width="520" height="70" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="450" y="325" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üîí Layer 4: TLS/SSL Encryption</text>
                    <text x="450" y="345" text-anchor="middle" fill="#888" font-size="10">tls-port 6379 | tls-cert-file | tls-key-file</text>
                    
                    <!-- Core Redis -->
                    <rect x="350" y="380" width="200" height="50" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="410" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="600">üõ°Ô∏è Protected Redis</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Authentication</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - Password Protection</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Set password (Redis 5.x and earlier)</span>
<span class="keyword">requirepass</span> <span class="string">YourStrongPassword123!@#</span>

<span class="comment"># Bind to localhost only (not internet!)</span>
<span class="keyword">bind</span> <span class="number">127.0.0.1</span>

<span class="comment"># Protected mode (rejects external connections without AUTH)</span>
<span class="keyword">protected-mode</span> yes

<span class="comment"># Connect with password</span>
redis-cli -a <span class="string">YourStrongPassword123!@#</span>

<span class="comment"># Or authenticate after connecting</span>
<span class="keyword">AUTH</span> <span class="string">YourStrongPassword123!@#</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: ACL (Redis 6+)</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Fine-Grained Permissions</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Create read-only user</span>
<span class="keyword">ACL SETUSER</span> readonly on ><span class="string">password123</span> ~* +<span class="keyword">@read</span> -<span class="keyword">@write</span> -<span class="keyword">@dangerous</span>

<span class="comment"># Create app user (limited commands)</span>
<span class="keyword">ACL SETUSER</span> webapp on ><span class="string">apppass456</span> ~cache:* +<span class="keyword">get</span> +<span class="keyword">set</span> +<span class="keyword">del</span> +<span class="keyword">expire</span>

<span class="comment"># Admin user (full access)</span>
<span class="keyword">ACL SETUSER</span> admin on ><span class="string">adminpass789</span> ~* +<span class="keyword">@all</span>

<span class="comment"># List users</span>
<span class="keyword">ACL LIST</span>

<span class="comment"># Test authentication</span>
<span class="keyword">AUTH</span> webapp <span class="string">apppass456</span>
<span class="keyword">SET</span> cache:user:123 <span class="string">"data"</span>  <span class="comment"># ‚úÖ Allowed</span>
<span class="keyword">FLUSHALL</span>  <span class="comment"># ‚ùå Denied (not in allowed commands)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Disable Dangerous Commands</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - Command Filtering</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Disable FLUSHALL (wipes entire DB!)</span>
<span class="keyword">rename-command</span> FLUSHALL <span class="string">""</span>

<span class="comment"># Disable FLUSHDB</span>
<span class="keyword">rename-command</span> FLUSHDB <span class="string">""</span>

<span class="comment"># Disable CONFIG (exposes settings)</span>
<span class="keyword">rename-command</span> CONFIG <span class="string">""</span>

<span class="comment"># Disable KEYS (blocks server)</span>
<span class="keyword">rename-command</span> KEYS <span class="string">""</span>

<span class="comment"># Disable DEBUG</span>
<span class="keyword">rename-command</span> DEBUG <span class="string">""</span>

<span class="comment"># Or rename to secret (obscurity, not security)</span>
<span class="keyword">rename-command</span> FLUSHALL <span class="string">secret_flush_XyZ123</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 4: Python with AUTH</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Secure Connection</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

<span class="comment"># Connect with password</span>
r = redis.Redis(
    host=<span class="string">'localhost'</span>,
    port=<span class="number">6379</span>,
    password=<span class="string">'YourStrongPassword123!@#'</span>,
    decode_responses=<span class="keyword">True</span>
)

<span class="comment"># ACL authentication (Redis 6+)</span>
r = redis.Redis(
    host=<span class="string">'localhost'</span>,
    port=<span class="number">6379</span>,
    username=<span class="string">'webapp'</span>,
    password=<span class="string">'apppass456'</span>,
    decode_responses=<span class="keyword">True</span>
)

<span class="comment"># TLS connection</span>
r = redis.Redis(
    host=<span class="string">'redis.example.com'</span>,
    port=<span class="number">6380</span>,
    password=<span class="string">'password'</span>,
    ssl=<span class="keyword">True</span>,
    ssl_cert_reqs=<span class="string">'required'</span>,
    ssl_ca_certs=<span class="string">'/path/to/ca.crt'</span>
)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: What's protected mode in Redis?</h4>
                <p><strong>A:</strong> Default security feature! Rejects external connections unless: (1) bind is localhost only OR (2) password is set. Protects against accidental internet exposure. Disable only if you have firewall!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: ACL vs requirepass - which to use?</h4>
                <p><strong>A:</strong> ACL (Redis 6+) better! Fine-grained permissions per user (read-only, specific keys, command filtering). requirepass: single password, all-or-nothing. Production: Use ACL!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Is renaming commands true security?</h4>
                <p><strong>A:</strong> NO! Security by obscurity. Attacker with access can still discover renamed commands. Real security: ACL to deny commands entirely + network isolation + strong auth!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Redis with password on public internet - safe?</h4>
                <p><strong>Answer:</strong> NO! Password helps but not enough. Risk: brute force attacks, DoS, protocol vulnerabilities. Always: (1) Private network/VPN, (2) Firewall, (3) Password, (4) TLS. Never expose Redis directly to internet!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I change password without restart?</h4>
                <p><strong>Answer:</strong> YES! CONFIG SET requirepass newpassword (runtime). But: Current connections keep old auth. New connections need new password. For ACL: ACL SETUSER updates immediately!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Production Security Checklist</strong></p>
            <p>E-commerce site launching. Redis stores sessions, cart data. How to secure?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Layered Security</h4>
                <p><strong>Network:</strong> ‚úÖ bind 127.0.0.1 (app server only) ‚úÖ Firewall rules ‚úÖ VPC/private network<br>
                <strong>Auth:</strong> ‚úÖ ACL with app-specific user ‚úÖ Strong password (32+ chars) ‚úÖ Rotate passwords quarterly<br>
                <strong>Commands:</strong> ‚úÖ Disable FLUSHALL, CONFIG, KEYS ‚úÖ App user: only GET/SET/DEL/EXPIRE<br>
                <strong>Encryption:</strong> ‚úÖ TLS for data in transit ‚úÖ Encrypted backups<br>
                <strong>Monitoring:</strong> ‚úÖ Failed auth attempts ‚úÖ Unusual commands ‚úÖ Connection from unexpected IPs</p>
                <p><strong>Result:</strong> Zero security incidents in production! üõ°Ô∏è</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîê</span><p><strong>Always use AUTH</strong> - Password or ACL (never default!)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåê</span><p><strong>Private network only</strong> - bind 127.0.0.1, firewall</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Disable dangerous commands</strong> - FLUSHALL, CONFIG, KEYS</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>Use TLS</strong> - Encrypt network traffic</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üë§</span><p><strong>ACL for granular control</strong> - Per-user permissions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Defense in depth</strong> - Multiple security layers</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Security</span><span class="keyword-tag">AUTH</span><span class="keyword-tag">ACL</span><span class="keyword-tag">requirepass</span><span class="keyword-tag">TLS</span><span class="keyword-tag">protected-mode</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Redis exposed to internet with no password. First security step?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Enable TLS encryption</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) Rename dangerous commands</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">C) Set requirepass + bind to private IP</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Install firewall</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: C - requirepass + bind to private IP</strong>
                    <p>IMMEDIATE action: Set password (requirepass) + bind to 127.0.0.1 or private IP. Blocks unauthorized access instantly! TLS good but won't stop unauthorized connections. Renaming commands is obscurity, not security. Firewall important but after basic auth. First priority: authentication + network restriction!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 54: Redis Monitoring and Observability
// ============================================================

function getQuestion54Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Production issue:</strong> "Redis suddenly slow but we don't know why! Memory usage spiking! Which commands are slow?" DevOps: "Check INFO memory for usage, SLOWLOG for slow commands, CLIENT LIST for connections, redis-cli --bigkeys for large keys! Monitor hit rate, evictions, memory fragmentation!"</p>
            <p>Monitoring = know before users complain.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis monitoring involves tracking: (1) Performance metrics (commands/sec, latency), (2) Memory usage (used_memory, fragmentation), (3) Hit rate (cache efficiency), (4) Slow commands (SLOWLOG), (5) Client connections, (6) Replication lag.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Key Monitoring Commands</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Command</th><th style="padding: 10px;">What It Shows</th><th style="padding: 10px;">Critical Metrics</th></tr>
                    <tr><td style="padding: 8px;">INFO memory</td><td>Memory stats</td><td>used_memory_rss, fragmentation_ratio</td></tr>
                    <tr><td style="padding: 8px;">INFO stats</td><td>Performance</td><td>ops/sec, hit rate, evicted_keys</td></tr>
                    <tr><td style="padding: 8px;">SLOWLOG GET</td><td>Slow commands</td><td>Execution time, command details</td></tr>
                    <tr><td style="padding: 8px;">CLIENT LIST</td><td>Connections</td><td>Connected clients, idle time</td></tr>
                    <tr><td style="padding: 8px;">INFO replication</td><td>Replication lag</td><td>master_repl_offset vs slave</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Critical Metrics to Monitor:</strong></p>
                <ul>
                    <li><strong>Hit Rate:</strong> keyspace_hits / (hits + misses) - should be >80%</li>
                    <li><strong>Memory:</strong> used_memory_rss - watch for growth</li>
                    <li><strong>Evictions:</strong> evicted_keys - high = need more memory</li>
                    <li><strong>Connections:</strong> connected_clients - watch for leaks</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Redis Monitoring Dashboard</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">Key Metrics to Monitor</text>
                    
                    <rect x="50" y="50" width="250" height="80" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="175" y="75" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üìä Performance</text>
                    <text x="70" y="95" fill="#bbb" font-size="10">Commands/sec: 10,000</text>
                    <text x="70" y="110" fill="#bbb" font-size="10">Latency: 0.5ms avg</text>
                    <text x="70" y="125" fill="#00FF88" font-size="10">Hit Rate: 92% ‚úÖ</text>
                    
                    <rect x="325" y="50" width="250" height="80" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="450" y="75" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">üíæ Memory</text>
                    <text x="345" y="95" fill="#bbb" font-size="10">Used: 2.4 GB / 4 GB</text>
                    <text x="345" y="110" fill="#bbb" font-size="10">Fragmentation: 1.3</text>
                    <text x="345" y="125" fill="#FFA500" font-size="10">Evicted: 1,200 ‚ö†Ô∏è</text>
                    
                    <rect x="600" y="50" width="250" height="80" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="725" y="75" text-anchor="middle" fill="#9C27B0" font-size="13" font-weight="600">üîå Connections</text>
                    <text x="620" y="95" fill="#bbb" font-size="10">Connected: 45 / 10,000</text>
                    <text x="620" y="110" fill="#bbb" font-size="10">Blocked: 0</text>
                    <text x="620" y="125" fill="#00FF88" font-size="10">No leaks ‚úÖ</text>
                    
                    <rect x="50" y="150" width="400" height="90" fill="rgba(255,165,0,0.1)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="250" y="175" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">üêå Slow Commands (SLOWLOG)</text>
                    <text x="70" y="195" fill="#bbb" font-size="9">1. KEYS * - 5.2s (‚ùå blocked server!)</text>
                    <text x="70" y="210" fill="#bbb" font-size="9">2. ZRANGE big_set 0 -1 - 2.1s</text>
                    <text x="70" y="225" fill="#bbb" font-size="9">3. HGETALL large_hash - 1.8s</text>
                    
                    <rect x="475" y="150" width="375" height="90" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="662" y="175" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üìà Trends</text>
                    <text x="495" y="195" fill="#00FF88" font-size="9">‚úÖ Memory stable (no leaks)</text>
                    <text x="495" y="210" fill="#FFA500" font-size="9">‚ö†Ô∏è Evictions increasing (add RAM)</text>
                    <text x="495" y="225" fill="#DC143C" font-size="9">‚ùå KEYS usage (fix app code!)</text>
                    
                    <rect x="50" y="260" width="800" height="120" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="285" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">Monitoring Tools</text>
                    
                    <text x="70" y="310" fill="#00FF88" font-size="11" font-weight="600">redis-cli --stat:</text>
                    <text x="80" y="325" fill="#bbb" font-size="10">Real-time stats (ops/sec, hit rate)</text>
                    
                    <text x="70" y="345" fill="#9C27B0" font-size="11" font-weight="600">redis-cli --bigkeys:</text>
                    <text x="80" y="360" fill="#bbb" font-size="10">Find largest keys (memory hogs)</text>
                    
                    <text x="450" y="310" fill="#FFA500" font-size="11" font-weight="600">RedisInsight:</text>
                    <text x="460" y="325" fill="#bbb" font-size="10">GUI dashboard, profiling</text>
                    
                    <text x="450" y="345" fill="#DC143C" font-size="11" font-weight="600">Prometheus/Grafana:</text>
                    <text x="460" y="360" fill="#bbb" font-size="10">Time-series monitoring, alerts</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: INFO Command</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Get Metrics</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Memory metrics</span>
<span class="keyword">INFO</span> memory
used_memory_human:<span class="number">2.40G</span>
used_memory_rss_human:<span class="number">3.10G</span>
mem_fragmentation_ratio:<span class="number">1.29</span>
maxmemory_human:<span class="number">4.00G</span>

<span class="comment"># Performance metrics</span>
<span class="keyword">INFO</span> stats
instantaneous_ops_per_sec:<span class="number">10543</span>
keyspace_hits:<span class="number">920000</span>
keyspace_misses:<span class="number">80000</span>
evicted_keys:<span class="number">1200</span>

<span class="comment"># Calculate hit rate</span>
<span class="comment"># 920000 / (920000 + 80000) = 92% ‚úÖ</span>

<span class="comment"># Replication metrics</span>
<span class="keyword">INFO</span> replication
role:master
connected_slaves:<span class="number">2</span>
master_repl_offset:<span class="number">123456789</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: SLOWLOG</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis CLI - Find Slow Commands</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Get last 10 slow commands</span>
<span class="keyword">SLOWLOG GET</span> <span class="number">10</span>

<span class="comment"># Example output:</span>
<span class="number">1)</span> <span class="number">1)</span> <span class="number">(integer) 123</span>     <span class="comment"># Log ID</span>
   <span class="number">2)</span> <span class="number">(integer) 1704067200</span> <span class="comment"># Timestamp</span>
   <span class="number">3)</span> <span class="number">(integer) 5200000</span>   <span class="comment"># 5.2 seconds!</span>
   <span class="number">4)</span> <span class="number">1)</span> <span class="string">"KEYS"</span>
      <span class="number">2)</span> <span class="string">"*"</span>

<span class="comment"># Configure slowlog threshold (microseconds)</span>
<span class="keyword">CONFIG SET</span> slowlog-log-slower-than <span class="number">10000</span>  <span class="comment"># 10ms</span>

<span class="comment"># See slowlog length</span>
<span class="keyword">SLOWLOG LEN</span>

<span class="comment"># Clear slowlog</span>
<span class="keyword">SLOWLOG RESET</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Python Monitoring</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Automated Monitoring</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis()

<span class="keyword">def</span> <span class="function">monitor_redis</span>():
    info = r.info()
    
    <span class="comment"># Memory usage</span>
    used_memory_gb = info[<span class="string">'used_memory'</span>] / <span class="number">1024</span>**<span class="number">3</span>
    <span class="keyword">print</span>(<span class="string">f"Memory: {used_memory_gb:.2f} GB"</span>)
    
    <span class="comment"># Hit rate</span>
    hits = info[<span class="string">'keyspace_hits'</span>]
    misses = info[<span class="string">'keyspace_misses'</span>]
    hit_rate = hits / (hits + misses) <span class="keyword">if</span> (hits + misses) > <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>
    <span class="keyword">print</span>(<span class="string">f"Hit Rate: {hit_rate*100:.1f}%"</span>)
    
    <span class="comment"># Evictions</span>
    evicted = info[<span class="string">'evicted_keys'</span>]
    <span class="keyword">if</span> evicted > <span class="number">1000</span>:
        <span class="keyword">print</span>(<span class="string">f"‚ö†Ô∏è HIGH EVICTIONS: {evicted}"</span>)
    
    <span class="comment"># Connected clients</span>
    clients = info[<span class="string">'connected_clients'</span>]
    <span class="keyword">print</span>(<span class="string">f"Clients: {clients}"</span>)
    
    <span class="comment"># Slow commands</span>
    slowlog = r.slowlog_get(<span class="number">5</span>)
    <span class="keyword">if</span> slowlog:
        <span class="keyword">print</span>(<span class="string">"\\nSlow commands:"</span>)
        <span class="keyword">for</span> entry <span class="keyword">in</span> slowlog:
            duration_ms = entry[<span class="string">'duration'</span>] / <span class="number">1000</span>
            <span class="keyword">print</span>(<span class="string">f"  {entry['command']} - {duration_ms}ms"</span>)

<span class="keyword">while</span> <span class="keyword">True</span>:
    monitor_redis()
    time.sleep(<span class="number">60</span>)  <span class="comment"># Check every minute</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 4: redis-cli Tools</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Bash - CLI Monitoring Tools</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Real-time stats</span>
redis-cli --stat
<span class="comment"># Shows: ops/sec, hit rate, memory every second</span>

<span class="comment"># Find biggest keys</span>
redis-cli --bigkeys
<span class="comment"># Scans DB, reports largest keys by type</span>

<span class="comment"># Memory analysis</span>
redis-cli --memkeys
<span class="comment"># Shows memory usage per key pattern</span>

<span class="comment"># Monitor commands in real-time</span>
redis-cli MONITOR
<span class="comment"># Shows every command (performance impact!)</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: What's a good cache hit rate?</h4>
                <p><strong>A:</strong> 80%+ good, 90%+ excellent! Low hit rate = cache not helping, wasting memory. Calculate: keyspace_hits / (hits + misses). Below 80%? Review TTLs and eviction policy!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What is memory fragmentation ratio?</h4>
                <p><strong>A:</strong> used_memory_rss / used_memory. Ideal: ~1.0-1.5. >2.0 = fragmentation (Redis allocated but not using efficiently). Fix: Restart Redis to defragment!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: When to worry about evicted_keys?</h4>
                <p><strong>A:</strong> If growing rapidly! Some eviction normal (cache full). But high evictions = need more memory or lower TTLs. Monitor trend: stable OK, increasing = action needed!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: MONITOR command safe in production?</h4>
                <p><strong>Answer:</strong> NO! MONITOR shows EVERY command in real-time = massive performance hit. Use only for debugging in dev/staging. Production: Use SLOWLOG or sampling tools instead!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: used_memory vs used_memory_rss - which matters?</h4>
                <p><strong>Answer:</strong> Both! used_memory = Redis's view. used_memory_rss = OS's view (actual RAM). RSS includes fragmentation. Monitor RSS for OOM kills, compare ratio for fragmentation!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Production Monitoring Dashboard</strong></p>
            <p>E-commerce site: Redis suddenly slow at peak traffic. How to diagnose?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Monitoring-Driven Debug</h4>
                <p><strong>1. Check SLOWLOG:</strong> Found KEYS * command (5 seconds!) from legacy cron job<br>
                <strong>2. Check INFO memory:</strong> 95% memory used, evictions spiking<br>
                <strong>3. Check --bigkeys:</strong> Found 50MB key (old analytics data)<br>
                <strong>4. Check CLIENT LIST:</strong> 500 idle connections (connection leak!)</p>
                <p><strong>Fixes:</strong> ‚úÖ Replace KEYS with SCAN ‚úÖ Delete old big key ‚úÖ Fix connection pool ‚úÖ Add 2GB RAM</p>
                <p><strong>Result:</strong> Latency: 5s ‚Üí 2ms! Problem solved in 20 minutes! üéØ</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>INFO command</strong> - Memory, stats, replication metrics</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üêå</span><p><strong>SLOWLOG</strong> - Find performance bottlenecks</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Hit rate >80%</strong> - Cache effectiveness measure</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>Monitor evictions</strong> - Growing = need more RAM</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîç</span><p><strong>--bigkeys</strong> - Find memory hogs</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìà</span><p><strong>Trend watching</strong> - Catch issues before crisis</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Monitoring</span><span class="keyword-tag">INFO</span><span class="keyword-tag">SLOWLOG</span><span class="keyword-tag">Hit Rate</span><span class="keyword-tag">Memory</span><span class="keyword-tag">Metrics</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Redis slow but don't know why. First diagnostic command?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) MONITOR (see all commands)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) SLOWLOG GET (find slow commands)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) KEYS * (count keys)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) FLUSHALL (restart fresh)</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - SLOWLOG GET</strong>
                    <p>SLOWLOG shows which commands are slow without impacting performance! Safe in production. MONITOR kills performance (shows ALL commands). KEYS blocks server. FLUSHALL deletes data! Start with SLOWLOG, then INFO for memory/stats, then --bigkeys for large keys!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 55: Redis Backup and Disaster Recovery
// ============================================================

function getQuestion55Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Disaster strikes:</strong> "Server crashed! Redis data lost! No backups!" CTO: "We need backup strategy! Daily RDB snapshots to S3! AOF for point-in-time recovery! Keep multiple backup generations! Test recovery regularly! Replicas as live backups!"</p>
            <p>Backup = insurance policy you hope never to use.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis backup strategies include: (1) RDB snapshots (periodic full backups), (2) AOF logs (continuous append-only logs), (3) Replication (live backups via replicas), (4) Cloud storage (S3/GCS for off-site backups), (5) Testing recovery procedures.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Backup Methods Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Method</th><th style="padding: 10px;">Pros</th><th style="padding: 10px;">Cons</th></tr>
                    <tr><td style="padding: 8px;">RDB Snapshot</td><td>Fast restore, compact</td><td>Point-in-time only, may lose data</td></tr>
                    <tr><td style="padding: 8px;">AOF Log</td><td>Minimal data loss, replay</td><td>Larger files, slower restore</td></tr>
                    <tr><td style="padding: 8px;">Replica</td><td>Live backup, instant failover</td><td>Same bugs affect both</td></tr>
                    <tr><td style="padding: 8px;">Cloud Storage</td><td>Off-site, disaster recovery</td><td>Restore time (network)</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Best Practice Strategy:</strong></p>
                <ul>
                    <li><strong>Daily RDB</strong> snapshots ‚Üí S3/cloud storage</li>
                    <li><strong>AOF enabled</strong> for minimal data loss</li>
                    <li><strong>Replicas</strong> for instant failover</li>
                    <li><strong>Keep 7 daily</strong> + 4 weekly backups</li>
                    <li><strong>Test recovery</strong> quarterly!</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Backup & Recovery Strategy</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">3-2-1 Backup Strategy</text>
                    
                    <rect x="350" y="50" width="200" height="60" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="80" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">üñ•Ô∏è Primary Redis</text>
                    <text x="450" y="95" text-anchor="middle" fill="#888" font-size="10">RDB + AOF enabled</text>
                    
                    <path d="M 350 85 L 220 140" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <path d="M 450 110 L 450 150" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    <path d="M 550 85 L 680 140" stroke="#FFA500" stroke-width="2" marker-end="url(#arrowOrange)"/>
                    
                    <rect x="80" y="140" width="160" height="70" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="160" y="165" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">üíæ RDB Backup</text>
                    <text x="160" y="182" text-anchor="middle" fill="#888" font-size="9">dump.rdb</text>
                    <text x="160" y="197" text-anchor="middle" fill="#888" font-size="9">Daily @ 2 AM</text>
                    
                    <rect x="370" y="140" width="160" height="70" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="450" y="165" text-anchor="middle" fill="#9C27B0" font-size="12" font-weight="600">üìù AOF Log</text>
                    <text x="450" y="182" text-anchor="middle" fill="#888" font-size="9">appendonly.aof</text>
                    <text x="450" y="197" text-anchor="middle" fill="#888" font-size="9">Continuous</text>
                    
                    <rect x="660" y="140" width="160" height="70" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="740" y="165" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">üîÑ Replica</text>
                    <text x="740" y="182" text-anchor="middle" fill="#888" font-size="9">Live backup</text>
                    <text x="740" y="197" text-anchor="middle" fill="#888" font-size="9">Real-time sync</text>
                    
                    <path d="M 160 210 L 160 250" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    
                    <rect x="80" y="250" width="160" height="60" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="160" y="275" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">‚òÅÔ∏è Cloud Storage</text>
                    <text x="160" y="292" text-anchor="middle" fill="#888" font-size="9">S3/GCS</text>
                    <text x="160" y="305" text-anchor="middle" fill="#888" font-size="9">7 daily + 4 weekly</text>
                    
                    <rect x="50" y="340" width="800" height="70" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="365" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">Recovery Scenarios</text>
                    <text x="70" y="385" fill="#00FF88" font-size="10">‚úÖ Recent crash: Restart ‚Üí AOF replays</text>
                    <text x="70" y="400" fill="#9C27B0" font-size="10">‚úÖ Data corruption: Restore from RDB backup</text>
                    <text x="450" y="385" fill="#FFA500" font-size="10">‚úÖ Server failure: Promote replica</text>
                    <text x="450" y="400" fill="#DC143C" font-size="10">‚úÖ Disaster: Download from S3, restore</text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                        <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#FFA500" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: RDB Snapshot Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - Automatic Snapshots</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Save RDB snapshots automatically</span>
<span class="keyword">save</span> <span class="number">900 1</span>    <span class="comment"># Save if 1 change in 15 min</span>
<span class="keyword">save</span> <span class="number">300 10</span>   <span class="comment"># Save if 10 changes in 5 min</span>
<span class="keyword">save</span> <span class="number">60 10000</span> <span class="comment"># Save if 10000 changes in 1 min</span>

<span class="comment"># RDB file location</span>
<span class="keyword">dbfilename</span> dump.rdb
<span class="keyword">dir</span> /var/lib/redis

<span class="comment"># Compression</span>
<span class="keyword">rdbcompression</span> yes

<span class="comment"># Manual snapshot</span>
<span class="keyword">SAVE</span>      <span class="comment"># Blocks server (use BGSAVE!)</span>
<span class="keyword">BGSAVE</span>    <span class="comment"># Background save (non-blocking)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: AOF Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - AOF Setup</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Enable AOF</span>
<span class="keyword">appendonly</span> yes
<span class="keyword">appendfilename</span> <span class="string">"appendonly.aof"</span>

<span class="comment"># Sync strategy</span>
<span class="keyword">appendfsync</span> everysec  <span class="comment"># Balanced (recommended)</span>
<span class="comment"># appendfsync always    # Safest, slowest</span>
<span class="comment"># appendfsync no        # Fastest, least safe</span>

<span class="comment"># Auto-rewrite when AOF gets big</span>
<span class="keyword">auto-aof-rewrite-percentage</span> <span class="number">100</span>
<span class="keyword">auto-aof-rewrite-min-size</span> <span class="number">64mb</span>

<span class="comment"># Manual rewrite</span>
<span class="keyword">BGREWRITEAOF</span>  <span class="comment"># Compact AOF file</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Backup to S3</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Bash - Daily Backup Script</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment">#!/bin/bash</span>
<span class="comment"># Daily Redis backup to S3</span>

DATE=$(<span class="function">date</span> +<span class="string">"%Y%m%d"</span>)
BACKUP_FILE=<span class="string">"redis-backup-$DATE.rdb"</span>

<span class="comment"># Trigger background save</span>
redis-cli BGSAVE

<span class="comment"># Wait for save to complete</span>
<span class="keyword">while</span> [ $(redis-cli LASTSAVE) == $LAST_SAVE ]; <span class="keyword">do</span>
    <span class="function">sleep</span> <span class="number">1</span>
<span class="keyword">done</span>

<span class="comment"># Copy to S3</span>
aws s3 cp /var/lib/redis/dump.rdb \
    s3://my-backups/redis/$BACKUP_FILE

<span class="comment"># Keep only last 7 daily backups</span>
aws s3 ls s3://my-backups/redis/ | \
    <span class="function">sort</span> -r | <span class="function">tail</span> -n +8 | \
    <span class="keyword">while</span> <span class="function">read</span> -r line; <span class="keyword">do</span>
        file=$(<span class="function">echo</span> $line | <span class="function">awk</span> <span class="string">'{print $4}'</span>)
        aws s3 rm s3://my-backups/redis/$file
    <span class="keyword">done</span>

<span class="function">echo</span> <span class="string">"‚úÖ Backup complete: $BACKUP_FILE"</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 4: Recovery</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Bash - Restore from Backup</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment">#!/bin/bash</span>
<span class="comment"># Restore Redis from S3 backup</span>

<span class="comment"># Stop Redis</span>
systemctl stop redis

<span class="comment"># Download backup</span>
aws s3 cp s3://my-backups/redis/redis-backup-20240115.rdb \
    /var/lib/redis/dump.rdb

<span class="comment"># Set permissions</span>
<span class="function">chown</span> redis:redis /var/lib/redis/dump.rdb

<span class="comment"># Start Redis (auto-loads dump.rdb)</span>
systemctl start redis

<span class="comment"># Verify</span>
redis-cli PING
<span class="comment"># Expected: PONG</span>

<span class="function">echo</span> <span class="string">"‚úÖ Recovery complete!"</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: RDB vs AOF - which to use for backups?</h4>
                <p><strong>A:</strong> Both! RDB for fast restore, compact files. AOF for minimal data loss (can lose only seconds). Production: RDB daily to S3 + AOF for protection. Best of both worlds!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: How much data can you lose with AOF everysec?</h4>
                <p><strong>A:</strong> Max 1 second of data! AOF writes buffer to disk every second. Crash = lose commands in last second only. appendfsync always = zero loss but slower. everysec = best balance!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Replica as backup - good idea?</h4>
                <p><strong>A:</strong> Yes AND no! Replica great for failover (instant). But: Software bugs affect master AND replica. Human error (FLUSHALL) replicates! Need offline backups (RDB to S3) too!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I restore from AOF if Redis crashes mid-write?</h4>
                <p><strong>Answer:</strong> YES! Redis checks AOF integrity on startup. Incomplete last command? Redis can auto-fix or you can use redis-check-aof --fix. AOF designed for crash resilience!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Both RDB and AOF exist - which loads?</h4>
                <p><strong>Answer:</strong> AOF takes priority! More recent data. Redis ignores RDB if AOF present. To force RDB: Temporarily disable AOF (appendonly no) in config!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Disaster Recovery Plan</strong></p>
            <p>Hosting provider has data center fire. All servers lost. Redis data critical (user carts, sessions). How to recover?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: 3-2-1 Backup Strategy</h4>
                <p><strong>3 copies:</strong> Primary + Replica + S3 backup<br>
                <strong>2 media:</strong> Local disk + Cloud storage<br>
                <strong>1 off-site:</strong> S3 in different region</p>
                <p><strong>Recovery Steps:</strong><br>
                1. Spin up new Redis server (5 minutes)<br>
                2. Download latest RDB from S3 (2 minutes)<br>
                3. Start Redis with dump.rdb (1 minute)<br>
                4. Total downtime: 8 minutes!</p>
                <p><strong>Data loss:</strong> Only changes since last backup (max 24 hours with daily backups, seconds with AOF)<br>
                <strong>Business impact:</strong> Minimal! Users re-add to cart if needed. Sessions recreate.</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>RDB snapshots</strong> - Fast restore, compact files</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìù</span><p><strong>AOF logs</strong> - Minimal data loss (seconds)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚òÅÔ∏è</span><p><strong>Cloud backups</strong> - Off-site disaster recovery</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Multiple generations</strong> - Keep 7 daily + 4 weekly</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üß™</span><p><strong>Test recovery</strong> - Practice makes perfect</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>3-2-1 strategy</strong> - 3 copies, 2 media, 1 off-site</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Backup</span><span class="keyword-tag">RDB</span><span class="keyword-tag">AOF</span><span class="keyword-tag">Recovery</span><span class="keyword-tag">BGSAVE</span><span class="keyword-tag">Disaster Recovery</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Production Redis. Need zero downtime backup. Which command?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) SAVE (creates dump.rdb)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) BGSAVE (background save)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) FLUSHALL then restore</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Stop Redis, copy files</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - BGSAVE</strong>
                    <p>BGSAVE creates dump.rdb in BACKGROUND! Zero downtime, doesn't block clients. SAVE blocks Redis (production disaster!). FLUSHALL deletes data. Stopping Redis = downtime. Production backups: Always BGSAVE + automate with cron!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 56: Redis Caching Strategies
// ============================================================

function getQuestion56Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Performance crisis:</strong> "Database overwhelmed! Every request hits DB. Response time: 2 seconds!" Architect: "Implement cache-aside pattern! Check Redis first, DB on miss. Add write-through for updates. Use appropriate TTLs. Result: Response time drops to 50ms!"</p>
            <p>Caching strategy = 40x performance boost.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis caching strategies include: (1) Cache-Aside (lazy loading), (2) Write-Through (sync updates), (3) Write-Behind (async updates), (4) Read-Through (automatic population), (5) Cache warming (pre-population). Choose based on read/write ratio and consistency needs.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Caching Patterns Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Pattern</th><th style="padding: 10px;">Best For</th><th style="padding: 10px;">Trade-off</th></tr>
                    <tr><td style="padding: 8px;">Cache-Aside</td><td>Read-heavy, lazy load</td><td>First request slow (cache miss)</td></tr>
                    <tr><td style="padding: 8px;">Write-Through</td><td>Strong consistency</td><td>Write latency (double write)</td></tr>
                    <tr><td style="padding: 8px;">Write-Behind</td><td>Write-heavy, eventual OK</td><td>Potential data loss on crash</td></tr>
                    <tr><td style="padding: 8px;">Read-Through</td><td>Automatic cache mgmt</td><td>Cache complexity</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° TTL Strategy by Data Type:</strong></p>
                <ul>
                    <li><strong>Static content:</strong> 24 hours (homepage, logos)</li>
                    <li><strong>User profiles:</strong> 1-6 hours (changes rarely)</li>
                    <li><strong>Product prices:</strong> 5-15 minutes (updates frequent)</li>
                    <li><strong>Session data:</strong> 30 minutes (user activity)</li>
                    <li><strong>Real-time data:</strong> 10-60 seconds (stock prices)</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Cache-Aside Pattern Flow</div>
                <svg viewBox="0 0 900 480" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Most Common: Cache-Aside Pattern</text>
                    
                    <!-- Application -->
                    <rect x="50" y="60" width="150" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="125" y="95" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="600">üì± Application</text>
                    
                    <!-- Read Flow -->
                    <text x="450" y="70" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="600">READ FLOW</text>
                    
                    <path d="M 200 90 L 350 90" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    <text x="275" y="80" text-anchor="middle" fill="#00FF88" font-size="10">1. GET user:123</text>
                    
                    <rect x="350" y="60" width="150" height="60" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="8"/>
                    <text x="425" y="95" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">‚ö° Redis Cache</text>
                    
                    <path d="M 500 90 L 650 90" stroke="#FFA500" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowOrange)"/>
                    <text x="575" y="80" text-anchor="middle" fill="#FFA500" font-size="10">2. Cache MISS</text>
                    
                    <rect x="650" y="60" width="150" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="725" y="95" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üóÑÔ∏è Database</text>
                    
                    <path d="M 650 105 L 500 105" stroke="#9C27B0" stroke-width="3" marker-end="url(#arrowPurple)"/>
                    <text x="575" y="125" text-anchor="middle" fill="#9C27B0" font-size="10">3. Return data</text>
                    
                    <path d="M 425 120 L 425 170" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    <text x="465" y="150" fill="#DC143C" font-size="10">4. SET cache</text>
                    
                    <rect x="350" y="170" width="150" height="50" fill="rgba(220,20,60,0.3)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="425" y="200" text-anchor="middle" fill="#DC143C" font-size="11">Cache populated</text>
                    
                    <path d="M 350 195 L 200 195" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    <text x="275" y="185" text-anchor="middle" fill="#00FF88" font-size="10">5. Return to app</text>
                    
                    <!-- Write Flow -->
                    <text x="450" y="270" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="600">WRITE FLOW</text>
                    
                    <path d="M 200 300 L 650 300" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    <text x="425" y="290" text-anchor="middle" fill="#DC143C" font-size="10">1. UPDATE database first</text>
                    
                    <rect x="650" y="270" width="150" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="8"/>
                    <text x="725" y="305" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üóÑÔ∏è Database</text>
                    
                    <path d="M 200 320 L 350 320" stroke="#FFA500" stroke-width="3" marker-end="url(#arrowOrange)"/>
                    <text x="275" y="340" text-anchor="middle" fill="#FFA500" font-size="10">2. DEL user:123</text>
                    
                    <rect x="350" y="290" width="150" height="60" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="8"/>
                    <text x="425" y="315" text-anchor="middle" fill="#DC143C" font-size="12">‚ö° Redis</text>
                    <text x="425" y="335" text-anchor="middle" fill="#888" font-size="9">Invalidate cache</text>
                    
                    <!-- Summary -->
                    <rect x="50" y="380" width="800" height="80" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="405" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">Cache-Aside Benefits</text>
                    <text x="70" y="425" fill="#00FF88" font-size="11">‚úÖ Simple to implement</text>
                    <text x="70" y="445" fill="#00FF88" font-size="11">‚úÖ Cache only what's needed</text>
                    <text x="450" y="425" fill="#00FF88" font-size="11">‚úÖ DB is source of truth</text>
                    <text x="450" y="445" fill="#00FF88" font-size="11">‚úÖ Cache failures don't break app</text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                        <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#FFA500" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Cache-Aside Pattern</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Most Common Pattern</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json
<span class="keyword">from</span> database <span class="keyword">import</span> db

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">get_user</span>(user_id):
    <span class="string">"""Cache-Aside: Check cache first, DB on miss"""</span>
    cache_key = <span class="string">f'user:{user_id}'</span>
    
    <span class="comment"># 1. Try cache first</span>
    cached = r.get(cache_key)
    <span class="keyword">if</span> cached:
        <span class="keyword">print</span>(<span class="string">"‚úÖ Cache HIT"</span>)
        <span class="keyword">return</span> json.loads(cached)
    
    <span class="comment"># 2. Cache miss - query database</span>
    <span class="keyword">print</span>(<span class="string">"‚ùå Cache MISS - querying DB"</span>)
    user = db.query(<span class="string">"SELECT * FROM users WHERE id=%s"</span>, user_id)
    
    <span class="keyword">if</span> user:
        <span class="comment"># 3. Populate cache for next time</span>
        r.setex(cache_key, <span class="number">3600</span>, json.dumps(user))  <span class="comment"># 1 hour TTL</span>
    
    <span class="keyword">return</span> user

<span class="keyword">def</span> <span class="function">update_user</span>(user_id, data):
    <span class="string">"""Update DB then invalidate cache"""</span>
    <span class="comment"># 1. Update database first</span>
    db.execute(<span class="string">"UPDATE users SET ... WHERE id=%s"</span>, user_id)
    
    <span class="comment"># 2. Invalidate cache</span>
    r.delete(<span class="string">f'user:{user_id}'</span>)
    <span class="comment"># Next read will refresh from DB</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Write-Through Pattern</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Strong Consistency</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">update_user_write_through</span>(user_id, data):
    <span class="string">"""Write to both DB and cache simultaneously"""</span>
    cache_key = <span class="string">f'user:{user_id}'</span>
    
    <span class="comment"># 1. Update database</span>
    db.execute(<span class="string">"UPDATE users SET name=%s WHERE id=%s"</span>, 
               data[<span class="string">'name'</span>], user_id)
    
    <span class="comment"># 2. Update cache immediately</span>
    user = db.query(<span class="string">"SELECT * FROM users WHERE id=%s"</span>, user_id)
    r.setex(cache_key, <span class="number">3600</span>, json.dumps(user))
    
    <span class="comment"># Cache always in sync with DB!</span>
    <span class="keyword">return</span> user</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Cache Warming</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Pre-populate Hot Data</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">warm_cache</span>():
    <span class="string">"""Pre-load popular data before traffic spike"""</span>
    
    <span class="comment"># Get top 1000 popular products</span>
    products = db.query(<span class="string">"""
        SELECT * FROM products 
        ORDER BY views DESC 
        LIMIT 1000
    """</span>)
    
    pipe = r.pipeline()
    <span class="keyword">for</span> product <span class="keyword">in</span> products:
        key = <span class="string">f'product:{product["id"]}'</span>
        pipe.setex(key, <span class="number">3600</span>, json.dumps(product))
    
    pipe.execute()
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Warmed cache with {len(products)} products"</span>)

<span class="comment"># Run before Black Friday sale!</span>
warm_cache()</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 4: Handling Cache Stampede</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Prevent Thundering Herd</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> time

<span class="keyword">def</span> <span class="function">get_user_safe</span>(user_id):
    <span class="string">"""Prevent cache stampede with locking"""</span>
    cache_key = <span class="string">f'user:{user_id}'</span>
    lock_key = <span class="string">f'lock:user:{user_id}'</span>
    
    <span class="comment"># Try cache</span>
    cached = r.get(cache_key)
    <span class="keyword">if</span> cached:
        <span class="keyword">return</span> json.loads(cached)
    
    <span class="comment"># Try to acquire lock (only one request queries DB)</span>
    <span class="keyword">if</span> r.set(lock_key, <span class="string">'1'</span>, nx=<span class="keyword">True</span>, ex=<span class="number">10</span>):
        <span class="keyword">try</span>:
            <span class="comment"># This request won the race - query DB</span>
            user = db.query(<span class="string">"SELECT * FROM users WHERE id=%s"</span>, user_id)
            r.setex(cache_key, <span class="number">3600</span>, json.dumps(user))
            <span class="keyword">return</span> user
        <span class="keyword">finally</span>:
            r.delete(lock_key)
    <span class="keyword">else</span>:
        <span class="comment"># Wait for first request to populate cache</span>
        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="function">range</span>(<span class="number">10</span>):
            time.sleep(<span class="number">0.1</span>)
            cached = r.get(cache_key)
            <span class="keyword">if</span> cached:
                <span class="keyword">return</span> json.loads(cached)
        
        <span class="comment"># Fallback to DB if cache still empty</span>
        <span class="keyword">return</span> db.query(<span class="string">"SELECT * FROM users WHERE id=%s"</span>, user_id)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Cache-Aside vs Write-Through - when to use which?</h4>
                <p><strong>A:</strong> Cache-Aside: Read-heavy apps, lazy loading OK, simpler. Write-Through: Need strong consistency, write latency acceptable. Most apps use Cache-Aside (simpler, DB is source of truth)!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Should I SET or DELETE cache on update?</h4>
                <p><strong>A:</strong> DELETE safer! SET might have race conditions (read old DB value, set stale cache). DELETE ensures next read gets fresh data. Exception: Write-Through where you control both writes!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What's cache stampede and how to prevent?</h4>
                <p><strong>A:</strong> Stampede = popular key expires, 1000 requests hit DB simultaneously! Prevent: (1) Locking (one request regenerates), (2) Probabilistic early expiration, (3) Cache warming. Locking most common!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Cache invalidation - why "hardest problem in CS"?</h4>
                <p><strong>Answer:</strong> Timing! Update DB ‚Üí delete cache. But: (1) Delete might fail (stale cache forever), (2) Race: Read cache miss ‚Üí query DB ‚Üí old data ‚Üí meanwhile DB updated ‚Üí set stale cache! Need careful ordering and error handling!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Should TTL be same for all data?</h4>
                <p><strong>Answer:</strong> NO! TTL should match data volatility. Static content: 24h. User profiles: 1-6h. Prices: 5-15min. Real-time: 10-60s. Too long = stale data. Too short = cache ineffective!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Product Catalog</strong></p>
            <p>1M products, 10K requests/sec. Database can't handle load. Need caching strategy!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Layered Caching Strategy</h4>
                <p><strong>Layer 1 - Hot products (top 1000):</strong> Cache-Aside, TTL 1 hour, cache warming before sales<br>
                <strong>Layer 2 - Regular products:</strong> Cache-Aside, TTL 6 hours, lazy load<br>
                <strong>Layer 3 - Prices (volatile):</strong> TTL 5 minutes<br>
                <strong>Write strategy:</strong> Update DB ‚Üí DELETE cache ‚Üí next read refreshes</p>
                <p><strong>Results:</strong> ‚úÖ DB load: 10K ‚Üí 500 req/sec (95% cache hit!) ‚úÖ Response time: 200ms ‚Üí 10ms ‚úÖ Cost savings: 80% fewer DB instances ‚úÖ Black Friday: Zero downtime (cache warming saved us!)</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìñ</span><p><strong>Cache-Aside most common</strong> - Simple, DB is truth</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚úçÔ∏è</span><p><strong>DELETE on update</strong> - Safer than SET (no race)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>TTL by volatility</strong> - Match data change rate</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî•</span><p><strong>Cache warming</strong> - Pre-populate before traffic</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>Prevent stampede</strong> - Lock on cache miss</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor hit rate</strong> - Should be 80%+</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Caching</span><span class="keyword-tag">Cache-Aside</span><span class="keyword-tag">Write-Through</span><span class="keyword-tag">TTL</span><span class="keyword-tag">Cache Stampede</span><span class="keyword-tag">Invalidation</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> On user update, should you SET new value in cache or DELETE the key?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) SET new value (faster)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) DELETE key (safer)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Do nothing (cache expires)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) SET with no TTL</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - DELETE key</strong>
                    <p>DELETE safer! Avoids race condition: Update DB ‚Üí read old value ‚Üí SET stale cache. DELETE ensures next read gets fresh data from DB. SET only safe in Write-Through pattern where you control all writes. Cache-Aside pattern: Always DELETE on update!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 57: Redis Session Management
// ============================================================

function getQuestion57Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Scaling problem:</strong> "Users logged out when load balancer switches servers! Sessions stored in memory per server!" Architect: "Move sessions to Redis! Shared across all servers. Horizontal scaling possible. Session persistence guaranteed. Auto-expiry with TTL!"</p>
            <p>Redis sessions = stateless application servers.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis session management stores user session data (login status, cart, preferences) with automatic expiration. Benefits: (1) Shared across servers, (2) Fast access (in-memory), (3) Automatic cleanup (TTL), (4) Horizontal scaling, (5) Session persistence across restarts.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Session Storage Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Storage</th><th style="padding: 10px;">Pros</th><th style="padding: 10px;">Cons</th></tr>
                    <tr><td style="padding: 8px;">Server Memory</td><td>Very fast</td><td>Not shared, lost on restart</td></tr>
                    <tr><td style="padding: 8px;">Database</td><td>Persistent, shared</td><td>Slow, DB load</td></tr>
                    <tr><td style="padding: 8px;">Redis</td><td>Fast, shared, auto-expire</td><td>Requires Redis setup</td></tr>
                    <tr><td style="padding: 8px;">JWT Tokens</td><td>Stateless, no storage</td><td>Can't revoke, size limits</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Redis Session Architecture</div>
                <svg viewBox="0 0 900 380" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">Shared Session Store</text>
                    
                    <rect x="150" y="60" width="140" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="220" y="95" text-anchor="middle" fill="#9C27B0" font-size="12">Server 1</text>
                    
                    <rect x="380" y="60" width="140" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="450" y="95" text-anchor="middle" fill="#9C27B0" font-size="12">Server 2</text>
                    
                    <rect x="610" y="60" width="140" height="60" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="680" y="95" text-anchor="middle" fill="#9C27B0" font-size="12">Server 3</text>
                    
                    <path d="M 220 120 L 450 180" stroke="#00FF88" stroke-width="2"/>
                    <path d="M 450 120 L 450 180" stroke="#00FF88" stroke-width="2"/>
                    <path d="M 680 120 L 450 180" stroke="#00FF88" stroke-width="2"/>
                    
                    <rect x="350" y="180" width="200" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="210" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">‚ö° Redis Sessions</text>
                    <text x="450" y="230" text-anchor="middle" fill="#888" font-size="10">sess:abc123 (user:1, cart:[...])</text>
                    <text x="450" y="245" text-anchor="middle" fill="#888" font-size="10">TTL: 30 minutes</text>
                    
                    <rect x="50" y="300" width="800" height="60" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="325" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">‚úÖ User switches servers ‚Üí Session persists!</text>
                    <text x="450" y="345" text-anchor="middle" fill="#888" font-size="10">Load balancer can route to any server</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Express.js with Redis Sessions</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Node.js - Session Middleware</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">const</span> express = <span class="function">require</span>(<span class="string">'express'</span>);
<span class="keyword">const</span> session = <span class="function">require</span>(<span class="string">'express-session'</span>);
<span class="keyword">const</span> RedisStore = <span class="function">require</span>(<span class="string">'connect-redis'</span>)(session);
<span class="keyword">const</span> redis = <span class="function">require</span>(<span class="string">'redis'</span>);

<span class="keyword">const</span> redisClient = redis.createClient({
    host: <span class="string">'localhost'</span>,
    port: <span class="number">6379</span>
});

<span class="keyword">const</span> app = express();

app.use(session({
    store: <span class="keyword">new</span> RedisStore({ client: redisClient }),
    secret: <span class="string">'your-secret-key'</span>,
    resave: <span class="keyword">false</span>,
    saveUninitialized: <span class="keyword">false</span>,
    cookie: {
        maxAge: <span class="number">1800000</span>  <span class="comment">// 30 minutes</span>
    }
}));

<span class="comment">// Login endpoint</span>
app.post(<span class="string">'/login'</span>, (req, res) => {
    req.session.userId = <span class="number">123</span>;
    req.session.username = <span class="string">'alice'</span>;
    res.json({ success: <span class="keyword">true</span> });
});

<span class="comment">// Protected endpoint</span>
app.get(<span class="string">'/profile'</span>, (req, res) => {
    <span class="keyword">if</span> (!req.session.userId) {
        <span class="keyword">return</span> res.status(<span class="number">401</span>).json({ error: <span class="string">'Not logged in'</span> });
    }
    res.json({ user: req.session.username });
});</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Flask with Redis Sessions</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python Flask - Session Management</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session
<span class="keyword">from</span> flask_session <span class="keyword">import</span> Session
<span class="keyword">import</span> redis

app = Flask(__name__)
app.config[<span class="string">'SESSION_TYPE'</span>] = <span class="string">'redis'</span>
app.config[<span class="string">'SESSION_REDIS'</span>] = redis.Redis(
    host=<span class="string">'localhost'</span>, 
    port=<span class="number">6379</span>
)
app.config[<span class="string">'SESSION_PERMANENT'</span>] = <span class="keyword">False</span>
app.config[<span class="string">'PERMANENT_SESSION_LIFETIME'</span>] = <span class="number">1800</span>  <span class="comment"># 30 min</span>

Session(app)

@app.route(<span class="string">'/login'</span>, methods=[<span class="string">'POST'</span>])
<span class="keyword">def</span> <span class="function">login</span>():
    session[<span class="string">'user_id'</span>] = <span class="number">123</span>
    session[<span class="string">'username'</span>] = <span class="string">'alice'</span>
    session[<span class="string">'cart'</span>] = []
    <span class="keyword">return</span> {<span class="string">'success'</span>: <span class="keyword">True</span>}

@app.route(<span class="string">'/cart/add'</span>, methods=[<span class="string">'POST'</span>])
<span class="keyword">def</span> <span class="function">add_to_cart</span>():
    <span class="keyword">if</span> <span class="string">'user_id'</span> <span class="keyword">not in</span> session:
        <span class="keyword">return</span> {<span class="string">'error'</span>: <span class="string">'Not logged in'</span>}, <span class="number">401</span>
    
    session[<span class="string">'cart'</span>].append(product_id)
    session.modified = <span class="keyword">True</span>  <span class="comment"># Mark as changed</span>
    <span class="keyword">return</span> {<span class="string">'cart_size'</span>: <span class="function">len</span>(session[<span class="string">'cart'</span>])}</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Redis sessions vs JWT tokens?</h4>
                <p><strong>A:</strong> Redis: Server-side, can revoke instantly, unlimited data. JWT: Client-side, can't revoke (until expiry), size limits. Use Redis for traditional sessions, JWT for stateless APIs. Can combine both!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What happens if Redis goes down?</h4>
                <p><strong>A:</strong> All users logged out! Solutions: (1) Redis replica for HA, (2) Redis Sentinel auto-failover, (3) Fallback to DB sessions, (4) Graceful degradation. Production: Always use replication!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: How to handle session data for millions of users?</h4>
                <p><strong>A:</strong> Redis perfect for this! In-memory = fast. TTL = automatic cleanup. Eviction policy (allkeys-lru) = LRU when memory full. Monitor memory, scale horizontally (Redis Cluster) if needed!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Session ID in cookie vs Redis key - what's the relationship?</h4>
                <p><strong>Answer:</strong> Session ID (like "sess_abc123") stored in browser cookie. This ID is the KEY in Redis! sess:abc123 ‚Üí {userId: 1, cart: [...]}. Cookie just points to data in Redis. Never store actual data in cookie (security + size limits)!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: User active = should session TTL reset?</h4>
                <p><strong>Answer:</strong> YES! Sliding expiration. On each request: EXPIRE sess:abc123 1800. Inactive 30 min = logout. Active = stays logged in. Most frameworks do this automatically. Manual: Touch session on each request!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Platform Scaling</strong></p>
            <p>Black Friday: Traffic 10x normal. Need 20 servers. Sessions in server memory won't work!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Redis Session Store</h4>
                <p><strong>Before:</strong> 2 servers, sessions in memory, sticky sessions needed<br>
                <strong>After:</strong> 20 servers + Redis (replicated), load balancer routes freely</p>
                <p><strong>Results:</strong> ‚úÖ Scale from 2 ‚Üí 20 servers seamlessly ‚úÖ Users stay logged in across servers ‚úÖ Shopping carts persist ‚úÖ 30-min auto-logout (TTL) ‚úÖ Zero session loss (Redis persistence)</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåê</span><p><strong>Shared across servers</strong> - Horizontal scaling</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Fast in-memory access</strong> - Low latency</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>Auto-expiry with TTL</strong> - Automatic cleanup</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Sliding expiration</strong> - Reset on activity</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõ°Ô∏è</span><p><strong>HA with replication</strong> - Prevent session loss</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor memory</strong> - Scale when needed</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Sessions</span><span class="keyword-tag">Authentication</span><span class="keyword-tag">TTL</span><span class="keyword-tag">Scaling</span><span class="keyword-tag">Stateless</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need to scale from 1 to 10 app servers. Where to store sessions?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Server memory (in each server)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Redis (shared store)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Database (too slow)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Cookies (security risk)</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Redis (shared store)</strong>
                    <p>Redis perfect for distributed sessions! All servers access same session data. Fast (in-memory), auto-expire (TTL), shared. Server memory won't work (not shared). Database too slow for every request. Cookies have size limits and security risks. Redis = standard for multi-server sessions!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 58: Redis Rate Limiting
// ============================================================

// ============================================================
// QUESTION 58: Redis Rate Limiting - FIXED VERSION
// ============================================================

function getQuestion58Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>API abuse:</strong> "Bot hitting API 10,000 times/minute! Server overload!" DevOps: "Implement rate limiting! Allow 100 requests/minute per IP. Use Redis INCR + EXPIRE. Atomic with Lua script. Block abusers, protect legitimate users!"</p>
            <p>Rate limiting = protect your infrastructure.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis rate limiting restricts request frequency per user/IP. Algorithms: (1) Fixed Window (simple counter), (2) Sliding Window (accurate, complex), (3) Token Bucket (burst allowed). Redis perfect: fast, atomic operations, auto-expiry.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Rate Limit Algorithms</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Algorithm</th><th style="padding: 10px;">Pros</th><th style="padding: 10px;">Cons</th></tr>
                    <tr><td style="padding: 8px;">Fixed Window</td><td>Simple, INCR+EXPIRE</td><td>Edge burst (100 at :59, 100 at :00)</td></tr>
                    <tr><td style="padding: 8px;">Sliding Window</td><td>Accurate, fair</td><td>Complex (Sorted Set)</td></tr>
                    <tr><td style="padding: 8px;">Token Bucket</td><td>Allows bursts</td><td>Requires state tracking</td></tr>
                    <tr><td style="padding: 8px;">Leaky Bucket</td><td>Smooth rate</td><td>Queuing complexity</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Common Rate Limits:</strong></p>
                <ul>
                    <li><strong>Login attempts:</strong> 5 per 15 minutes (brute force prevention)</li>
                    <li><strong>API free tier:</strong> 1000 requests/hour</li>
                    <li><strong>API paid tier:</strong> 10,000 requests/hour</li>
                    <li><strong>Password reset:</strong> 3 per day</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Fixed Window Rate Limiting</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">100 Requests Per Minute Limit</text>
                    
                    <rect x="80" y="60" width="220" height="100" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="190" y="85" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">Window 1</text>
                    <text x="190" y="105" text-anchor="middle" fill="#888" font-size="11">12:00-12:01</text>
                    <text x="190" y="125" text-anchor="middle" fill="#00FF88" font-size="13">Count: 85 / 100</text>
                    <text x="190" y="145" text-anchor="middle" fill="#00FF88" font-size="12">‚úÖ Allowed</text>
                    
                    <rect x="340" y="60" width="220" height="100" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="3" rx="8"/>
                    <text x="450" y="85" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">Window 2</text>
                    <text x="450" y="105" text-anchor="middle" fill="#888" font-size="11">12:01-12:02</text>
                    <text x="450" y="125" text-anchor="middle" fill="#FF6347" font-size="13">Count: 101 / 100</text>
                    <text x="450" y="145" text-anchor="middle" fill="#FF6347" font-size="12">‚ùå Blocked</text>
                    
                    <rect x="600" y="60" width="220" height="100" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="710" y="85" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">Window 3</text>
                    <text x="710" y="105" text-anchor="middle" fill="#888" font-size="11">12:02-12:03</text>
                    <text x="710" y="125" text-anchor="middle" fill="#00FF88" font-size="13">Count: 0 / 100</text>
                    <text x="710" y="145" text-anchor="middle" fill="#00FF88" font-size="12">‚úÖ Reset!</text>
                    
                    <rect x="50" y="200" width="800" height="180" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="230" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="700">Redis Implementation</text>
                    
                    <text x="70" y="260" fill="#00FF88" font-size="12" font-weight="600">Request arrives:</text>
                    <text x="80" y="280" fill="#bbb" font-size="10">1. key = "rate:192.168.1.100:12:00"</text>
                    <text x="80" y="295" fill="#bbb" font-size="10">2. count = INCR key</text>
                    <text x="80" y="310" fill="#bbb" font-size="10">3. IF count == 1: EXPIRE key 60</text>
                    <text x="80" y="325" fill="#bbb" font-size="10">4. IF count > 100: BLOCK (429)</text>
                    <text x="80" y="340" fill="#bbb" font-size="10">5. ELSE: ALLOW ‚úÖ</text>
                    
                    <text x="500" y="260" fill="#FFA500" font-size="12" font-weight="600">Why Redis?</text>
                    <text x="510" y="280" fill="#bbb" font-size="10">‚úÖ INCR atomic (no race)</text>
                    <text x="510" y="295" fill="#bbb" font-size="10">‚úÖ EXPIRE auto-cleanup</text>
                    <text x="510" y="310" fill="#bbb" font-size="10">‚úÖ Fast (in-memory)</text>
                    <text x="510" y="325" fill="#bbb" font-size="10">‚úÖ Shared across servers</text>
                    <text x="510" y="340" fill="#bbb" font-size="10">‚úÖ O(1) operations</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Fixed Window (Simple)</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Basic Rate Limiting</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis()

<span class="keyword">def</span> <span class="function">is_rate_limited</span>(user_id, limit=<span class="number">100</span>, window=<span class="number">60</span>):
    <span class="string">"""Fixed window: limit requests per window"""</span>
    current_window = <span class="function">int</span>(time.time() / window)
    key = <span class="string">f'rate_limit:{user_id}:{current_window}'</span>
    
    <span class="comment"># Increment counter</span>
    count = r.incr(key)
    
    <span class="comment"># Set expiry on first request</span>
    <span class="keyword">if</span> count == <span class="number">1</span>:
        r.expire(key, window)
    
    <span class="comment"># Check if over limit</span>
    <span class="keyword">if</span> count > limit:
        <span class="keyword">return</span> <span class="keyword">True</span>, count  <span class="comment"># Blocked</span>
    
    <span class="keyword">return</span> <span class="keyword">False</span>, count  <span class="comment"># Allowed</span>

<span class="comment"># Usage</span>
blocked, count = is_rate_limited(<span class="string">'user_123'</span>)
<span class="keyword">if</span> blocked:
    <span class="keyword">print</span>(<span class="string">f"‚ùå Rate limit exceeded: {count}/100"</span>)
<span class="keyword">else</span>:
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Request allowed: {count}/100"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Sliding Window (Accurate)</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Lua Script for Accuracy</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Lua script for atomic sliding window</span>
SLIDING_WINDOW_LUA = '''
local key = KEYS[1]
local limit = tonumber(ARGV[1])
local window = tonumber(ARGV[2])
local now = tonumber(ARGV[3])

-- Remove old entries outside window
redis.call('ZREMRANGEBYSCORE', key, 0, now - window * 1000)

-- Count requests in current window
local count = redis.call('ZCARD', key)

if count < limit then
    -- Add current request with timestamp
    redis.call('ZADD', key, now, now)
    redis.call('EXPIRE', key, window)
    return 1  -- Allowed
else
    return 0  -- Blocked
end
'''

<span class="keyword">def</span> <span class="function">sliding_window_rate_limit</span>(user_id, limit=<span class="number">100</span>, window=<span class="number">60</span>):
    key = <span class="string">f'rate_limit_sliding:{user_id}'</span>
    now = <span class="function">int</span>(time.time() * <span class="number">1000</span>)  <span class="comment"># milliseconds</span>
    
    result = r.eval(SLIDING_WINDOW_LUA, <span class="number">1</span>, key, limit, window, now)
    <span class="keyword">return</span> result == <span class="number">0</span>  <span class="comment"># True = blocked</span>

<span class="comment"># More accurate - no edge burst issue</span>
<span class="keyword">if</span> sliding_window_rate_limit(<span class="string">'user_123'</span>):
    <span class="keyword">print</span>(<span class="string">"‚ùå Rate limited"</span>)
<span class="keyword">else</span>:
    <span class="keyword">print</span>(<span class="string">"‚úÖ Allowed"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Express.js Middleware</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Node.js - API Rate Limiting</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">const</span> redis = <span class="function">require</span>(<span class="string">'redis'</span>);
<span class="keyword">const</span> client = redis.createClient();

<span class="keyword">async function</span> <span class="function">rateLimitMiddleware</span>(req, res, next) {
    <span class="keyword">const</span> ip = req.ip;
    <span class="keyword">const</span> window = Math.floor(Date.now() / <span class="number">60000</span>);  <span class="comment">// 1 minute</span>
    <span class="keyword">const</span> key = \`rate_limit:\${ip}:\${window}\`;
    
    <span class="keyword">try</span> {
        <span class="keyword">const</span> count = <span class="keyword">await</span> client.incr(key);
        
        <span class="keyword">if</span> (count === <span class="number">1</span>) {
            <span class="keyword">await</span> client.expire(key, <span class="number">60</span>);
        }
        
        <span class="keyword">const</span> limit = <span class="number">100</span>;
        <span class="keyword">const</span> remaining = Math.max(<span class="number">0</span>, limit - count);
        
        <span class="comment">// Add rate limit headers</span>
        res.setHeader(<span class="string">'X-RateLimit-Limit'</span>, limit);
        res.setHeader(<span class="string">'X-RateLimit-Remaining'</span>, remaining);
        res.setHeader(<span class="string">'X-RateLimit-Reset'</span>, (window + <span class="number">1</span>) * <span class="number">60</span>);
        
        <span class="keyword">if</span> (count > limit) {
            <span class="keyword">return</span> res.status(<span class="number">429</span>).json({
                error: <span class="string">'Too Many Requests'</span>,
                message: \`Rate limit exceeded. Try again in \${60} seconds.\`,
                retryAfter: <span class="number">60</span>
            });
        }
        
        next();
    } <span class="keyword">catch</span> (err) {
        <span class="comment">// Fail open - allow request if Redis down</span>
        console.error(<span class="string">'Rate limit error:'</span>, err);
        next();
    }
}

app.use(rateLimitMiddleware);</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Fixed Window vs Sliding Window?</h4>
                <p><strong>A:</strong> Fixed: Simple (INCR+EXPIRE), but edge burst issue (100 at :59, 100 at :00 = 200 in 1 sec). Sliding: Accurate (Sorted Set removes old), no burst. Production: Fixed for simplicity, Sliding for strict enforcement!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Rate limit by IP or User ID?</h4>
                <p><strong>A:</strong> Both! IP: Protects login (unauthenticated). User ID: After login. Best practice: Different limits for each (IP: 100/min, User: 1000/min). Premium users get higher limits!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: INCR then EXPIRE - race condition?</h4>
                <p><strong>A:</strong> YES! Crash between INCR and EXPIRE = key never expires. Fix: Check if count==1 then EXPIRE (shown in code). Or use Lua script for atomicity. Always handle this!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: What if Redis goes down?</h4>
                <p><strong>Answer:</strong> Fail open or fail closed? Fail open: Allow requests (avoid blocking legitimate users). Fail closed: Block all (maximum security). Most APIs fail open with monitoring. Use Redis replica for HA!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Should return HTTP 429 with headers?</h4>
                <p><strong>Answer:</strong> YES! HTTP 429 = Too Many Requests. Include: Retry-After (seconds), X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset. Helps clients implement exponential backoff!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Public API with Tiered Pricing</strong></p>
            <p>Free tier: 1000 req/hour. Pro: 10,000/hour. Enterprise: Unlimited. Need fair enforcement!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Tiered Rate Limiting</h4>
                <p><strong>Implementation:</strong> Check API key ‚Üí Get tier from cache ‚Üí Apply limit<br>
                <strong>Free:</strong> rate:free:KEY:HOUR (1000 limit)<br>
                <strong>Pro:</strong> rate:pro:KEY:HOUR (10,000 limit)<br>
                <strong>Enterprise:</strong> No rate limit</p>
                <p><strong>Results:</strong> ‚úÖ Free users protected ‚úÖ Pro users get value ‚úÖ Server protected ‚úÖ Clear upgrade incentive ‚úÖ Automatic enforcement</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõ°Ô∏è</span><p><strong>Protect infrastructure</strong> - Prevent abuse and DoS</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Fixed window simplest</strong> - INCR + EXPIRE pattern</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Sliding window accurate</strong> - Lua + Sorted Set</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîê</span><p><strong>Rate limit by IP and user</strong> - Layered defense</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì°</span><p><strong>Return HTTP 429</strong> - With retry headers</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Fail open in production</strong> - Redis down = allow</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Rate Limiting</span><span class="keyword-tag">INCR</span><span class="keyword-tag">Fixed Window</span><span class="keyword-tag">Sliding Window</span><span class="keyword-tag">API Protection</span><span class="keyword-tag">HTTP 429</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> API needs 100 requests/minute limit per user. Best Redis approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Store all requests in List</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) INCR counter with 60sec EXPIRE</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Check database each request</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Manual tracking in memory</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - INCR counter with EXPIRE</strong>
                    <p>Perfect for fixed window rate limiting! INCR atomic O(1), EXPIRE auto-cleanup, key includes time window. Count > 100? Block with 429. List wasteful. Database too slow for every request. INCR + EXPIRE = standard pattern, works across servers!</p>
                </div>
            </div>
        </div>
    `;
}

// ============================================================
// QUESTION 59: Redis Pub/Sub Messaging
// ============================================================

function getQuestion59Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Real-time nightmare:</strong> "Need to notify all users when new message arrives! Polling database every second = 10,000 queries/sec overload!" Architect: "Use Redis Pub/Sub! Publish to channel, all subscribers get instantly. Push not pull. Fire-and-forget. Real-time with zero polling!"</p>
            <p>Pub/Sub = instant push notifications.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Pub/Sub enables publish-subscribe messaging pattern. Publishers send messages to channels, subscribers receive instantly. Fire-and-forget (no persistence). Use cases: Real-time notifications, chat, live updates, event broadcasting.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Pub/Sub vs Other Patterns</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Pattern</th><th style="padding: 10px;">Persistence</th><th style="padding: 10px;">Use Case</th></tr>
                    <tr><td style="padding: 8px;">Pub/Sub</td><td>No (fire-forget)</td><td>Real-time, ephemeral</td></tr>
                    <tr><td style="padding: 8px;">Streams</td><td>Yes (log)</td><td>Event sourcing, history</td></tr>
                    <tr><td style="padding: 8px;">List (Queue)</td><td>Yes</td><td>Job queue, guaranteed delivery</td></tr>
                    <tr><td style="padding: 8px;">WebSockets</td><td>No</td><td>Browser real-time</td></tr>
                </table>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border-left: 3px solid #FF6347; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>‚ö†Ô∏è Critical Limitations:</strong></p>
                <ul>
                    <li><strong>No persistence:</strong> Messages lost if no subscriber</li>
                    <li><strong>No replay:</strong> Can't retrieve history</li>
                    <li><strong>Blocking:</strong> SUBSCRIBE blocks client connection</li>
                    <li><strong>Single node:</strong> Doesn't work across Redis Cluster</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Pub/Sub Architecture</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Publish-Subscribe Pattern</text>
                    
                    <rect x="50" y="80" width="180" height="70" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="140" y="110" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">üì§ Publisher</text>
                    <text x="140" y="130" text-anchor="middle" fill="#888" font-size="10">Backend Service</text>
                    
                    <path d="M 230 115 L 340 115" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    <text x="285" y="105" text-anchor="middle" fill="#DC143C" font-size="10">PUBLISH chat "Hi!"</text>
                    
                    <rect x="340" y="80" width="220" height="70" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="110" text-anchor="middle" fill="#9C27B0" font-size="16" font-weight="600">üì° Channel</text>
                    <text x="450" y="130" text-anchor="middle" fill="#888" font-size="11">"chat"</text>
                    
                    <path d="M 560 95 L 650 95" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <path d="M 560 115 L 650 140" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <path d="M 560 135 L 650 185" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    
                    <text x="605" y="90" text-anchor="middle" fill="#00FF88" font-size="9">Instant</text>
                    
                    <rect x="650" y="70" width="200" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="750" y="95" text-anchor="middle" fill="#00FF88" font-size="12">üë§ Subscriber 1</text>
                    <text x="750" y="110" text-anchor="middle" fill="#888" font-size="9">WebSocket Server A</text>
                    
                    <rect x="650" y="130" width="200" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="750" y="155" text-anchor="middle" fill="#00FF88" font-size="12">üë§ Subscriber 2</text>
                    <text x="750" y="170" text-anchor="middle" fill="#888" font-size="9">WebSocket Server B</text>
                    
                    <rect x="650" y="190" width="200" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="750" y="215" text-anchor="middle" fill="#00FF88" font-size="12">üë§ Subscriber 3</text>
                    <text x="750" y="230" text-anchor="middle" fill="#888" font-size="9">Mobile App Backend</text>
                    
                    <rect x="50" y="280" width="800" height="120" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="310" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">Key Characteristics</text>
                    
                    <text x="70" y="335" fill="#00FF88" font-size="11">‚úÖ Instant push (no polling)</text>
                    <text x="70" y="355" fill="#00FF88" font-size="11">‚úÖ 1-to-many broadcast</text>
                    <text x="70" y="375" fill="#00FF88" font-size="11">‚úÖ Pattern matching (room:*)</text>
                    
                    <text x="450" y="335" fill="#FFA500" font-size="11">‚ö†Ô∏è No persistence</text>
                    <text x="450" y="355" fill="#FFA500" font-size="11">‚ö†Ô∏è Offline = miss messages</text>
                    <text x="450" y="375" fill="#FFA500" font-size="11">‚ö†Ô∏è SUBSCRIBE blocks connection</text>
                    
                    <defs>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Pub/Sub</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Publisher & Subscriber</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

<span class="comment"># Publisher (separate connection)</span>
r_pub = redis.Redis()
r_pub.publish(<span class="string">'notifications'</span>, <span class="string">'New message from Alice'</span>)
<span class="keyword">print</span>(<span class="string">"‚úÖ Message published"</span>)

<span class="comment"># Subscriber (separate connection - blocks!)</span>
r_sub = redis.Redis()
pubsub = r_sub.pubsub()
pubsub.subscribe(<span class="string">'notifications'</span>)

<span class="keyword">print</span>(<span class="string">"üëÇ Listening for messages..."</span>)
<span class="keyword">for</span> message <span class="keyword">in</span> pubsub.listen():
    <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'message'</span>:
        <span class="keyword">print</span>(<span class="string">f"üì® Received: {message['data'].decode()}"</span>)
        <span class="comment"># Process message (send to browser, push notification, etc.)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Pattern Subscription</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Wildcard Channels</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r_pub = redis.Redis()
r_sub = redis.Redis()
pubsub = r_sub.pubsub()

<span class="comment"># Subscribe to pattern (matches room:1, room:2, room:123, etc.)</span>
pubsub.psubscribe(<span class="string">'room:*'</span>)

<span class="comment"># Publisher sends to specific rooms</span>
r_pub.publish(<span class="string">'room:101'</span>, <span class="string">'Message to room 101'</span>)
r_pub.publish(<span class="string">'room:202'</span>, <span class="string">'Message to room 202'</span>)
r_pub.publish(<span class="string">'lobby'</span>, <span class="string">'This won\'t match'</span>)

<span class="comment"># Subscriber receives all matching channels</span>
<span class="keyword">for</span> message <span class="keyword">in</span> pubsub.listen():
    <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'pmessage'</span>:
        channel = message[<span class="string">'channel'</span>].decode()
        data = message[<span class="string">'data'</span>].decode()
        <span class="keyword">print</span>(<span class="string">f"üì° {channel}: {data}"</span>)
        <span class="comment"># Output:</span>
        <span class="comment"># room:101: Message to room 101</span>
        <span class="comment"># room:202: Message to room 202</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Real-Time Chat with WebSockets</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Node.js - WebSocket + Pub/Sub Bridge</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">const</span> redis = <span class="function">require</span>(<span class="string">'redis'</span>);
<span class="keyword">const</span> WebSocket = <span class="function">require</span>(<span class="string">'ws'</span>);

<span class="comment">// Separate Redis connections</span>
<span class="keyword">const</span> publisher = redis.createClient();
<span class="keyword">const</span> subscriber = redis.createClient();

<span class="keyword">const</span> wss = <span class="keyword">new</span> WebSocket.Server({ port: <span class="number">8080</span> });

<span class="comment">// Subscribe to chat channel</span>
subscriber.subscribe(<span class="string">'chat'</span>);

<span class="comment">// Redis ‚Üí WebSocket (broadcast to all clients)</span>
subscriber.on(<span class="string">'message'</span>, (channel, message) => {
    wss.clients.forEach(client => {
        <span class="keyword">if</span> (client.readyState === WebSocket.OPEN) {
            client.send(message);
        }
    });
});

<span class="comment">// WebSocket ‚Üí Redis (publish to channel)</span>
wss.on(<span class="string">'connection'</span>, (ws) => {
    console.log(<span class="string">'üë§ Client connected'</span>);
    
    ws.on(<span class="string">'message'</span>, (msg) => {
        <span class="comment">// Publish to Redis (other servers get it too!)</span>
        publisher.publish(<span class="string">'chat'</span>, msg);
    });
    
    ws.on(<span class="string">'close'</span>, () => {
        console.log(<span class="string">'üëã Client disconnected'</span>);
    });
});

console.log(<span class="string">'üöÄ Chat server running on ws://localhost:8080'</span>);</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Pub/Sub vs Streams - when to use which?</h4>
                <p><strong>A:</strong> Pub/Sub: Real-time only, don't need history (chat, notifications). Streams: Need persistence, replay, consumer groups (event sourcing, audit logs). Pub/Sub simpler but no reliability!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Subscriber crashes - messages lost?</h4>
                <p><strong>A:</strong> YES! Fire-and-forget. Offline subscriber misses ALL messages. No queue, no replay. For reliability: Use Streams or combine Pub/Sub (instant) + Streams (history backup)!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can use across Redis Cluster?</h4>
                <p><strong>A:</strong> Tricky! Pub/Sub messages stay within single node (don't follow data sharding). For cluster-wide: (1) Publish to all nodes, (2) Use Streams, or (3) External broker (RabbitMQ). Cluster = data, not messaging!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: SUBSCRIBE blocks connection - can't do other commands?</h4>
                <p><strong>Answer:</strong> CORRECT! SUBSCRIBE enters "pub/sub mode" - can ONLY do SUBSCRIBE/UNSUBSCRIBE/QUIT. Need separate connection for regular commands (GET, SET). Solution: 2 Redis clients (one pub/sub, one data)!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Does PUBLISH return subscriber count?</h4>
                <p><strong>Answer:</strong> YES! Returns number of clients that received message. 0 = no subscribers (message lost!). Use this to detect if anyone listening. Can trigger fallback (save to DB if no subscribers)!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Live Sports Scores Dashboard</strong></p>
            <p>100K users watching live game. Need instant score updates without polling database!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Redis Pub/Sub + WebSockets</h4>
                <p><strong>Architecture:</strong> Score service ‚Üí PUBLISH game:12345 ‚Üí Redis Pub/Sub ‚Üí 10 WebSocket servers (subscribe) ‚Üí Push to 100K browser clients<br>
                <strong>Channels:</strong> game:12345, game:67890 (per game)<br>
                <strong>Pattern:</strong> game:* (subscribe all games)</p>
                <p><strong>Results:</strong> ‚úÖ Instant updates (no polling!) ‚úÖ 100K concurrent users ‚úÖ Low latency (<100ms) ‚úÖ Scales horizontally (add WS servers) ‚úÖ Zero database load!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì°</span><p><strong>Real-time push</strong> - Instant message delivery</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî•</span><p><strong>Fire-and-forget</strong> - No persistence or replay</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¢</span><p><strong>Pattern matching</strong> - PSUBSCRIBE wildcards</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîå</span><p><strong>Dedicated connection</strong> - SUBSCRIBE blocks</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>vs Streams</strong> - Use Streams for reliability</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üí¨</span><p><strong>Perfect for</strong> - Chat, notifications, live updates</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Pub/Sub</span><span class="keyword-tag">PUBLISH</span><span class="keyword-tag">SUBSCRIBE</span><span class="keyword-tag">Real-time</span><span class="keyword-tag">Messaging</span><span class="keyword-tag">WebSocket</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Real-time chat with message history for offline users. Best choice?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Pub/Sub only (no history)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Streams (persistent messages)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Database polling</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Lists as queue</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Streams</strong>
                    <p>Streams perfect for chat with history! Persistent log, consumer groups, replay capability. Pub/Sub fire-and-forget = offline users miss messages. Streams = message queue + append-only log. Can combine: Pub/Sub for online users (instant) + Streams for offline (history). For reliable chat: Streams wins!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 60: Redis Leaderboards (Sorted Sets)
// ============================================================

function getQuestion60Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Gaming nightmare:</strong> "Need leaderboard for 1M players! Database query takes 5 seconds - ORDER BY score, LIMIT 100!" Architect: "Use Redis Sorted Set! ZADD updates scores in O(log N). ZREVRANGE top 100 in milliseconds. ZRANK finds any player position instantly. Real-time rankings!"</p>
            <p>Sorted Sets = built-in leaderboard engine.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Sorted Sets maintain ordered collection by score. Members unique, auto-sorted. O(log N) insert/update, O(log N + M) range queries. Perfect for leaderboards, trending lists, priority queues, time-series (score=timestamp).</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Sorted Set Leaderboard Commands</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Command</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Complexity</th></tr>
                    <tr><td style="padding: 8px;">ZADD</td><td>Add/update score</td><td>O(log N)</td></tr>
                    <tr><td style="padding: 8px;">ZREVRANGE</td><td>Top N players</td><td>O(log N + M)</td></tr>
                    <tr><td style="padding: 8px;">ZRANK</td><td>Player rank (low‚Üíhigh)</td><td>O(log N)</td></tr>
                    <tr><td style="padding: 8px;">ZREVRANK</td><td>Player rank (high‚Üílow)</td><td>O(log N)</td></tr>
                    <tr><td style="padding: 8px;">ZINCRBY</td><td>Increment score</td><td>O(log N)</td></tr>
                    <tr><td style="padding: 8px;">ZSCORE</td><td>Get player score</td><td>O(1)</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Why Sorted Set Perfect for Leaderboards:</strong></p>
                <ul>
                    <li><strong>Automatic sorting:</strong> Always ordered by score</li>
                    <li><strong>Fast updates:</strong> O(log N) even with 10M players</li>
                    <li><strong>Range queries:</strong> Top 10, rank 100-110, etc.</li>
                    <li><strong>Ties handled:</strong> Lexicographical order by name</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Leaderboard with Sorted Sets</div>
                <svg viewBox="0 0 900 440" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Gaming Leaderboard - 1 Million Players</text>
                    
                    <rect x="180" y="70" width="540" height="300" fill="rgba(220,20,60,0.05)" stroke="#DC143C" stroke-width="3" rx="10"/>
                    <text x="450" y="100" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">Sorted Set: "leaderboard"</text>
                    
                    <rect x="200" y="120" width="500" height="45" fill="rgba(255,215,0,0.4)" stroke="#FFD700" stroke-width="3" rx="6"/>
                    <text x="220" y="145" fill="#FFD700" font-size="14" font-weight="700">ü•á #1: AliceGamer - 10,000 pts</text>
                    <text x="600" y="145" fill="#888" font-size="9">ZREVRANK ‚Üí 0</text>
                    
                    <rect x="200" y="175" width="500" height="40" fill="rgba(192,192,192,0.3)" stroke="#C0C0C0" stroke-width="2" rx="6"/>
                    <text x="220" y="200" fill="#888" font-size="13" font-weight="600">ü•à #2: BobPro - 9,500 pts</text>
                    
                    <rect x="200" y="225" width="500" height="40" fill="rgba(205,127,50,0.3)" stroke="#CD7F32" stroke-width="2" rx="6"/>
                    <text x="220" y="250" fill="#CD7F32" font-size="13" font-weight="600">ü•â #3: CarolStar - 9,200 pts</text>
                    
                    <text x="450" y="285" text-anchor="middle" fill="#888" font-size="12">...</text>
                    <text x="450" y="300" text-anchor="middle" fill="#666" font-size="10">(997,000 players in between)</text>
                    <text x="450" y="315" text-anchor="middle" fill="#888" font-size="12">...</text>
                    
                    <rect x="200" y="325" width="500" height="30" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="220" y="345" fill="#00FF88" font-size="12">Rank #42,156: You - 5,430 pts</text>
                    <text x="600" y="345" fill="#888" font-size="9">O(log N)</text>
                    
                    <rect x="50" y="390" width="800" height="40" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="6"/>
                    <text x="450" y="415" text-anchor="middle" fill="#00FF88" font-size="12">
                        ‚ö° ZREVRANGE 0 99 ‚Üí Top 100 in &lt;1ms | ZREVRANK player ‚Üí Find rank instantly
                    </text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Leaderboard Operations</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Game Leaderboard</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Add players with scores</span>
r.zadd(<span class="string">'leaderboard'</span>, {
    <span class="string">'alice'</span>: <span class="number">10000</span>,
    <span class="string">'bob'</span>: <span class="number">9500</span>,
    <span class="string">'carol'</span>: <span class="number">9200</span>,
    <span class="string">'dave'</span>: <span class="number">8800</span>
})

<span class="comment"># Get top 10 (highest scores first)</span>
top10 = r.zrevrange(<span class="string">'leaderboard'</span>, <span class="number">0</span>, <span class="number">9</span>, withscores=<span class="keyword">True</span>)
<span class="keyword">print</span>(<span class="string">"üèÜ Top 10 Leaderboard:"</span>)
<span class="keyword">for</span> rank, (player, score) <span class="keyword">in</span> <span class="function">enumerate</span>(top10, <span class="number">1</span>):
    <span class="keyword">print</span>(<span class="string">f"  {rank}. {player}: {int(score)} points"</span>)

<span class="comment"># Get player rank (0-based, add 1 for display)</span>
rank = r.zrevrank(<span class="string">'leaderboard'</span>, <span class="string">'alice'</span>)
<span class="keyword">print</span>(<span class="string">f"\\nAlice rank: #{rank + 1}"</span>)

<span class="comment"># Increment player score</span>
new_score = r.zincrby(<span class="string">'leaderboard'</span>, <span class="number">500</span>, <span class="string">'bob'</span>)
<span class="keyword">print</span>(<span class="string">f"Bob new score: {int(new_score)}"</span>)

<span class="comment"># Get specific player score</span>
score = r.zscore(<span class="string">'leaderboard'</span>, <span class="string">'carol'</span>)
<span class="keyword">print</span>(<span class="string">f"Carol score: {int(score)}"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Show Player with Context</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Paginated Leaderboard</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">get_player_context</span>(player, context_size=<span class="number">5</span>):
    <span class="string">"""Show player with N above and N below"""</span>
    
    <span class="comment"># Get player rank</span>
    rank = r.zrevrank(<span class="string">'leaderboard'</span>, player)
    <span class="keyword">if</span> rank <span class="keyword">is</span> <span class="keyword">None</span>:
        <span class="keyword">return</span> <span class="string">f"Player {player} not found"</span>
    
    <span class="comment"># Calculate range (with boundaries)</span>
    start = <span class="function">max</span>(<span class="number">0</span>, rank - context_size)
    end = rank + context_size
    
    <span class="comment"># Get slice of leaderboard</span>
    results = r.zrevrange(<span class="string">'leaderboard'</span>, start, end, withscores=<span class="keyword">True</span>)
    
    <span class="keyword">print</span>(<span class="string">f"\\nüìä Leaderboard around {player}:\\n"</span>)
    <span class="keyword">for</span> i, (name, score) <span class="keyword">in</span> <span class="function">enumerate</span>(results):
        display_rank = start + i + <span class="number">1</span>
        marker = <span class="string">"üëâ"</span> <span class="keyword">if</span> name == player <span class="keyword">else</span> <span class="string">"  "</span>
        <span class="keyword">print</span>(<span class="string">f"{marker} #{display_rank}: {name} - {int(score)} pts"</span>)

<span class="comment"># Show Bob with 5 above and 5 below</span>
get_player_context(<span class="string">'bob'</span>, context_size=<span class="number">5</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Weekly Leaderboards</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Time-Based Rankings</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime

<span class="keyword">def</span> <span class="function">get_weekly_key</span>():
    <span class="string">"""Generate key for current week"""</span>
    week = datetime.now().strftime(<span class="string">"%Y-W%W"</span>)  <span class="comment"># e.g., "2024-W42"</span>
    <span class="keyword">return</span> <span class="string">f'leaderboard:weekly:{week}'</span>

<span class="keyword">def</span> <span class="function">add_weekly_score</span>(player, points):
    <span class="string">"""Add score to current week's leaderboard"""</span>
    key = get_weekly_key()
    r.zincrby(key, points, player)
    <span class="comment"># Auto-expire after 2 weeks</span>
    r.expire(key, <span class="number">604800</span> * <span class="number">2</span>)  <span class="comment"># 2 weeks in seconds</span>

<span class="keyword">def</span> <span class="function">get_weekly_top10</span>():
    <span class="string">"""Get this week's top 10"""</span>
    key = get_weekly_key()
    <span class="keyword">return</span> r.zrevrange(key, <span class="number">0</span>, <span class="number">9</span>, withscores=<span class="keyword">True</span>)

<span class="comment"># Usage</span>
add_weekly_score(<span class="string">'alice'</span>, <span class="number">100</span>)
add_weekly_score(<span class="string">'bob'</span>, <span class="number">150</span>)

<span class="keyword">print</span>(<span class="string">f"\\nüìÖ Weekly Leaderboard ({get_weekly_key()}):"</span>)
<span class="keyword">for</span> rank, (player, score) <span class="keyword">in</span> <span class="function">enumerate</span>(get_weekly_top10(), <span class="number">1</span>):
    <span class="keyword">print</span>(<span class="string">f"  {rank}. {player}: {int(score)} pts"</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: How does Sorted Set handle ties (same score)?</h4>
                <p><strong>A:</strong> Lexicographical order by member name! Both have score 100 ‚Üí "alice" ranks before "bob". For true ties, use microsecond timestamp in score (100.000001) or accept lexical ordering!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can Sorted Sets handle millions of players?</h4>
                <p><strong>A:</strong> YES! O(log N) scales well. 10M players = ~24 comparisons. BUT memory: ~100 bytes/player. 10M = 1GB RAM. Monitor memory usage. For 100M+, consider sharding by region/tier!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: ZRANGE vs ZREVRANGE?</h4>
                <p><strong>A:</strong> Order! ZRANGE: Lowest‚ÜíHighest (ascending). ZREVRANGE: Highest‚ÜíLowest (descending). Leaderboards use ZREVRANGE (best players first). Priority queue uses ZRANGE (lowest priority processed first)!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: ZRANK vs ZREVRANK - which for leaderboards?</h4>
                <p><strong>Answer:</strong> ZREVRANK! Returns rank from highest score (0 = best player). ZRANK returns rank from lowest score (0 = worst player). Leaderboards want best-first, so ZREVRANK!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Scores are floats - precision issues?</h4>
                <p><strong>Answer:</strong> YES! Redis uses doubles (53-bit precision). For exact scores: Use integers (multiply by 100 for cents, by 1000 for milliseconds). Or use score=timestamp for time-based ranking. Never rely on float equality!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Mobile Game with 5M Active Players</strong></p>
            <p>Need: Global leaderboard + Friends leaderboard + Weekly tournaments + Daily challenges!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Multiple Sorted Sets</h4>
                <p><strong>Global:</strong> leaderboard:global (5M users, ~500MB)<br>
                <strong>Friends:</strong> leaderboard:user:123:friends (~100 per user)<br>
                <strong>Weekly:</strong> leaderboard:weekly:2024-W42 (auto-expire)<br>
                <strong>Tournament:</strong> tournament:spring2024 (temp)<br>
                <strong>Daily:</strong> leaderboard:daily:2024-10-15 (24hr TTL)</p>
                <p><strong>Results:</strong> ‚úÖ Sub-ms queries for any leaderboard ‚úÖ Real-time score updates ‚úÖ Multiple ranking dimensions ‚úÖ Scales to millions ‚úÖ Memory efficient with TTLs</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üèÜ</span><p><strong>Perfect for rankings</strong> - Auto-sorted by score</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>O(log N) updates</strong> - Fast with millions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>ZREVRANGE top N</strong> - Highest scores first</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>ZREVRANK position</strong> - Find player rank</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìÖ</span><p><strong>Time-based keys</strong> - Weekly/daily boards</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Monitor memory</strong> - ~100 bytes per entry</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Sorted Set</span><span class="keyword-tag">Leaderboard</span><span class="keyword-tag">ZADD</span><span class="keyword-tag">ZREVRANGE</span><span class="keyword-tag">ZREVRANK</span><span class="keyword-tag">Rankings</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Game with 1M players. Need top 100 leaderboard updated in real-time. Best solution?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Database ORDER BY LIMIT 100</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Redis Sorted Set ZREVRANGE</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Sort in application memory</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Keep separate top 100 list</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Redis Sorted Set</strong>
                    <p>Sorted Set PERFECT! Auto-sorted by score, ZREVRANGE(0, 99) gets top 100 in &lt;1ms. ZADD updates in O(log N). ZREVRANK finds any player rank instantly. Database ORDER BY too slow. App memory not shared across servers. Maintaining separate top 100 complex and error-prone. Sorted Set = built-in leaderboard!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 61: Redis Transactions (MULTI/EXEC)
// ============================================================

function getQuestion61Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Race condition disaster:</strong> "Money transfer: Read balance (100), deduct 50, write 50. But another request reads 100 simultaneously, deducts 30, writes 70. Result: 70 instead of 20! Lost 50 dollars!" Architect: "Use Redis MULTI/EXEC! Queue commands atomically. All-or-nothing execution. No interleaving!"</p>
            <p>Transactions = atomic command groups.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis transactions (MULTI/EXEC) execute multiple commands atomically. Commands queued, executed together. No other commands can run between. Optional WATCH for optimistic locking. Not like SQL transactions (no rollback on error).</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Transaction Commands</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Command</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">When</th></tr>
                    <tr><td style="padding: 8px;">MULTI</td><td>Start transaction</td><td>Begin queuing commands</td></tr>
                    <tr><td style="padding: 8px;">EXEC</td><td>Execute all</td><td>Run queued commands atomically</td></tr>
                    <tr><td style="padding: 8px;">DISCARD</td><td>Cancel transaction</td><td>Clear queue without executing</td></tr>
                    <tr><td style="padding: 8px;">WATCH</td><td>Optimistic lock</td><td>Monitor keys for changes</td></tr>
                    <tr><td style="padding: 8px;">UNWATCH</td><td>Remove locks</td><td>Clear all WATCH</td></tr>
                </table>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border-left: 3px solid #FF6347; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>‚ö†Ô∏è Important Differences from SQL:</strong></p>
                <ul>
                    <li><strong>No rollback:</strong> Error in one command doesn't undo others</li>
                    <li><strong>Commands queued:</strong> Not executed until EXEC</li>
                    <li><strong>All-or-nothing scheduling:</strong> No interleaving</li>
                    <li><strong>WATCH for CAS:</strong> Compare-and-swap pattern</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">MULTI/EXEC Transaction Flow</div>
                <svg viewBox="0 0 900 450" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Atomic Transaction Execution</text>
                    
                    <!-- Client 1 -->
                    <rect x="50" y="70" width="180" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="140" y="105" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üë§ Client 1</text>
                    
                    <!-- Transaction Steps -->
                    <path d="M 140 130 L 140 180" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    
                    <rect x="50" y="180" width="180" height="200" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="140" y="205" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">Transaction Queue</text>
                    
                    <text x="60" y="230" fill="#888" font-size="11">1. MULTI</text>
                    <text x="60" y="250" fill="#888" font-size="11">2. GET balance</text>
                    <text x="60" y="270" fill="#888" font-size="11">3. DECRBY balance 50</text>
                    <text x="60" y="290" fill="#888" font-size="11">4. INCRBY target 50</text>
                    <text x="60" y="310" fill="#888" font-size="11">5. SET log "transfer"</text>
                    <text x="60" y="340" fill="#DC143C" font-size="12" font-weight="600">6. EXEC ‚Üí</text>
                    
                    <!-- Redis -->
                    <path d="M 230 290 L 350 290" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    <text x="290" y="280" text-anchor="middle" fill="#DC143C" font-size="10">Atomic execution</text>
                    
                    <rect x="350" y="180" width="200" height="200" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="205" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="600">‚ö° Redis</text>
                    <text x="450" y="230" text-anchor="middle" fill="#888" font-size="11">All commands execute</text>
                    <text x="450" y="250" text-anchor="middle" fill="#888" font-size="11">together - no other</text>
                    <text x="450" y="270" text-anchor="middle" fill="#888" font-size="11">clients can interfere</text>
                    <text x="450" y="310" text-anchor="middle" fill="#00FF88" font-size="12">‚úÖ Atomicity</text>
                    <text x="450" y="330" text-anchor="middle" fill="#00FF88" font-size="12">‚úÖ Isolation</text>
                    <text x="450" y="350" text-anchor="middle" fill="#00FF88" font-size="12">‚úÖ Consistency</text>
                    
                    <!-- Client 2 Blocked -->
                    <rect x="650" y="180" width="200" height="100" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="750" y="205" text-anchor="middle" fill="#FF6347" font-size="13" font-weight="600">üë§ Client 2</text>
                    <text x="750" y="230" text-anchor="middle" fill="#888" font-size="10">Trying to access</text>
                    <text x="750" y="245" text-anchor="middle" fill="#888" font-size="10">same keys...</text>
                    <text x="750" y="265" text-anchor="middle" fill="#FF6347" font-size="11">‚è≥ Waits until EXEC</text>
                    
                    <rect x="50" y="410" width="800" height="30" fill="rgba(0,0,0,0.3)" stroke="#666" stroke-width="2" rx="6"/>
                    <text x="450" y="430" text-anchor="middle" fill="#00FF88" font-size="11">
                        Result: All 5 commands executed atomically - no partial updates!
                    </text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Transaction</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Money Transfer</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="keyword">def</span> <span class="function">transfer_money</span>(from_account, to_account, amount):
    <span class="string">"""Transfer money atomically"""</span>
    pipe = r.pipeline()  <span class="comment"># Creates MULTI/EXEC pipeline</span>
    
    <span class="comment"># Queue commands (not executed yet)</span>
    pipe.decrby(from_account, amount)
    pipe.incrby(to_account, amount)
    pipe.set(<span class="string">'last_transfer'</span>, <span class="string">f'{from_account}->{to_account}'</span>)
    
    <span class="comment"># Execute all atomically</span>
    results = pipe.execute()
    
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Transferred ${amount}"</span>)
    <span class="keyword">print</span>(<span class="string">f"Results: {results}"</span>)

<span class="comment"># Usage</span>
r.set(<span class="string">'account:alice'</span>, <span class="number">1000</span>)
r.set(<span class="string">'account:bob'</span>, <span class="number">500</span>)

transfer_money(<span class="string">'account:alice'</span>, <span class="string">'account:bob'</span>, <span class="number">200</span>)

<span class="keyword">print</span>(<span class="string">f"Alice: ${r.get('account:alice')}"</span>)  <span class="comment"># 800</span>
<span class="keyword">print</span>(<span class="string">f"Bob: ${r.get('account:bob')}"</span>)      <span class="comment"># 700</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: WATCH for Optimistic Locking</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Check-and-Set Pattern</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">safe_increment</span>(key, max_value=<span class="number">100</span>):
    <span class="string">"""Increment only if under max (with retry)"""</span>
    
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="keyword">try</span>:
            <span class="comment"># Watch key for changes</span>
            r.watch(key)
            
            <span class="comment"># Read current value</span>
            current = <span class="function">int</span>(r.get(key) <span class="keyword">or</span> <span class="number">0</span>)
            
            <span class="comment"># Check condition</span>
            <span class="keyword">if</span> current >= max_value:
                r.unwatch()
                <span class="keyword">return</span> <span class="keyword">False</span>, <span class="string">"Max reached"</span>
            
            <span class="comment"># Start transaction</span>
            pipe = r.pipeline()
            pipe.incr(key)
            pipe.execute()  <span class="comment"># Fails if key changed!</span>
            
            <span class="keyword">return</span> <span class="keyword">True</span>, current + <span class="number">1</span>
            
        <span class="keyword">except</span> redis.WatchError:
            <span class="comment"># Key changed by another client - retry</span>
            <span class="keyword">print</span>(<span class="string">"‚ö†Ô∏è Conflict detected, retrying..."</span>)
            <span class="keyword">continue</span>

<span class="comment"># Usage - safe concurrent increments</span>
success, value = safe_increment(<span class="string">'counter'</span>)
<span class="keyword">if</span> success:
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Incremented to {value}"</span>)
<span class="keyword">else</span>:
    <span class="keyword">print</span>(<span class="string">f"‚ùå {value}"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Node.js Transaction</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Node.js - Atomic Operations</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">const</span> redis = <span class="function">require</span>(<span class="string">'redis'</span>);
<span class="keyword">const</span> client = redis.createClient();

<span class="keyword">async function</span> <span class="function">atomicUpdate</span>(userId) {
    <span class="keyword">const</span> multi = client.multi();
    
    <span class="comment">// Queue multiple operations</span>
    multi.hincrby(<span class="string">\`user:\${userId}\`</span>, <span class="string">'posts'</span>, <span class="number">1</span>);
    multi.hincrby(<span class="string">\`user:\${userId}\`</span>, <span class="string">'score'</span>, <span class="number">10</span>);
    multi.zadd(<span class="string">'leaderboard'</span>, <span class="number">10</span>, userId);
    multi.lpush(<span class="string">'recent_activity'</span>, <span class="string">\`\${userId}:post\`</span>);
    
    <span class="comment">// Execute atomically</span>
    <span class="keyword">const</span> results = <span class="keyword">await</span> multi.exec();
    
    console.log(<span class="string">'‚úÖ All updates completed'</span>, results);
}

<span class="keyword">await</span> atomicUpdate(<span class="string">'user_123'</span>);</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Does Redis transaction rollback on error?</h4>
                <p><strong>A:</strong> NO! Unlike SQL. If command 3 of 5 fails, commands 1-2 already executed, 4-5 still execute. No automatic rollback. Use Lua scripts for true atomicity with rollback logic!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Transaction vs Pipeline - what's difference?</h4>
                <p><strong>A:</strong> Pipeline: Batch commands for network efficiency (not atomic). Transaction (MULTI/EXEC): Atomic execution (no interleaving). Pipeline faster for non-critical batches. Transaction for consistency!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: When to use WATCH?</h4>
                <p><strong>A:</strong> Optimistic locking! Read value, check condition, update if unchanged. Example: Increment only if under limit. WATCH fails transaction if key changes. Retry loop handles conflicts!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I read values inside MULTI/EXEC?</h4>
                <p><strong>Answer:</strong> NO directly! Commands queued, not executed. GET returns "QUEUED", not value. Solution: Read BEFORE MULTI, or use WATCH pattern, or use Lua script (can read during execution)!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Transaction across Redis Cluster?</h4>
                <p><strong>Answer:</strong> Only if all keys in SAME slot! Use hash tags: {user123}:balance, {user123}:history - same slot. Different slots? Transaction fails. Design keys carefully for Cluster!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Order Processing</strong></p>
            <p>Place order: Decrement inventory, create order, update user stats, add to recent. All must succeed together!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Transaction with WATCH</h4>
                <p><strong>Steps:</strong> WATCH inventory ‚Üí Check stock > 0 ‚Üí MULTI ‚Üí DECRBY inventory ‚Üí SADD orders ‚Üí HINCRBY user:stats ‚Üí LPUSH recent ‚Üí EXEC<br>
                <strong>If stock changed:</strong> WatchError ‚Üí Retry<br>
                <strong>Result:</strong> Atomic order - no overselling!</p>
                <p><strong>Benefits:</strong> ‚úÖ No race conditions ‚úÖ Inventory accurate ‚úÖ Order consistency ‚úÖ Handles concurrent requests</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚öõÔ∏è</span><p><strong>MULTI/EXEC atomic</strong> - All commands together</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ùå</span><p><strong>No rollback</strong> - Unlike SQL transactions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üëÅÔ∏è</span><p><strong>WATCH for CAS</strong> - Optimistic locking</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¶</span><p><strong>Commands queued</strong> - Not executed until EXEC</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Retry on WatchError</strong> - Handle conflicts</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Cluster limitation</strong> - Same slot only</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">MULTI</span><span class="keyword-tag">EXEC</span><span class="keyword-tag">WATCH</span><span class="keyword-tag">Transactions</span><span class="keyword-tag">Atomicity</span><span class="keyword-tag">Pipeline</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Transfer money: deduct from A, add to B. Need both succeed together. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Two separate commands</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) MULTI/EXEC transaction</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Pipeline (non-atomic)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Two separate connections</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - MULTI/EXEC transaction</strong>
                    <p>MULTI/EXEC ensures both operations execute atomically! DECRBY A, INCRBY B - both or neither. No partial updates. Separate commands = race condition (A deducted, crash before B credited). Pipeline batches for speed but not atomic. MULTI/EXEC = consistency guarantee!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 62: Redis Pipelining vs Transactions
// ============================================================

function getQuestion62Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Performance problem:</strong> "Need to SET 1000 keys. Sequential: 1 second (1ms per round-trip). Too slow!" Developer: "Use pipelining! Batch all commands in one network round-trip. 1000 SETs in 10ms. 100x faster! But not atomic like transactions. Choose based on need!"</p>
            <p>Pipeline = speed. Transaction = consistency.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Pipeline sends multiple commands without waiting for replies (batching network). Transaction (MULTI/EXEC) executes commands atomically (no interleaving). Pipeline = performance. Transaction = atomicity. Can combine both!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Pipeline vs Transaction Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Feature</th><th style="padding: 10px;">Pipeline</th><th style="padding: 10px;">Transaction</th></tr>
                    <tr><td style="padding: 8px;">Speed</td><td>Very fast (1 round-trip)</td><td>Fast but atomic</td></tr>
                    <tr><td style="padding: 8px;">Atomicity</td><td>‚ùå No guarantee</td><td>‚úÖ All-or-nothing</td></tr>
                    <tr><td style="padding: 8px;">Interleaving</td><td>‚ùå Other commands can run</td><td>‚úÖ Blocked</td></tr>
                    <tr><td style="padding: 8px;">Use Case</td><td>Bulk operations</td><td>Consistency required</td></tr>
                    <tr><td style="padding: 8px;">Commands</td><td>None (implicit)</td><td>MULTI/EXEC</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Best Practices:</strong></p>
                <ul>
                    <li><strong>Pipeline:</strong> Bulk writes, batch reads, non-critical updates</li>
                    <li><strong>Transaction:</strong> Money transfers, inventory, critical state</li>
                    <li><strong>Both:</strong> Atomic bulk operations (pipeline inside MULTI)</li>
                    <li><strong>Neither:</strong> Single command is already atomic</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Pipeline vs Transaction</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Network Efficiency Comparison</text>
                    
                    <!-- Sequential -->
                    <text x="150" y="65" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">Sequential (Slow)</text>
                    <rect x="50" y="80" width="200" height="80" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="150" y="105" text-anchor="middle" fill="#888" font-size="10">SET key1 ‚Üí wait</text>
                    <text x="150" y="120" text-anchor="middle" fill="#888" font-size="10">SET key2 ‚Üí wait</text>
                    <text x="150" y="135" text-anchor="middle" fill="#888" font-size="10">SET key3 ‚Üí wait</text>
                    <text x="150" y="150" text-anchor="middle" fill="#FF6347" font-size="11">3 round-trips = 3ms</text>
                    
                    <!-- Pipeline -->
                    <text x="450" y="65" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">Pipeline (Fast)</text>
                    <rect x="350" y="80" width="200" height="80" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="105" text-anchor="middle" fill="#888" font-size="10">SET key1 (queue)</text>
                    <text x="450" y="120" text-anchor="middle" fill="#888" font-size="10">SET key2 (queue)</text>
                    <text x="450" y="135" text-anchor="middle" fill="#888" font-size="10">SET key3 (queue)</text>
                    <text x="450" y="150" text-anchor="middle" fill="#00FF88" font-size="11">1 round-trip = 1ms</text>
                    
                    <!-- Transaction -->
                    <text x="750" y="65" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="600">Transaction (Atomic)</text>
                    <rect x="650" y="80" width="200" height="80" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="750" y="100" text-anchor="middle" fill="#888" font-size="10">MULTI</text>
                    <text x="750" y="115" text-anchor="middle" fill="#888" font-size="10">SET key1, SET key2, SET key3</text>
                    <text x="750" y="130" text-anchor="middle" fill="#888" font-size="10">EXEC</text>
                    <text x="750" y="150" text-anchor="middle" fill="#9C27B0" font-size="11">Fast + Atomic</text>
                    
                    <!-- Performance Chart -->
                    <rect x="50" y="200" width="800" height="200" fill="rgba(0,0,0,0.2)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="225" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="700">1000 Commands Performance</text>
                    
                    <!-- Bars -->
                    <rect x="100" y="250" width="150" height="120" fill="rgba(255,69,0,0.3)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="175" y="340" text-anchor="middle" fill="#FF6347" font-size="13" font-weight="600">Sequential</text>
                    <text x="175" y="360" text-anchor="middle" fill="#888" font-size="11">1000ms</text>
                    
                    <rect x="320" y="310" width="150" height="60" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="395" y="340" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">Pipeline</text>
                    <text x="395" y="360" text-anchor="middle" fill="#888" font-size="11">10ms (100x)</text>
                    
                    <rect x="540" y="320" width="150" height="50" fill="rgba(156,39,176,0.3)" stroke="#9C27B0" stroke-width="2" rx="4"/>
                    <text x="615" y="350" text-anchor="middle" fill="#9C27B0" font-size="13" font-weight="600">Transaction</text>
                    <text x="615" y="370" text-anchor="middle" fill="#888" font-size="11">12ms (atomic)</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Pipeline for Bulk Operations</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Fast Bulk Writes</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis()

<span class="comment"># Slow: Sequential (1000ms)</span>
start = time.time()
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
    r.set(<span class="string">f'key:{i}'</span>, <span class="string">f'value{i}'</span>)
<span class="keyword">print</span>(<span class="string">f"Sequential: {(time.time() - start) * 1000:.1f}ms"</span>)

<span class="comment"># Fast: Pipeline (10ms)</span>
start = time.time()
pipe = r.pipeline(transaction=<span class="keyword">False</span>)  <span class="comment"># No MULTI/EXEC</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
    pipe.set(<span class="string">f'key:{i}'</span>, <span class="string">f'value{i}'</span>)
pipe.execute()
<span class="keyword">print</span>(<span class="string">f"Pipeline: {(time.time() - start) * 1000:.1f}ms"</span>)

<span class="comment"># Result: 100x faster! ‚ö°</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Transaction for Atomicity</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Atomic Guarantees</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Pipeline (Not Atomic)</span>
pipe = r.pipeline(transaction=<span class="keyword">False</span>)
pipe.decrby(<span class="string">'inventory:item123'</span>, <span class="number">1</span>)
pipe.incrby(<span class="string">'orders_count'</span>, <span class="number">1</span>)
pipe.execute()
<span class="comment"># ‚ö†Ô∏è Other commands can run between these!</span>

<span class="comment"># Transaction (Atomic)</span>
pipe = r.pipeline(transaction=<span class="keyword">True</span>)  <span class="comment"># With MULTI/EXEC</span>
pipe.decrby(<span class="string">'inventory:item123'</span>, <span class="number">1</span>)
pipe.incrby(<span class="string">'orders_count'</span>, <span class="number">1</span>)
pipe.execute()
<span class="comment"># ‚úÖ Both execute atomically - no interleaving!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Combined Approach</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Best of Both Worlds</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">bulk_user_updates</span>(user_updates):
    <span class="string">"""Update many users atomically per user, fast overall"""</span>
    
    <span class="keyword">for</span> user_id, data <span class="keyword">in</span> user_updates.items():
        <span class="comment"># Each user: atomic transaction</span>
        pipe = r.pipeline(transaction=<span class="keyword">True</span>)
        
        <span class="comment"># Multiple updates for this user (atomic)</span>
        pipe.hset(<span class="string">f'user:{user_id}'</span>, <span class="string">'score'</span>, data[<span class="string">'score'</span>])
        pipe.hset(<span class="string">f'user:{user_id}'</span>, <span class="string">'level'</span>, data[<span class="string">'level'</span>])
        pipe.zadd(<span class="string">'leaderboard'</span>, {user_id: data[<span class="string">'score'</span>]})
        
        pipe.execute()
        <span class="comment"># Each user atomic, but fast batch processing</span>

<span class="comment"># Update 1000 users - atomic per user, fast overall</span>
updates = {<span class="string">f'user{i}'</span>: {<span class="string">'score'</span>: i*<span class="number">10</span>, <span class="string">'level'</span>: i} <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>)}
bulk_user_updates(updates)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: When to use pipeline vs transaction?</h4>
                <p><strong>A:</strong> Pipeline: Bulk operations, speed critical, atomicity not needed (cache warm, batch reads). Transaction: Consistency required (money transfer, inventory). Can combine: Transaction for atomicity, pipeline for speed!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can I use pipeline for reads?</h4>
                <p><strong>A:</strong> YES! Batch multiple GETs, HGETALLs, etc. Results returned in order. Great for: Get 100 user profiles, fetch multiple cache keys. Still 100x faster than sequential!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: How big should pipeline batches be?</h4>
                <p><strong>A:</strong> 100-1000 commands ideal. Too small = less benefit. Too large = memory issues, blocking. For millions: batch in chunks of 1000. Monitor Redis memory during pipeline!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Pipeline with transaction=True vs False?</h4>
                <p><strong>Answer:</strong> transaction=True adds MULTI/EXEC (atomic). transaction=False pure pipeline (batching only). Python redis.pipeline() defaults to True! Explicitly set False for non-atomic bulk operations!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can another client read between pipeline commands?</h4>
                <p><strong>Answer:</strong> YES if transaction=False! Pipeline batches network, NOT execution. Commands still execute one-by-one on server. For true atomicity: transaction=True (MULTI/EXEC)!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Loading 10,000 Products at Startup</strong></p>
            <p>App starts, needs to cache 10K products from DB. Sequential: 10 seconds. Unacceptable!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Pipeline in Batches</h4>
                <p><strong>Strategy:</strong> Batch 1000 products per pipeline (10 batches)<br>
                <strong>Code:</strong> for batch in chunks(products, 1000): pipe = pipeline(False); batch SET commands; execute()<br>
                <strong>Time:</strong> 10 seconds ‚Üí 100ms (100x faster!)</p>
                <p><strong>Results:</strong> ‚úÖ Fast startup ‚úÖ Low memory ‚úÖ No Redis blocking ‚úÖ Atomicity not needed (cache warm)</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Pipeline = speed</strong> - Batch network round-trips</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚öõÔ∏è</span><p><strong>Transaction = atomicity</strong> - MULTI/EXEC guarantee</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Choose based on need</strong> - Speed vs consistency</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¶</span><p><strong>Batch size 100-1000</strong> - Sweet spot</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Can combine both</strong> - Pipeline + MULTI/EXEC</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>100x speedup typical</strong> - For bulk operations</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Pipeline</span><span class="keyword-tag">Transaction</span><span class="keyword-tag">Bulk Operations</span><span class="keyword-tag">Performance</span><span class="keyword-tag">Atomicity</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need to SET 1000 cache keys. Speed critical, atomicity not needed. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) 1000 individual SET commands</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Pipeline (transaction=False)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) MULTI/EXEC transaction</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Lua script</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Pipeline (transaction=False)</strong>
                    <p>Pipeline perfect for bulk operations! Batches 1000 commands in 1 network round-trip = 100x faster. transaction=False skips MULTI/EXEC overhead (no atomicity needed for cache). Individual commands = 1000 round-trips (slow). MULTI/EXEC adds overhead. Lua script overkill. Pipeline = speed champion!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 63: Redis Memory Optimization Techniques
// ============================================================

function getQuestion63Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Memory crisis:</strong> "Redis using 8GB RAM for 1M keys! OOM kills every day! Costs skyrocketing!" Engineer: "Optimize! Use Hashes for small objects (ziplist encoding). Short key names. Enable compression. Eviction policy. Result: 8GB ‚Üí 2GB! 75% savings!"</p>
            <p>Memory optimization = cost savings.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis memory optimization: (1) Use Hashes for small objects (ziplist encoding saves 40-60%), (2) Short key names, (3) Appropriate data structures, (4) Eviction policies, (5) Compression, (6) Monitor with INFO memory.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Memory Optimization Techniques</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Technique</th><th style="padding: 10px;">Savings</th><th style="padding: 10px;">Trade-off</th></tr>
                    <tr><td style="padding: 8px;">Hash ziplist</td><td>40-60%</td><td>Slight read overhead</td></tr>
                    <tr><td style="padding: 8px;">Short key names</td><td>10-20%</td><td>Less readable</td></tr>
                    <tr><td style="padding: 8px;">Eviction policy</td><td>Prevents OOM</td><td>Data loss</td></tr>
                    <tr><td style="padding: 8px;">Compression</td><td>30-50%</td><td>CPU overhead</td></tr>
                    <tr><td style="padding: 8px;">Remove TTL granularity</td><td>5-10%</td><td>Less precision</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Key Optimization Strategy:</strong></p>
                <ul>
                    <li><strong>Consolidate keys:</strong> 4M keys ‚Üí 1M Hash keys = 75% less memory</li>
                    <li><strong>Short names:</strong> "u:123" vs "user:12345:profile" saves 40 bytes/key</li>
                    <li><strong>Ziplist tuning:</strong> hash-max-ziplist-entries 512 (default)</li>
                    <li><strong>Monitor fragmentation:</strong> Restart if ratio > 2.0</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Memory Usage Comparison</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">1M User Profiles - Memory Comparison</text>
                    
                    <!-- Unoptimized -->
                    <rect x="80" y="60" width="180" height="250" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="3" rx="8"/>
                    <text x="170" y="85" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">‚ùå Unoptimized</text>
                    <text x="170" y="110" text-anchor="middle" fill="#888" font-size="10">Separate String keys</text>
                    <text x="170" y="130" fill="#bbb" font-size="9">user:12345:name</text>
                    <text x="170" y="145" fill="#bbb" font-size="9">user:12345:email</text>
                    <text x="170" y="160" fill="#bbb" font-size="9">user:12345:age</text>
                    <text x="170" y="175" fill="#bbb" font-size="9">user:12345:city</text>
                    <text x="170" y="200" text-anchor="middle" fill="#FF6347" font-size="16" font-weight="700">8 GB</text>
                    <text x="170" y="230" text-anchor="middle" fill="#888" font-size="10">4M keys total</text>
                    <text x="170" y="245" text-anchor="middle" fill="#888" font-size="10">Long key names</text>
                    <text x="170" y="260" text-anchor="middle" fill="#888" font-size="10">Overhead per key</text>
                    <text x="170" y="295" text-anchor="middle" fill="#FF6347" font-size="12">üí∏ $800/month</text>
                    
                    <!-- Optimized -->
                    <rect x="340" y="160" width="180" height="150" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="430" y="185" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">‚úÖ Optimized</text>
                    <text x="430" y="205" text-anchor="middle" fill="#888" font-size="10">Hash ziplist</text>
                    <text x="430" y="220" fill="#bbb" font-size="9">u:12345 ‚Üí Hash</text>
                    <text x="430" y="235" fill="#bbb" font-size="9">{n, e, a, c}</text>
                    <text x="430" y="260" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="700">2 GB</text>
                    <text x="430" y="285" text-anchor="middle" fill="#888" font-size="10">1M keys only</text>
                    <text x="430" y="300" text-anchor="middle" fill="#00FF88" font-size="11">75% savings!</text>
                    
                    <!-- Arrow -->
                    <path d="M 260 200 L 340 235" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    <text x="300" y="210" text-anchor="middle" fill="#00FF88" font-size="12">-6 GB</text>
                    
                    <!-- Techniques -->
                    <rect x="600" y="60" width="250" height="250" fill="rgba(0,0,0,0.2)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="725" y="85" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">Optimization Techniques</text>
                    <text x="615" y="110" fill="#00FF88" font-size="11">1. Hash ziplist encoding</text>
                    <text x="625" y="125" fill="#888" font-size="9">hash-max-ziplist-entries 512</text>
                    <text x="615" y="150" fill="#00FF88" font-size="11">2. Short key names</text>
                    <text x="625" y="165" fill="#888" font-size="9">u:123 not user:12345:profile</text>
                    <text x="615" y="190" fill="#00FF88" font-size="11">3. Eviction policy</text>
                    <text x="625" y="205" fill="#888" font-size="9">maxmemory-policy allkeys-lru</text>
                    <text x="615" y="230" fill="#00FF88" font-size="11">4. Monitor memory</text>
                    <text x="625" y="245" fill="#888" font-size="9">INFO memory, --bigkeys</text>
                    <text x="615" y="270" fill="#FFA500" font-size="11">5. Set max memory</text>
                    <text x="625" y="285" fill="#888" font-size="9">maxmemory 4gb</text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Hash Optimization</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Memory Efficient Storage</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
r = redis.Redis()

<span class="comment"># ‚ùå Inefficient: Separate keys (8 GB for 1M users)</span>
<span class="keyword">def</span> <span class="function">store_user_inefficient</span>(user_id, data):
    r.set(<span class="string">f'user:{user_id}:name'</span>, data[<span class="string">'name'</span>])
    r.set(<span class="string">f'user:{user_id}:email'</span>, data[<span class="string">'email'</span>])
    r.set(<span class="string">f'user:{user_id}:age'</span>, data[<span class="string">'age'</span>])
    r.set(<span class="string">f'user:{user_id}:city'</span>, data[<span class="string">'city'</span>])
    <span class="comment"># 4 keys per user = 4M keys total!</span>

<span class="comment"># ‚úÖ Efficient: Hash with short keys (2 GB for 1M users)</span>
<span class="keyword">def</span> <span class="function">store_user_efficient</span>(user_id, data):
    r.hset(<span class="string">f'u:{user_id}'</span>, mapping={
        <span class="string">'n'</span>: data[<span class="string">'name'</span>],     <span class="comment"># Short field names</span>
        <span class="string">'e'</span>: data[<span class="string">'email'</span>],
        <span class="string">'a'</span>: data[<span class="string">'age'</span>],
        <span class="string">'c'</span>: data[<span class="string">'city'</span>]
    })
    <span class="comment"># 1 key per user = 1M keys total (75% less memory!)</span>

<span class="comment"># Retrieve efficiently</span>
user_data = r.hgetall(<span class="string">'u:12345'</span>)
<span class="keyword">print</span>(user_data)  <span class="comment"># {b'n': b'Alice', b'e': b'alice@example.com'...}</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Configure Memory Limits</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - Memory Configuration</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Set max memory (prevents OOM kills)</span>
<span class="keyword">maxmemory</span> <span class="number">4gb</span>

<span class="comment"># Eviction policy (when maxmemory reached)</span>
<span class="keyword">maxmemory-policy</span> allkeys-lru  <span class="comment"># LRU eviction</span>

<span class="comment"># Hash ziplist optimization (use for small hashes)</span>
<span class="keyword">hash-max-ziplist-entries</span> <span class="number">512</span>
<span class="keyword">hash-max-ziplist-value</span> <span class="number">64</span>

<span class="comment"># List optimization</span>
<span class="keyword">list-max-ziplist-size</span> <span class="number">-2</span>

<span class="comment"># Set optimization</span>
<span class="keyword">set-max-intset-entries</span> <span class="number">512</span>

<span class="comment"># Zset optimization</span>
<span class="keyword">zset-max-ziplist-entries</span> <span class="number">128</span>
<span class="keyword">zset-max-ziplist-value</span> <span class="number">64</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Monitor Memory Usage</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Memory Monitoring</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">check_memory</span>():
    info = r.info(<span class="string">'memory'</span>)
    
    used_gb = info[<span class="string">'used_memory'</span>] / (<span class="number">1024</span>**<span class="number">3</span>)
    rss_gb = info[<span class="string">'used_memory_rss'</span>] / (<span class="number">1024</span>**<span class="number">3</span>)
    peak_gb = info[<span class="string">'used_memory_peak'</span>] / (<span class="number">1024</span>**<span class="number">3</span>)
    frag_ratio = info[<span class="string">'mem_fragmentation_ratio'</span>]
    
    <span class="keyword">print</span>(<span class="string">f"Used Memory: {used_gb:.2f} GB"</span>)
    <span class="keyword">print</span>(<span class="string">f"RSS Memory: {rss_gb:.2f} GB"</span>)
    <span class="keyword">print</span>(<span class="string">f"Peak Memory: {peak_gb:.2f} GB"</span>)
    <span class="keyword">print</span>(<span class="string">f"Fragmentation: {frag_ratio:.2f}"</span>)
    
    <span class="keyword">if</span> frag_ratio > <span class="number">2.0</span>:
        <span class="keyword">print</span>(<span class="string">"‚ö†Ô∏è High fragmentation - consider restart"</span>)
    
    <span class="keyword">if</span> used_gb > <span class="number">3.5</span>:
        <span class="keyword">print</span>(<span class="string">"‚ö†Ô∏è Approaching max memory (4 GB)"</span>)

check_memory()</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why use Hash instead of separate keys?</h4>
                <p><strong>A:</strong> Ziplist encoding! Small hashes stored as compact array (40-60% less memory). Separate keys = overhead per key. 1M users with 4 fields: Hash = 1M keys, Strings = 4M keys. Huge savings!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What's mem_fragmentation_ratio?</h4>
                <p><strong>A:</strong> used_memory_rss / used_memory. Ideal: 1.0-1.5. >2.0 = fragmentation (Redis allocated but not using efficiently). Fix: Restart Redis to defragment. Or use activedefrag (Redis 4.0+)!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Which eviction policy for cache?</h4>
                <p><strong>A:</strong> allkeys-lru (Least Recently Used)! Evicts least used keys when memory full. For cache, all keys eligible. Other policies: volatile-lru (only keys with TTL), noeviction (errors when full)!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Short key names - worth the trade-off?</h4>
                <p><strong>Answer:</strong> Depends! 1M keys: "u:123" vs "user:12345" saves ~40 bytes √ó 1M = 40MB. Small savings. But: 100M keys = 4GB savings! Large scale: YES. Small scale: Readability wins!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Hash ziplist breaks when?</h4>
                <p><strong>Answer:</strong> When hash exceeds hash-max-ziplist-entries (512) OR hash-max-ziplist-value (64 bytes). Then converts to regular hash table (more memory). Keep hashes small for optimization!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Social Media User Profiles</strong></p>
            <p>10M active users, 10 fields each. Separate keys = 100M keys, 50 GB RAM. Budget: 10 GB max!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Aggressive Optimization</h4>
                <p><strong>1. Hash consolidation:</strong> 100M keys ‚Üí 10M keys (10x reduction)<br>
                <strong>2. Short names:</strong> u:123 with single-char fields (n, e, a)<br>
                <strong>3. Ziplist tuning:</strong> hash-max-ziplist-entries 512<br>
                <strong>4. Eviction:</strong> allkeys-lru with maxmemory 10gb</p>
                <p><strong>Results:</strong> 50 GB ‚Üí 8 GB! ‚úÖ Within budget ‚úÖ 80% cost savings ‚úÖ Same functionality</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¶</span><p><strong>Use Hashes</strong> - 40-60% memory savings with ziplist</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî§</span><p><strong>Short key names</strong> - Saves memory at scale</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚öôÔ∏è</span><p><strong>Set maxmemory</strong> - Prevents OOM kills</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>allkeys-lru policy</strong> - For cache use case</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor INFO memory</strong> - Track usage trends</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõ†Ô∏è</span><p><strong>Tune ziplist settings</strong> - Balance memory vs speed</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Memory</span><span class="keyword-tag">Optimization</span><span class="keyword-tag">Ziplist</span><span class="keyword-tag">Eviction</span><span class="keyword-tag">Hash</span><span class="keyword-tag">Fragmentation</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Storing 1M user profiles with 4 fields each. Most memory-efficient approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) 4M separate String keys</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) 1M Hashes with ziplist encoding</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) JSON strings in 1M keys</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) 1M Lists</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Hashes with ziplist encoding</strong>
                    <p>Hash ziplist = 40-60% less memory! 1M hashes vs 4M separate keys = 75% savings. Ziplist stores small hashes compactly. Separate Strings = overhead per key. JSON strings = parsing overhead. Lists wrong data structure. Hash perfect for small objects!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 64: Redis Best Practices Checklist
// ============================================================

function getQuestion64Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Production horror stories:</strong> "Used KEYS * in production - server frozen 5 seconds! No password - got hacked! No persistence - crash = all data lost!" Senior Engineer: "Follow best practices: (1) Never KEYS in prod, (2) Always AUTH, (3) Enable persistence, (4) Monitor memory, (5) Use connection pooling!"</p>
            <p>Best practices = avoid disasters.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis best practices cover: (1) Performance (SCAN not KEYS, pipeline, connection pooling), (2) Security (AUTH, ACL, private network), (3) Reliability (persistence, replication, Sentinel), (4) Operations (monitoring, backups, testing). Follow these to build production-ready systems.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Production Checklist</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Category</th><th style="padding: 10px;">Must Do</th><th style="padding: 10px;">Why</th></tr>
                    <tr><td style="padding: 8px;">Security</td><td>Enable AUTH/ACL</td><td>Prevent unauthorized access</td></tr>
                    <tr><td style="padding: 8px;">Performance</td><td>Use SCAN not KEYS</td><td>Avoid blocking server</td></tr>
                    <tr><td style="padding: 8px;">Reliability</td><td>Enable persistence</td><td>Survive crashes</td></tr>
                    <tr><td style="padding: 8px;">Scaling</td><td>Connection pooling</td><td>Reuse connections</td></tr>
                    <tr><td style="padding: 8px;">Operations</td><td>Monitor metrics</td><td>Catch issues early</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Production Best Practices</div>
                <svg viewBox="0 0 900 450" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="30" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Production Checklist</text>
                    
                    <!-- Security -->
                    <rect x="50" y="60" width="250" height="100" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="175" y="85" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">üîê Security</text>
                    <text x="65" y="105" fill="#888" font-size="10">‚úÖ requirepass / ACL</text>
                    <text x="65" y="120" fill="#888" font-size="10">‚úÖ bind 127.0.0.1</text>
                    <text x="65" y="135" fill="#888" font-size="10">‚úÖ Disable dangerous commands</text>
                    <text x="65" y="150" fill="#888" font-size="10">‚úÖ TLS encryption</text>
                    
                    <!-- Performance -->
                    <rect x="325" y="60" width="250" height="100" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="85" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">‚ö° Performance</text>
                    <text x="340" y="105" fill="#888" font-size="10">‚úÖ SCAN not KEYS</text>
                    <text x="340" y="120" fill="#888" font-size="10">‚úÖ Pipeline bulk operations</text>
                    <text x="340" y="135" fill="#888" font-size="10">‚úÖ Connection pooling</text>
                    <text x="340" y="150" fill="#888" font-size="10">‚úÖ Appropriate TTLs</text>
                    
                    <!-- Reliability -->
                    <rect x="600" y="60" width="250" height="100" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="725" y="85" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="600">üõ°Ô∏è Reliability</text>
                    <text x="615" y="105" fill="#888" font-size="10">‚úÖ Enable AOF/RDB</text>
                    <text x="615" y="120" fill="#888" font-size="10">‚úÖ Replication (replicas)</text>
                    <text x="615" y="135" fill="#888" font-size="10">‚úÖ Sentinel for HA</text>
                    <text x="615" y="150" fill="#888" font-size="10">‚úÖ Backup to S3</text>
                    
                    <!-- Operations -->
                    <rect x="50" y="185" width="250" height="100" fill="rgba(255,165,0,0.1)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="175" y="210" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">üìä Operations</text>
                    <text x="65" y="230" fill="#888" font-size="10">‚úÖ Monitor INFO metrics</text>
                    <text x="65" y="245" fill="#888" font-size="10">‚úÖ Set maxmemory</text>
                    <text x="65" y="260" fill="#888" font-size="10">‚úÖ SLOWLOG monitoring</text>
                    <text x="65" y="275" fill="#888" font-size="10">‚úÖ Test backups monthly</text>
                    
                    <!-- Development -->
                    <rect x="325" y="185" width="250" height="100" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="450" y="210" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">üíª Development</text>
                    <text x="340" y="230" fill="#888" font-size="10">‚úÖ Use transactions for consistency</text>
                    <text x="340" y="245" fill="#888" font-size="10">‚úÖ Error handling</text>
                    <text x="340" y="260" fill="#888" font-size="10">‚úÖ Key naming conventions</text>
                    <text x="340" y="275" fill="#888" font-size="10">‚úÖ Lua for complex logic</text>
                    
                    <!-- Scaling -->
                    <rect x="600" y="185" width="250" height="100" fill="rgba(0,191,255,0.1)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="725" y="210" text-anchor="middle" fill="#00BFFF" font-size="14" font-weight="600">üìà Scaling</text>
                    <text x="615" y="230" fill="#888" font-size="10">‚úÖ Cluster for sharding</text>
                    <text x="615" y="245" fill="#888" font-size="10">‚úÖ Read replicas</text>
                    <text x="615" y="260" fill="#888" font-size="10">‚úÖ Separate cache/data instances</text>
                    <text x="615" y="275" fill="#888" font-size="10">‚úÖ Monitor growth trends</text>
                    
                    <!-- Critical Mistakes -->
                    <rect x="50" y="310" width="800" height="120" fill="rgba(255,0,0,0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="335" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="700">‚ùå Critical Mistakes to AVOID</text>
                    
                    <text x="70" y="360" fill="#DC143C" font-size="11">‚ùå KEYS * in production</text>
                    <text x="70" y="375" fill="#888" font-size="9">Blocks server for seconds!</text>
                    
                    <text x="270" y="360" fill="#DC143C" font-size="11">‚ùå No password</text>
                    <text x="270" y="375" fill="#888" font-size="9">Easy target for attackers</text>
                    
                    <text x="450" y="360" fill="#DC143C" font-size="11">‚ùå No persistence</text>
                    <text x="450" y="375" fill="#888" font-size="9">Data loss on crash</text>
                    
                    <text x="630" y="360" fill="#DC143C" font-size="11">‚ùå DEL large keys</text>
                    <text x="630" y="375" fill="#888" font-size="9">Use UNLINK instead</text>
                    
                    <text x="70" y="400" fill="#DC143C" font-size="11">‚ùå No connection pooling</text>
                    <text x="70" y="415" fill="#888" font-size="9">Connection overhead</text>
                    
                    <text x="270" y="400" fill="#DC143C" font-size="11">‚ùå Ignoring SLOWLOG</text>
                    <text x="270" y="415" fill="#888" font-size="9">Performance issues grow</text>
                    
                    <text x="450" y="400" fill="#DC143C" font-size="11">‚ùå No monitoring</text>
                    <text x="450" y="415" fill="#888" font-size="9">Blind to problems</text>
                    
                    <text x="630" y="400" fill="#DC143C" font-size="11">‚ùå Public internet exposure</text>
                    <text x="630" y="415" fill="#888" font-size="9">Security nightmare</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Production Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">redis.conf - Production Settings</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Security</span>
<span class="keyword">requirepass</span> <span class="string">YourStrongPassword123!@#</span>
<span class="keyword">bind</span> <span class="number">127.0.0.1</span>
<span class="keyword">protected-mode</span> yes
<span class="keyword">rename-command</span> FLUSHALL <span class="string">""</span>
<span class="keyword">rename-command</span> KEYS <span class="string">""</span>

<span class="comment"># Memory</span>
<span class="keyword">maxmemory</span> <span class="number">4gb</span>
<span class="keyword">maxmemory-policy</span> allkeys-lru

<span class="comment"># Persistence</span>
<span class="keyword">appendonly</span> yes
<span class="keyword">appendfsync</span> everysec
<span class="keyword">save</span> <span class="number">900 1</span>
<span class="keyword">save</span> <span class="number">300 10</span>
<span class="keyword">save</span> <span class="number">60 10000</span>

<span class="comment"># Performance</span>
<span class="keyword">tcp-backlog</span> <span class="number">511</span>
<span class="keyword">timeout</span> <span class="number">300</span>
<span class="keyword">tcp-keepalive</span> <span class="number">60</span>

<span class="comment"># Monitoring</span>
<span class="keyword">slowlog-log-slower-than</span> <span class="number">10000</span>  <span class="comment"># 10ms</span>
<span class="keyword">slowlog-max-len</span> <span class="number">128</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Connection Pooling</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Proper Connection Management</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

<span class="comment"># ‚úÖ Good: Connection Pool (reuse connections)</span>
pool = redis.ConnectionPool(
    host=<span class="string">'localhost'</span>,
    port=<span class="number">6379</span>,
    password=<span class="string">'YourPassword'</span>,
    max_connections=<span class="number">50</span>,
    decode_responses=<span class="keyword">True</span>
)

<span class="keyword">def</span> <span class="function">get_redis_client</span>():
    <span class="keyword">return</span> redis.Redis(connection_pool=pool)

<span class="comment"># Use in application</span>
r = get_redis_client()
r.set(<span class="string">'key'</span>, <span class="string">'value'</span>)

<span class="comment"># ‚ùå Bad: New connection every time</span>
<span class="keyword">def</span> <span class="function">bad_approach</span>():
    r = redis.Redis(host=<span class="string">'localhost'</span>)  <span class="comment"># New connection!</span>
    r.set(<span class="string">'key'</span>, <span class="string">'value'</span>)
    <span class="comment"># Connection overhead every time</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Safe Key Iteration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - SCAN Not KEYS</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># ‚ùå NEVER do this in production!</span>
keys = r.keys(<span class="string">'user:*'</span>)  <span class="comment"># Blocks server!</span>

<span class="comment"># ‚úÖ Always use SCAN instead</span>
<span class="keyword">def</span> <span class="function">scan_keys_safely</span>(pattern=<span class="string">'user:*'</span>):
    cursor = <span class="number">0</span>
    <span class="keyword">while</span> <span class="keyword">True</span>:
        cursor, keys = r.scan(cursor, match=pattern, count=<span class="number">100</span>)
        <span class="keyword">for</span> key <span class="keyword">in</span> keys:
            <span class="keyword">yield</span> key
        <span class="keyword">if</span> cursor == <span class="number">0</span>:
            <span class="keyword">break</span>

<span class="comment"># Process safely</span>
<span class="keyword">for</span> key <span class="keyword">in</span> scan_keys_safely(<span class="string">'user:*'</span>):
    <span class="keyword">print</span>(key)  <span class="comment"># Non-blocking!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Most critical production mistake?</h4>
                <p><strong>A:</strong> Using KEYS * in production! Blocks single-threaded Redis for seconds. 1M keys = 5 second freeze. All clients blocked. Always use SCAN! Second: No password (hacked instantly)!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: RDB or AOF for production?</h4>
                <p><strong>A:</strong> Both! RDB for fast restarts, AOF for minimal data loss. Best: RDB daily backups to S3 + AOF enabled (appendfsync everysec). Balance: Performance + durability!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Connection pooling - why mandatory?</h4>
                <p><strong>A:</strong> Creating connections expensive! Each connection: TCP handshake, auth, overhead. Pool reuses 50 connections instead of creating thousands. 10x performance boost. Always use pools in production!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I disable persistence for pure cache?</h4>
                <p><strong>Answer:</strong> YES for cache! If all data can be regenerated (cache miss hits DB), persistence optional. Saves disk I/O. But: Consider restart time (refill cache). Most apps keep AOF for safety!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: DEL vs UNLINK for large keys?</h4>
                <p><strong>Answer:</strong> UNLINK! DEL blocks while deleting (1M item list = seconds). UNLINK deletes asynchronously in background. Always UNLINK for keys >1MB or >10K items. DEL fine for small keys!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Startup ‚Üí Production Migration</strong></p>
            <p>Dev: No password, no persistence, KEYS everywhere. Production launch imminent!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Production Hardening Checklist</h4>
                <p><strong>Week 1:</strong> ‚úÖ Add requirepass ‚úÖ Enable AOF ‚úÖ Set maxmemory ‚úÖ Replace KEYS with SCAN<br>
                <strong>Week 2:</strong> ‚úÖ Setup replication ‚úÖ Configure Sentinel ‚úÖ S3 backups ‚úÖ Monitoring (Grafana)<br>
                <strong>Week 3:</strong> ‚úÖ Connection pooling ‚úÖ Load testing ‚úÖ Disaster recovery drill ‚úÖ Documentation</p>
                <p><strong>Result:</strong> Zero downtime in 6 months! Survived traffic spike. Fast recovery from hardware failure! üéâ</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîê</span><p><strong>Security first</strong> - Password, private network, TLS</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>SCAN not KEYS</strong> - Never block production</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõ°Ô∏è</span><p><strong>Enable persistence</strong> - AOF + RDB backups</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Connection pooling</strong> - Mandatory for production</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor everything</strong> - INFO, SLOWLOG, metrics</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üß™</span><p><strong>Test backups</strong> - Monthly recovery drills</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Best Practices</span><span class="keyword-tag">Production</span><span class="keyword-tag">Security</span><span class="keyword-tag">Performance</span><span class="keyword-tag">Reliability</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need to find all keys matching "user:*" in production with 1M keys. What to use?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) KEYS user:* (simple)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) SCAN with match pattern</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Loop GET on all keys</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Query database instead</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - SCAN with match pattern</strong>
                    <p>SCAN only safe option! Iterates non-blocking, returns chunks. KEYS blocks server for 5+ seconds with 1M keys = production disaster. All clients frozen! Loop GET wasteful. Database query misses point. ALWAYS SCAN in production - this is critical!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 65: Redis Common Anti-Patterns
// ============================================================

function getQuestion65Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Anti-pattern horror:</strong> "Storing 10MB JSON strings! Getting entire blob every time! Parsing in app! Network saturated! Redis memory exploding!" Architect: "Use Hash for structured data! Store fields separately! HGET single fields! Result: 10MB ‚Üí 100KB per request! 100x bandwidth savings!"</p>
            <p>Anti-patterns = performance killers.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Common Redis anti-patterns: (1) Large values (>1MB keys), (2) Using Redis as primary database, (3) Hot keys (1 key, all traffic), (4) No key expiration (memory leak), (5) Wrong data structure choice. Each causes production issues.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Top 10 Anti-Patterns</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Anti-Pattern</th><th style="padding: 10px;">Problem</th><th style="padding: 10px;">Solution</th></tr>
                    <tr><td style="padding: 8px;">Large values (>1MB)</td><td>Network/memory issues</td><td>Split data, use Hash</td></tr>
                    <tr><td style="padding: 8px;">Redis as primary DB</td><td>Data durability risk</td><td>Use as cache + real DB</td></tr>
                    <tr><td style="padding: 8px;">Hot keys</td><td>Single key bottleneck</td><td>Shard across keys</td></tr>
                    <tr><td style="padding: 8px;">No TTL</td><td>Memory leak</td><td>Always set expiration</td></tr>
                    <tr><td style="padding: 8px;">Wrong structure</td><td>Inefficiency</td><td>Choose appropriate type</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Anti-Patterns vs Solutions</div>
                <svg viewBox="0 0 900 450" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Common Mistakes and Fixes</text>
                    
                    <!-- Anti-Pattern 1 -->
                    <rect x="50" y="60" width="380" height="80" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="70" y="85" fill="#FF6347" font-size="13" font-weight="600">‚ùå Anti-Pattern: Large JSON Blob</text>
                    <text x="70" y="105" fill="#888" font-size="10">SET user:123 '{"name":"Alice",...10MB JSON...}'</text>
                    <text x="70" y="120" fill="#888" font-size="10">Problem: Get entire 10MB every time!</text>
                    
                    <rect x="470" y="60" width="380" height="80" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="490" y="85" fill="#00FF88" font-size="13" font-weight="600">‚úÖ Solution: Use Hash</text>
                    <text x="490" y="105" fill="#888" font-size="10">HSET user:123 name "Alice" email "..." age 30</text>
                    <text x="490" y="120" fill="#888" font-size="10">Get single field: HGET user:123 name</text>
                    
                    <!-- Anti-Pattern 2 -->
                    <rect x="50" y="160" width="380" height="80" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="70" y="185" fill="#FF6347" font-size="13" font-weight="600">‚ùå Anti-Pattern: Hot Key</text>
                    <text x="70" y="205" fill="#888" font-size="10">GET counter (1M req/sec on 1 key!)</text>
                    <text x="70" y="220" fill="#888" font-size="10">Problem: Single key bottleneck</text>
                    
                    <rect x="470" y="160" width="380" height="80" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="490" y="185" fill="#00FF88" font-size="13" font-weight="600">‚úÖ Solution: Shard Keys</text>
                    <text x="490" y="205" fill="#888" font-size="10">counter:1, counter:2, ... counter:100</text>
                    <text x="490" y="220" fill="#888" font-size="10">Distribute load: 10K req/sec per shard</text>
                    
                    <!-- Anti-Pattern 3 -->
                    <rect x="50" y="260" width="380" height="80" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="70" y="285" fill="#FF6347" font-size="13" font-weight="600">‚ùå Anti-Pattern: No TTL</text>
                    <text x="70" y="305" fill="#888" font-size="10">SET session:abc "data" (never expires!)</text>
                    <text x="70" y="320" fill="#888" font-size="10">Problem: Memory leak, OOM kills</text>
                    
                    <rect x="470" y="260" width="380" height="80" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="490" y="285" fill="#00FF88" font-size="13" font-weight="600">‚úÖ Solution: Always Set TTL</text>
                    <text x="490" y="305" fill="#888" font-size="10">SETEX session:abc 1800 "data" (30 min)</text>
                    <text x="490" y="320" fill="#888" font-size="10">Auto-cleanup prevents memory leak</text>
                    
                    <!-- Anti-Pattern 4 -->
                    <rect x="50" y="360" width="380" height="70" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="70" y="385" fill="#FF6347" font-size="13" font-weight="600">‚ùå Anti-Pattern: Wrong Structure</text>
                    <text x="70" y="405" fill="#888" font-size="10">Using List for leaderboard (must sort!)</text>
                    <text x="70" y="420" fill="#888" font-size="10">Problem: O(N log N) every read</text>
                    
                    <rect x="470" y="360" width="380" height="70" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="490" y="385" fill="#00FF88" font-size="13" font-weight="600">‚úÖ Solution: Sorted Set</text>
                    <text x="490" y="405" fill="#888" font-size="10">ZADD leaderboard score player</text>
                    <text x="490" y="420" fill="#888" font-size="10">Auto-sorted: O(log N) insert, O(1) rank</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Large Value Anti-Pattern</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Fix Large Values</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json

r = redis.Redis()

<span class="comment"># ‚ùå Anti-Pattern: Large JSON blob</span>
user_data = {
    <span class="string">'name'</span>: <span class="string">'Alice'</span>, 
    <span class="string">'email'</span>: <span class="string">'alice@example.com'</span>,
    <span class="string">'profile'</span>: <span class="string">'...'</span> * <span class="number">10000</span>,  <span class="comment"># 10MB of data</span>
    <span class="comment"># ... 50 more fields</span>
}
r.set(<span class="string">'user:123'</span>, json.dumps(user_data))  <span class="comment"># Store 10MB</span>

<span class="comment"># Get entire 10MB just to read name!</span>
data = json.loads(r.get(<span class="string">'user:123'</span>))
name = data[<span class="string">'name'</span>]  <span class="comment"># Wasteful!</span>

<span class="comment"># ‚úÖ Solution: Use Hash</span>
r.hset(<span class="string">'user:123'</span>, mapping=user_data)

<span class="comment"># Get single field (100 bytes vs 10MB!)</span>
name = r.hget(<span class="string">'user:123'</span>, <span class="string">'name'</span>)  <span class="comment"># Efficient!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Hot Key Problem</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Shard to Avoid Hot Keys</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> random

<span class="comment"># ‚ùå Anti-Pattern: Single counter (hot key)</span>
r.incr(<span class="string">'global_counter'</span>)  <span class="comment"># 1M requests = bottleneck!</span>

<span class="comment"># ‚úÖ Solution: Shard across multiple keys</span>
NUM_SHARDS = <span class="number">100</span>

<span class="keyword">def</span> <span class="function">increment_sharded</span>():
    shard = random.randint(<span class="number">0</span>, NUM_SHARDS - <span class="number">1</span>)
    r.incr(<span class="string">f'counter:shard:{shard}'</span>)

<span class="keyword">def</span> <span class="function">get_total_count</span>():
    total = <span class="number">0</span>
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(NUM_SHARDS):
        count = r.get(<span class="string">f'counter:shard:{i}'</span>) <span class="keyword">or</span> <span class="number">0</span>
        total += <span class="function">int</span>(count)
    <span class="keyword">return</span> total

<span class="comment"># Now: 1M req/sec = 10K req/sec per shard (manageable!)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: TTL Best Practice</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Always Set Expiration</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># ‚ùå Anti-Pattern: No TTL (memory leak!)</span>
r.set(<span class="string">'session:abc123'</span>, <span class="string">'user_data'</span>)  <span class="comment"># Never expires!</span>
<span class="comment"># Problem: Dead sessions accumulate, OOM</span>

<span class="comment"># ‚úÖ Solution 1: SETEX (set with expiration)</span>
r.setex(<span class="string">'session:abc123'</span>, <span class="number">1800</span>, <span class="string">'user_data'</span>)  <span class="comment"># 30 min</span>

<span class="comment"># ‚úÖ Solution 2: SET with EX parameter</span>
r.set(<span class="string">'session:abc123'</span>, <span class="string">'user_data'</span>, ex=<span class="number">1800</span>)

<span class="comment"># ‚úÖ Solution 3: Cache with automatic TTL</span>
<span class="keyword">def</span> <span class="function">cache_set</span>(key, value, ttl=<span class="number">3600</span>):
    <span class="string">"""Always include TTL - prevent memory leaks"""</span>
    r.setex(key, ttl, value)

<span class="comment"># Golden rule: Every SET should have a TTL!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Should I store images in Redis?</h4>
                <p><strong>A:</strong> Generally NO! Images = 100KB-10MB. Redis = in-memory = expensive. Store in S3/CDN, cache URL/metadata in Redis. Exception: Small thumbnails (<10KB) for ultra-low latency!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Can Redis replace my database?</h4>
                <p><strong>A:</strong> NO for primary data! Redis = cache/session store. Not ACID database. Risk: Eviction policy deletes data, restart loses data (no persistence). Use Redis WITH database, not instead!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Hot key causing problems - quick fix?</h4>
                <p><strong>A:</strong> Shard it! Split "counter" into counter:1..100. Random shard on write. Sum all on read. Distributes load. For reads: Replicate key across replicas, load balance reads!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Is storing 1MB JSON okay?</h4>
                <p><strong>Answer:</strong> Depends on access pattern! If always read entire object: Maybe okay. But if read parts: Use Hash! Also: Network transfer = 1MB each request. 1000 req/sec = 1 GB/sec bandwidth!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: All keys have TTL - still running out of memory?</h4>
                <p><strong>Answer:</strong> TTLs too long OR eviction policy wrong! Check: (1) TTL values appropriate? (2) maxmemory set? (3) Eviction policy enabled (allkeys-lru)? (4) Keys expiring fast enough?</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: News Site Article Caching</strong></p>
            <p>Initial design: Store full HTML (100KB) per article. 1M articles = 100GB RAM! Unaffordable!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Smart Anti-Pattern Avoidance</h4>
                <p><strong>Problem 1:</strong> Large values ‚Üí Store metadata only (title, URL, preview - 1KB)<br>
                <strong>Problem 2:</strong> Hot articles ‚Üí Shard popular articles across 10 keys<br>
                <strong>Problem 3:</strong> No TTL ‚Üí Set 1-hour expiration on all<br>
                <strong>Problem 4:</strong> Wrong structure ‚Üí Use Hash not String</p>
                <p><strong>Results:</strong> 100 GB ‚Üí 1 GB (99% savings!)  ‚úÖ Same performance ‚úÖ Affordable ‚úÖ Scalable</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¶</span><p><strong>No large values</strong> - Keep keys <1MB</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî•</span><p><strong>Shard hot keys</strong> - Distribute load</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è∞</span><p><strong>Always set TTL</strong> - Prevent memory leaks</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üóÑÔ∏è</span><p><strong>Redis = cache not DB</strong> - Use with database</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Choose right structure</strong> - Match access pattern</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Use Hash for objects</strong> - Not JSON strings</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Anti-Patterns</span><span class="keyword-tag">Hot Keys</span><span class="keyword-tag">Large Values</span><span class="keyword-tag">TTL</span><span class="keyword-tag">Performance</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Storing user profiles. Each profile 50 fields. Best approach to avoid anti-patterns?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Large JSON string per user</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Hash with TTL per user</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) 50 separate keys per user</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Store in Redis, no DB</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Hash with TTL</strong>
                    <p>Hash perfect for objects! HGET single fields (not entire blob). Ziplist encoding saves memory. TTL prevents memory leak. JSON string = must parse entire object. 50 separate keys = overhead + 50x memory. Redis not primary DB. Hash + TTL = best practice!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 66: Redis for Real-Time Analytics
// ============================================================

function getQuestion66Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Analytics nightmare:</strong> "Dashboard shows page views, active users, trending topics. Database query takes 10 seconds! Users wait forever! Page refreshes kill server!" Architect: "Use Redis for real-time analytics! HyperLogLog for unique counts, Sorted Sets for trending, Streams for event tracking. Sub-second queries!"</p>
            <p>Real-time analytics = instant insights.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis real-time analytics uses: (1) HyperLogLog for unique counts (0.81% error, 12KB memory), (2) Sorted Sets for rankings/trends, (3) Bitmaps for user tracking, (4) Streams for event logs, (5) Time-series with Sorted Sets. Perfect for dashboards, monitoring, trending content.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Analytics Use Cases</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Metric</th><th style="padding: 10px;">Redis Structure</th><th style="padding: 10px;">Complexity</th></tr>
                    <tr><td style="padding: 8px;">Unique visitors</td><td>HyperLogLog</td><td>O(1) insert/count</td></tr>
                    <tr><td style="padding: 8px;">Trending topics</td><td>Sorted Set (by score)</td><td>O(log N) update</td></tr>
                    <tr><td style="padding: 8px;">Active users today</td><td>Bitmap</td><td>O(1) set/count</td></tr>
                    <tr><td style="padding: 8px;">Page views time-series</td><td>Sorted Set (timestamp)</td><td>O(log N) insert</td></tr>
                    <tr><td style="padding: 8px;">Event stream</td><td>Stream</td><td>O(1) append</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Why Redis for Analytics:</strong></p>
                <ul>
                    <li><strong>Speed:</strong> In-memory = sub-millisecond queries</li>
                    <li><strong>Memory efficient:</strong> HyperLogLog = 12KB for billions of uniques</li>
                    <li><strong>Real-time:</strong> No batch processing delays</li>
                    <li><strong>Scalable:</strong> Millions of events/second</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Real-Time Analytics Architecture</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Real-Time Dashboard Powered by Redis</text>
                    
                    <!-- Events -->
                    <rect x="50" y="60" width="180" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="140" y="85" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üìä Events</text>
                    <text x="140" y="105" text-anchor="middle" fill="#888" font-size="10">Page views</text>
                    <text x="140" y="120" text-anchor="middle" fill="#888" font-size="10">User actions</text>
                    <text x="140" y="135" text-anchor="middle" fill="#888" font-size="10">Millions/second</text>
                    
                    <!-- Arrow to Redis -->
                    <path d="M 230 100 L 320 100" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    
                    <!-- Redis Analytics -->
                    <rect x="320" y="60" width="260" height="300" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="85" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">‚ö° Redis Analytics</text>
                    
                    <rect x="340" y="100" width="220" height="50" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="450" y="120" text-anchor="middle" fill="#DC143C" font-size="11" font-weight="600">HyperLogLog</text>
                    <text x="450" y="135" text-anchor="middle" fill="#888" font-size="9">Unique visitors: 1.2M</text>
                    <text x="450" y="145" text-anchor="middle" fill="#888" font-size="8">(12KB memory!)</text>
                    
                    <rect x="340" y="160" width="220" height="50" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="450" y="180" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">Sorted Set</text>
                    <text x="450" y="195" text-anchor="middle" fill="#888" font-size="9">Trending: #tech (850 votes)</text>
                    <text x="450" y="205" text-anchor="middle" fill="#888" font-size="8">(O(log N) updates)</text>
                    
                    <rect x="340" y="220" width="220" height="50" fill="rgba(255,165,0,0.1)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="450" y="240" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">Bitmap</text>
                    <text x="450" y="255" text-anchor="middle" fill="#888" font-size="9">Active today: 45,231 users</text>
                    <text x="450" y="265" text-anchor="middle" fill="#888" font-size="8">(1 bit per user!)</text>
                    
                    <rect x="340" y="280" width="220" height="50" fill="rgba(0,191,255,0.1)" stroke="#00BFFF" stroke-width="2" rx="4"/>
                    <text x="450" y="300" text-anchor="middle" fill="#00BFFF" font-size="11" font-weight="600">Time-Series (ZSet)</text>
                    <text x="450" y="315" text-anchor="middle" fill="#888" font-size="9">Views/min: 15,234</text>
                    <text x="450" y="325" text-anchor="middle" fill="#888" font-size="8">(Last 60 minutes)</text>
                    
                    <!-- Arrow to Dashboard -->
                    <path d="M 580 200 L 670 200" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    <text x="625" y="190" text-anchor="middle" fill="#DC143C" font-size="10"><1ms</text>
                    
                    <!-- Dashboard -->
                    <rect x="670" y="80" width="180" height="280" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="760" y="105" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">üìà Dashboard</text>
                    <text x="760" y="130" text-anchor="middle" fill="#00FF88" font-size="11">Real-time Updates</text>
                    
                    <text x="690" y="160" fill="#888" font-size="10">Unique Visitors</text>
                    <text x="690" y="175" fill="#00FF88" font-size="13" font-weight="600">1,234,567</text>
                    
                    <text x="690" y="200" fill="#888" font-size="10">Trending Now</text>
                    <text x="690" y="215" fill="#00FF88" font-size="11">1. #tech (850)</text>
                    <text x="690" y="230" fill="#888" font-size="11">2. #news (742)</text>
                    
                    <text x="690" y="255" fill="#888" font-size="10">Active Users</text>
                    <text x="690" y="270" fill="#00FF88" font-size="13" font-weight="600">45,231</text>
                    
                    <text x="690" y="295" fill="#888" font-size="10">Views/Minute</text>
                    <text x="690" y="310" fill="#00FF88" font-size="13" font-weight="600">15,234</text>
                    
                    <text x="760" y="345" text-anchor="middle" fill="#DC143C" font-size="10">‚úÖ Sub-second refresh!</text>
                    
                    <defs>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Unique Visitor Tracking</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - HyperLogLog for Unique Counts</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime

r = redis.Redis()

<span class="keyword">def</span> <span class="function">track_unique_visitor</span>(page, user_id):
    <span class="string">"""Track unique visitors per page per day"""</span>
    date = datetime.now().strftime(<span class="string">"%Y-%m-%d"</span>)
    key = <span class="string">f'visitors:{page}:{date}'</span>
    
    <span class="comment"># Add user to HyperLogLog (12KB for billions!)</span>
    r.pfadd(key, user_id)
    r.expire(key, <span class="number">86400</span> * <span class="number">7</span>)  <span class="comment"># Keep 7 days</span>

<span class="keyword">def</span> <span class="function">get_unique_visitors</span>(page, date):
    <span class="string">"""Get unique visitor count (0.81% error margin)"""</span>
    key = <span class="string">f'visitors:{page}:{date}'</span>
    count = r.pfcount(key)
    <span class="keyword">return</span> count

<span class="comment"># Track 1M visitors - uses only 12KB!</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000000</span>):
    track_unique_visitor(<span class="string">'/home'</span>, <span class="string">f'user_{i}'</span>)

unique = get_unique_visitors(<span class="string">'/home'</span>, <span class="string">'2024-10-15'</span>)
<span class="keyword">print</span>(<span class="string">f"Unique visitors: {unique:,}"</span>)  <span class="comment"># ~1,000,000</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Trending Topics</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Real-Time Trending</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">track_hashtag</span>(hashtag):
    <span class="string">"""Increment trending score"""</span>
    r.zincrby(<span class="string">'trending:hashtags'</span>, <span class="number">1</span>, hashtag)
    
    <span class="comment"># Decay old scores (time-based trending)</span>
    now = <span class="function">int</span>(time.time())
    r.zadd(<span class="string">'trending:time'</span>, {hashtag: now})

<span class="keyword">def</span> <span class="function">get_trending</span>(limit=<span class="number">10</span>):
    <span class="string">"""Get top trending hashtags with scores"""</span>
    trending = r.zrevrange(
        <span class="string">'trending:hashtags'</span>, 
        <span class="number">0</span>, 
        limit - <span class="number">1</span>, 
        withscores=<span class="keyword">True</span>
    )
    <span class="keyword">return</span> [(tag.decode(), <span class="function">int</span>(score)) <span class="keyword">for</span> tag, score <span class="keyword">in</span> trending]

<span class="keyword">def</span> <span class="function">decay_trending</span>(decay_factor=<span class="number">0.9</span>):
    <span class="string">"""Periodic decay for time-based trending"""</span>
    <span class="keyword">for</span> hashtag <span class="keyword">in</span> r.zrange(<span class="string">'trending:hashtags'</span>, <span class="number">0</span>, <span class="number">-1</span>):
        current_score = r.zscore(<span class="string">'trending:hashtags'</span>, hashtag)
        r.zadd(<span class="string">'trending:hashtags'</span>, {hashtag: current_score * decay_factor})

<span class="comment"># Usage</span>
track_hashtag(<span class="string">'#tech'</span>)
track_hashtag(<span class="string">'#tech'</span>)
track_hashtag(<span class="string">'#news'</span>)

trending = get_trending(<span class="number">5</span>)
<span class="keyword">for</span> i, (tag, score) <span class="keyword">in</span> <span class="function">enumerate</span>(trending, <span class="number">1</span>):
    <span class="keyword">print</span>(<span class="string">f"{i}. {tag}: {score} mentions"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Active Users with Bitmap</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Memory-Efficient User Tracking</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">mark_user_active</span>(user_id):
    <span class="string">"""Mark user as active today (1 bit per user!)"""</span>
    date = datetime.now().strftime(<span class="string">"%Y-%m-%d"</span>)
    key = <span class="string">f'active_users:{date}'</span>
    
    <span class="comment"># Set bit at user_id position</span>
    r.setbit(key, user_id, <span class="number">1</span>)
    r.expire(key, <span class="number">86400</span> * <span class="number">7</span>)

<span class="keyword">def</span> <span class="function">get_active_count</span>(date):
    <span class="string">"""Count active users (O(N) but fast)"""</span>
    key = <span class="string">f'active_users:{date}'</span>
    <span class="keyword">return</span> r.bitcount(key)

<span class="keyword">def</span> <span class="function">is_user_active</span>(user_id, date):
    <span class="string">"""Check if specific user was active"""</span>
    key = <span class="string">f'active_users:{date}'</span>
    <span class="keyword">return</span> <span class="function">bool</span>(r.getbit(key, user_id))

<span class="comment"># 1M users = only 125KB memory!</span>
<span class="keyword">for</span> user_id <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">100</span>, <span class="number">500</span>, <span class="number">1000</span>, <span class="number">10000</span>]:
    mark_user_active(user_id)

today = datetime.now().strftime(<span class="string">"%Y-%m-%d"</span>)
active = get_active_count(today)
<span class="keyword">print</span>(<span class="string">f"Active users today: {active}"</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why HyperLogLog for unique counts vs Set?</h4>
                <p><strong>A:</strong> Memory! Set stores all IDs: 1M users √ó 20 bytes = 20MB. HyperLogLog: Always 12KB regardless of count! Trade-off: 0.81% error margin. Perfect for analytics where exact count not critical!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: How to handle time-series data?</h4>
                <p><strong>A:</strong> Sorted Set with timestamp as score! ZADD metric timestamp value. Query range: ZRANGEBYSCORE start_time end_time. Trim old: ZREMRANGEBYSCORE 0 cutoff_time. Or use RedisTimeSeries module for advanced features!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Bitmap vs HyperLogLog for user tracking?</h4>
                <p><strong>A:</strong> Bitmap: Exact count, check specific user, 1 bit/user (125KB per 1M). HyperLogLog: Approximate count, can't check individuals, 12KB always. Use Bitmap when need exact + individual checks!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I merge HyperLogLogs?</h4>
                <p><strong>Answer:</strong> YES! PFMERGE destkey sourcekey1 sourcekey2. Combines multiple HyperLogLogs. Example: Merge hourly unique visitors into daily total. Still 12KB result! Perfect for distributed counting!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Trending - how to prevent old topics staying forever?</h4>
                <p><strong>Answer:</strong> Time decay! Periodic job multiplies scores by 0.9. Or: Use timestamp in score, filter by recency. Or: Separate hourly/daily leaderboards with TTL. Decay keeps trending fresh!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Social Media Analytics Dashboard</strong></p>
            <p>Need: Unique visitors, trending hashtags, active users, posts/minute - all real-time!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Multi-Structure Analytics</h4>
                <p><strong>Unique visitors:</strong> HyperLogLog per page/day (12KB each)<br>
                <strong>Trending hashtags:</strong> Sorted Set with score = mentions<br>
                <strong>Active users:</strong> Bitmap per day (1 bit per user)<br>
                <strong>Posts/minute:</strong> Sorted Set with timestamp, trim >1h old</p>
                <p><strong>Results:</strong> ‚úÖ Dashboard updates <1ms ‚úÖ 10M users tracked in 1.5 MB ‚úÖ Real-time trending ‚úÖ 60-day history in 100MB ‚úÖ Handles 100K events/sec</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>HyperLogLog</strong> - 12KB for billions of uniques</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî•</span><p><strong>Sorted Set</strong> - Rankings and time-series</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Bitmap</strong> - 1 bit per user tracking</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Sub-millisecond</strong> - Real-time dashboards</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Memory efficient</strong> - Billions tracked in MB</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìà</span><p><strong>Scalable</strong> - Millions of events/second</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Analytics</span><span class="keyword-tag">HyperLogLog</span><span class="keyword-tag">Real-time</span><span class="keyword-tag">Trending</span><span class="keyword-tag">Bitmap</span><span class="keyword-tag">Dashboard</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need to track 1 billion unique visitors. Memory constraint: 100MB. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Set storing all user IDs</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) HyperLogLog (12KB memory)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Hash with user counts</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Bitmap (125GB needed)</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - HyperLogLog</strong>
                    <p>HyperLogLog PERFECT! Always 12KB regardless of count (1M or 1B users). 0.81% error acceptable for analytics. Set = 1B √ó 20 bytes = 20GB memory! Bitmap = 1B bits = 125MB (works but HyperLogLog better). HyperLogLog = probabilistic counting magic!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 67: Redis as Message Queue
// ============================================================

function getQuestion67Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Job queue problem:</strong> "Need to send 10K emails after user signup. Can't block signup flow! Database polling = wasteful! Jobs lost on crash!" Architect: "Use Redis as message queue! LPUSH jobs, workers BRPOP. Persistent, fast, supports retry. Email queue cleared in seconds!"</p>
            <p>Message queue = async processing.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis message queue uses Lists or Streams: (1) Simple queue: LPUSH (producer) + BRPOP (consumer), (2) Reliable queue: RPOPLPUSH for processing guarantee, (3) Advanced: Streams with consumer groups, acknowledgments, retry. Perfect for background jobs, email queues, image processing.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Queue Approaches</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Approach</th><th style="padding: 10px;">Commands</th><th style="padding: 10px;">Use Case</th></tr>
                    <tr><td style="padding: 8px;">Simple Queue</td><td>LPUSH/BRPOP</td><td>Basic job processing</td></tr>
                    <tr><td style="padding: 8px;">Reliable Queue</td><td>RPOPLPUSH</td><td>No job loss on crash</td></tr>
                    <tr><td style="padding: 8px;">Priority Queue</td><td>Multiple lists by priority</td><td>VIP jobs first</td></tr>
                    <tr><td style="padding: 8px;">Stream Queue</td><td>XADD/XREADGROUP</td><td>Multiple consumers, ack</td></tr>
                    <tr><td style="padding: 8px;">Delayed Queue</td><td>Sorted Set by timestamp</td><td>Schedule future jobs</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Queue vs Pub/Sub:</strong></p>
                <ul>
                    <li><strong>Queue:</strong> Persistent, one consumer processes each job, FIFO order</li>
                    <li><strong>Pub/Sub:</strong> Ephemeral, all subscribers get message, no history</li>
                    <li><strong>Use Queue for:</strong> Background jobs, guaranteed processing</li>
                    <li><strong>Use Pub/Sub for:</strong> Real-time notifications, broadcasting</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Redis Queue Architecture</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Message Queue Flow</text>
                    
                    <!-- Producer -->
                    <rect x="50" y="60" width="160" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="130" y="90" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üì§ Producer</text>
                    <text x="130" y="110" text-anchor="middle" fill="#888" font-size="10">Web Server</text>
                    <text x="130" y="125" text-anchor="middle" fill="#888" font-size="10">API Endpoint</text>
                    
                    <path d="M 210 100 L 280 100" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    <text x="245" y="90" text-anchor="middle" fill="#DC143C" font-size="10">LPUSH</text>
                    
                    <!-- Redis Queue -->
                    <rect x="280" y="60" width="200" height="280" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="380" y="85" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">‚ö° Redis Queue</text>
                    <text x="380" y="105" text-anchor="middle" fill="#888" font-size="11">List: "email_queue"</text>
                    
                    <rect x="300" y="120" width="160" height="40" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="380" y="145" text-anchor="middle" fill="#888" font-size="10">Job 3 (newest)</text>
                    
                    <rect x="300" y="170" width="160" height="40" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="380" y="195" text-anchor="middle" fill="#888" font-size="10">Job 2</text>
                    
                    <rect x="300" y="220" width="160" height="40" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="380" y="245" text-anchor="middle" fill="#888" font-size="10">Job 1</text>
                    
                    <rect x="300" y="270" width="160" height="40" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="380" y="295" text-anchor="middle" fill="#00FF88" font-size="10">Job 0 (oldest) ‚Üí</text>
                    
                    <text x="380" y="325" text-anchor="middle" fill="#888" font-size="9">FIFO: First In, First Out</text>
                    
                    <!-- Consumers -->
                    <path d="M 480 140 L 550 120" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    <text x="515" y="125" text-anchor="middle" fill="#00FF88" font-size="9">BRPOP</text>
                    
                    <path d="M 480 210 L 550 210" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    <text x="515" y="200" text-anchor="middle" fill="#00FF88" font-size="9">BRPOP</text>
                    
                    <path d="M 480 290 L 550 300" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    <text x="515" y="285" text-anchor="middle" fill="#00FF88" font-size="9">BRPOP</text>
                    
                    <rect x="550" y="80" width="140" height="60" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="620" y="105" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">üë∑ Worker 1</text>
                    <text x="620" y="125" text-anchor="middle" fill="#888" font-size="9">Processing...</text>
                    
                    <rect x="550" y="170" width="140" height="60" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="620" y="195" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">üë∑ Worker 2</text>
                    <text x="620" y="215" text-anchor="middle" fill="#888" font-size="9">Processing...</text>
                    
                    <rect x="550" y="260" width="140" height="60" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="620" y="285" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">üë∑ Worker 3</text>
                    <text x="620" y="305" text-anchor="middle" fill="#888" font-size="9">Processing...</text>
                    
                    <!-- Results -->
                    <path d="M 690 110 L 750 110" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <path d="M 690 200 L 750 200" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <path d="M 690 290 L 750 290" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    
                    <rect x="750" y="150" width="100" height="100" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="800" y="175" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">‚úÖ Done</text>
                    <text x="800" y="195" text-anchor="middle" fill="#888" font-size="9">Email sent</text>
                    <text x="800" y="210" text-anchor="middle" fill="#888" font-size="9">Image processed</text>
                    <text x="800" y="225" text-anchor="middle" fill="#888" font-size="9">Report generated</text>
                    
                    <rect x="50" y="360" width="800" height="30" fill="rgba(0,0,0,0.2)" stroke="#666" stroke-width="2" rx="6"/>
                    <text x="450" y="380" text-anchor="middle" fill="#00FF88" font-size="11">
                        ‚ö° Async processing: Multiple workers process jobs in parallel
                    </text>
                    
                    <defs>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Simple Queue</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Basic Producer/Consumer</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json
<span class="keyword">import</span> time

r = redis.Redis()

<span class="comment"># Producer: Add jobs to queue</span>
<span class="keyword">def</span> <span class="function">enqueue_email</span>(to_email, subject, body):
    job = {
        <span class="string">'to'</span>: to_email,
        <span class="string">'subject'</span>: subject,
        <span class="string">'body'</span>: body,
        <span class="string">'timestamp'</span>: time.time()
    }
    r.lpush(<span class="string">'email_queue'</span>, json.dumps(job))
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Queued email to {to_email}"</span>)

<span class="comment"># Consumer: Process jobs (blocking)</span>
<span class="keyword">def</span> <span class="function">worker</span>():
    <span class="keyword">print</span>(<span class="string">"üë∑ Worker started, waiting for jobs..."</span>)
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="comment"># BRPOP blocks until job available (timeout 0 = forever)</span>
        result = r.brpop(<span class="string">'email_queue'</span>, timeout=<span class="number">0</span>)
        
        <span class="keyword">if</span> result:
            queue_name, job_data = result
            job = json.loads(job_data)
            
            <span class="keyword">print</span>(<span class="string">f"üìß Sending email to {job['to']}..."</span>)
            time.sleep(<span class="number">1</span>)  <span class="comment"># Simulate email sending</span>
            <span class="keyword">print</span>(<span class="string">f"‚úÖ Email sent to {job['to']}"</span>)

<span class="comment"># Usage</span>
enqueue_email(<span class="string">'user@example.com'</span>, <span class="string">'Welcome!'</span>, <span class="string">'Thanks for signing up'</span>)
<span class="comment"># worker()  # Run in separate process</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Reliable Queue with RPOPLPUSH</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - No Job Loss on Crash</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">reliable_worker</span>():
    <span class="string">"""Process jobs with guarantee - moves to processing list"""</span>
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="comment"># Atomic: Remove from queue, add to processing</span>
        job_data = r.brpoplpush(
            <span class="string">'email_queue'</span>,           <span class="comment"># Source</span>
            <span class="string">'email_processing'</span>,      <span class="comment"># Destination</span>
            timeout=<span class="number">0</span>
        )
        
        <span class="keyword">if</span> job_data:
            job = json.loads(job_data)
            
            <span class="keyword">try</span>:
                <span class="comment"># Process job</span>
                <span class="keyword">print</span>(<span class="string">f"üìß Processing {job['to']}..."</span>)
                send_email(job)  <span class="comment"># Your email function</span>
                
                <span class="comment"># Success: Remove from processing list</span>
                r.lrem(<span class="string">'email_processing'</span>, <span class="number">1</span>, job_data)
                <span class="keyword">print</span>(<span class="string">f"‚úÖ Completed {job['to']}"</span>)
                
            <span class="keyword">except</span> <span class="function">Exception</span> <span class="keyword">as</span> e:
                <span class="keyword">print</span>(<span class="string">f"‚ùå Failed {job['to']}: {e}"</span>)
                <span class="comment"># Job stays in processing list for retry</span>

<span class="keyword">def</span> <span class="function">retry_failed_jobs</span>():
    <span class="string">"""Periodic job to retry stuck jobs"""</span>
    <span class="comment"># Move jobs from processing back to queue</span>
    <span class="keyword">while</span> r.llen(<span class="string">'email_processing'</span>) > <span class="number">0</span>:
        job_data = r.rpoplpush(<span class="string">'email_processing'</span>, <span class="string">'email_queue'</span>)
        <span class="keyword">print</span>(<span class="string">f"üîÑ Requeued job for retry"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Priority Queue</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - VIP Jobs First</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">enqueue_with_priority</span>(job, priority=<span class="string">'normal'</span>):
    <span class="string">"""Add job to priority-specific queue"""</span>
    queue_name = <span class="string">f'jobs:{priority}'</span>  <span class="comment"># jobs:high, jobs:normal, jobs:low</span>
    r.lpush(queue_name, json.dumps(job))

<span class="keyword">def</span> <span class="function">priority_worker</span>():
    <span class="string">"""Process high priority first, then normal, then low"""</span>
    queues = [<span class="string">'jobs:high'</span>, <span class="string">'jobs:normal'</span>, <span class="string">'jobs:low'</span>]
    
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="comment"># BRPOP checks queues in order, returns first available</span>
        result = r.brpop(queues, timeout=<span class="number">1</span>)
        
        <span class="keyword">if</span> result:
            queue_name, job_data = result
            priority = queue_name.decode().split(<span class="string">':'</span>)[<span class="number">1</span>]
            job = json.loads(job_data)
            
            <span class="keyword">print</span>(<span class="string">f"‚ö° Processing {priority} priority job"</span>)
            process_job(job)

<span class="comment"># Usage</span>
enqueue_with_priority({<span class="string">'task'</span>: <span class="string">'payment'</span>}, priority=<span class="string">'high'</span>)
enqueue_with_priority({<span class="string">'task'</span>: <span class="string">'email'</span>}, priority=<span class="string">'normal'</span>)
enqueue_with_priority({<span class="string">'task'</span>: <span class="string">'cleanup'</span>}, priority=<span class="string">'low'</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Queue vs Pub/Sub - when to use which?</h4>
                <p><strong>A:</strong> Queue: Persistent, guaranteed processing, one consumer per job (background jobs). Pub/Sub: Ephemeral, broadcast to all, no storage (real-time notifications). Queue = tasks. Pub/Sub = events!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: How to prevent job loss on worker crash?</h4>
                <p><strong>A:</strong> RPOPLPUSH! Atomically moves job from queue to processing list. If worker crashes, job still in processing list. Retry worker moves stuck jobs back to queue. No loss!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: BRPOP timeout 0 vs 5 seconds?</h4>
                <p><strong>A:</strong> timeout=0: Block forever until job arrives (dedicated worker). timeout=5: Check every 5 seconds, allows worker to do other tasks or health checks. Choose based on worker pattern!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Multiple workers - will jobs duplicate?</h4>
                <p><strong>Answer:</strong> NO! BRPOP atomic - only ONE worker gets each job. 100 workers can safely consume same queue. Each job processed exactly once. Perfect for scaling workers horizontally!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Queue growing too fast - jobs backing up?</h4>
                <p><strong>Answer:</strong> Add more workers! Monitor queue length: LLEN. Alert if >1000. Scale workers up/down based on queue depth. Or: Rate limit producers. Queue growing = need more processing power!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Order Processing</strong></p>
            <p>Order placed ‚Üí Email confirmation, inventory update, shipping label, analytics - all async!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Multi-Queue Architecture</h4>
                <p><strong>Order API:</strong> LPUSH to 4 queues (email, inventory, shipping, analytics)<br>
                <strong>Email workers:</strong> BRPOP email_queue (5 workers)<br>
                <strong>Inventory workers:</strong> BRPOP inventory_queue (3 workers)<br>
                <strong>Each queue:</strong> RPOPLPUSH for reliability</p>
                <p><strong>Results:</strong> ‚úÖ Order response <100ms ‚úÖ Emails sent within 5s ‚úÖ Zero job loss ‚úÖ Scales to 10K orders/min ‚úÖ Each system independent</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì•</span><p><strong>LPUSH/BRPOP</strong> - Simple queue pattern</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõ°Ô∏è</span><p><strong>RPOPLPUSH</strong> - Reliable, no job loss</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Multiple workers</strong> - Scale horizontally</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Priority queues</strong> - Multiple lists</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor LLEN</strong> - Queue depth alerts</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Persistent</strong> - Survives Redis restart</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Queue</span><span class="keyword-tag">BRPOP</span><span class="keyword-tag">RPOPLPUSH</span><span class="keyword-tag">Background Jobs</span><span class="keyword-tag">Workers</span><span class="keyword-tag">Async</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need reliable job queue - no job loss if worker crashes. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) LPUSH/BRPOP (simple queue)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) RPOPLPUSH to processing list</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Pub/Sub (broadcasting)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Store in database</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - RPOPLPUSH to processing list</strong>
                    <p>RPOPLPUSH perfect! Atomically moves job from queue to processing list. Worker crash? Job still in processing list, retry worker requeues it. Zero job loss! Simple BRPOP = job gone if worker crashes. Pub/Sub ephemeral. Database too slow. RPOPLPUSH = reliability!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 68: Redis for Geospatial Data
// ============================================================

function getQuestion68Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Location search disaster:</strong> "Find restaurants within 5km! Database calculates distance for 100K restaurants. Query takes 30 seconds! Users give up!" Architect: "Use Redis Geospatial! GEOADD locations, GEORADIUS for instant nearby search. 30 seconds ‚Üí 10 milliseconds! Sub-second results!"</p>
            <p>Geospatial = location-based queries.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Geospatial commands: (1) GEOADD adds locations (lat/lon), (2) GEORADIUS finds nearby points within radius, (3) GEODIST calculates distance between two points, (4) GEOPOS gets coordinates. Uses Sorted Set with geohash encoding. Perfect for: nearby search, location tracking, delivery radius.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Geospatial Commands</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Command</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">GEOADD</td><td>Add location</td><td>GEOADD drivers -122.4 37.8 "driver1"</td></tr>
                    <tr><td style="padding: 8px;">GEORADIUS</td><td>Find nearby</td><td>GEORADIUS drivers -122.4 37.8 5 km</td></tr>
                    <tr><td style="padding: 8px;">GEODIST</td><td>Distance between</td><td>GEODIST drivers "d1" "d2" km</td></tr>
                    <tr><td style="padding: 8px;">GEOPOS</td><td>Get coordinates</td><td>GEOPOS drivers "driver1"</td></tr>
                    <tr><td style="padding: 8px;">GEOSEARCH</td><td>Modern search</td><td>GEOSEARCH drivers FROMLONLAT -122 37 5 km</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Under the Hood:</strong></p>
                <ul>
                    <li><strong>Storage:</strong> Sorted Set with geohash as score (52-bit integer)</li>
                    <li><strong>Units:</strong> m (meters), km, mi (miles), ft (feet) - MUST specify!</li>
                    <li><strong>Accuracy:</strong> ~1 meter precision for most use cases</li>
                    <li><strong>Performance:</strong> O(log N) search even with millions of points</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Geospatial Nearby Search</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;" preserveAspectRatio="xMidYMid meet">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Find Nearby Locations</text>
                    
                    <!-- Map Background -->
                    <rect x="50" y="50" width="800" height="350" fill="rgba(200,220,255,0.2)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="75" text-anchor="middle" fill="#888" font-size="12">San Francisco Bay Area</text>
                    
                    <!-- User Location (Center) -->
                    <circle cx="450" cy="220" r="8" fill="#DC143C"/>
                    <text x="450" y="245" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">üë§ User</text>
                    <text x="450" y="260" text-anchor="middle" fill="#888" font-size="9">37.7749¬∞N, 122.4194¬∞W</text>
                    
                    <!-- Search Radius -->
                    <circle cx="450" cy="220" r="150" fill="none" stroke="#DC143C" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="580" y="215" fill="#DC143C" font-size="11">5 km radius</text>
                    
                    <!-- Nearby Restaurants (Inside) -->
                    <circle cx="380" cy="180" r="6" fill="#00FF88"/>
                    <text x="380" y="170" text-anchor="middle" fill="#00FF88" font-size="10">üçï Pizza</text>
                    <text x="380" y="198" text-anchor="middle" fill="#888" font-size="8">1.2 km</text>
                    
                    <circle cx="520" cy="190" r="6" fill="#00FF88"/>
                    <text x="520" y="180" text-anchor="middle" fill="#00FF88" font-size="10">üçú Ramen</text>
                    <text x="520" y="208" text-anchor="middle" fill="#888" font-size="8">2.8 km</text>
                    
                    <circle cx="420" cy="280" r="6" fill="#00FF88"/>
                    <text x="420" y="270" text-anchor="middle" fill="#00FF88" font-size="10">üçî Burger</text>
                    <text x="420" y="298" text-anchor="middle" fill="#888" font-size="8">3.5 km</text>
                    
                    <circle cx="510" cy="260" r="6" fill="#00FF88"/>
                    <text x="510" y="250" text-anchor="middle" fill="#00FF88" font-size="10">üç£ Sushi</text>
                    <text x="510" y="278" text-anchor="middle" fill="#888" font-size="8">4.2 km</text>
                    
                    <!-- Far Restaurants (Outside) -->
                    <circle cx="650" cy="150" r="6" fill="#FF6347"/>
                    <text x="650" y="140" text-anchor="middle" fill="#FF6347" font-size="10">ü•ó Salad</text>
                    <text x="650" y="168" text-anchor="middle" fill="#888" font-size="8">8.1 km</text>
                    
                    <circle cx="250" cy="300" r="6" fill="#FF6347"/>
                    <text x="250" y="290" text-anchor="middle" fill="#FF6347" font-size="10">üåÆ Tacos</text>
                    <text x="250" y="318" text-anchor="middle" fill="#888" font-size="8">9.3 km</text>
                    
                    <!-- Redis Command -->
                    <rect x="100" y="360" width="700" height="30" fill="rgba(0,0,0,0.3)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="380" text-anchor="middle" fill="#00FF88" font-size="11" font-family="monospace">
                        GEORADIUS restaurants -122.4194 37.7749 5 km WITHDIST ‚Üí 4 results in 10ms
                    </text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Restaurant Nearby Search</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Find Nearby Locations</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Add restaurants with coordinates</span>
<span class="keyword">def</span> <span class="function">add_restaurant</span>(name, longitude, latitude):
    <span class="string">"""Store restaurant location (lon, lat order!)"""</span>
    r.geoadd(<span class="string">'restaurants'</span>, (longitude, latitude, name))
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Added {name} at ({latitude}, {longitude})"</span>)

<span class="comment"># Populate data</span>
add_restaurant(<span class="string">'Pizza Place'</span>, <span class="number">-122.4100</span>, <span class="number">37.7849</span>)
add_restaurant(<span class="string">'Ramen House'</span>, <span class="number">-122.4300</span>, <span class="number">37.7700</span>)
add_restaurant(<span class="string">'Burger Joint'</span>, <span class="number">-122.4200</span>, <span class="number">37.7600</span>)
add_restaurant(<span class="string">'Sushi Bar'</span>, <span class="number">-122.4150</span>, <span class="number">37.7550</span>)
add_restaurant(<span class="string">'Salad Shop'</span>, <span class="number">-122.3800</span>, <span class="number">37.8000</span>)

<span class="comment"># Find restaurants within 5km</span>
<span class="keyword">def</span> <span class="function">find_nearby</span>(user_lon, user_lat, radius_km=<span class="number">5</span>):
    <span class="string">"""Find nearby restaurants with distance"""</span>
    results = r.georadius(
        <span class="string">'restaurants'</span>,
        user_lon,
        user_lat,
        radius_km,
        unit=<span class="string">'km'</span>,
        withdist=<span class="keyword">True</span>,  <span class="comment"># Include distance</span>
        sort=<span class="string">'ASC'</span>         <span class="comment"># Nearest first</span>
    )
    
    <span class="keyword">return</span> results

<span class="comment"># User location: San Francisco downtown</span>
nearby = find_nearby(<span class="number">-122.4194</span>, <span class="number">37.7749</span>, radius_km=<span class="number">5</span>)

<span class="keyword">for</span> i, (name, distance) <span class="keyword">in</span> <span class="function">enumerate</span>(nearby, <span class="number">1</span>):
    <span class="keyword">print</span>(<span class="string">f"{i}. {name}: {distance:.2f} km away"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Real-Time Driver Tracking</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Uber-like System</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">update_driver_location</span>(driver_id, lon, lat):
    <span class="string">"""Update driver's current location (real-time)"""</span>
    r.geoadd(<span class="string">'drivers'</span>, (lon, lat, driver_id))
    r.expire(<span class="string">'drivers'</span>, <span class="number">3600</span>)  <span class="comment"># Auto-cleanup after 1 hour</span>

<span class="keyword">def</span> <span class="function">find_nearest_drivers</span>(rider_lon, rider_lat, count=<span class="number">5</span>):
    <span class="string">"""Find N nearest available drivers"""</span>
    drivers = r.georadius(
        <span class="string">'drivers'</span>,
        rider_lon,
        rider_lat,
        <span class="number">10</span>,                  <span class="comment"># 10 km max radius</span>
        unit=<span class="string">'km'</span>,
        withdist=<span class="keyword">True</span>,
        withcoord=<span class="keyword">True</span>,    <span class="comment"># Include coordinates</span>
        count=count,
        sort=<span class="string">'ASC'</span>
    )
    
    <span class="keyword">return</span> drivers

<span class="keyword">def</span> <span class="function">get_distance_between</span>(driver_id, rider_id):
    <span class="string">"""Calculate distance between driver and rider"""</span>
    distance = r.geodist(
        <span class="string">'locations'</span>,
        driver_id,
        rider_id,
        unit=<span class="string">'km'</span>
    )
    <span class="keyword">return</span> <span class="function">float</span>(distance) <span class="keyword">if</span> distance <span class="keyword">else</span> <span class="keyword">None</span>

<span class="comment"># Simulate driver updates</span>
update_driver_location(<span class="string">'driver_1'</span>, <span class="number">-122.4100</span>, <span class="number">37.7849</span>)
update_driver_location(<span class="string">'driver_2'</span>, <span class="number">-122.4200</span>, <span class="number">37.7750</span>)
update_driver_location(<span class="string">'driver_3'</span>, <span class="number">-122.4300</span>, <span class="number">37.7650</span>)

<span class="comment"># Find nearest 3 drivers for rider</span>
nearest = find_nearest_drivers(<span class="number">-122.4194</span>, <span class="number">37.7749</span>, count=<span class="number">3</span>)

<span class="keyword">for</span> driver, distance, coords <span class="keyword">in</span> nearest:
    lon, lat = coords
    <span class="keyword">print</span>(<span class="string">f"üöó {driver}: {distance:.2f} km away at ({lat:.4f}, {lon:.4f})"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Delivery Zone Check</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Check if Address in Delivery Range</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">is_in_delivery_zone</span>(restaurant_name, customer_lon, customer_lat, max_km=<span class="number">5</span>):
    <span class="string">"""Check if customer is within delivery radius"""</span>
    
    <span class="comment"># Get restaurant coordinates</span>
    coords = r.geopos(<span class="string">'restaurants'</span>, restaurant_name)
    
    <span class="keyword">if</span> <span class="keyword">not</span> coords <span class="keyword">or</span> <span class="keyword">not</span> coords[<span class="number">0</span>]:
        <span class="keyword">return</span> <span class="keyword">False</span>, <span class="string">"Restaurant not found"</span>
    
    rest_lon, rest_lat = coords[<span class="number">0</span>]
    
    <span class="comment"># Calculate distance</span>
    <span class="comment"># Add customer temporarily to calculate</span>
    r.geoadd(<span class="string">'temp_calc'</span>, (customer_lon, customer_lat, <span class="string">'customer'</span>))
    r.geoadd(<span class="string">'temp_calc'</span>, (rest_lon, rest_lat, restaurant_name))
    
    distance = r.geodist(<span class="string">'temp_calc'</span>, restaurant_name, <span class="string">'customer'</span>, unit=<span class="string">'km'</span>)
    distance = <span class="function">float</span>(distance)
    
    <span class="comment"># Cleanup</span>
    r.delete(<span class="string">'temp_calc'</span>)
    
    in_zone = distance <= max_km
    message = <span class="string">f"‚úÖ Delivers! ({distance:.2f} km)"</span> <span class="keyword">if</span> in_zone <span class="keyword">else</span> <span class="string">f"‚ùå Too far ({distance:.2f} km)"</span>
    
    <span class="keyword">return</span> in_zone, message

<span class="comment"># Check delivery</span>
can_deliver, msg = is_in_delivery_zone(
    <span class="string">'Pizza Place'</span>,
    <span class="number">-122.4250</span>,  <span class="comment"># Customer longitude</span>
    <span class="number">37.7800</span>     <span class="comment"># Customer latitude</span>
)
<span class="keyword">print</span>(msg)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: How does Redis store geospatial data internally?</h4>
                <p><strong>A:</strong> Sorted Set! Encodes lat/lon as 52-bit geohash integer (score). Location "restaurant1" stored as member, geohash as score. GEORADIUS searches sorted set efficiently. Can use ZRANGE commands on geo keys!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Lon/Lat order - which comes first?</h4>
                <p><strong>A:</strong> LONGITUDE first! GEOADD key lon lat member. Common mistake: putting lat first. Remember: X-axis (lon) before Y-axis (lat). Like (X, Y) in math!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Accuracy limitations of Redis geo?</h4>
                <p><strong>A:</strong> ~1 meter precision! Good enough for most apps (restaurants, drivers, stores). Not for surveying or military. 52-bit geohash = trade-off between precision and efficiency. Perfect for consumer apps!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Units - forgot to specify, what happens?</h4>
                <p><strong>Answer:</strong> ERROR! Must specify: m, km, mi, or ft. "GEORADIUS key lon lat 5" fails. Always: "GEORADIUS key lon lat 5 km". No default unit. Explicit = safe!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I update location by re-adding same member?</h4>
                <p><strong>Answer:</strong> YES! GEOADD overwrites. Add driver_1 at location A, then GEOADD driver_1 at location B = updates to B. Perfect for real-time tracking. Same member = update, not duplicate!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Food Delivery App (DoorDash/Uber Eats)</strong></p>
            <p>Need: Find restaurants nearby, check delivery zone, track driver location in real-time!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Three Geo Collections</h4>
                <p><strong>Restaurants:</strong> GEOADD restaurants (50K locations)<br>
                <strong>Drivers:</strong> GEOADD drivers (updated every 5 seconds)<br>
                <strong>Search:</strong> GEORADIUS restaurants user_location 10 km<br>
                <strong>Delivery zone:</strong> GEODIST restaurant customer (check < 8km)<br>
                <strong>Assign driver:</strong> GEORADIUS drivers restaurant 5 km (nearest 10)</p>
                <p><strong>Results:</strong> ‚úÖ Search <10ms ‚úÖ Tracks 10K drivers real-time ‚úÖ Accurate delivery zones ‚úÖ Optimal driver assignment ‚úÖ Handles 100K req/sec</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üó∫Ô∏è</span><p><strong>GEOADD</strong> - Add/update locations (lon, lat)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìç</span><p><strong>GEORADIUS</strong> - Find nearby within radius</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìè</span><p><strong>GEODIST</strong> - Calculate distance</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>O(log N)</strong> - Fast even with millions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>~1m precision</strong> - Good for consumer apps</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Real-time updates</strong> - Re-add to update</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Geospatial</span><span class="keyword-tag">GEOADD</span><span class="keyword-tag">GEORADIUS</span><span class="keyword-tag">Location</span><span class="keyword-tag">Nearby</span><span class="keyword-tag">Maps</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Ride-sharing app needs to find 5 nearest drivers within 3km. Best command?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Get all drivers, calculate in app</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) GEORADIUS drivers lon lat 3 km COUNT 5</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) GEODIST for each driver individually</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Store in SQL with lat/lon columns</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - GEORADIUS with COUNT parameter</strong>
                    <p>GEORADIUS perfect! Single command finds nearest drivers within radius, sorted by distance. COUNT 5 limits results. <10ms query! Option A wasteful (transfer all drivers, calculate in app). GEODIST requires knowing driver IDs first. SQL geospatial queries slow. GEORADIUS = built for this!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 69: Redis Distributed Locking (Redlock)
// ============================================================

function getQuestion69Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Concurrency disaster:</strong> "Two servers processing same payment! Customer charged twice! Refunds everywhere!" Engineer: "Need distributed lock! Server 1 acquires lock on order_123, server 2 waits. Single processing guaranteed. Use Redis SET NX EX for simple lock, Redlock for multi-node safety!"</p>
            <p>Distributed lock = prevent race conditions.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis distributed lock prevents concurrent operations: (1) Simple: SET key value NX EX seconds (atomic set-if-not-exists with expiry), (2) Lock value = random UUID (prevent releasing others' locks), (3) Auto-expiry prevents deadlock, (4) Redlock algorithm for multi-node safety. Critical for: payments, inventory, job processing.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Locking Patterns</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Pattern</th><th style="padding: 10px;">Command</th><th style="padding: 10px;">Safety</th></tr>
                    <tr><td style="padding: 8px;">Simple Lock</td><td>SET lock:key uuid NX EX 30</td><td>Single Redis instance</td></tr>
                    <tr><td style="padding: 8px;">Lock Release</td><td>DEL if value matches</td><td>Lua script (atomic)</td></tr>
                    <tr><td style="padding: 8px;">Auto-Renewal</td><td>Extend TTL periodically</td><td>Long operations</td></tr>
                    <tr><td style="padding: 8px;">Redlock</td><td>Acquire on N/2+1 nodes</td><td>Multi-node safety</td></tr>
                    <tr><td style="padding: 8px;">Fair Lock</td><td>Sorted Set by timestamp</td><td>FIFO order</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Distributed Lock Flow</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Multiple Servers, One Lock Winner</text>
                    
                    <!-- Server 1 -->
                    <rect x="50" y="80" width="150" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="3" rx="6"/>
                    <text x="125" y="110" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üñ•Ô∏è Server 1</text>
                    <text x="125" y="130" text-anchor="middle" fill="#888" font-size="10">Tries to acquire lock</text>
                    <text x="125" y="145" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">‚úÖ WINS!</text>
                    
                    <!-- Server 2 -->
                    <rect x="50" y="200" width="150" height="80" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="125" y="230" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">üñ•Ô∏è Server 2</text>
                    <text x="125" y="250" text-anchor="middle" fill="#888" font-size="10">Tries to acquire lock</text>
                    <text x="125" y="265" text-anchor="middle" fill="#FF6347" font-size="11" font-weight="600">‚ùå Waits...</text>
                    
                    <!-- Server 3 -->
                    <rect x="50" y="320" width="150" height="60" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="125" y="345" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">üñ•Ô∏è Server 3</text>
                    <text x="125" y="365" text-anchor="middle" fill="#FF6347" font-size="11" font-weight="600">‚ùå Blocked</text>
                    
                    <!-- Redis Lock -->
                    <rect x="350" y="150" width="200" height="120" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="175" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">üîí Redis Lock</text>
                    <text x="450" y="200" text-anchor="middle" fill="#888" font-size="10">Key: lock:order_123</text>
                    <text x="450" y="220" text-anchor="middle" fill="#00FF88" font-size="11">Value: uuid_abc_server1</text>
                    <text x="450" y="240" text-anchor="middle" fill="#888" font-size="10">TTL: 30 seconds</text>
                    <text x="450" y="260" text-anchor="middle" fill="#DC143C" font-size="9">Auto-expires to prevent deadlock</text>
                    
                    <!-- Arrows -->
                    <path d="M 200 120 L 350 180" stroke="#00FF88" stroke-width="3"/>
                    <text x="270" y="140" fill="#00FF88" font-size="10">SET NX EX ‚úÖ</text>
                    
                    <path d="M 200 240 L 350 220" stroke="#FF6347" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="250" y="220" fill="#FF6347" font-size="9">Failed (exists)</text>
                    
                    <path d="M 200 350 L 350 250" stroke="#FF6347" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="250" y="300" fill="#FF6347" font-size="9">Blocked</text>
                    
                    <!-- Critical Section -->
                    <rect x="650" y="130" width="200" height="160" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="750" y="155" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="700">‚ö° Critical Section</text>
                    <text x="750" y="180" text-anchor="middle" fill="#888" font-size="11">Server 1 Processing:</text>
                    <text x="750" y="200" text-anchor="middle" fill="#888" font-size="10">1. Read order status</text>
                    <text x="750" y="215" text-anchor="middle" fill="#888" font-size="10">2. Charge payment</text>
                    <text x="750" y="230" text-anchor="middle" fill="#888" font-size="10">3. Update inventory</text>
                    <text x="750" y="245" text-anchor="middle" fill="#888" font-size="10">4. Send confirmation</text>
                    <text x="750" y="270" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">‚úÖ Release lock</text>
                    
                    <path d="M 550 210 L 650 210" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Simple Distributed Lock</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Acquire and Release Lock</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> uuid
<span class="keyword">import</span> time

r = redis.Redis()

<span class="keyword">def</span> <span class="function">acquire_lock</span>(resource, ttl=<span class="number">30</span>):
    <span class="string">"""Acquire distributed lock with random value"""</span>
    lock_key = <span class="string">f'lock:{resource}'</span>
    lock_value = <span class="function">str</span>(uuid.uuid4())  <span class="comment"># Random UUID</span>
    
    <span class="comment"># SET NX EX = atomic set if not exists with expiry</span>
    acquired = r.set(lock_key, lock_value, nx=<span class="keyword">True</span>, ex=ttl)
    
    <span class="keyword">if</span> acquired:
        <span class="keyword">return</span> lock_value  <span class="comment"># Return value to release later</span>
    <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># Lock held by another process</span>

<span class="keyword">def</span> <span class="function">release_lock</span>(resource, lock_value):
    <span class="string">"""Release lock only if we own it (Lua script for atomicity)"""</span>
    lock_key = <span class="string">f'lock:{resource}'</span>
    
    <span class="comment"># Lua script: Check value matches, then delete</span>
    lua_script = <span class="string">"""
    if redis.call("GET", KEYS[1]) == ARGV[1] then
        return redis.call("DEL", KEYS[1])
    else
        return 0
    end
    """</span>
    
    released = r.eval(lua_script, <span class="number">1</span>, lock_key, lock_value)
    <span class="keyword">return</span> <span class="function">bool</span>(released)

<span class="comment"># Usage</span>
resource_id = <span class="string">'order_12345'</span>
lock_value = acquire_lock(resource_id, ttl=<span class="number">30</span>)

<span class="keyword">if</span> lock_value:
    <span class="keyword">try</span>:
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Lock acquired, processing {resource_id}..."</span>)
        <span class="comment"># Critical section: process order</span>
        time.sleep(<span class="number">5</span>)  <span class="comment"># Simulate processing</span>
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Processing complete"</span>)
    <span class="keyword">finally</span>:
        <span class="keyword">if</span> release_lock(resource_id, lock_value):
            <span class="keyword">print</span>(<span class="string">f"‚úÖ Lock released"</span>)
<span class="keyword">else</span>:
    <span class="keyword">print</span>(<span class="string">f"‚ùå Lock held by another process, skipping"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Lock with Auto-Renewal</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Long-Running Operations</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> threading

<span class="keyword">class</span> <span class="function">RenewableLock</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self, resource, ttl=<span class="number">30</span>, auto_renew=<span class="keyword">True</span>):
        self.resource = resource
        self.lock_key = <span class="string">f'lock:{resource}'</span>
        self.lock_value = <span class="function">str</span>(uuid.uuid4())
        self.ttl = ttl
        self.auto_renew = auto_renew
        self.renew_thread = <span class="keyword">None</span>
        self.stop_renewal = threading.Event()
    
    <span class="keyword">def</span> <span class="function">acquire</span>(self):
        acquired = r.set(self.lock_key, self.lock_value, nx=<span class="keyword">True</span>, ex=self.ttl)
        
        <span class="keyword">if</span> acquired <span class="keyword">and</span> self.auto_renew:
            <span class="comment"># Start renewal thread</span>
            self.renew_thread = threading.Thread(target=self._renew_lock)
            self.renew_thread.daemon = <span class="keyword">True</span>
            self.renew_thread.start()
        
        <span class="keyword">return</span> acquired
    
    <span class="keyword">def</span> <span class="function">_renew_lock</span>(self):
        <span class="string">"""Renew lock every TTL/2 seconds"""</span>
        <span class="keyword">while</span> <span class="keyword">not</span> self.stop_renewal.is_set():
            time.sleep(self.ttl / <span class="number">2</span>)  <span class="comment"># Renew at half TTL</span>
            
            <span class="comment"># Extend TTL if we still own the lock</span>
            lua_script = <span class="string">"""
            if redis.call("GET", KEYS[1]) == ARGV[1] then
                return redis.call("EXPIRE", KEYS[1], ARGV[2])
            else
                return 0
            end
            """</span>
            renewed = r.eval(lua_script, <span class="number">1</span>, self.lock_key, self.lock_value, self.ttl)
            
            <span class="keyword">if</span> renewed:
                <span class="keyword">print</span>(<span class="string">f"üîÑ Lock renewed for {self.resource}"</span>)
            <span class="keyword">else</span>:
                <span class="keyword">break</span>  <span class="comment"># Lost the lock</span>
    
    <span class="keyword">def</span> <span class="function">release</span>(self):
        self.stop_renewal.set()
        
        lua_script = <span class="string">"""
        if redis.call("GET", KEYS[1]) == ARGV[1] then
            return redis.call("DEL", KEYS[1])
        end
        """</span>
        r.eval(lua_script, <span class="number">1</span>, self.lock_key, self.lock_value)

<span class="comment"># Usage for long operation</span>
lock = RenewableLock(<span class="string">'report_generation'</span>, ttl=<span class="number">30</span>)
<span class="keyword">if</span> lock.acquire():
    <span class="keyword">try</span>:
        <span class="comment"># Long operation (5 minutes)</span>
        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">10</span>):
            <span class="keyword">print</span>(<span class="string">f"Processing chunk {i+1}/10..."</span>)
            time.sleep(<span class="number">30</span>)  <span class="comment"># Lock auto-renews!</span>
    <span class="keyword">finally</span>:
        lock.release()</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Lock with Retry</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Wait and Retry Pattern</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">acquire_lock_with_retry</span>(resource, ttl=<span class="number">30</span>, retry_times=<span class="number">3</span>, retry_delay=<span class="number">1</span>):
    <span class="string">"""Try to acquire lock with retries"""</span>
    <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="function">range</span>(retry_times):
        lock_value = acquire_lock(resource, ttl)
        
        <span class="keyword">if</span> lock_value:
            <span class="keyword">return</span> lock_value
        
        <span class="keyword">if</span> attempt < retry_times - <span class="number">1</span>:
            <span class="keyword">print</span>(<span class="string">f"‚è≥ Lock busy, retrying in {retry_delay}s (attempt {attempt+1}/{retry_times})..."</span>)
            time.sleep(retry_delay)
    
    <span class="keyword">return</span> <span class="keyword">None</span>  <span class="comment"># Failed to acquire after retries</span>

<span class="comment"># Usage</span>
lock_value = acquire_lock_with_retry(<span class="string">'payment_123'</span>, retry_times=<span class="number">5</span>, retry_delay=<span class="number">2</span>)

<span class="keyword">if</span> lock_value:
    <span class="keyword">try</span>:
        process_payment()
    <span class="keyword">finally</span>:
        release_lock(<span class="string">'payment_123'</span>, lock_value)
<span class="keyword">else</span>:
    <span class="keyword">print</span>(<span class="string">"‚ùå Could not acquire lock after retries"</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why use random UUID as lock value?</h4>
                <p><strong>A:</strong> Prevent releasing someone else's lock! Server A acquires lock, crashes. TTL expires. Server B acquires same lock. Server A recovers, tries to release - without UUID check, it would release B's lock! UUID = ownership proof!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What if process crashes while holding lock?</h4>
                <p><strong>A:</strong> TTL auto-expires! Lock released after 30s (or your TTL). Prevents deadlock. Trade-off: Choose TTL wisely. Too short = lock expires during processing. Too long = others wait unnecessarily. Monitor operation time!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: SET NX vs SETNX - which is better?</h4>
                <p><strong>A:</strong> SET NX preferred! SET key value NX EX 30 = atomic set-if-not-exists with expiry. Old SETNX + EXPIRE = two commands (not atomic). If crash between them, no expiry = deadlock! Always use SET NX EX!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Why use Lua script for lock release?</h4>
                <p><strong>Answer:</strong> Atomicity! Check value + delete must be atomic. Without Lua: GET (value matches) ‚Üí another process grabs lock ‚Üí DEL (delete wrong lock!). Lua script executes atomically. No race condition!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Single Redis vs Redlock - when to use Redlock?</h4>
                <p><strong>Answer:</strong> Redlock for critical operations across multiple Redis instances! Single Redis = simpler, good for most apps. Redlock = acquire lock on N/2+1 nodes, prevents split-brain. Use for: payments, financial transactions. Overkill for: caching, rate limiting!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Payment Processing</strong></p>
            <p>User double-clicks "Pay Now". Two requests hit two servers. Both try to charge card!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Distributed Lock on Order ID</h4>
                <p><strong>Both servers try:</strong> acquire_lock(order_123)<br>
                <strong>Server 1:</strong> ‚úÖ Acquires lock, processes payment<br>
                <strong>Server 2:</strong> ‚ùå Lock exists, returns "Already processing"<br>
                <strong>Server 1 finishes:</strong> Release lock<br>
                <strong>Lock expires:</strong> 30s TTL (if crash)</p>
                <p><strong>Results:</strong> ‚úÖ Single charge guaranteed ‚úÖ No double-processing ‚úÖ Auto-recovery on crash ‚úÖ Works across any number of servers</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>SET NX EX</strong> - Atomic lock with expiry</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üé≤</span><p><strong>Random UUID</strong> - Ownership verification</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>TTL prevents deadlock</strong> - Auto-expires</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìú</span><p><strong>Lua for release</strong> - Atomic check+delete</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Auto-renewal</strong> - Long operations</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõ°Ô∏è</span><p><strong>Redlock</strong> - Multi-node safety</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Lock</span><span class="keyword-tag">SET NX</span><span class="keyword-tag">Distributed</span><span class="keyword-tag">Redlock</span><span class="keyword-tag">Concurrency</span><span class="keyword-tag">Mutex</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Prevent duplicate payment processing across multiple servers. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Database row lock</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Redis SET NX EX with UUID</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) In-memory lock per server</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Check database before processing</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Redis SET NX EX with UUID</strong>
                    <p>Redis distributed lock perfect! SET NX = only one server acquires. EX = auto-expires (no deadlock). UUID = prevent releasing others' locks. Database locks slow, may timeout. In-memory locks per-server don't prevent cross-server duplicates. Database check = race condition (check ‚Üí process gap). Redis lock = industry standard for distributed systems!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 70: Redis Interview Tips & Tricks
// ============================================================

function getQuestion70Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Interview preparation:</strong> "Redis interview tomorrow! What do I focus on?" Interviewer asks: (1) Data structures - when to use each, (2) Cache strategies, (3) Persistence trade-offs, (4) Scaling approaches, (5) Real problems solved. Nail these = offer! This question covers what interviewers ACTUALLY ask!</p>
            <p>Preparation = success.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis interview success requires: (1) Know when to use each data structure, (2) Understand persistence (RDB vs AOF), (3) Explain caching strategies (write-through, write-behind), (4) Describe scaling (replication, Cluster, Sentinel), (5) Avoid anti-patterns (KEYS *, no TTL), (6) Share real use cases. Show production experience!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Top 10 Interview Topics</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Topic</th><th style="padding: 10px;">What They Ask</th><th style="padding: 10px;">Key Points</th></tr>
                    <tr><td style="padding: 8px;">Data Structures</td><td>When to use Hash vs Set?</td><td>Match structure to access pattern</td></tr>
                    <tr><td style="padding: 8px;">Caching</td><td>Implement cache layer</td><td>TTL, eviction, invalidation</td></tr>
                    <tr><td style="padding: 8px;">Persistence</td><td>RDB vs AOF trade-offs?</td><td>Performance vs durability</td></tr>
                    <tr><td style="padding: 8px;">Scaling</td><td>Handle 10M users?</td><td>Replication, Cluster, Sentinel</td></tr>
                    <tr><td style="padding: 8px;">Performance</td><td>Optimize slow queries?</td><td>SCAN not KEYS, pipeline</td></tr>
                    <tr><td style="padding: 8px;">Use Cases</td><td>Real problems solved?</td><td>Specific examples with metrics</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Interview Success Formula:</strong></p>
                <ul>
                    <li><strong>Specifics over generics:</strong> "Reduced cache miss from 40% to 5%" not "improved performance"</li>
                    <li><strong>Trade-offs:</strong> Always discuss pros/cons, not just solutions</li>
                    <li><strong>Production experience:</strong> Share real incidents, decisions, results</li>
                    <li><strong>Ask clarifying questions:</strong> Scale? Latency requirements? Consistency needs?</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Interview Preparation Roadmap</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">What Interviewers Actually Ask</text>
                    
                    <!-- Foundation -->
                    <rect x="50" y="60" width="250" height="80" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="175" y="85" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">üìö Foundation (Must Know)</text>
                    <text x="60" y="110" fill="#888" font-size="11">‚úÖ 5 data structures + use cases</text>
                    <text x="60" y="125" fill="#888" font-size="11">‚úÖ Strings, Hashes, Lists, Sets, ZSets</text>
                    
                    <!-- Intermediate -->
                    <rect x="325" y="60" width="250" height="80" fill="rgba(255,165,0,0.1)" stroke="#FFA500" stroke-width="3" rx="8"/>
                    <text x="450" y="85" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="700">üîß Intermediate (Expected)</text>
                    <text x="335" y="110" fill="#888" font-size="11">‚úÖ Persistence (RDB vs AOF)</text>
                    <text x="335" y="125" fill="#888" font-size="11">‚úÖ Caching strategies, TTL, eviction</text>
                    
                    <!-- Advanced -->
                    <rect x="600" y="60" width="250" height="80" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="725" y="85" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">üöÄ Advanced (Impressive)</text>
                    <text x="610" y="110" fill="#888" font-size="11">‚úÖ Replication, Sentinel, Cluster</text>
                    <text x="610" y="125" fill="#888" font-size="11">‚úÖ Lua scripts, transactions, locks</text>
                    
                    <!-- Common Questions -->
                    <rect x="50" y="170" width="800" height="220" fill="rgba(0,0,0,0.2)" stroke="#666" stroke-width="2" rx="8"/>
                    <text x="450" y="195" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="700">‚ùì Top 10 Interview Questions</text>
                    
                    <text x="70" y="220" fill="#DC143C" font-size="12" font-weight="600">1. "Design a caching layer for our API"</text>
                    <text x="80" y="235" fill="#888" font-size="10">‚Üí Discuss: TTL strategy, cache-aside vs write-through, invalidation</text>
                    
                    <text x="70" y="255" fill="#DC143C" font-size="12" font-weight="600">2. "Which data structure for leaderboard?"</text>
                    <text x="80" y="270" fill="#888" font-size="10">‚Üí Answer: Sorted Set (ZADD, ZRANGE) - O(log N) updates</text>
                    
                    <text x="70" y="290" fill="#DC143C" font-size="12" font-weight="600">3. "RDB vs AOF - when to use each?"</text>
                    <text x="80" y="305" fill="#888" font-size="10">‚Üí Trade-off: RDB = fast restart, AOF = minimal data loss</text>
                    
                    <text x="70" y="325" fill="#DC143C" font-size="12" font-weight="600">4. "How to handle 1M requests/second?"</text>
                    <text x="80" y="340" fill="#888" font-size="10">‚Üí Solutions: Read replicas, Cluster sharding, connection pooling</text>
                    
                    <text x="70" y="360" fill="#DC143C" font-size="12" font-weight="600">5. "Biggest Redis mistake you've seen?"</text>
                    <text x="80" y="375" fill="#888" font-size="10">‚Üí Answer: KEYS * in production (blocking), no TTL (memory leak)</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Common Coding Challenge - Cache Implementation</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Implement Cache-Aside Pattern</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json

r = redis.Redis()

<span class="keyword">def</span> <span class="function">get_user</span>(user_id):
    <span class="string">"""Cache-aside pattern - check cache first, then DB"""</span>
    cache_key = <span class="string">f'user:{user_id}'</span>
    
    <span class="comment"># Try cache first</span>
    cached = r.get(cache_key)
    <span class="keyword">if</span> cached:
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Cache HIT for user {user_id}"</span>)
        <span class="keyword">return</span> json.loads(cached)
    
    <span class="comment"># Cache miss - fetch from database</span>
    <span class="keyword">print</span>(<span class="string">f"‚ùå Cache MISS for user {user_id}, fetching from DB..."</span>)
    user_data = fetch_from_database(user_id)  <span class="comment"># Your DB query</span>
    
    <span class="comment"># Store in cache with TTL</span>
    r.setex(cache_key, <span class="number">3600</span>, json.dumps(user_data))  <span class="comment"># 1 hour TTL</span>
    
    <span class="keyword">return</span> user_data

<span class="keyword">def</span> <span class="function">update_user</span>(user_id, data):
    <span class="string">"""Update DB and invalidate cache"""</span>
    <span class="comment"># Update database</span>
    update_database(user_id, data)
    
    <span class="comment"># Invalidate cache (cache-aside pattern)</span>
    r.delete(<span class="string">f'user:{user_id}'</span>)
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Cache invalidated for user {user_id}"</span>)

<span class="comment"># Interviewers love seeing:</span>
<span class="comment"># 1. TTL to prevent stale data</span>
<span class="comment"># 2. Cache invalidation strategy</span>
<span class="comment"># 3. Error handling (not shown for brevity)</span>
<span class="comment"># 4. Monitoring (cache hit rate)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: System Design Question - Rate Limiter</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Sliding Window Rate Limiter</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> time

<span class="keyword">def</span> <span class="function">is_rate_limited</span>(user_id, max_requests=<span class="number">100</span>, window_seconds=<span class="number">60</span>):
    <span class="string">"""Sliding window rate limiter"""</span>
    key = <span class="string">f'rate_limit:{user_id}'</span>
    now = time.time()
    window_start = now - window_seconds
    
    <span class="comment"># Start transaction</span>
    pipe = r.pipeline()
    
    <span class="comment"># Remove old requests outside window</span>
    pipe.zremrangebyscore(key, <span class="number">0</span>, window_start)
    
    <span class="comment"># Count requests in current window</span>
    pipe.zcard(key)
    
    <span class="comment"># Add current request</span>
    pipe.zadd(key, {<span class="function">str</span>(now): now})
    
    <span class="comment"># Set expiry</span>
    pipe.expire(key, window_seconds)
    
    results = pipe.execute()
    request_count = results[<span class="number">1</span>]  <span class="comment"># ZCARD result</span>
    
    <span class="keyword">if</span> request_count > max_requests:
        <span class="keyword">print</span>(<span class="string">f"‚ùå Rate limited: {request_count} requests"</span>)
        <span class="keyword">return</span> <span class="keyword">True</span>
    
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Allowed: {request_count}/{max_requests} requests"</span>)
    <span class="keyword">return</span> <span class="keyword">False</span>

<span class="comment"># Demonstrates:</span>
<span class="comment"># 1. Sorted Set for time-based data</span>
<span class="comment"># 2. Pipeline for efficiency</span>
<span class="comment"># 3. Sliding window algorithm</span>
<span class="comment"># 4. Production-ready approach</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Behavioral Question Answer</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Interview Response - Real Production Story</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment">/**
 * Question: "Tell me about a Redis problem you solved in production"
 * 
 * GOOD Answer Template:
 * 
 * SITUATION: "Our API response time increased from 50ms to 2 seconds.
 * Cache hit rate dropped from 90% to 20%."
 * 
 * PROBLEM: "Investigation showed: keys had no TTL, Redis memory at 95%,
 * eviction policy was noeviction (blocking writes!)"
 * 
 * ACTION: "I implemented:
 * 1. Added TTL to all cache keys (1 hour for user data, 5 min for feed)
 * 2. Changed eviction policy to allkeys-lru
 * 3. Set maxmemory to 8GB (was unlimited)
 * 4. Added monitoring: cache hit rate, memory usage, eviction count"
 * 
 * RESULT: "Response time dropped to 60ms, cache hit rate recovered to 88%,
 * memory stabilized at 6GB. Zero OOM kills in 6 months since fix."
 * 
 * LEARNED: "Always set TTL, monitor memory, test eviction policies before production"
 * 
 * Why this works:
 * ‚úÖ Specific metrics (2s ‚Üí 60ms, 20% ‚Üí 88%)
 * ‚úÖ Shows debugging process
 * ‚úÖ Multiple solutions (not just one fix)
 * ‚úÖ Results with timeline
 * ‚úÖ Learning/growth mindset
 */</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Most common Redis interview mistake?</h4>
                <p><strong>A:</strong> Saying "I'd use Redis for X" without explaining WHY or discussing trade-offs. Good answer: "Redis for session storage because: in-memory speed, TTL support, atomic operations. Trade-off: more expensive than DB, requires persistence strategy."</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: How to show Redis expertise in interview?</h4>
                <p><strong>A:</strong> Share specific production metrics! "Reduced API latency from 500ms to 50ms using Redis cache. Cache hit rate: 92%. Handled 50K req/sec. Saved $10K/month in database costs." Numbers = credibility!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Red flags that hurt candidates?</h4>
                <p><strong>A:</strong> (1) Recommending KEYS * for production, (2) Not knowing persistence options, (3) Claiming Redis can replace database, (4) No experience with scaling/clustering, (5) Can't explain when NOT to use Redis!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: "When would you NOT use Redis?"</h4>
                <p><strong>Answer:</strong> (1) Primary data storage (no ACID, durability risk), (2) Complex queries (no JOIN, WHERE clauses), (3) Large blobs (>1MB values), (4) Very low traffic (overhead not worth it), (5) Strict consistency required (eventual consistency). Knowing limits = expertise!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: "Redis vs Memcached?"</h4>
                <p><strong>Answer:</strong> Redis wins: (1) Rich data structures (not just strings), (2) Persistence (RDB/AOF), (3) Replication, (4) Pub/Sub, (5) Lua scripts. Memcached wins: (1) Simpler (easier to operate), (2) Multi-threaded (better for very simple GET/SET). Modern apps ‚Üí Redis!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Mock Interview Question: "Design Caching for E-commerce Product Catalog"</strong></p>
            <p>10M products, 100K req/sec, need <100ms response. How do you use Redis?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Strong Interview Answer</h4>
                <p><strong>Clarifying questions:</strong> Read-heavy or write-heavy? Consistency requirements? Budget?<br>
                <strong>Assuming:</strong> 95% reads, eventual consistency OK, minimize costs<br>
                <strong>Solution:</strong> (1) Hash per product: product:{id} with fields (name, price, stock, etc.) - Uses ziplist = memory efficient. (2) TTL 5 minutes for price/stock (frequent changes), 1 hour for static data. (3) Cache-aside pattern with invalidation on update. (4) Read replicas for 100K req/sec distribution. (5) Monitor: cache hit rate >90%, p99 latency <50ms.<br>
                <strong>Trade-offs:</strong> 5-min TTL = slightly stale prices (acceptable for e-commerce). Memory: ~10GB for 10M products. Cost: ~$100/month vs $1K/month database load.<br>
                <strong>Scalability:</strong> Add replicas as traffic grows. Consider Cluster if >100M products.</p>
                <p><strong>Why this impresses:</strong> ‚úÖ Asked clarifying questions ‚úÖ Specific data structures ‚úÖ Discussed trade-offs ‚úÖ Included metrics ‚úÖ Cost analysis ‚úÖ Scalability path</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Use metrics</strong> - Specific numbers show experience</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚öñÔ∏è</span><p><strong>Discuss trade-offs</strong> - Not just solutions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ùì</span><p><strong>Ask questions</strong> - Clarify requirements first</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî¥</span><p><strong>Know limitations</strong> - When NOT to use Redis</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìñ</span><p><strong>Share real stories</strong> - Production experience counts</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõ†Ô∏è</span><p><strong>Show debugging</strong> - Process matters, not just solutions</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Interview</span><span class="keyword-tag">Tips</span><span class="keyword-tag">Preparation</span><span class="keyword-tag">Best Practices</span><span class="keyword-tag">System Design</span><span class="keyword-tag">Questions</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Interviewer asks "Design a cache". What's the FIRST thing you should do?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Start writing code immediately</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Ask clarifying questions (scale, requirements, budget)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Explain all Redis data structures</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Draw architecture diagram</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Ask clarifying questions</strong>
                    <p>ALWAYS clarify requirements first! Ask: Traffic volume? Read/write ratio? Latency requirements? Consistency needs? Budget constraints? This shows: (1) You think like senior engineer, (2) You don't make assumptions, (3) You optimize for real needs not theoretical perfection. Jumping to code = junior mistake. Questions ‚Üí understanding ‚Üí right solution!</p>
                </div>
            </div>
        </div>
    `;
}
// ============================================================
// QUESTION 71: Redis Streams Deep Dive
// ============================================================

function getQuestion71Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Event streaming problem:</strong> "Need event log: user actions, system events, audit trail. Database writes slow down app! Lost events on crash! Need replay capability!" Architect: "Use Redis Streams! XADD for events, consumer groups for processing, persistence for durability. Result: 100K events/sec, zero loss, easy replay!"</p>
            <p>Streams = event sourcing.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Streams: append-only log with unique IDs (timestamp-sequence). XADD adds entries, XREAD reads, XREADGROUP for consumer groups with acknowledgment. Features: automatic ID generation, range queries, consumer groups, pending list. Perfect for: event sourcing, activity feeds, audit logs, microservices communication.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Stream Commands</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Command</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">XADD</td><td>Add entry</td><td>XADD events * action "login" user "alice"</td></tr>
                    <tr><td style="padding: 8px;">XREAD</td><td>Read entries</td><td>XREAD COUNT 10 STREAMS events 0</td></tr>
                    <tr><td style="padding: 8px;">XREADGROUP</td><td>Consumer group read</td><td>XREADGROUP GROUP mygroup consumer1</td></tr>
                    <tr><td style="padding: 8px;">XACK</td><td>Acknowledge</td><td>XACK events mygroup 1234567-0</td></tr>
                    <tr><td style="padding: 8px;">XLEN</td><td>Get length</td><td>XLEN events</td></tr>
                    <tr><td style="padding: 8px;">XRANGE</td><td>Range query</td><td>XRANGE events - + COUNT 100</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Streams vs Lists vs Pub/Sub:</strong></p>
                <ul>
                    <li><strong>Streams:</strong> Persistent log, consumer groups, acknowledgment, replay</li>
                    <li><strong>Lists:</strong> Simple queue, no built-in consumer groups</li>
                    <li><strong>Pub/Sub:</strong> Ephemeral, broadcast, no persistence</li>
                    <li><strong>Use Streams when:</strong> Need reliability, multiple consumers, replay</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Redis Streams Architecture</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Stream with Consumer Groups</text>
                    
                    <!-- Producer -->
                    <rect x="50" y="80" width="150" height="60" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="125" y="105" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üì§ Producer</text>
                    <text x="125" y="125" text-anchor="middle" fill="#888" font-size="10">XADD events</text>
                    
                    <path d="M 200 110 L 280 110" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    
                    <!-- Stream -->
                    <rect x="280" y="60" width="340" height="300" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="85" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">üåä Redis Stream: "events"</text>
                    
                    <!-- Stream Entries -->
                    <rect x="300" y="100" width="300" height="35" fill="rgba(220,20,60,0.15)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="310" y="120" fill="#888" font-size="9">1234567890-0: {action: "login", user: "alice"}</text>
                    
                    <rect x="300" y="145" width="300" height="35" fill="rgba(220,20,60,0.15)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="310" y="165" fill="#888" font-size="9">1234567891-0: {action: "purchase", item: "book"}</text>
                    
                    <rect x="300" y="190" width="300" height="35" fill="rgba(220,20,60,0.15)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="310" y="210" fill="#888" font-size="9">1234567892-0: {action: "logout", user: "alice"}</text>
                    
                    <text x="450" y="245" text-anchor="middle" fill="#888" font-size="10">... more entries ...</text>
                    
                    <!-- Consumer Groups -->
                    <rect x="295" y="265" width="145" height="80" fill="rgba(255,165,0,0.1)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="367" y="285" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">Group: analytics</text>
                    <text x="305" y="305" fill="#888" font-size="9">Consumer A</text>
                    <text x="305" y="320" fill="#888" font-size="9">Consumer B</text>
                    <text x="305" y="335" fill="#888" font-size="9">Last ID: 1234567892-0</text>
                    
                    <rect x="455" y="265" width="145" height="80" fill="rgba(0,191,255,0.1)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="527" y="285" text-anchor="middle" fill="#00BFFF" font-size="11" font-weight="600">Group: notifications</text>
                    <text x="465" y="305" fill="#888" font-size="9">Consumer C</text>
                    <text x="465" y="320" fill="#888" font-size="9">Last ID: 1234567891-0</text>
                    
                    <!-- Consumers -->
                    <rect x="670" y="90" width="180" height="60" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="760" y="115" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">üë∑ Analytics Workers</text>
                    <text x="760" y="135" text-anchor="middle" fill="#888" font-size="9">Process in parallel</text>
                    
                    <rect x="670" y="180" width="180" height="60" fill="rgba(0,191,255,0.2)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="760" y="205" text-anchor="middle" fill="#00BFFF" font-size="12" font-weight="600">üìß Notification Service</text>
                    <text x="760" y="225" text-anchor="middle" fill="#888" font-size="9">Sends emails/push</text>
                    
                    <path d="M 620 295 L 670 120" stroke="#FFA500" stroke-width="2" marker-end="url(#arrowOrange)"/>
                    <text x="640" y="200" fill="#FFA500" font-size="9">XREADGROUP</text>
                    
                    <path d="M 620 305 L 670 210" stroke="#00BFFF" stroke-width="2" marker-end="url(#arrowBlue)"/>
                    <text x="640" y="260" fill="#00BFFF" font-size="9">XREADGROUP</text>
                    
                    <rect x="50" y="380" width="800" height="30" fill="rgba(0,0,0,0.2)" stroke="#666" stroke-width="2" rx="6"/>
                    <text x="450" y="400" text-anchor="middle" fill="#00FF88" font-size="11">
                        ‚úÖ Each group processes independently, ACK tracking, automatic replay on failure
                    </text>
                    
                    <defs>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                        <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#FFA500" />
                        </marker>
                        <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00BFFF" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Stream Operations</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Producer and Consumer</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis(decode_responses=<span class="keyword">True</span>)

<span class="comment"># Producer: Add events to stream</span>
<span class="keyword">def</span> <span class="function">log_event</span>(action, user, **metadata):
    <span class="string">"""Add event to stream with auto-generated ID"""</span>
    event_data = {<span class="string">'action'</span>: action, <span class="string">'user'</span>: user, **metadata}
    
    <span class="comment"># * = auto-generate ID (timestamp-sequence)</span>
    event_id = r.xadd(<span class="string">'events'</span>, event_data)
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Event added: {event_id} - {action}"</span>)
    <span class="keyword">return</span> event_id

<span class="comment"># Add events</span>
log_event(<span class="string">'login'</span>, <span class="string">'alice'</span>, ip=<span class="string">'192.168.1.1'</span>)
log_event(<span class="string">'purchase'</span>, <span class="string">'alice'</span>, item=<span class="string">'book'</span>, price=<span class="number">29.99</span>)
log_event(<span class="string">'logout'</span>, <span class="string">'alice'</span>)

<span class="comment"># Consumer: Read events</span>
<span class="keyword">def</span> <span class="function">read_events</span>(last_id=<span class="string">'0'</span>, count=<span class="number">10</span>):
    <span class="string">"""Read events from stream"""</span>
    <span class="comment"># XREAD: Read from last_id onwards</span>
    events = r.xread({<span class="string">'events'</span>: last_id}, count=count, block=<span class="number">1000</span>)
    
    <span class="keyword">if</span> events:
        <span class="keyword">for</span> stream_name, messages <span class="keyword">in</span> events:
            <span class="keyword">for</span> event_id, event_data <span class="keyword">in</span> messages:
                <span class="keyword">print</span>(<span class="string">f"üì® {event_id}: {event_data}"</span>)
                <span class="keyword">return</span> event_id  <span class="comment"># Return last processed ID</span>
    <span class="keyword">return</span> last_id

<span class="comment"># Read all events</span>
last = <span class="string">'0'</span>
<span class="keyword">while</span> <span class="keyword">True</span>:
    last = read_events(last) <span class="keyword">or</span> last
    time.sleep(<span class="number">1</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Consumer Groups</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Reliable Processing</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Create consumer group</span>
<span class="keyword">try</span>:
    r.xgroup_create(<span class="string">'events'</span>, <span class="string">'analytics'</span>, id=<span class="string">'0'</span>)
    <span class="keyword">print</span>(<span class="string">"‚úÖ Consumer group 'analytics' created"</span>)
<span class="keyword">except</span> redis.ResponseError:
    <span class="keyword">print</span>(<span class="string">"‚ö†Ô∏è Consumer group already exists"</span>)

<span class="keyword">def</span> <span class="function">process_with_consumer_group</span>(group_name, consumer_name):
    <span class="string">"""Process events with acknowledgment"""</span>
    <span class="keyword">while</span> <span class="keyword">True</span>:
        <span class="comment"># Read unprocessed events for this consumer group</span>
        events = r.xreadgroup(
            group_name,
            consumer_name,
            {<span class="string">'events'</span>: <span class="string">'>'</span>},  <span class="comment"># '>' = only new messages</span>
            count=<span class="number">10</span>,
            block=<span class="number">2000</span>
        )
        
        <span class="keyword">if</span> <span class="keyword">not</span> events:
            <span class="keyword">continue</span>
        
        <span class="keyword">for</span> stream_name, messages <span class="keyword">in</span> events:
            <span class="keyword">for</span> event_id, event_data <span class="keyword">in</span> messages:
                <span class="keyword">try</span>:
                    <span class="comment"># Process event</span>
                    <span class="keyword">print</span>(<span class="string">f"üîÑ [{consumer_name}] Processing {event_id}: {event_data}"</span>)
                    
                    <span class="comment"># Simulate processing</span>
                    time.sleep(<span class="number">0.5</span>)
                    
                    <span class="comment"># Acknowledge successful processing</span>
                    r.xack(<span class="string">'events'</span>, group_name, event_id)
                    <span class="keyword">print</span>(<span class="string">f"‚úÖ [{consumer_name}] Acknowledged {event_id}"</span>)
                    
                <span class="keyword">except</span> <span class="function">Exception</span> <span class="keyword">as</span> e:
                    <span class="keyword">print</span>(<span class="string">f"‚ùå [{consumer_name}] Error processing {event_id}: {e}"</span>)
                    <span class="comment"># Don't ACK - message stays in pending list for retry</span>

<span class="comment"># Run consumer (in separate process/thread)</span>
<span class="comment"># process_with_consumer_group('analytics', 'worker1')</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Stream with Trimming</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Memory Management</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">log_event_with_trimming</span>(action, user, max_len=<span class="number">10000</span>):
    <span class="string">"""Add event and keep only recent N entries"""</span>
    event_data = {<span class="string">'action'</span>: action, <span class="string">'user'</span>: user}
    
    <span class="comment"># MAXLEN ~ = approximate trimming (faster)</span>
    event_id = r.xadd(
        <span class="string">'events'</span>,
        event_data,
        maxlen=max_len,
        approximate=<span class="keyword">True</span>  <span class="comment"># ~ for performance</span>
    )
    <span class="keyword">return</span> event_id

<span class="keyword">def</span> <span class="function">trim_old_events</span>(before_timestamp):
    <span class="string">"""Trim events older than timestamp"""</span>
    <span class="comment"># MINID: Remove entries with ID < before_timestamp</span>
    trimmed = r.xtrim(<span class="string">'events'</span>, minid=before_timestamp)
    <span class="keyword">print</span>(<span class="string">f"‚úÇÔ∏è Trimmed {trimmed} old events"</span>)

<span class="keyword">def</span> <span class="function">get_stream_info</span>():
    <span class="string">"""Get stream statistics"""</span>
    info = r.xinfo_stream(<span class="string">'events'</span>)
    <span class="keyword">print</span>(<span class="string">f"üìä Stream Info:"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Length: {info['length']}"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Groups: {info['groups']}"</span>)
    <span class="keyword">print</span>(<span class="string">f"  First entry: {info['first-entry']}"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Last entry: {info['last-entry']}"</span>)

<span class="comment"># Trim events older than 1 hour</span>
one_hour_ago = <span class="function">int</span>((time.time() - <span class="number">3600</span>) * <span class="number">1000</span>)
trim_old_events(<span class="string">f'{one_hour_ago}-0'</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Stream ID format - what does 1234567890-0 mean?</h4>
                <p><strong>A:</strong> timestamp-sequence! 1234567890 = millisecond timestamp, 0 = sequence number (for same millisecond). Auto-generated ensures uniqueness and time-ordering. Can specify custom ID but must be > previous ID!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What happens if consumer crashes without ACK?</h4>
                <p><strong>A:</strong> Message stays in pending list! Another consumer can claim it with XPENDING and XCLAIM. Enables automatic retry. Unlike Lists (job lost), Streams track unacknowledged messages. Reliability!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Consumer groups vs multiple XREAD consumers?</h4>
                <p><strong>A:</strong> Consumer groups distribute work (each message to ONE consumer). Multiple XREAD = ALL consumers get ALL messages (broadcast). Groups for work distribution, XREAD for fan-out!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: XREADGROUP with '>' vs '0' - difference?</h4>
                <p><strong>Answer:</strong> '>' = only NEW undelivered messages (normal mode). '0' = ALL pending messages for this consumer (recovery mode). Use '>' for normal processing, '0' to claim stuck messages after timeout!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Can I delete specific stream entries?</h4>
                <p><strong>Answer:</strong> YES with XDEL! But rarely needed - use XTRIM instead. XDEL removes specific IDs. XTRIM removes old entries (by count or timestamp). Streams designed as append-only logs!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Microservices Event Bus</strong></p>
            <p>Order service publishes events. Inventory, email, analytics services all need to process independently!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Stream with Multiple Consumer Groups</h4>
                <p><strong>Order service:</strong> XADD orders * event "created" order_id 123<br>
                <strong>Inventory group:</strong> Workers process, ACK, update stock<br>
                <strong>Email group:</strong> Workers send confirmation, ACK<br>
                <strong>Analytics group:</strong> Workers log metrics, ACK<br>
                <strong>Each group independent:</strong> Can process at own pace, retry on failure</p>
                <p><strong>Results:</strong> ‚úÖ Decoupled services ‚úÖ Guaranteed delivery ‚úÖ Independent scaling ‚úÖ Automatic retry ‚úÖ Event replay possible ‚úÖ Handles 50K orders/sec</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåä</span><p><strong>Append-only log</strong> - Ordered, persistent events</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üÜî</span><p><strong>Auto IDs</strong> - Timestamp-sequence format</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üë•</span><p><strong>Consumer groups</strong> - Distribute work, track ACKs</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>XACK tracking</strong> - Reliable processing</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Pending list</strong> - Automatic retry capability</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚úÇÔ∏è</span><p><strong>XTRIM</strong> - Manage memory with trimming</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Streams</span><span class="keyword-tag">XADD</span><span class="keyword-tag">XREADGROUP</span><span class="keyword-tag">Consumer Groups</span><span class="keyword-tag">Event Sourcing</span><span class="keyword-tag">XACK</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need event log with multiple services processing independently. Each service must process every event exactly once. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Pub/Sub (broadcast)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Streams with consumer groups</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Single List queue</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Separate List per service</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Streams with consumer groups</strong>
                    <p>Streams perfect! Create consumer group per service. Each group processes all events independently. XACK tracks processing. Pending list enables retry. Pub/Sub ephemeral (lost if consumer down). Single List = one consumer only. Separate Lists = manual management. Streams built for this pattern!</p>
                </div>
            </div>
        </div>
    `;
}

// ============================================================
// QUESTION 73: Redis Cluster Production Setup  
// ============================================================

function getQuestion73Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Scaling crisis:</strong> "Single Redis maxed out! 100GB data, 500K req/sec, need horizontal scaling!" Architect: "Redis Cluster! 16384 hash slots distributed across nodes. Automatic sharding. Result: 6 nodes handle 3M req/sec, 600GB data. Linear scaling!"</p>
            <p>Cluster = horizontal scaling.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Cluster: distributed setup with 16384 hash slots. Each master node owns subset of slots. CRC16(key) mod 16384 determines slot. Minimum 3 master nodes. Features: automatic sharding, master-replica failover, resharding. Multi-key commands require same slot (use hash tags: {user123}).</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Cluster Architecture</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Component</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Details</th></tr>
                    <tr><td style="padding: 8px;">Hash Slots</td><td>Sharding mechanism</td><td>16384 slots distributed across masters</td></tr>
                    <tr><td style="padding: 8px;">Master Nodes</td><td>Handle reads/writes</td><td>Each owns range of slots</td></tr>
                    <tr><td style="padding: 8px;">Replica Nodes</td><td>Failover + reads</td><td>Copy of master data</td></tr>
                    <tr><td style="padding: 8px;">Hash Tags</td><td>Multi-key ops</td><td>{user123}:profile, {user123}:prefs</td></tr>
                    <tr><td style="padding: 8px;">Resharding</td><td>Rebalance slots</td><td>Move slots between nodes</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Cluster Topology</div>
                <svg viewBox="0 0 900 350" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="18" font-weight="700">Redis Cluster - 3 Masters + 3 Replicas</text>
                    
                    <rect x="80" y="60" width="200" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="6"/>
                    <text x="180" y="85" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">Master 1 (port 7000)</text>
                    <text x="180" y="105" text-anchor="middle" fill="#888" font-size="10">Slots: 0-5460</text>
                    <text x="180" y="120" text-anchor="middle" fill="#888" font-size="9">~33% of data</text>
                    
                    <rect x="350" y="60" width="200" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="6"/>
                    <text x="450" y="85" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">Master 2 (port 7001)</text>
                    <text x="450" y="105" text-anchor="middle" fill="#888" font-size="10">Slots: 5461-10922</text>
                    <text x="450" y="120" text-anchor="middle" fill="#888" font-size="9">~33% of data</text>
                    
                    <rect x="620" y="60" width="200" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="6"/>
                    <text x="720" y="85" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">Master 3 (port 7002)</text>
                    <text x="720" y="105" text-anchor="middle" fill="#888" font-size="10">Slots: 10923-16383</text>
                    <text x="720" y="120" text-anchor="middle" fill="#888" font-size="9">~33% of data</text>
                    
                    <rect x="80" y="200" width="200" height="60" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="180" y="225" text-anchor="middle" fill="#9C27B0" font-size="12">Replica of M1 (7003)</text>
                    <text x="180" y="245" text-anchor="middle" fill="#888" font-size="9">Failover ready</text>
                    
                    <rect x="350" y="200" width="200" height="60" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="450" y="225" text-anchor="middle" fill="#9C27B0" font-size="12">Replica of M2 (7004)</text>
                    <text x="450" y="245" text-anchor="middle" fill="#888" font-size="9">Failover ready</text>
                    
                    <rect x="620" y="200" width="200" height="60" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="720" y="225" text-anchor="middle" fill="#9C27B0" font-size="12">Replica of M3 (7005)</text>
                    <text x="720" y="245" text-anchor="middle" fill="#888" font-size="9">Failover ready</text>
                    
                    <path d="M 180 140 L 180 200" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5"/>
                    <path d="M 450 140 L 450 200" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5"/>
                    <path d="M 720 140 L 720 200" stroke="#9C27B0" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <rect x="50" y="300" width="800" height="30" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="320" text-anchor="middle" fill="#00FF88" font-size="11">
                        CRC16(key) mod 16384 = slot ‚Üí routes to correct master automatically
                    </text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Hash Tags for Multi-Key Operations</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Cluster-Compatible Keys</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">from</span> rediscluster <span class="keyword">import</span> RedisCluster

<span class="comment"># Connect to cluster</span>
cluster = RedisCluster(startup_nodes=[
    {<span class="string">"host"</span>: <span class="string">"localhost"</span>, <span class="string">"port"</span>: <span class="number">7000</span>},
    {<span class="string">"host"</span>: <span class="string">"localhost"</span>, <span class="string">"port"</span>: <span class="number">7001</span>}
], decode_responses=<span class="keyword">True</span>)

<span class="comment"># ‚ùå Bad: Multi-key ops across different slots</span>
cluster.set(<span class="string">'user:123:profile'</span>, <span class="string">'data1'</span>)
cluster.set(<span class="string">'user:123:prefs'</span>, <span class="string">'data2'</span>)
<span class="comment"># MGET user:123:profile user:123:prefs ‚Üí ERROR! (different slots)</span>

<span class="comment"># ‚úÖ Good: Hash tags ensure same slot</span>
cluster.set(<span class="string">'{user:123}:profile'</span>, <span class="string">'data1'</span>)  <span class="comment"># Hashes "user:123"</span>
cluster.set(<span class="string">'{user:123}:prefs'</span>, <span class="string">'data2'</span>)    <span class="comment"># Hashes "user:123"</span>
values = cluster.mget(<span class="string">'{user:123}:profile'</span>, <span class="string">'{user:123}:prefs'</span>)  <span class="comment"># ‚úÖ Works!</span>

<span class="keyword">print</span>(values)  <span class="comment"># ['data1', 'data2']</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Check Cluster Status</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Bash - Cluster Management</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Check cluster health</span>
redis-cli -c -p <span class="number">7000</span> CLUSTER INFO

<span class="comment"># View node assignments</span>
redis-cli -c -p <span class="number">7000</span> CLUSTER NODES

<span class="comment"># Check which slot a key belongs to</span>
redis-cli -c -p <span class="number">7000</span> CLUSTER KEYSLOT <span class="string">"user:123"</span>

<span class="comment"># Reshard slots (move 1000 slots from node1 to node2)</span>
redis-cli --cluster reshard <span class="number">127.0.0.1</span>:<span class="number">7000</span> \
  --cluster-from <node_id_1> \
  --cluster-to <node_id_2> \
  --cluster-slots <span class="number">1000</span> \
  --cluster-yes</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Cluster-Aware Application</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Production Pattern</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">store_user_data</span>(user_id, profile_data, preferences):
    <span class="string">"""Store user data in cluster-compatible way"""</span>
    <span class="comment"># Use hash tag to keep all user data in same slot</span>
    base_key = <span class="string">f'{{user:{user_id}}}'</span>
    
    <span class="comment"># All these keys hash to same slot</span>
    cluster.hset(<span class="string">f'{base_key}:profile'</span>, mapping=profile_data)
    cluster.hset(<span class="string">f'{base_key}:prefs'</span>, mapping=preferences)
    cluster.sadd(<span class="string">f'{base_key}:friends'</span>, *friend_ids)
    
    <span class="comment"># Can use pipeline for same-slot keys</span>
    pipe = cluster.pipeline()
    pipe.hget(<span class="string">f'{base_key}:profile'</span>, <span class="string">'name'</span>)
    pipe.smembers(<span class="string">f'{base_key}:friends'</span>)
    results = pipe.execute()

<span class="keyword">def</span> <span class="function">handle_cluster_failover</span>():
    <span class="string">"""Handle cluster connection issues"""</span>
    <span class="keyword">try</span>:
        cluster.get(<span class="string">'key'</span>)
    <span class="keyword">except</span> ClusterDownError:
        <span class="keyword">print</span>(<span class="string">"Cluster unavailable - waiting for failover..."</span>)
        time.sleep(<span class="number">1</span>)
        <span class="comment"># Cluster client auto-reconnects after failover</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: How are keys distributed to slots?</h4>
                <p><strong>A:</strong> CRC16(key) mod 16384! Hash tag in braces changes hash: CRC16 of content inside {}. Example: {user:123}:profile hashes "user:123" only. Ensures related keys in same slot for multi-key ops!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Why 16384 slots not 16000 or 20000?</h4>
                <p><strong>A:</strong> Optimization! 16384 = 2^14. Fits bitmap of slots in 2KB. Gossip protocol efficiency. Small enough for fast rebalancing. Large enough for many nodes. Sweet spot for cluster management!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Minimum cluster size - why 3 masters?</h4>
                <p><strong>A:</strong> Quorum! Need majority for failover decisions. 2 nodes: Split-brain possible (50/50). 3 nodes: 2-node majority for election. Prevents conflicting failovers. Production: 3 masters minimum, each with 1+ replica!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can I use Lua scripts in Cluster?</h4>
                <p><strong>Answer:</strong> YES but all KEYS must be in same slot! Use hash tags: KEYS[1] = {user:123}:a, KEYS[2] = {user:123}:b. Script accesses only same-slot keys. Otherwise ‚Üí CROSSSLOT error!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: What happens during resharding?</h4>
                <p><strong>Answer:</strong> Online operation! Cluster stays available. Slots migrated one-by-one. Clients redirected via MOVED responses. Brief ASK redirects during migration. Zero downtime! Performance impact minimal!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Scale Social Network from 100K to 10M Users</strong></p>
            <p>Single Redis: 20GB data, 100K req/sec hitting limits. Need to 10x capacity!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: 6-Node Cluster Migration</h4>
                <p><strong>Setup:</strong> 3 masters (each 66GB capacity) + 3 replicas<br>
                <strong>Migration:</strong> Setup cluster ‚Üí Replicate from single Redis ‚Üí Reshard ‚Üí Cutover clients<br>
                <strong>Key design:</strong> Use {user_id} hash tags for related data<br>
                <strong>Capacity:</strong> 200GB total (20GB √ó 10) with headroom</p>
                <p><strong>Results:</strong> ‚úÖ 1M req/sec capacity ‚úÖ 200GB data ‚úÖ Automatic failover ‚úÖ Zero-downtime migration ‚úÖ Linear scaling path</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî¢</span><p><strong>16384 slots</strong> - Distributed across masters</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üè∑Ô∏è</span><p><strong>Hash tags {}</strong> - Same slot for multi-key ops</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Auto failover</strong> - Replica promotes to master</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìà</span><p><strong>Horizontal scaling</strong> - Add nodes, redistribute slots</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Minimum 3 masters</strong> - Quorum requirement</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>CRC16 hashing</strong> - Deterministic routing</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Cluster</span><span class="keyword-tag">Hash Slots</span><span class="keyword-tag">Sharding</span><span class="keyword-tag">CRC16</span><span class="keyword-tag">Hash Tags</span><span class="keyword-tag">Scaling</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need MGET on user:123:profile and user:123:prefs in Redis Cluster. How to ensure it works?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Use as-is (will work automatically)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Use {user:123}:profile and {user:123}:prefs</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Put both in same master manually</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Use separate GET commands</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Use hash tags {user:123}</strong>
                    <p>Hash tags essential! Cluster hashes content in {} only. {user:123}:profile and {user:123}:prefs both hash "user:123" ‚Üí same slot. Without tags: different slots ‚Üí CROSSSLOT error. Manual placement impossible (automatic hashing). Separate GETs work but inefficient. Hash tags = cluster-compatible multi-key ops!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 72: Redis Lua Scripting Advanced
// ============================================================

function getQuestion72Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Atomic operation problem:</strong> "Need to increment counter ONLY if current value < 100. Two commands = race condition! Server 1 checks (99), Server 2 checks (99), both increment = 101!" Engineer: "Use Lua script! Executes atomically. Check and increment in single operation. No race condition. Redis guarantees atomicity!"</p>
            <p>Lua scripting = custom atomic operations.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis Lua scripting: (1) Execute custom logic atomically, (2) Has access to all Redis commands via redis.call/pcall, (3) Can use conditionals, loops, variables, (4) EVAL executes script, SCRIPT LOAD caches, EVALSHA runs cached. More powerful than MULTI/EXEC (supports conditionals). Perfect for: complex atomicity, rate limiting, reservation systems.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Lua Commands</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Command</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">EVAL</td><td>Execute script</td><td>EVAL "return redis.call('GET', KEYS[1])" 1 mykey</td></tr>
                    <tr><td style="padding: 8px;">EVALSHA</td><td>Execute cached</td><td>EVALSHA sha1hash 1 mykey</td></tr>
                    <tr><td style="padding: 8px;">SCRIPT LOAD</td><td>Cache script</td><td>SCRIPT LOAD "return 'hello'"</td></tr>
                    <tr><td style="padding: 8px;">redis.call()</td><td>Execute command</td><td>redis.call('SET', 'key', 'value')</td></tr>
                    <tr><td style="padding: 8px;">redis.pcall()</td><td>Safe execute</td><td>redis.pcall('GET', 'key') -- no error</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Lua vs MULTI/EXEC:</strong></p>
                <ul>
                    <li><strong>Lua:</strong> Supports if/else, loops, variables, complex logic</li>
                    <li><strong>MULTI/EXEC:</strong> Queue commands only, no conditionals</li>
                    <li><strong>Lua atomicity:</strong> Entire script executes without interruption</li>
                    <li><strong>Use Lua when:</strong> Need conditional logic, complex operations</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Lua Script Execution</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Atomic Lua Script Execution</text>
                    
                    <!-- Client -->
                    <rect x="50" y="80" width="160" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="130" y="110" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">üì± Client</text>
                    <text x="130" y="130" text-anchor="middle" fill="#888" font-size="10">Sends Lua script</text>
                    <text x="130" y="145" text-anchor="middle" fill="#888" font-size="9">EVAL script 1 key</text>
                    
                    <path d="M 210 120 L 290 120" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    
                    <!-- Redis Server -->
                    <rect x="290" y="60" width="320" height="280" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="85" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">‚ö° Redis Server</text>
                    
                    <!-- Script Execution -->
                    <rect x="310" y="100" width="280" height="220" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="450" y="125" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">üîí Atomic Execution</text>
                    
                    <rect x="325" y="140" width="250" height="30" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="1" rx="4"/>
                    <text x="450" y="160" text-anchor="middle" fill="#888" font-size="10">1. Parse Lua script</text>
                    
                    <rect x="325" y="180" width="250" height="30" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="1" rx="4"/>
                    <text x="450" y="200" text-anchor="middle" fill="#888" font-size="10">2. Execute: local val = GET key</text>
                    
                    <rect x="325" y="220" width="250" height="30" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="1" rx="4"/>
                    <text x="450" y="240" text-anchor="middle" fill="#888" font-size="10">3. Check: if val < 100 then</text>
                    
                    <rect x="325" y="260" width="250" height="30" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="1" rx="4"/>
                    <text x="450" y="280" text-anchor="middle" fill="#888" font-size="10">4. Execute: INCR key</text>
                    
                    <rect x="325" y="300" width="250" height="30" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="450" y="320" text-anchor="middle" fill="#00FF88" font-size="10" font-weight="600">5. Return result</text>
                    
                    <text x="450" y="305" text-anchor="middle" fill="#DC143C" font-size="9">No other commands execute during script!</text>
                    
                    <!-- Result -->
                    <path d="M 610 180 L 690 140" stroke="#00FF88" stroke-width="3" marker-end="url(#arrowGreen)"/>
                    
                    <rect x="690" y="100" width="160" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="770" y="130" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">‚úÖ Result</text>
                    <text x="770" y="150" text-anchor="middle" fill="#888" font-size="11">New value: 100</text>
                    <text x="770" y="165" text-anchor="middle" fill="#888" font-size="9">Atomic guarantee!</text>
                    
                    <!-- Comparison -->
                    <rect x="50" y="240" width="220" height="100" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="160" y="260" text-anchor="middle" fill="#FF6347" font-size="12" font-weight="600">‚ùå Without Lua (Race Condition)</text>
                    <text x="60" y="280" fill="#888" font-size="9">1. GET key ‚Üí 99</text>
                    <text x="60" y="295" fill="#888" font-size="9">2. Check if < 100 ‚úì</text>
                    <text x="60" y="310" fill="#DC143C" font-size="9">‚ö†Ô∏è Another client increments here!</text>
                    <text x="60" y="325" fill="#888" font-size="9">3. INCR key ‚Üí 101 (Wrong!)</text>
                    
                    <defs>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Conditional Increment</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Lua Script with Conditional Logic</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis()

<span class="comment"># Lua script: Increment only if value < 100</span>
conditional_incr = <span class="string">"""
local current = redis.call('GET', KEYS[1])
if current and tonumber(current) >= tonumber(ARGV[1]) then
    return 0  -- Max reached
else
    return redis.call('INCR', KEYS[1])
end
"""</span>

<span class="keyword">def</span> <span class="function">increment_with_limit</span>(key, max_value=<span class="number">100</span>):
    <span class="string">"""Increment counter with maximum limit"""</span>
    result = r.eval(conditional_incr, <span class="number">1</span>, key, max_value)
    
    <span class="keyword">if</span> result == <span class="number">0</span>:
        <span class="keyword">print</span>(<span class="string">f"‚ùå Cannot increment - limit {max_value} reached"</span>)
        <span class="keyword">return</span> <span class="keyword">None</span>
    <span class="keyword">else</span>:
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Incremented to {result}"</span>)
        <span class="keyword">return</span> result

<span class="comment"># Usage</span>
r.set(<span class="string">'counter'</span>, <span class="number">98</span>)
increment_with_limit(<span class="string">'counter'</span>, max_value=<span class="number">100</span>)  <span class="comment"># ‚Üí 99</span>
increment_with_limit(<span class="string">'counter'</span>, max_value=<span class="number">100</span>)  <span class="comment"># ‚Üí 100</span>
increment_with_limit(<span class="string">'counter'</span>, max_value=<span class="number">100</span>)  <span class="comment"># ‚Üí 0 (limit reached)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Atomic Rate Limiter</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Advanced Rate Limiting</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Lua script: Sliding window rate limiter</span>
rate_limit_script = <span class="string">"""
local key = KEYS[1]
local limit = tonumber(ARGV[1])
local window = tonumber(ARGV[2])
local now = tonumber(ARGV[3])

-- Remove old entries outside window
redis.call('ZREMRANGEBYSCORE', key, 0, now - window)

-- Count current requests
local current = redis.call('ZCARD', key)

if current < limit then
    -- Allow request
    redis.call('ZADD', key, now, now)
    redis.call('EXPIRE', key, window)
    return {1, limit - current - 1}  -- [allowed, remaining]
else
    -- Deny request
    return {0, 0}
end
"""</span>

<span class="keyword">def</span> <span class="function">check_rate_limit</span>(user_id, max_requests=<span class="number">100</span>, window_seconds=<span class="number">60</span>):
    <span class="string">"""Check if user is rate limited"""</span>
    key = <span class="string">f'rate_limit:{user_id}'</span>
    now = <span class="function">int</span>(time.time() * <span class="number">1000</span>)  <span class="comment"># milliseconds</span>
    
    result = r.eval(rate_limit_script, <span class="number">1</span>, key, max_requests, window_seconds, now)
    allowed, remaining = result
    
    <span class="keyword">if</span> allowed:
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Request allowed - {remaining} remaining"</span>)
        <span class="keyword">return</span> <span class="keyword">True</span>
    <span class="keyword">else</span>:
        <span class="keyword">print</span>(<span class="string">f"‚ùå Rate limited - try again later"</span>)
        <span class="keyword">return</span> <span class="keyword">False</span>

<span class="comment"># Test rate limiting</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">105</span>):
    <span class="keyword">if</span> <span class="keyword">not</span> check_rate_limit(<span class="string">'user123'</span>, max_requests=<span class="number">100</span>):
        <span class="keyword">break</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Inventory Reservation</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Atomic Stock Check and Reserve</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Lua script: Reserve inventory atomically</span>
reserve_inventory = <span class="string">"""
local product_key = KEYS[1]
local reserved_key = KEYS[2]
local quantity = tonumber(ARGV[1])
local order_id = ARGV[2]

-- Get current stock
local current_stock = tonumber(redis.call('GET', product_key) or 0)

if current_stock >= quantity then
    -- Sufficient stock: reserve it
    redis.call('DECRBY', product_key, quantity)
    redis.call('HSET', reserved_key, order_id, quantity)
    return {1, current_stock - quantity}  -- [success, remaining]
else
    -- Insufficient stock
    return {0, current_stock}
end
"""</span>

<span class="keyword">def</span> <span class="function">reserve_product</span>(product_id, order_id, quantity):
    <span class="string">"""Reserve product inventory atomically"""</span>
    product_key = <span class="string">f'inventory:{product_id}'</span>
    reserved_key = <span class="string">f'reserved:{product_id}'</span>
    
    result = r.eval(
        reserve_inventory,
        <span class="number">2</span>,  <span class="comment"># 2 keys</span>
        product_key,
        reserved_key,
        quantity,
        order_id
    )
    
    success, remaining = result
    
    <span class="keyword">if</span> success:
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Reserved {quantity} units - {remaining} left"</span>)
        <span class="keyword">return</span> <span class="keyword">True</span>
    <span class="keyword">else</span>:
        <span class="keyword">print</span>(<span class="string">f"‚ùå Insufficient stock - only {remaining} available"</span>)
        <span class="keyword">return</span> <span class="keyword">False</span>

<span class="comment"># Setup and test</span>
r.set(<span class="string">'inventory:product_123'</span>, <span class="number">10</span>)

reserve_product(<span class="string">'product_123'</span>, <span class="string">'order_1'</span>, <span class="number">3</span>)  <span class="comment"># ‚úÖ Reserved, 7 left</span>
reserve_product(<span class="string">'product_123'</span>, <span class="string">'order_2'</span>, <span class="number">5</span>)  <span class="comment"># ‚úÖ Reserved, 2 left</span>
reserve_product(<span class="string">'product_123'</span>, <span class="string">'order_3'</span>, <span class="number">5</span>)  <span class="comment"># ‚ùå Only 2 available</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: redis.call() vs redis.pcall() - difference?</h4>
                <p><strong>A:</strong> Error handling! redis.call() raises error on failure (script stops). redis.pcall() returns error (script continues). Use call() when error should abort, pcall() when you want to handle errors in script!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Why EVALSHA instead of EVAL?</h4>
                <p><strong>A:</strong> Performance! SCRIPT LOAD caches script, returns SHA1 hash. EVALSHA runs cached version (no re-parsing). For frequently used scripts: Load once, EVALSHA many times. Saves bandwidth + parsing time!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can Lua scripts call other Lua scripts?</h4>
                <p><strong>A:</strong> NO! Lua can only call Redis commands (redis.call/pcall). Cannot execute other EVAL/EVALSHA. Design scripts to be self-contained. For complex logic: Put everything in one script!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: KEYS vs ARGV - what's the difference?</h4>
                <p><strong>Answer:</strong> Redis Cluster requirement! KEYS[1], KEYS[2] = keys accessed (must be in same hash slot for Cluster). ARGV[1], ARGV[2] = parameters. Cluster hashes KEYS to route script. Always use KEYS for key names!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can Lua scripts run forever?</h4>
                <p><strong>Answer:</strong> NO! lua-time-limit (default 5 seconds) kills long scripts. Redis blocks during Lua execution. Long script = Redis unresponsive! Keep scripts fast (<1ms typical). For heavy work: Use background jobs!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Flash Sale Inventory Management</strong></p>
            <p>1000 items, 10K users trying to buy simultaneously. Need atomic check-and-reserve!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Lua Script Prevents Overselling</h4>
                <p><strong>Script logic:</strong> Get stock ‚Üí Check quantity available ‚Üí Decrement stock ‚Üí Record reservation ‚Üí Return success/failure<br>
                <strong>Atomicity guarantee:</strong> No two users can reserve same last item<br>
                <strong>Race condition eliminated:</strong> Check and reserve in single operation</p>
                <p><strong>Results:</strong> ‚úÖ Zero overselling ‚úÖ Exactly 1000 reservations ‚úÖ 9000 users see "sold out" ‚úÖ Fair first-come-first-serve ‚úÖ Handles 10K concurrent requests</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>Atomic execution</strong> - Entire script runs without interruption</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Conditional logic</strong> - if/else, loops, variables</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìû</span><p><strong>redis.call/pcall</strong> - Execute Redis commands</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>EVALSHA</strong> - Cache scripts for performance</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîë</span><p><strong>KEYS vs ARGV</strong> - Keys for routing, ARGV for params</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>Keep fast</strong> - Scripts block Redis (<1ms ideal)</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Lua</span><span class="keyword-tag">EVAL</span><span class="keyword-tag">Scripting</span><span class="keyword-tag">Atomic</span><span class="keyword-tag">EVALSHA</span><span class="keyword-tag">redis.call</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need to increment counter ONLY if current value < 100. Prevent race conditions. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) GET + check + INCR (3 commands)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Lua script with conditional logic</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) MULTI/EXEC transaction</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Use WATCH for optimistic locking</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Lua script with conditional logic</strong>
                    <p>Lua perfect! Execute GET + check + INCR atomically in single script. No race condition possible. MULTI/EXEC can't do conditionals (queues commands only). GET+check+INCR = race condition (between check and INCR). WATCH optimistic but complex. Lua = atomic + conditional = ideal!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 74: Redis Security Hardening
// ============================================================

function getQuestion74Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Security disaster:</strong> "Redis exposed to internet with no password! Hacker connected, ran FLUSHALL, deleted everything! Lost 6 months of data!" Engineer: "Implement security layers: ACL for user permissions, requirepass authentication, bind to localhost, TLS encryption, rename dangerous commands. Never expose Redis publicly!"</p>
            <p>Security = multiple defense layers.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis security hardening: (1) Network: bind to private IPs, use firewall, (2) Authentication: ACL with user permissions or requirepass, (3) Encryption: TLS for data in transit, (4) Command restrictions: rename/disable dangerous commands (FLUSHALL, KEYS, CONFIG), (5) Protected mode by default. Defense in depth approach!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Security Layers</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Layer</th><th style="padding: 10px;">Method</th><th style="padding: 10px;">Protection</th></tr>
                    <tr><td style="padding: 8px;">Network</td><td>bind 127.0.0.1, VPC</td><td>Prevent external access</td></tr>
                    <tr><td style="padding: 8px;">Authentication</td><td>ACL users, requirepass</td><td>Verify identity</td></tr>
                    <tr><td style="padding: 8px;">Authorization</td><td>ACL permissions</td><td>Limit commands per user</td></tr>
                    <tr><td style="padding: 8px;">Encryption</td><td>TLS/SSL</td><td>Protect data in transit</td></tr>
                    <tr><td style="padding: 8px;">Command Control</td><td>rename-command</td><td>Disable dangerous ops</td></tr>
                    <tr><td style="padding: 8px;">Monitoring</td><td>Audit logs</td><td>Detect intrusions</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Security Best Practices:</strong></p>
                <ul>
                    <li><strong>Never expose Redis to internet</strong> - Use private networks only</li>
                    <li><strong>Always use authentication</strong> - ACL or requirepass minimum</li>
                    <li><strong>TLS in production</strong> - Encrypt client-server communication</li>
                    <li><strong>Disable dangerous commands</strong> - FLUSHALL, KEYS, CONFIG</li>
                    <li><strong>Regular updates</strong> - Patch security vulnerabilities</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Defense in Depth Architecture</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Security Layers</text>
                    
                    <!-- Internet -->
                    <rect x="50" y="60" width="150" height="60" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="125" y="85" text-anchor="middle" fill="#FF6347" font-size="13" font-weight="600">üåê Internet</text>
                    <text x="125" y="105" text-anchor="middle" fill="#888" font-size="10">Untrusted</text>
                    
                    <!-- Firewall -->
                    <rect x="250" y="50" width="120" height="80" fill="rgba(220,20,60,0.15)" stroke="#DC143C" stroke-width="3" rx="6"/>
                    <text x="310" y="75" text-anchor="middle" fill="#DC143C" font-size="12" font-weight="600">üî• Firewall</text>
                    <text x="310" y="95" text-anchor="middle" fill="#888" font-size="9">Block port 6379</text>
                    <text x="310" y="110" text-anchor="middle" fill="#888" font-size="9">VPC only</text>
                    
                    <path d="M 200 90 L 250 90" stroke="#FF6347" stroke-width="3"/>
                    <text x="225" y="80" text-anchor="middle" fill="#FF6347" font-size="11">‚ùå BLOCKED</text>
                    
                    <!-- VPC Network -->
                    <rect x="420" y="40" width="430" height="340" fill="rgba(0,191,255,0.05)" stroke="#00BFFF" stroke-width="3" rx="8"/>
                    <text x="635" y="65" text-anchor="middle" fill="#00BFFF" font-size="13" font-weight="600">üîí Private Network (VPC)</text>
                    
                    <!-- Application Server -->
                    <rect x="440" y="90" width="160" height="70" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="520" y="115" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">üíª App Server</text>
                    <text x="520" y="135" text-anchor="middle" fill="#888" font-size="9">Authenticated client</text>
                    <text x="520" y="150" text-anchor="middle" fill="#888" font-size="9">TLS enabled</text>
                    
                    <path d="M 370 90 L 440 125" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    <text x="400" y="100" fill="#00FF88" font-size="9">‚úÖ Allowed</text>
                    
                    <!-- TLS Layer -->
                    <rect x="640" y="90" width="180" height="70" fill="rgba(255,215,0,0.2)" stroke="#FFD700" stroke-width="2" rx="6"/>
                    <text x="730" y="115" text-anchor="middle" fill="#FFD700" font-size="12" font-weight="600">üîê TLS Encryption</text>
                    <text x="730" y="135" text-anchor="middle" fill="#888" font-size="9">Data encrypted</text>
                    <text x="730" y="150" text-anchor="middle" fill="#888" font-size="9">in transit</text>
                    
                    <path d="M 600 125 L 640 125" stroke="#FFD700" stroke-width="2" marker-end="url(#arrowGold)"/>
                    
                    <!-- Redis Server -->
                    <rect x="480" y="200" width="300" height="160" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="630" y="225" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">‚ö° Redis Server</text>
                    
                    <rect x="500" y="240" width="260" height="25" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="630" y="257" text-anchor="middle" fill="#888" font-size="9">1Ô∏è‚É£ ACL: User permissions checked</text>
                    
                    <rect x="500" y="275" width="260" height="25" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="630" y="292" text-anchor="middle" fill="#888" font-size="9">2Ô∏è‚É£ Command validation (no FLUSHALL)</text>
                    
                    <rect x="500" y="310" width="260" height="25" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="1" rx="4"/>
                    <text x="630" y="327" text-anchor="middle" fill="#888" font-size="9">3Ô∏è‚É£ bind 127.0.0.1 (localhost only)</text>
                    
                    <rect x="500" y="345" width="260" height="25" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="630" y="362" text-anchor="middle" fill="#00FF88" font-size="9" font-weight="600">‚úÖ Request executed safely</text>
                    
                    <path d="M 730 160 L 730 200" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    
                    <rect x="50" y="390" width="800" height="20" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="450" y="405" text-anchor="middle" fill="#DC143C" font-size="10">
                        üõ°Ô∏è Multiple layers: Network isolation + Authentication + Encryption + Command restrictions
                    </text>
                    
                    <defs>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowGold" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#FFD700" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#9C27B0" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: ACL Configuration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis - Access Control Lists</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Create read-only user</span>
ACL SETUSER readonly <span class="keyword">on</span> >password123 ~cached:* +<span class="keyword">get</span> +mget +exists

<span class="comment"># Create write user for specific keys</span>
ACL SETUSER writer <span class="keyword">on</span> >writepass ~session:* +<span class="keyword">get</span> +<span class="keyword">set</span> +<span class="keyword">del</span> +expire

<span class="comment"># Create admin user (all commands except dangerous ones)</span>
ACL SETUSER admin <span class="keyword">on</span> >adminpass ~* +@all -flushdb -flushall -keys -config

<span class="comment"># Disable default user (IMPORTANT!)</span>
ACL SETUSER <span class="keyword">default</span> <span class="keyword">off</span>

<span class="comment"># List all users</span>
ACL LIST

<span class="comment"># View user permissions</span>
ACL GETUSER admin

<span class="comment"># Save ACL to file</span>
ACL SAVE</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: redis.conf Security Settings</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Config - Production Security Configuration</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Network Security</span>
bind <span class="number">127.0.0.1</span> <span class="number">10.0.1.5</span>  <span class="comment"># Private IPs only, never 0.0.0.0!</span>
protected-mode yes           <span class="comment"># Reject external connections without auth</span>
port <span class="number">6379</span>                    <span class="comment"># Or use non-standard port</span>

<span class="comment"># Authentication</span>
requirepass <span class="string">YourStrongPasswordHere123!</span>  <span class="comment"># Fallback auth</span>
aclfile /etc/redis/users.acl              <span class="comment"># ACL configuration</span>

<span class="comment"># TLS/SSL Encryption</span>
tls-port <span class="number">6380</span>
tls-cert-file /path/to/redis.crt
tls-key-file /path/to/redis.key
tls-ca-cert-file /path/to/ca.crt
tls-auth-clients yes  <span class="comment"># Require client certificates</span>

<span class="comment"># Disable/Rename Dangerous Commands</span>
rename-command FLUSHDB <span class="string">""</span>           <span class="comment"># Disable completely</span>
rename-command FLUSHALL <span class="string">""</span>
rename-command KEYS <span class="string">""</span>
rename-command CONFIG <span class="string">"CONFIG_ABC123"</span>  <span class="comment"># Rename with secret</span>

<span class="comment"># Logging & Monitoring</span>
logfile /var/log/redis/redis.log
loglevel notice
slowlog-log-slower-than <span class="number">10000</span>  <span class="comment"># Log queries >10ms</span>

<span class="comment"># Resource Limits</span>
maxclients <span class="number">10000</span>
timeout <span class="number">300</span>       <span class="comment"># Close idle connections after 5 min</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Python Client with TLS</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Secure Connection</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> ssl

<span class="comment"># Connect with TLS and authentication</span>
r = redis.Redis(
    host=<span class="string">'redis.internal.company.com'</span>,
    port=<span class="number">6380</span>,
    username=<span class="string">'myapp'</span>,
    password=<span class="string">'securepassword123'</span>,
    ssl=<span class="keyword">True</span>,
    ssl_cert_reqs=ssl.CERT_REQUIRED,
    ssl_ca_certs=<span class="string">'/path/to/ca.crt'</span>,
    ssl_certfile=<span class="string">'/path/to/client.crt'</span>,
    ssl_keyfile=<span class="string">'/path/to/client.key'</span>,
    decode_responses=<span class="keyword">True</span>
)

<span class="comment"># Test connection</span>
<span class="keyword">try</span>:
    r.ping()
    <span class="keyword">print</span>(<span class="string">"‚úÖ Secure connection established"</span>)
    
    <span class="comment"># Use as normal</span>
    r.set(<span class="string">'secure:key'</span>, <span class="string">'encrypted value'</span>)
    
<span class="keyword">except</span> redis.AuthenticationError:
    <span class="keyword">print</span>(<span class="string">"‚ùå Authentication failed"</span>)
<span class="keyword">except</span> redis.ConnectionError:
    <span class="keyword">print</span>(<span class="string">"‚ùå Connection failed - check TLS config"</span>)

<span class="comment"># Security audit function</span>
<span class="keyword">def</span> <span class="function">security_audit</span>():
    <span class="string">"""Check Redis security configuration"""</span>
    info = r.info(<span class="string">'server'</span>)
    
    checks = {
        <span class="string">'TLS enabled'</span>: info.get(<span class="string">'ssl_enabled'</span>) == <span class="number">1</span>,
        <span class="string">'Protected mode'</span>: info.get(<span class="string">'protected_mode'</span>) == <span class="number">1</span>,
        <span class="string">'ACL enabled'</span>: <span class="function">len</span>(r.acl_list()) > <span class="number">1</span>
    }
    
    <span class="keyword">for</span> check, passed <span class="keyword">in</span> checks.items():
        status = <span class="string">"‚úÖ"</span> <span class="keyword">if</span> passed <span class="keyword">else</span> <span class="string">"‚ùå"</span>
        <span class="keyword">print</span>(<span class="string">f"{status} {check}"</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: ACL vs requirepass - which is better?</h4>
                <p><strong>A:</strong> ACL more powerful! Granular permissions per user (read-only, specific keys, command restrictions). requirepass = single password, all-or-nothing. Modern Redis (6.0+): Use ACL. Legacy: requirepass acceptable but limited!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Why disable default user?</h4>
                <p><strong>A:</strong> Security risk! Default user active without password if ACL enabled but default not disabled. Attacker connects as default user, full access! Always: ACL SETUSER default off. Force explicit authentication!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: TLS performance impact?</h4>
                <p><strong>A:</strong> ~5-10% latency increase. Encryption overhead. But: Security worth it for production! Optimize: Use TLS 1.3 (faster), hardware acceleration, connection pooling. Never skip TLS for performance!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: rename-command CONFIG "" vs CONFIG_SECRET?</h4>
                <p><strong>Answer:</strong> "" = completely disable (safer). "CONFIG_SECRET" = rename but admins can still use it with secret name. Use "" for FLUSHALL/FLUSHDB (never needed). Use rename for CONFIG (needed for admin tasks with secret)!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: bind 0.0.0.0 with requirepass - is it safe?</h4>
                <p><strong>Answer:</strong> NO! Exposed to internet = brute force attacks! requirepass helps but not enough. Attackers can: (1) Exploit vulnerabilities, (2) DDoS, (3) Brute force password. Always: bind to private IPs + firewall + auth!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Security Audit After Breach</strong></p>
            <p>Company Redis exposed, attacker ran FLUSHALL, lost everything. Post-mortem audit!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Comprehensive Security Hardening</h4>
                <p><strong>Network:</strong> Move to VPC, bind 10.0.1.5 only, firewall rules<br>
                <strong>Authentication:</strong> ACL with 3 users (readonly, writer, admin), disable default<br>
                <strong>Encryption:</strong> TLS with client certificates required<br>
                <strong>Commands:</strong> Disable FLUSHALL, FLUSHDB, KEYS, rename CONFIG<br>
                <strong>Monitoring:</strong> Alert on auth failures, unusual commands, traffic patterns</p>
                <p><strong>Results:</strong> ‚úÖ Zero breaches in 2 years ‚úÖ Failed attack attempts logged ‚úÖ Compliance certified ‚úÖ Peace of mind ‚úÖ Defense in depth works!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>Never expose to internet</strong> - Private networks only</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üë•</span><p><strong>ACL per user</strong> - Granular permissions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîê</span><p><strong>TLS encryption</strong> - Protect data in transit</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üö´</span><p><strong>Disable dangerous commands</strong> - FLUSHALL, KEYS</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor auth failures</strong> - Detect attacks</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üõ°Ô∏è</span><p><strong>Defense in depth</strong> - Multiple layers</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Security</span><span class="keyword-tag">ACL</span><span class="keyword-tag">TLS</span><span class="keyword-tag">Authentication</span><span class="keyword-tag">Encryption</span><span class="keyword-tag">Hardening</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Setting up production Redis. What's the MINIMUM security configuration?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Just requirepass</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">B) Only bind to localhost</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">C) Private network + ACL + TLS + disabled dangerous commands</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Default settings with firewall</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: C - Multiple security layers</strong>
                    <p>Production needs defense in depth! Private network prevents exposure. ACL controls who can do what. TLS encrypts data. Disabled dangerous commands prevent accidents. Just requirepass = weak (no encryption, simple password). Just localhost = can't connect from other servers. Firewall alone = not enough if Redis misconfigured. Layered security = production standard!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 75: Redis Monitoring & Observability
// ============================================================

function getQuestion75Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Mystery slowdown:</strong> "Redis suddenly slow! API response time 200ms ‚Üí 2 seconds! But can't find problem!" Engineer: "Check SLOWLOG - found SELECT command taking 500ms! CLIENT LIST shows 500 idle connections. INFO stats shows evicted_keys spiking. Memory at 99%! Solution: Increase memory, close idle connections, add alerts. Monitoring prevents disasters!"</p>
            <p>Monitoring = early problem detection.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis monitoring essentials: (1) INFO command (memory, stats, replication), (2) SLOWLOG for slow queries, (3) CLIENT LIST for connections, (4) KEY metrics: memory usage, hit rate, evictions, latency, (5) Tools: Prometheus+Grafana, Redis Insights. Alert on: memory >80%, hit rate <85%, evictions >0, latency >10ms.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Critical Metrics to Monitor</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Metric</th><th style="padding: 10px;">Command</th><th style="padding: 10px;">Alert Threshold</th></tr>
                    <tr><td style="padding: 8px;">Memory Usage</td><td>INFO memory</td><td>>80% of maxmemory</td></tr>
                    <tr><td style="padding: 8px;">Cache Hit Rate</td><td>INFO stats</td><td><85% (calculate from hits/misses)</td></tr>
                    <tr><td style="padding: 8px;">Evicted Keys</td><td>INFO stats</td><td>>0 sustained</td></tr>
                    <tr><td style="padding: 8px;">Expired Keys</td><td>INFO stats</td><td>Sudden spikes</td></tr>
                    <tr><td style="padding: 8px;">Connected Clients</td><td>INFO clients</td><td>>maxclients-100</td></tr>
                    <tr><td style="padding: 8px;">Slow Queries</td><td>SLOWLOG GET</td><td>>10ms queries</td></tr>
                    <tr><td style="padding: 8px;">Replication Lag</td><td>INFO replication</td><td>>1 second</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Monitoring Stack</div>
                <svg viewBox="0 0 900 380" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Monitoring Architecture</text>
                    
                    <!-- Redis Server -->
                    <rect x="50" y="70" width="180" height="120" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="140" y="95" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">‚ö° Redis Server</text>
                    <text x="60" y="120" fill="#888" font-size="10">Memory: 7.2GB / 8GB</text>
                    <text x="60" y="135" fill="#888" font-size="10">Hit rate: 92%</text>
                    <text x="60" y="150" fill="#888" font-size="10">Clients: 245</text>
                    <text x="60" y="165" fill="#888" font-size="10">Ops/sec: 45K</text>
                    <text x="60" y="180" fill="#888" font-size="10">Evictions: 0</text>
                    
                    <!-- Metrics Export -->
                    <rect x="280" y="70" width="180" height="120" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="370" y="95" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">üìä Redis Exporter</text>
                    <text x="290" y="120" fill="#888" font-size="10">Collects metrics via:</text>
                    <text x="300" y="138" fill="#888" font-size="9">‚Ä¢ INFO commands</text>
                    <text x="300" y="153" fill="#888" font-size="9">‚Ä¢ SLOWLOG</text>
                    <text x="300" y="168" fill="#888" font-size="9">‚Ä¢ CLIENT LIST</text>
                    <text x="290" y="183" fill="#888" font-size="10">Exports to Prometheus</text>
                    
                    <path d="M 230 130 L 280 130" stroke="#FFA500" stroke-width="2" marker-end="url(#arrowOrange)"/>
                    
                    <!-- Prometheus -->
                    <rect x="510" y="70" width="160" height="120" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="590" y="95" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">üìà Prometheus</text>
                    <text x="520" y="120" fill="#888" font-size="10">Time-series DB</text>
                    <text x="520" y="138" fill="#888" font-size="9">Scrapes every 15s</text>
                    <text x="520" y="153" fill="#888" font-size="9">Stores metrics</text>
                    <text x="520" y="168" fill="#888" font-size="9">Triggers alerts</text>
                    
                    <path d="M 460 130 L 510 130" stroke="#DC143C" stroke-width="2" marker-end="url(#arrowRed)"/>
                    
                    <!-- Grafana -->
                    <rect x="720" y="70" width="130" height="120" fill="rgba(0,191,255,0.2)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="785" y="95" text-anchor="middle" fill="#00BFFF" font-size="13" font-weight="600">üìâ Grafana</text>
                    <text x="730" y="115" fill="#888" font-size="9">Dashboard</text>
                    <text x="730" y="130" fill="#888" font-size="9">Visualization</text>
                    <text x="730" y="145" fill="#888" font-size="9">Real-time</text>
                    <text x="730" y="160" fill="#888" font-size="9">monitoring</text>
                    
                    <path d="M 670 130 L 720 130" stroke="#00BFFF" stroke-width="2" marker-end="url(#arrowBlue)"/>
                    
                    <!-- Alerting -->
                    <rect x="280" y="230" width="390" height="100" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="475" y="255" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">üö® Alert Manager</text>
                    
                    <rect x="300" y="270" width="160" height="45" fill="rgba(0,0,0,0.1)" stroke="#666" stroke-width="1" rx="4"/>
                    <text x="380" y="288" text-anchor="middle" fill="#DC143C" font-size="10" font-weight="600">‚ö†Ô∏è Memory > 80%</text>
                    <text x="380" y="303" text-anchor="middle" fill="#888" font-size="9">‚Üí Slack/PagerDuty</text>
                    
                    <rect x="490" y="270" width="160" height="45" fill="rgba(0,0,0,0.1)" stroke="#666" stroke-width="1" rx="4"/>
                    <text x="570" y="288" text-anchor="middle" fill="#DC143C" font-size="10" font-weight="600">‚ö†Ô∏è Hit rate < 85%</text>
                    <text x="570" y="303" text-anchor="middle" fill="#888" font-size="9">‚Üí Email team</text>
                    
                    <path d="M 590 190 L 475 230" stroke="#FF6347" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <rect x="50" y="350" width="800" height="20" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="450" y="365" text-anchor="middle" fill="#00FF88" font-size="10">
                        ‚úÖ Continuous monitoring ‚Üí Early detection ‚Üí Proactive fixes ‚Üí High availability
                    </text>
                    
                    <defs>
                        <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#FFA500" />
                        </marker>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                        <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00BFFF" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Monitoring Script</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Health Check & Metrics</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis()

<span class="keyword">def</span> <span class="function">get_critical_metrics</span>():
    <span class="string">"""Collect key Redis metrics"""</span>
    info = r.info()
    
    <span class="comment"># Memory metrics</span>
    used_memory = info[<span class="string">'used_memory'</span>]
    max_memory = info.get(<span class="string">'maxmemory'</span>, <span class="number">0</span>)
    memory_pct = (used_memory / max_memory * <span class="number">100</span>) <span class="keyword">if</span> max_memory <span class="keyword">else</span> <span class="number">0</span>
    
    <span class="comment"># Cache hit rate</span>
    hits = info[<span class="string">'keyspace_hits'</span>]
    misses = info[<span class="string">'keyspace_misses'</span>]
    hit_rate = (hits / (hits + misses) * <span class="number">100</span>) <span class="keyword">if</span> (hits + misses) > <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>
    
    metrics = {
        <span class="string">'memory_used_mb'</span>: used_memory / <span class="number">1024</span> / <span class="number">1024</span>,
        <span class="string">'memory_percent'</span>: memory_pct,
        <span class="string">'hit_rate'</span>: hit_rate,
        <span class="string">'evicted_keys'</span>: info[<span class="string">'evicted_keys'</span>],
        <span class="string">'expired_keys'</span>: info[<span class="string">'expired_keys'</span>],
        <span class="string">'connected_clients'</span>: info[<span class="string">'connected_clients'</span>],
        <span class="string">'ops_per_sec'</span>: info[<span class="string">'instantaneous_ops_per_sec'</span>],
        <span class="string">'blocked_clients'</span>: info[<span class="string">'blocked_clients'</span>]
    }
    
    <span class="keyword">return</span> metrics

<span class="keyword">def</span> <span class="function">check_health</span>():
    <span class="string">"""Health check with alerts"""</span>
    metrics = get_critical_metrics()
    alerts = []
    
    <span class="comment"># Memory alert</span>
    <span class="keyword">if</span> metrics[<span class="string">'memory_percent'</span>] > <span class="number">80</span>:
        alerts.append(<span class="string">f"‚ö†Ô∏è MEMORY HIGH: {metrics['memory_percent']:.1f}%"</span>)
    
    <span class="comment"># Hit rate alert</span>
    <span class="keyword">if</span> metrics[<span class="string">'hit_rate'</span>] < <span class="number">85</span>:
        alerts.append(<span class="string">f"‚ö†Ô∏è HIT RATE LOW: {metrics['hit_rate']:.1f}%"</span>)
    
    <span class="comment"># Evictions alert</span>
    <span class="keyword">if</span> metrics[<span class="string">'evicted_keys'</span>] > <span class="number">0</span>:
        alerts.append(<span class="string">f"‚ö†Ô∏è EVICTIONS: {metrics['evicted_keys']}"</span>)
    
    <span class="keyword">if</span> alerts:
        <span class="keyword">for</span> alert <span class="keyword">in</span> alerts:
            <span class="keyword">print</span>(alert)
            <span class="comment"># send_to_slack(alert)  # Your alerting</span>
    <span class="keyword">else</span>:
        <span class="keyword">print</span>(<span class="string">"‚úÖ All metrics healthy"</span>)
    
    <span class="keyword">return</span> metrics, alerts

<span class="comment"># Run health check</span>
metrics, alerts = check_health()
<span class="keyword">print</span>(<span class="string">f"\nüìä Metrics: {metrics}"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: SLOWLOG Analysis</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Find Slow Queries</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">analyze_slow_queries</span>(count=<span class="number">10</span>):
    <span class="string">"""Analyze slowlog for performance issues"""</span>
    slowlog = r.slowlog_get(count)
    
    <span class="keyword">if</span> <span class="keyword">not</span> slowlog:
        <span class="keyword">print</span>(<span class="string">"‚úÖ No slow queries"</span>)
        <span class="keyword">return</span>
    
    <span class="keyword">print</span>(<span class="string">f"\nüêå Found {len(slowlog)} slow queries:"</span>)
    
    <span class="keyword">for</span> entry <span class="keyword">in</span> slowlog:
        duration_ms = entry[<span class="string">'duration'</span>] / <span class="number">1000</span>  <span class="comment"># Convert to ms</span>
        command = <span class="string">' '</span>.join(entry[<span class="string">'command'</span>])
        
        <span class="keyword">print</span>(<span class="string">f"\n  Duration: {duration_ms:.2f}ms"</span>)
        <span class="keyword">print</span>(<span class="string">f"  Command: {command[:100]}"</span>)  <span class="comment"># Truncate long commands</span>
        <span class="keyword">print</span>(<span class="string">f"  Time: {time.ctime(entry['start_time'])}"</span>)

<span class="comment"># Configure slowlog</span>
r.config_set(<span class="string">'slowlog-log-slower-than'</span>, <span class="number">10000</span>)  <span class="comment"># 10ms threshold</span>
r.config_set(<span class="string">'slowlog-max-len'</span>, <span class="number">128</span>)  <span class="comment"># Keep 128 entries</span>

analyze_slow_queries()</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Client Connection Monitoring</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Track Connections</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">monitor_clients</span>():
    <span class="string">"""Monitor client connections"""</span>
    clients = r.client_list()
    
    <span class="comment"># Analyze by client type</span>
    connections = {
        <span class="string">'total'</span>: <span class="function">len</span>(clients),
        <span class="string">'idle'</span>: <span class="number">0</span>,
        <span class="string">'active'</span>: <span class="number">0</span>,
        <span class="string">'blocked'</span>: <span class="number">0</span>
    }
    
    long_idle = []
    
    <span class="keyword">for</span> client <span class="keyword">in</span> clients:
        idle_seconds = client[<span class="string">'idle'</span>]
        
        <span class="keyword">if</span> idle_seconds > <span class="number">300</span>:  <span class="comment"># 5 minutes</span>
            long_idle.append(client)
            connections[<span class="string">'idle'</span>] += <span class="number">1</span>
        <span class="keyword">elif</span> client.get(<span class="string">'flags'</span>, <span class="string">''</span>) == <span class="string">'b'</span>:
            connections[<span class="string">'blocked'</span>] += <span class="number">1</span>
        <span class="keyword">else</span>:
            connections[<span class="string">'active'</span>] += <span class="number">1</span>
    
    <span class="keyword">print</span>(<span class="string">f"\nüì± Client Connections:"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Total: {connections['total']}"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Active: {connections['active']}"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Idle >5min: {connections['idle']}"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Blocked: {connections['blocked']}"</span>)
    
    <span class="comment"># Kill long idle connections (optional)</span>
    <span class="keyword">if</span> <span class="function">len</span>(long_idle) > <span class="number">50</span>:
        <span class="keyword">print</span>(<span class="string">f"\n‚ö†Ô∏è Killing {len(long_idle)} idle connections"</span>)
        <span class="keyword">for</span> client <span class="keyword">in</span> long_idle:
            r.client_kill_filter(_id=client[<span class="string">'id'</span>])

monitor_clients()</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Evicted keys vs Expired keys - difference?</h4>
                <p><strong>A:</strong> Evicted = removed due to memory pressure (maxmemory-policy). Expired = removed due to TTL. Evictions bad (need more memory). Expiration normal (designed behavior). Monitor: evicted_keys should stay 0!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Good cache hit rate threshold?</h4>
                <p><strong>A:</strong> 85%+ is good! 90%+ excellent! <80% investigate (small TTL? Unpredictable access? Insufficient memory?). Calculate: hits / (hits + misses). Monitor trends not just absolute values!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What's blocking_clients metric?</h4>
                <p><strong>A:</strong> Clients waiting on BLPOP/BRPOP/BRPOPLPUSH. High number normal if using Redis queues. Sudden spike = investigate (backed up queues? Slow workers?). Monitor along with list lengths!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: instantaneous_ops_per_sec vs total_commands_processed?</h4>
                <p><strong>Answer:</strong> instantaneous = current rate (per second now). total_commands = cumulative since start. For monitoring: Use instantaneous! Alerts on ops/sec drops or spikes. Total useful for lifetime stats only!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: used_memory vs used_memory_rss - which to monitor?</h4>
                <p><strong>Answer:</strong> Both! used_memory = Redis allocation. used_memory_rss = actual OS memory. Big gap = fragmentation! Monitor ratio: rss/used > 1.5 = fragmentation issue. Restart Redis to defragment!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Debugging Performance Degradation</strong></p>
            <p>API suddenly slow (50ms ‚Üí 500ms). Redis seems fine but something's wrong!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Investigation Using Monitoring</h4>
                <p><strong>SLOWLOG:</strong> Found KEYS * command taking 400ms<br>
                <strong>CLIENT LIST:</strong> One client running KEYS repeatedly<br>
                <strong>INFO stats:</strong> evicted_keys jumping from 0 to 1000/sec<br>
                <strong>Memory:</strong> 99% of maxmemory<br>
                <strong>Root cause:</strong> New deployment running KEYS *, causing blocking + memory pressure</p>
                <p><strong>Fix:</strong> ‚úÖ Kill misbehaving client ‚úÖ Disable KEYS command ‚úÖ Increase memory ‚úÖ Add monitoring alerts ‚úÖ Back to 50ms latency!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>INFO command</strong> - All metrics in one place</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üêå</span><p><strong>SLOWLOG</strong> - Find performance bottlenecks</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Monitor memory</strong> - Alert at 80%</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Hit rate >85%</strong> - Cache effectiveness</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üö®</span><p><strong>Evictions = bad</strong> - Need more memory</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìà</span><p><strong>Prometheus+Grafana</strong> - Industry standard</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Monitoring</span><span class="keyword-tag">INFO</span><span class="keyword-tag">SLOWLOG</span><span class="keyword-tag">Metrics</span><span class="keyword-tag">Grafana</span><span class="keyword-tag">Alerts</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Redis suddenly slow. What's the FIRST thing to check?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Restart Redis server</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Check SLOWLOG GET 10</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Increase maxmemory</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Add more replicas</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Check SLOWLOG</strong>
                    <p>SLOWLOG shows slow queries immediately! Find blocking commands (KEYS *, long-running ops). Restart loses data, doesn't fix root cause. Memory increase without diagnosis wastes resources. More replicas don't help master performance. Always: Investigate FIRST (SLOWLOG + INFO), then fix root cause!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 76: Redis vs Alternatives (Comparison Guide)
// ============================================================

function getQuestion76Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Technology decision:</strong> "Should we use Redis, Memcached, DynamoDB, or Kafka?" Engineer: "Wrong question! Each tool different purpose. Redis: Rich data structures + persistence. Memcached: Simple cache only. DynamoDB: Database with consistency. Kafka: Event streaming. Use Redis for: Cache + data structures + pub/sub. Not primary database!"</p>
            <p>Right tool for right job.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis vs alternatives comparison: (1) Memcached: Simple key-value cache, no persistence, Redis wins with data structures + persistence, (2) DynamoDB: Managed database, stronger consistency, Redis wins on speed + data structures, (3) Kafka: Event streaming, Redis Streams lighter weight, (4) MongoDB: Document DB, Redis for hot data layer. Choose based on use case!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Feature Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Feature</th><th style="padding: 10px;">Redis</th><th style="padding: 10px;">Memcached</th><th style="padding: 10px;">DynamoDB</th></tr>
                    <tr><td style="padding: 8px;">Data Structures</td><td>5 types + modules</td><td>Strings only</td><td>JSON documents</td></tr>
                    <tr><td style="padding: 8px;">Persistence</td><td>RDB + AOF</td><td>None</td><td>Durable</td></tr>
                    <tr><td style="padding: 8px;">Replication</td><td>Master-replica</td><td>None (client-side)</td><td>Multi-region</td></tr>
                    <tr><td style="padding: 8px;">Max Value Size</td><td>512MB</td><td>1MB</td><td>400KB</td></tr>
                    <tr><td style="padding: 8px;">Latency</td><td>Sub-millisecond</td><td>Sub-millisecond</td><td>Single-digit ms</td></tr>
                    <tr><td style="padding: 8px;">Pub/Sub</td><td>Yes</td><td>No</td><td>No (use DynamoDB Streams)</td></tr>
                    <tr><td style="padding: 8px;">Transactions</td><td>MULTI/EXEC</td><td>No</td><td>TransactWriteItems</td></tr>
                    <tr><td style="padding: 8px;">Cost</td><td>Self-managed</td><td>Self-managed</td><td>Pay-per-request</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Decision Matrix:</strong></p>
                <ul>
                    <li><strong>Use Redis when:</strong> Need data structures, pub/sub, speed with persistence</li>
                    <li><strong>Use Memcached when:</strong> Simple cache, multi-threaded performance critical</li>
                    <li><strong>Use DynamoDB when:</strong> Need managed service, strong consistency, auto-scaling</li>
                    <li><strong>Use Kafka when:</strong> High-volume event streaming, log aggregation, replay</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Technology Decision Tree</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Which Technology to Choose?</text>
                    
                    <!-- Decision Start -->
                    <rect x="350" y="60" width="200" height="50" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">What's your use case?</text>
                    
                    <!-- Branch 1: Cache -->
                    <path d="M 350 85 L 150 140" stroke="#666" stroke-width="2"/>
                    <text x="240" y="110" fill="#888" font-size="11">Simple cache?</text>
                    
                    <rect x="50" y="140" width="200" height="80" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="150" y="165" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">Memcached</text>
                    <text x="60" y="185" fill="#888" font-size="9">‚úÖ Very fast</text>
                    <text x="60" y="200" fill="#888" font-size="9">‚úÖ Multi-threaded</text>
                    <text x="60" y="215" fill="#888" font-size="9">‚ùå No persistence</text>
                    
                    <!-- Branch 2: Rich Features -->
                    <path d="M 400 110 L 400 140" stroke="#666" stroke-width="2"/>
                    <text x="340" y="130" fill="#888" font-size="11">Data structures + speed?</text>
                    
                    <rect x="300" y="140" width="200" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="6"/>
                    <text x="400" y="165" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="700">üèÜ Redis</text>
                    <text x="310" y="185" fill="#888" font-size="9">‚úÖ 5+ data structures</text>
                    <text x="310" y="200" fill="#888" font-size="9">‚úÖ Persistence + replication</text>
                    <text x="310" y="215" fill="#888" font-size="9">‚úÖ Pub/Sub, Streams</text>
                    
                    <!-- Branch 3: Database -->
                    <path d="M 500 85 L 650 140" stroke="#666" stroke-width="2"/>
                    <text x="580" y="110" fill="#888" font-size="11">Primary database?</text>
                    
                    <rect x="550" y="140" width="200" height="80" fill="rgba(0,191,255,0.2)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="650" y="165" text-anchor="middle" fill="#00BFFF" font-size="13" font-weight="600">DynamoDB / MongoDB</text>
                    <text x="560" y="185" fill="#888" font-size="9">‚úÖ Managed service</text>
                    <text x="560" y="200" fill="#888" font-size="9">‚úÖ Auto-scaling</text>
                    <text x="560" y="215" fill="#888" font-size="9">‚úÖ Strong consistency</text>
                    
                    <!-- Event Streaming -->
                    <rect x="300" y="260" width="200" height="80" fill="rgba(138,43,226,0.2)" stroke="#8A2BE2" stroke-width="2" rx="6"/>
                    <text x="400" y="285" text-anchor="middle" fill="#8A2BE2" font-size="13" font-weight="600">Kafka</text>
                    <text x="310" y="305" fill="#888" font-size="9">‚úÖ Event streaming</text>
                    <text x="310" y="320" fill="#888" font-size="9">‚úÖ Replay capability</text>
                    <text x="310" y="335" fill="#888" font-size="9">‚úÖ High throughput</text>
                    
                    <path d="M 400 220 L 400 260" stroke="#666" stroke-width="2"/>
                    <text x="340" y="245" fill="#888" font-size="11">Event streaming?</text>
                    
                    <!-- Use Cases -->
                    <rect x="50" y="370" width="800" height="30" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="390" text-anchor="middle" fill="#00FF88" font-size="11">
                        üí° Redis = Hot data layer + Cache + Real-time features (sessions, leaderboards, rate limiting)
                    </text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Same Operation Different Technologies</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Comparison - Store User Session</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Redis - Rich data structure, TTL support</span>
<span class="keyword">import</span> redis
r = redis.Redis()

<span class="comment"># Store as hash with TTL</span>
r.hset(<span class="string">'session:user123'</span>, mapping={
    <span class="string">'user_id'</span>: <span class="string">'123'</span>,
    <span class="string">'name'</span>: <span class="string">'Alice'</span>,
    <span class="string">'role'</span>: <span class="string">'admin'</span>
})
r.expire(<span class="string">'session:user123'</span>, <span class="number">3600</span>)  <span class="comment"># 1 hour</span>

<span class="comment"># Get specific field</span>
name = r.hget(<span class="string">'session:user123'</span>, <span class="string">'name'</span>)

<span class="comment"># -------------------------------------------</span>

<span class="comment"># Memcached - String only, manual serialization</span>
<span class="keyword">import</span> memcache
<span class="keyword">import</span> json
mc = memcache.Client([<span class="string">'127.0.0.1:11211'</span>])

<span class="comment"># Must serialize to JSON</span>
session_data = json.dumps({
    <span class="string">'user_id'</span>: <span class="string">'123'</span>,
    <span class="string">'name'</span>: <span class="string">'Alice'</span>,
    <span class="string">'role'</span>: <span class="string">'admin'</span>
})
mc.set(<span class="string">'session:user123'</span>, session_data, time=<span class="number">3600</span>)

<span class="comment"># Get entire object, parse manually</span>
session = json.loads(mc.get(<span class="string">'session:user123'</span>))
name = session[<span class="string">'name'</span>]

<span class="comment"># -------------------------------------------</span>

<span class="comment"># DynamoDB - Managed, auto-scaling</span>
<span class="keyword">import</span> boto3
dynamodb = boto3.resource(<span class="string">'dynamodb'</span>)
table = dynamodb.Table(<span class="string">'Sessions'</span>)

<span class="comment"># Put with TTL</span>
table.put_item(
    Item={
        <span class="string">'session_id'</span>: <span class="string">'user123'</span>,
        <span class="string">'user_id'</span>: <span class="string">'123'</span>,
        <span class="string">'name'</span>: <span class="string">'Alice'</span>,
        <span class="string">'role'</span>: <span class="string">'admin'</span>,
        <span class="string">'ttl'</span>: <span class="function">int</span>(time.time()) + <span class="number">3600</span>
    }
)

<span class="comment"># Get item</span>
response = table.get_item(Key={<span class="string">'session_id'</span>: <span class="string">'user123'</span>})
name = response[<span class="string">'Item'</span>][<span class="string">'name'</span>]</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Leaderboard Comparison</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis Sorted Set vs DynamoDB GSI</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Redis - Native sorted set (perfect fit!)</span>
<span class="comment"># Add score</span>
r.zadd(<span class="string">'leaderboard'</span>, {<span class="string">'alice'</span>: <span class="number">1500</span>, <span class="string">'bob'</span>: <span class="number">1200</span>})

<span class="comment"># Get top 10</span>
top_10 = r.zrevrange(<span class="string">'leaderboard'</span>, <span class="number">0</span>, <span class="number">9</span>, withscores=<span class="keyword">True</span>)
<span class="comment"># Result: [('alice', 1500), ('bob', 1200)] - Instant!</span>

<span class="comment"># Get rank</span>
rank = r.zrevrank(<span class="string">'leaderboard'</span>, <span class="string">'alice'</span>)  <span class="comment"># 0 (first place)</span>

<span class="comment"># Update score (atomic)</span>
r.zincrby(<span class="string">'leaderboard'</span>, <span class="number">100</span>, <span class="string">'alice'</span>)

<span class="comment"># -------------------------------------------</span>

<span class="comment"># DynamoDB - Requires GSI, more complex</span>
<span class="comment"># 1. Need Global Secondary Index on score</span>
<span class="comment"># 2. Query with limit</span>
response = table.query(
    IndexName=<span class="string">'ScoreIndex'</span>,
    ScanIndexForward=<span class="keyword">False</span>,  <span class="comment"># Descending</span>
    Limit=<span class="number">10</span>
)

<span class="comment"># 3. Getting rank requires full scan (expensive!)</span>
<span class="comment"># 4. Atomic increment more complex</span>

<span class="comment"># Redis: O(log N), DynamoDB: Query cost + GSI overhead</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: When NOT to Use Redis</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Anti-Patterns - Wrong Tool</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># ‚ùå BAD: Redis as primary database</span>
<span class="comment"># Problem: No complex queries, no ACID guarantees</span>
r.hset(<span class="string">'user:123'</span>, mapping={<span class="string">'name'</span>: <span class="string">'Alice'</span>, <span class="string">'email'</span>: <span class="string">'a@b.com'</span>})
<span class="comment"># How to find user by email? Must scan all keys!</span>

<span class="comment"># ‚úÖ GOOD: Use PostgreSQL/MySQL for primary data</span>
<span class="comment"># Use Redis for hot cache layer only</span>

<span class="comment"># -------------------------------------------</span>

<span class="comment"># ‚ùå BAD: Large blobs in Redis</span>
image_data = <span class="function">open</span>(<span class="string">'large_image.jpg'</span>, <span class="string">'rb'</span>).read()  <span class="comment"># 10MB</span>
r.set(<span class="string">'image:123'</span>, image_data)  <span class="comment"># Memory waste!</span>

<span class="comment"># ‚úÖ GOOD: Use S3/object storage for blobs</span>
<span class="comment"># Store URL in Redis</span>
r.set(<span class="string">'image:123:url'</span>, <span class="string">'s3://bucket/image.jpg'</span>)

<span class="comment"># -------------------------------------------</span>

<span class="comment"># ‚ùå BAD: High-volume event streaming</span>
<span class="comment"># Redis Streams: Good for moderate volume</span>
<span class="comment"># Kafka: Built for millions of events/sec</span>

<span class="comment"># Use Kafka when: >100K events/sec, need replay, log retention</span>
<span class="comment"># Use Redis Streams when: <50K events/sec, simpler setup</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why choose Memcached over Redis?</h4>
                <p><strong>A:</strong> Rarely! Memcached wins: (1) Multi-threaded (better CPU utilization), (2) Simpler (easier operations). Redis wins almost everywhere else. Modern answer: Use Redis unless specific multi-threading need or legacy infrastructure!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Redis Streams vs Kafka - when to use each?</h4>
                <p><strong>A:</strong> Kafka for: High volume (millions/sec), long retention (days/weeks), complex processing. Redis Streams for: Moderate volume (<100K/sec), short retention (hours), simpler setup. Kafka = enterprise event backbone. Redis = lightweight messaging!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can Redis replace MongoDB?</h4>
                <p><strong>A:</strong> NO! Different purposes. MongoDB: Primary database, complex queries, ACID transactions. Redis: Cache + hot data layer. Use together: MongoDB stores, Redis caches. Redis RedisJSON module helps but not full replacement!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: "We use DynamoDB, should we add Redis?"</h4>
                <p><strong>Answer:</strong> Maybe! If: (1) Need <1ms latency (DynamoDB 5-10ms), (2) Complex data structures (leaderboards, rate limiting), (3) Pub/Sub real-time features. Redis as cache layer can 10x reduce DynamoDB costs!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Why not use Redis for everything?</h4>
                <p><strong>Answer:</strong> Cost + Complexity! Redis all-in-memory = expensive at scale. No complex queries (JOIN, WHERE). No strong ACID. Best as: (1) Cache layer, (2) Session store, (3) Real-time features. Not: (1) Primary database, (2) Analytics, (3) Large data storage!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Architecture Decision</strong></p>
            <p>Building e-commerce: Need products, orders, cache, real-time features. Which technologies?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Multi-Technology Stack</h4>
                <p><strong>PostgreSQL:</strong> Primary data (products, orders, users) - ACID transactions<br>
                <strong>Redis:</strong> (1) Product catalog cache, (2) Session store, (3) Shopping cart, (4) Real-time inventory, (5) Rate limiting<br>
                <strong>Elasticsearch:</strong> Product search with filters<br>
                <strong>S3:</strong> Product images<br>
                <strong>Why this works:</strong> Each tool does what it's best at!</p>
                <p><strong>Results:</strong> ‚úÖ <50ms API latency ‚úÖ ACID for orders ‚úÖ Real-time inventory ‚úÖ 10K req/sec capacity ‚úÖ $5K/month cost (vs $20K with just DynamoDB)</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Right tool for job</strong> - Don't force Redis everywhere</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üí™</span><p><strong>Redis wins on</strong> - Data structures + speed + features</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Best as cache</strong> - Hot data layer over DB</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Not primary DB</strong> - Use PostgreSQL/MySQL for that</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Memcached simpler</strong> - But Redis more powerful</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåä</span><p><strong>Kafka for events</strong> - Redis Streams for lighter needs</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Comparison</span><span class="keyword-tag">Memcached</span><span class="keyword-tag">DynamoDB</span><span class="keyword-tag">Kafka</span><span class="keyword-tag">Trade-offs</span><span class="keyword-tag">Architecture</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Building gaming leaderboard with millions of players. Need top 100 in <10ms. Best choice?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) DynamoDB with GSI</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Redis Sorted Set</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) MongoDB with index</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) PostgreSQL with ORDER BY</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Redis Sorted Set</strong>
                    <p>Redis Sorted Set PERFECT for leaderboards! ZADD O(log N), ZREVRANGE top N = instant. Sub-millisecond latency. Atomic score updates. DynamoDB GSI slower (5-10ms), expensive queries. MongoDB/PostgreSQL can't match Redis speed for this use case. Redis literally built for this pattern!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 77: Redis Client-Side Caching
// ============================================================

function getQuestion77Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Latency optimization:</strong> "API calls Redis 1000 times/sec. Network latency 2ms. Total: 2 seconds wasted on network! Can we cache in application memory?" Engineer: "CLIENT TRACKING! Redis notifies when keys change. App caches locally, invalidates on change. Result: 2ms ‚Üí 0.1ms. 20x faster!"</p>
            <p>Client-side caching = two-tier speed.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis client-side caching (Redis 6.0+): Cache GET responses in application memory. SERVER tracks which clients accessed which keys. On key change: sends invalidation message via Pub/Sub. Client updates local cache. Modes: (1) Default tracking (exact keys), (2) BCAST (prefix-based). Reduces Redis load 70%+, improves latency 10x!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Client-Side Caching Flow</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Step</th><th style="padding: 10px;">Action</th><th style="padding: 10px;">Benefit</th></tr>
                    <tr><td style="padding: 8px;">1. Enable</td><td>CLIENT TRACKING ON</td><td>Server starts tracking</td></tr>
                    <tr><td style="padding: 8px;">2. Read</td><td>GET key ‚Üí cache locally</td><td>Instant future reads</td></tr>
                    <tr><td style="padding: 8px;">3. Change</td><td>Another client SET key</td><td>Server detects change</td></tr>
                    <tr><td style="padding: 8px;">4. Invalidate</td><td>Server sends notification</td><td>Client knows to refresh</td></tr>
                    <tr><td style="padding: 8px;">5. Refresh</td><td>GET key ‚Üí update cache</td><td>Always fresh data</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Client-Side Cache with Tracking</div>
                <svg viewBox="0 0 900 380" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Two-Tier Caching Architecture</text>
                    
                    <rect x="50" y="80" width="180" height="220" fill="rgba(0,191,255,0.1)" stroke="#00BFFF" stroke-width="3" rx="8"/>
                    <text x="140" y="105" text-anchor="middle" fill="#00BFFF" font-size="14" font-weight="700">üì± Application</text>
                    
                    <rect x="70" y="120" width="140" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="140" y="140" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Local Cache</text>
                    <text x="80" y="160" fill="#888" font-size="9">user:123 ‚Üí {name: "Alice"}</text>
                    <text x="80" y="175" fill="#888" font-size="9">product:456 ‚Üí {...}</text>
                    <text x="80" y="190" fill="#888" font-size="9">‚ö° 0.1ms access!</text>
                    
                    <rect x="70" y="220" width="140" height="60" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="140" y="240" text-anchor="middle" fill="#9C27B0" font-size="11" font-weight="600">Invalidation Handler</text>
                    <text x="80" y="260" fill="#888" font-size="9">Listens for changes</text>
                    <text x="80" y="272" fill="#888" font-size="9">Clears stale entries</text>
                    
                    <rect x="350" y="80" width="200" height="220" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="105" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">‚ö° Redis Server</text>
                    
                    <rect x="370" y="125" width="160" height="60" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="450" y="145" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">Tracking Table</text>
                    <text x="380" y="162" fill="#888" font-size="9">user:123 ‚Üí [client1, client2]</text>
                    <text x="380" y="175" fill="#888" font-size="9">product:456 ‚Üí [client1]</text>
                    
                    <rect x="370" y="200" width="160" height="80" fill="rgba(138,43,226,0.1)" stroke="#8A2BE2" stroke-width="2" rx="4"/>
                    <text x="450" y="220" text-anchor="middle" fill="#8A2BE2" font-size="11" font-weight="600">Invalidation Pub/Sub</text>
                    <text x="380" y="240" fill="#888" font-size="9">Channel: __redis__:invalidate</text>
                    <text x="380" y="255" fill="#888" font-size="9">Sends: ["user:123"]</text>
                    <text x="380" y="270" fill="#888" font-size="9">On SET/DEL/EXPIRE</text>
                    
                    <rect x="650" y="140" width="180" height="100" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="740" y="165" text-anchor="middle" fill="#FF6347" font-size="13" font-weight="600">üìù Writer Client</text>
                    <text x="660" y="185" fill="#888" font-size="10">SET user:123 {...}</text>
                    <text x="660" y="205" fill="#DC143C" font-size="10" font-weight="600">‚Üí Triggers invalidation!</text>
                    <text x="660" y="225" fill="#888" font-size="9">Other clients notified</text>
                    
                    <path d="M 230 160 L 350 160" stroke="#00BFFF" stroke-width="2" marker-end="url(#arrowBlue)"/>
                    <text x="285" y="150" fill="#00BFFF" font-size="9">GET (cache miss)</text>
                    
                    <path d="M 350 240 L 230 240" stroke="#8A2BE2" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowPurple)"/>
                    <text x="260" y="230" fill="#8A2BE2" font-size="9">Invalidation msg</text>
                    
                    <path d="M 650 190 L 550 160" stroke="#FF6347" stroke-width="2" marker-end="url(#arrowRed)"/>
                    <text x="600" y="165" fill="#FF6347" font-size="9">Write</text>
                    
                    <rect x="50" y="340" width="800" height="25" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="450" y="357" text-anchor="middle" fill="#00FF88" font-size="10">
                        ‚úÖ 70% fewer Redis calls + 10x faster reads + Always consistent data
                    </text>
                    
                    <defs>
                        <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00BFFF" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#8A2BE2" />
                        </marker>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Client-Side Cache</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Simple Implementation</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> threading

<span class="keyword">class</span> <span class="function">ClientSideCache</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self):
        <span class="comment"># Main connection for commands</span>
        self.redis = redis.Redis()
        
        <span class="comment"># Separate connection for tracking</span>
        self.tracking = redis.Redis()
        
        <span class="comment"># Local cache</span>
        self.cache = {}
        
        <span class="comment"># Enable tracking</span>
        self.tracking.execute_command(<span class="string">'CLIENT'</span>, <span class="string">'TRACKING'</span>, <span class="string">'ON'</span>)
        
        <span class="comment"># Start invalidation listener</span>
        self._start_listener()
    
    <span class="keyword">def</span> <span class="function">_start_listener</span>(self):
        <span class="string">"""Listen for invalidation messages"""</span>
        <span class="keyword">def</span> <span class="function">listen</span>():
            pubsub = self.tracking.pubsub()
            <span class="comment"># Subscribe to invalidation channel</span>
            pubsub.subscribe(<span class="string">'__redis__:invalidate'</span>)
            
            <span class="keyword">for</span> message <span class="keyword">in</span> pubsub.listen():
                <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'message'</span>:
                    <span class="comment"># Keys to invalidate</span>
                    keys = message[<span class="string">'data'</span>]
                    <span class="keyword">for</span> key <span class="keyword">in</span> keys:
                        self.cache.pop(key, <span class="keyword">None</span>)
                        <span class="keyword">print</span>(<span class="string">f"üóëÔ∏è Invalidated: {key}"</span>)
        
        thread = threading.Thread(target=listen, daemon=<span class="keyword">True</span>)
        thread.start()
    
    <span class="keyword">def</span> <span class="function">get</span>(self, key):
        <span class="string">"""Get with client-side cache"""</span>
        <span class="comment"># Check local cache first</span>
        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:
            <span class="keyword">print</span>(<span class="string">f"‚úÖ Cache HIT: {key}"</span>)
            <span class="keyword">return</span> self.cache[key]
        
        <span class="comment"># Cache miss - fetch from Redis</span>
        value = self.redis.get(key)
        <span class="keyword">if</span> value:
            self.cache[key] = value
            <span class="keyword">print</span>(<span class="string">f"üì• Cache MISS: {key} (fetched)"</span>)
        
        <span class="keyword">return</span> value

<span class="comment"># Usage</span>
cache = ClientSideCache()
cache.get(<span class="string">'user:123'</span>)  <span class="comment"># Miss, fetch from Redis</span>
cache.get(<span class="string">'user:123'</span>)  <span class="comment"># HIT, instant from local</span>
<span class="comment"># Another client: SET user:123 "new value"</span>
<span class="comment"># ‚Üí Invalidation triggered automatically!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: BCAST Mode (Prefix-Based)</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Broadcast Tracking</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># BCAST mode: Track by prefix, not exact keys</span>
<span class="comment"># Useful when you cache many related keys</span>

<span class="keyword">def</span> <span class="function">enable_bcast_tracking</span>():
    <span class="string">"""Enable broadcast mode for prefix matching"""</span>
    r = redis.Redis()
    
    <span class="comment"># Track all keys with 'user:' prefix</span>
    r.execute_command(
        <span class="string">'CLIENT'</span>, <span class="string">'TRACKING'</span>, <span class="string">'ON'</span>,
        <span class="string">'BCAST'</span>,
        <span class="string">'PREFIX'</span>, <span class="string">'user:'</span>,
        <span class="string">'PREFIX'</span>, <span class="string">'product:'</span>
    )
    
    <span class="keyword">print</span>(<span class="string">"‚úÖ BCAST tracking enabled for user: and product: prefixes"</span>)

<span class="comment"># Now ANY change to user:* or product:* triggers invalidation</span>
<span class="comment"># More notifications but simpler (don't track exact keys)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Production-Ready Cache</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - With TTL and Stats</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> time

<span class="keyword">class</span> <span class="function">ProductionCache</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self, max_size=<span class="number">10000</span>, ttl=<span class="number">300</span>):
        self.cache = {}  <span class="comment"># {key: (value, timestamp)}</span>
        self.max_size = max_size
        self.ttl = ttl
        self.stats = {<span class="string">'hits'</span>: <span class="number">0</span>, <span class="string">'misses'</span>: <span class="number">0</span>, <span class="string">'invalidations'</span>: <span class="number">0</span>}
    
    <span class="keyword">def</span> <span class="function">get</span>(self, key):
        <span class="comment"># Check cache</span>
        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:
            value, timestamp = self.cache[key]
            
            <span class="comment"># Check TTL</span>
            <span class="keyword">if</span> time.time() - timestamp < self.ttl:
                self.stats[<span class="string">'hits'</span>] += <span class="number">1</span>
                <span class="keyword">return</span> value
            <span class="keyword">else</span>:
                <span class="comment"># Expired</span>
                <span class="keyword">del</span> self.cache[key]
        
        <span class="comment"># Cache miss</span>
        self.stats[<span class="string">'misses'</span>] += <span class="number">1</span>
        value = self._fetch_from_redis(key)
        
        <span class="comment"># Store in cache (with size limit)</span>
        <span class="keyword">if</span> <span class="function">len</span>(self.cache) >= self.max_size:
            <span class="comment"># Evict oldest (simple LRU)</span>
            oldest = <span class="function">min</span>(self.cache.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>][<span class="number">1</span>])
            <span class="keyword">del</span> self.cache[oldest[<span class="number">0</span>]]
        
        self.cache[key] = (value, time.time())
        <span class="keyword">return</span> value
    
    <span class="keyword">def</span> <span class="function">invalidate</span>(self, key):
        <span class="string">"""Called by invalidation listener"""</span>
        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:
            <span class="keyword">del</span> self.cache[key]
            self.stats[<span class="string">'invalidations'</span>] += <span class="number">1</span>
    
    <span class="keyword">def</span> <span class="function">get_stats</span>(self):
        total = self.stats[<span class="string">'hits'</span>] + self.stats[<span class="string">'misses'</span>]
        hit_rate = (self.stats[<span class="string">'hits'</span>] / total * <span class="number">100</span>) <span class="keyword">if</span> total > <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>
        
        <span class="keyword">return</span> {
            <span class="string">'hit_rate'</span>: <span class="string">f'{hit_rate:.1f}%'</span>,
            <span class="string">'cache_size'</span>: <span class="function">len</span>(self.cache),
            **self.stats
        }</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Default mode vs BCAST mode - which to use?</h4>
                <p><strong>A:</strong> Default: Tracks exact keys accessed (precise, fewer notifications). BCAST: Tracks prefixes (simpler, more notifications). Use default when: Specific keys cached. Use BCAST when: Cache entire namespaces (user:*, product:*)!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What happens if invalidation message lost?</h4>
                <p><strong>A:</strong> Stale data! Solution: Add TTL to local cache (5-60 seconds). Ensures refresh even without invalidation. Trade-off: Eventual consistency vs guaranteed freshness. Production: Always use TTL as safety net!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Client-side cache size limit?</h4>
                <p><strong>A:</strong> Set max size (10K-100K items typical). Implement LRU eviction. Monitor memory usage. Don't cache everything - cache hot 20% that gets 80% of requests. Too big = memory waste, too small = low hit rate!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Does CLIENT TRACKING work with Cluster?</h4>
                <p><strong>Answer:</strong> YES but REDIRECT mode required! Each node tracks separately. Use CLIENT TRACKING ON REDIRECT <node_id>. Invalidations sent to redirect node. More complex setup but works!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Invalidation for EXPIRE vs DEL - different?</h4>
                <p><strong>Answer:</strong> NO! Both trigger invalidation. EXPIRE, DEL, SET all invalidate. Even lazy expiration (key accessed after TTL). All modifications = invalidation. Consistent behavior!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: API Performance Optimization</strong></p>
            <p>API makes 500 Redis GET calls per request. 2ms network latency √ó 500 = 1 second wasted!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Client-Side Cache</h4>
                <p><strong>Implementation:</strong> Enable CLIENT TRACKING, cache GET responses locally, TTL 30 seconds<br>
                <strong>Results after 1 hour:</strong> Hit rate 95% (475/500 requests from local cache)<br>
                <strong>Latency improvement:</strong> 500 √ó 2ms ‚Üí 25 √ó 2ms + 475 √ó 0.1ms = 100ms (90% reduction!)<br>
                <strong>Redis load:</strong> 500 req/sec ‚Üí 25 req/sec (95% reduction)</p>
                <p><strong>Impact:</strong> ‚úÖ API response 1000ms ‚Üí 150ms ‚úÖ Redis capacity 10x ‚úÖ Cost savings $2K/month ‚úÖ Same data freshness (invalidations work!)</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üöÄ</span><p><strong>CLIENT TRACKING ON</strong> - Enable server-side tracking</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì±</span><p><strong>Local cache</strong> - Store GET responses in memory</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîî</span><p><strong>Invalidation</strong> - Pub/Sub notifications on changes</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>Add TTL</strong> - Safety net for lost messages</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>70% fewer calls</strong> - Massive Redis load reduction</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>10x faster reads</strong> - Sub-millisecond access</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Client Caching</span><span class="keyword-tag">TRACKING</span><span class="keyword-tag">Invalidation</span><span class="keyword-tag">Two-Tier</span><span class="keyword-tag">Performance</span><span class="keyword-tag">BCAST</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Application makes 1000 Redis GETs/sec with 95% cache hit rate possible. Best optimization?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Add read replicas</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Enable CLIENT TRACKING with local cache</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Use pipeline for batching</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Upgrade to faster network</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - CLIENT TRACKING with local cache</strong>
                    <p>Client-side cache perfect! 95% hit rate = 950/1000 from local memory (0.1ms). Only 50 Redis calls. Reduces load 95%, improves latency 10x. Read replicas don't help (still network latency). Pipeline good but doesn't reduce calls. Network upgrade expensive. CLIENT TRACKING = best ROI!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 76: Redis vs Alternatives (Comparison Guide)
// ============================================================

function getQuestion76Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Technology decision:</strong> "Should we use Redis, Memcached, DynamoDB, or Kafka?" Engineer: "Wrong question! Each tool different purpose. Redis: Rich data structures + persistence. Memcached: Simple cache only. DynamoDB: Database with consistency. Kafka: Event streaming. Use Redis for: Cache + data structures + pub/sub. Not primary database!"</p>
            <p>Right tool for right job.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis vs alternatives comparison: (1) Memcached: Simple key-value cache, no persistence, Redis wins with data structures + persistence, (2) DynamoDB: Managed database, stronger consistency, Redis wins on speed + data structures, (3) Kafka: Event streaming, Redis Streams lighter weight, (4) MongoDB: Document DB, Redis for hot data layer. Choose based on use case!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Feature Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Feature</th><th style="padding: 10px;">Redis</th><th style="padding: 10px;">Memcached</th><th style="padding: 10px;">DynamoDB</th></tr>
                    <tr><td style="padding: 8px;">Data Structures</td><td>5 types + modules</td><td>Strings only</td><td>JSON documents</td></tr>
                    <tr><td style="padding: 8px;">Persistence</td><td>RDB + AOF</td><td>None</td><td>Durable</td></tr>
                    <tr><td style="padding: 8px;">Replication</td><td>Master-replica</td><td>None (client-side)</td><td>Multi-region</td></tr>
                    <tr><td style="padding: 8px;">Max Value Size</td><td>512MB</td><td>1MB</td><td>400KB</td></tr>
                    <tr><td style="padding: 8px;">Latency</td><td>Sub-millisecond</td><td>Sub-millisecond</td><td>Single-digit ms</td></tr>
                    <tr><td style="padding: 8px;">Pub/Sub</td><td>Yes</td><td>No</td><td>No (use DynamoDB Streams)</td></tr>
                    <tr><td style="padding: 8px;">Transactions</td><td>MULTI/EXEC</td><td>No</td><td>TransactWriteItems</td></tr>
                    <tr><td style="padding: 8px;">Cost</td><td>Self-managed</td><td>Self-managed</td><td>Pay-per-request</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Decision Matrix:</strong></p>
                <ul>
                    <li><strong>Use Redis when:</strong> Need data structures, pub/sub, speed with persistence</li>
                    <li><strong>Use Memcached when:</strong> Simple cache, multi-threaded performance critical</li>
                    <li><strong>Use DynamoDB when:</strong> Need managed service, strong consistency, auto-scaling</li>
                    <li><strong>Use Kafka when:</strong> High-volume event streaming, log aggregation, replay</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Technology Decision Tree</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Which Technology to Choose?</text>
                    
                    <!-- Decision Start -->
                    <rect x="350" y="60" width="200" height="50" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">What's your use case?</text>
                    
                    <!-- Branch 1: Cache -->
                    <path d="M 350 85 L 150 140" stroke="#666" stroke-width="2"/>
                    <text x="240" y="110" fill="#888" font-size="11">Simple cache?</text>
                    
                    <rect x="50" y="140" width="200" height="80" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="150" y="165" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">Memcached</text>
                    <text x="60" y="185" fill="#888" font-size="9">‚úÖ Very fast</text>
                    <text x="60" y="200" fill="#888" font-size="9">‚úÖ Multi-threaded</text>
                    <text x="60" y="215" fill="#888" font-size="9">‚ùå No persistence</text>
                    
                    <!-- Branch 2: Rich Features -->
                    <path d="M 400 110 L 400 140" stroke="#666" stroke-width="2"/>
                    <text x="340" y="130" fill="#888" font-size="11">Data structures + speed?</text>
                    
                    <rect x="300" y="140" width="200" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="6"/>
                    <text x="400" y="165" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="700">üèÜ Redis</text>
                    <text x="310" y="185" fill="#888" font-size="9">‚úÖ 5+ data structures</text>
                    <text x="310" y="200" fill="#888" font-size="9">‚úÖ Persistence + replication</text>
                    <text x="310" y="215" fill="#888" font-size="9">‚úÖ Pub/Sub, Streams</text>
                    
                    <!-- Branch 3: Database -->
                    <path d="M 500 85 L 650 140" stroke="#666" stroke-width="2"/>
                    <text x="580" y="110" fill="#888" font-size="11">Primary database?</text>
                    
                    <rect x="550" y="140" width="200" height="80" fill="rgba(0,191,255,0.2)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="650" y="165" text-anchor="middle" fill="#00BFFF" font-size="13" font-weight="600">DynamoDB / MongoDB</text>
                    <text x="560" y="185" fill="#888" font-size="9">‚úÖ Managed service</text>
                    <text x="560" y="200" fill="#888" font-size="9">‚úÖ Auto-scaling</text>
                    <text x="560" y="215" fill="#888" font-size="9">‚úÖ Strong consistency</text>
                    
                    <!-- Event Streaming -->
                    <rect x="300" y="260" width="200" height="80" fill="rgba(138,43,226,0.2)" stroke="#8A2BE2" stroke-width="2" rx="6"/>
                    <text x="400" y="285" text-anchor="middle" fill="#8A2BE2" font-size="13" font-weight="600">Kafka</text>
                    <text x="310" y="305" fill="#888" font-size="9">‚úÖ Event streaming</text>
                    <text x="310" y="320" fill="#888" font-size="9">‚úÖ Replay capability</text>
                    <text x="310" y="335" fill="#888" font-size="9">‚úÖ High throughput</text>
                    
                    <path d="M 400 220 L 400 260" stroke="#666" stroke-width="2"/>
                    <text x="340" y="245" fill="#888" font-size="11">Event streaming?</text>
                    
                    <!-- Use Cases -->
                    <rect x="50" y="370" width="800" height="30" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="390" text-anchor="middle" fill="#00FF88" font-size="11">
                        üí° Redis = Hot data layer + Cache + Real-time features (sessions, leaderboards, rate limiting)
                    </text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Same Operation Different Technologies</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Comparison - Store User Session</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Redis - Rich data structure, TTL support</span>
<span class="keyword">import</span> redis
r = redis.Redis()

<span class="comment"># Store as hash with TTL</span>
r.hset(<span class="string">'session:user123'</span>, mapping={
    <span class="string">'user_id'</span>: <span class="string">'123'</span>,
    <span class="string">'name'</span>: <span class="string">'Alice'</span>,
    <span class="string">'role'</span>: <span class="string">'admin'</span>
})
r.expire(<span class="string">'session:user123'</span>, <span class="number">3600</span>)  <span class="comment"># 1 hour</span>

<span class="comment"># Get specific field</span>
name = r.hget(<span class="string">'session:user123'</span>, <span class="string">'name'</span>)

<span class="comment"># -------------------------------------------</span>

<span class="comment"># Memcached - String only, manual serialization</span>
<span class="keyword">import</span> memcache
<span class="keyword">import</span> json
mc = memcache.Client([<span class="string">'127.0.0.1:11211'</span>])

<span class="comment"># Must serialize to JSON</span>
session_data = json.dumps({
    <span class="string">'user_id'</span>: <span class="string">'123'</span>,
    <span class="string">'name'</span>: <span class="string">'Alice'</span>,
    <span class="string">'role'</span>: <span class="string">'admin'</span>
})
mc.set(<span class="string">'session:user123'</span>, session_data, time=<span class="number">3600</span>)

<span class="comment"># Get entire object, parse manually</span>
session = json.loads(mc.get(<span class="string">'session:user123'</span>))
name = session[<span class="string">'name'</span>]

<span class="comment"># -------------------------------------------</span>

<span class="comment"># DynamoDB - Managed, auto-scaling</span>
<span class="keyword">import</span> boto3
dynamodb = boto3.resource(<span class="string">'dynamodb'</span>)
table = dynamodb.Table(<span class="string">'Sessions'</span>)

<span class="comment"># Put with TTL</span>
table.put_item(
    Item={
        <span class="string">'session_id'</span>: <span class="string">'user123'</span>,
        <span class="string">'user_id'</span>: <span class="string">'123'</span>,
        <span class="string">'name'</span>: <span class="string">'Alice'</span>,
        <span class="string">'role'</span>: <span class="string">'admin'</span>,
        <span class="string">'ttl'</span>: <span class="function">int</span>(time.time()) + <span class="number">3600</span>
    }
)

<span class="comment"># Get item</span>
response = table.get_item(Key={<span class="string">'session_id'</span>: <span class="string">'user123'</span>})
name = response[<span class="string">'Item'</span>][<span class="string">'name'</span>]</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Leaderboard Comparison</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Redis Sorted Set vs DynamoDB GSI</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Redis - Native sorted set (perfect fit!)</span>
<span class="comment"># Add score</span>
r.zadd(<span class="string">'leaderboard'</span>, {<span class="string">'alice'</span>: <span class="number">1500</span>, <span class="string">'bob'</span>: <span class="number">1200</span>})

<span class="comment"># Get top 10</span>
top_10 = r.zrevrange(<span class="string">'leaderboard'</span>, <span class="number">0</span>, <span class="number">9</span>, withscores=<span class="keyword">True</span>)
<span class="comment"># Result: [('alice', 1500), ('bob', 1200)] - Instant!</span>

<span class="comment"># Get rank</span>
rank = r.zrevrank(<span class="string">'leaderboard'</span>, <span class="string">'alice'</span>)  <span class="comment"># 0 (first place)</span>

<span class="comment"># Update score (atomic)</span>
r.zincrby(<span class="string">'leaderboard'</span>, <span class="number">100</span>, <span class="string">'alice'</span>)

<span class="comment"># -------------------------------------------</span>

<span class="comment"># DynamoDB - Requires GSI, more complex</span>
<span class="comment"># 1. Need Global Secondary Index on score</span>
<span class="comment"># 2. Query with limit</span>
response = table.query(
    IndexName=<span class="string">'ScoreIndex'</span>,
    ScanIndexForward=<span class="keyword">False</span>,  <span class="comment"># Descending</span>
    Limit=<span class="number">10</span>
)

<span class="comment"># 3. Getting rank requires full scan (expensive!)</span>
<span class="comment"># 4. Atomic increment more complex</span>

<span class="comment"># Redis: O(log N), DynamoDB: Query cost + GSI overhead</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: When NOT to Use Redis</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Anti-Patterns - Wrong Tool</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># ‚ùå BAD: Redis as primary database</span>
<span class="comment"># Problem: No complex queries, no ACID guarantees</span>
r.hset(<span class="string">'user:123'</span>, mapping={<span class="string">'name'</span>: <span class="string">'Alice'</span>, <span class="string">'email'</span>: <span class="string">'a@b.com'</span>})
<span class="comment"># How to find user by email? Must scan all keys!</span>

<span class="comment"># ‚úÖ GOOD: Use PostgreSQL/MySQL for primary data</span>
<span class="comment"># Use Redis for hot cache layer only</span>

<span class="comment"># -------------------------------------------</span>

<span class="comment"># ‚ùå BAD: Large blobs in Redis</span>
image_data = <span class="function">open</span>(<span class="string">'large_image.jpg'</span>, <span class="string">'rb'</span>).read()  <span class="comment"># 10MB</span>
r.set(<span class="string">'image:123'</span>, image_data)  <span class="comment"># Memory waste!</span>

<span class="comment"># ‚úÖ GOOD: Use S3/object storage for blobs</span>
<span class="comment"># Store URL in Redis</span>
r.set(<span class="string">'image:123:url'</span>, <span class="string">'s3://bucket/image.jpg'</span>)

<span class="comment"># -------------------------------------------</span>

<span class="comment"># ‚ùå BAD: High-volume event streaming</span>
<span class="comment"># Redis Streams: Good for moderate volume</span>
<span class="comment"># Kafka: Built for millions of events/sec</span>

<span class="comment"># Use Kafka when: >100K events/sec, need replay, log retention</span>
<span class="comment"># Use Redis Streams when: <50K events/sec, simpler setup</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why choose Memcached over Redis?</h4>
                <p><strong>A:</strong> Rarely! Memcached wins: (1) Multi-threaded (better CPU utilization), (2) Simpler (easier operations). Redis wins almost everywhere else. Modern answer: Use Redis unless specific multi-threading need or legacy infrastructure!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Redis Streams vs Kafka - when to use each?</h4>
                <p><strong>A:</strong> Kafka for: High volume (millions/sec), long retention (days/weeks), complex processing. Redis Streams for: Moderate volume (<100K/sec), short retention (hours), simpler setup. Kafka = enterprise event backbone. Redis = lightweight messaging!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can Redis replace MongoDB?</h4>
                <p><strong>A:</strong> NO! Different purposes. MongoDB: Primary database, complex queries, ACID transactions. Redis: Cache + hot data layer. Use together: MongoDB stores, Redis caches. Redis RedisJSON module helps but not full replacement!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: "We use DynamoDB, should we add Redis?"</h4>
                <p><strong>Answer:</strong> Maybe! If: (1) Need <1ms latency (DynamoDB 5-10ms), (2) Complex data structures (leaderboards, rate limiting), (3) Pub/Sub real-time features. Redis as cache layer can 10x reduce DynamoDB costs!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Why not use Redis for everything?</h4>
                <p><strong>Answer:</strong> Cost + Complexity! Redis all-in-memory = expensive at scale. No complex queries (JOIN, WHERE). No strong ACID. Best as: (1) Cache layer, (2) Session store, (3) Real-time features. Not: (1) Primary database, (2) Analytics, (3) Large data storage!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Architecture Decision</strong></p>
            <p>Building e-commerce: Need products, orders, cache, real-time features. Which technologies?</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Multi-Technology Stack</h4>
                <p><strong>PostgreSQL:</strong> Primary data (products, orders, users) - ACID transactions<br>
                <strong>Redis:</strong> (1) Product catalog cache, (2) Session store, (3) Shopping cart, (4) Real-time inventory, (5) Rate limiting<br>
                <strong>Elasticsearch:</strong> Product search with filters<br>
                <strong>S3:</strong> Product images<br>
                <strong>Why this works:</strong> Each tool does what it's best at!</p>
                <p><strong>Results:</strong> ‚úÖ <50ms API latency ‚úÖ ACID for orders ‚úÖ Real-time inventory ‚úÖ 10K req/sec capacity ‚úÖ $5K/month cost (vs $20K with just DynamoDB)</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Right tool for job</strong> - Don't force Redis everywhere</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üí™</span><p><strong>Redis wins on</strong> - Data structures + speed + features</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Best as cache</strong> - Hot data layer over DB</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Not primary DB</strong> - Use PostgreSQL/MySQL for that</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Memcached simpler</strong> - But Redis more powerful</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåä</span><p><strong>Kafka for events</strong> - Redis Streams for lighter needs</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Comparison</span><span class="keyword-tag">Memcached</span><span class="keyword-tag">DynamoDB</span><span class="keyword-tag">Kafka</span><span class="keyword-tag">Trade-offs</span><span class="keyword-tag">Architecture</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Building gaming leaderboard with millions of players. Need top 100 in <10ms. Best choice?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) DynamoDB with GSI</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Redis Sorted Set</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) MongoDB with index</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) PostgreSQL with ORDER BY</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Redis Sorted Set</strong>
                    <p>Redis Sorted Set PERFECT for leaderboards! ZADD O(log N), ZREVRANGE top N = instant. Sub-millisecond latency. Atomic score updates. DynamoDB GSI slower (5-10ms), expensive queries. MongoDB/PostgreSQL can't match Redis speed for this use case. Redis literally built for this pattern!</p>
                </div>
            </div>
        </div>
    `;
}


// Q77-Q80 COMPLETE FUNCTIONS BELOW
// Each follows the exact same 10-section pattern

// For brevity and context management, providing Q77 fully, and Q78-Q80 as template-ready functions

// ============================================================
// QUESTION 77: Redis Client-Side Caching
// ============================================================

function getQuestion77Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Latency optimization:</strong> "API calls Redis 1000 times/sec. Network latency 2ms. Total: 2 seconds wasted on network! Can we cache in application memory?" Engineer: "CLIENT TRACKING! Redis notifies when keys change. App caches locally, invalidates on change. Result: 2ms ‚Üí 0.1ms. 20x faster!"</p>
            <p>Client-side caching = two-tier speed.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis client-side caching (Redis 6.0+): Cache GET responses in application memory. SERVER tracks which clients accessed which keys. On key change: sends invalidation message via Pub/Sub. Client updates local cache. Modes: (1) Default tracking (exact keys), (2) BCAST (prefix-based). Reduces Redis load 70%+, improves latency 10x!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Client-Side Caching Flow</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Step</th><th style="padding: 10px;">Action</th><th style="padding: 10px;">Benefit</th></tr>
                    <tr><td style="padding: 8px;">1. Enable</td><td>CLIENT TRACKING ON</td><td>Server starts tracking</td></tr>
                    <tr><td style="padding: 8px;">2. Read</td><td>GET key ‚Üí cache locally</td><td>Instant future reads</td></tr>
                    <tr><td style="padding: 8px;">3. Change</td><td>Another client SET key</td><td>Server detects change</td></tr>
                    <tr><td style="padding: 8px;">4. Invalidate</td><td>Server sends notification</td><td>Client knows to refresh</td></tr>
                    <tr><td style="padding: 8px;">5. Refresh</td><td>GET key ‚Üí update cache</td><td>Always fresh data</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Client-Side Cache with Tracking</div>
                <svg viewBox="0 0 900 380" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Two-Tier Caching Architecture</text>
                    
                    <rect x="50" y="80" width="180" height="220" fill="rgba(0,191,255,0.1)" stroke="#00BFFF" stroke-width="3" rx="8"/>
                    <text x="140" y="105" text-anchor="middle" fill="#00BFFF" font-size="14" font-weight="700">üì± Application</text>
                    
                    <rect x="70" y="120" width="140" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="140" y="140" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Local Cache</text>
                    <text x="80" y="160" fill="#888" font-size="9">user:123 ‚Üí {name: "Alice"}</text>
                    <text x="80" y="175" fill="#888" font-size="9">product:456 ‚Üí {...}</text>
                    <text x="80" y="190" fill="#888" font-size="9">‚ö° 0.1ms access!</text>
                    
                    <rect x="70" y="220" width="140" height="60" fill="rgba(156,39,176,0.1)" stroke="#9C27B0" stroke-width="2" rx="6"/>
                    <text x="140" y="240" text-anchor="middle" fill="#9C27B0" font-size="11" font-weight="600">Invalidation Handler</text>
                    <text x="80" y="260" fill="#888" font-size="9">Listens for changes</text>
                    <text x="80" y="272" fill="#888" font-size="9">Clears stale entries</text>
                    
                    <rect x="350" y="80" width="200" height="220" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="105" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">‚ö° Redis Server</text>
                    
                    <rect x="370" y="125" width="160" height="60" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="450" y="145" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">Tracking Table</text>
                    <text x="380" y="162" fill="#888" font-size="9">user:123 ‚Üí [client1, client2]</text>
                    <text x="380" y="175" fill="#888" font-size="9">product:456 ‚Üí [client1]</text>
                    
                    <rect x="370" y="200" width="160" height="80" fill="rgba(138,43,226,0.1)" stroke="#8A2BE2" stroke-width="2" rx="4"/>
                    <text x="450" y="220" text-anchor="middle" fill="#8A2BE2" font-size="11" font-weight="600">Invalidation Pub/Sub</text>
                    <text x="380" y="240" fill="#888" font-size="9">Channel: __redis__:invalidate</text>
                    <text x="380" y="255" fill="#888" font-size="9">Sends: ["user:123"]</text>
                    <text x="380" y="270" fill="#888" font-size="9">On SET/DEL/EXPIRE</text>
                    
                    <rect x="650" y="140" width="180" height="100" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="740" y="165" text-anchor="middle" fill="#FF6347" font-size="13" font-weight="600">üìù Writer Client</text>
                    <text x="660" y="185" fill="#888" font-size="10">SET user:123 {...}</text>
                    <text x="660" y="205" fill="#DC143C" font-size="10" font-weight="600">‚Üí Triggers invalidation!</text>
                    <text x="660" y="225" fill="#888" font-size="9">Other clients notified</text>
                    
                    <path d="M 230 160 L 350 160" stroke="#00BFFF" stroke-width="2" marker-end="url(#arrowBlue)"/>
                    <text x="285" y="150" fill="#00BFFF" font-size="9">GET (cache miss)</text>
                    
                    <path d="M 350 240 L 230 240" stroke="#8A2BE2" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowPurple)"/>
                    <text x="260" y="230" fill="#8A2BE2" font-size="9">Invalidation msg</text>
                    
                    <path d="M 650 190 L 550 160" stroke="#FF6347" stroke-width="2" marker-end="url(#arrowRed)"/>
                    <text x="600" y="165" fill="#FF6347" font-size="9">Write</text>
                    
                    <rect x="50" y="340" width="800" height="25" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="450" y="357" text-anchor="middle" fill="#00FF88" font-size="10">
                        ‚úÖ 70% fewer Redis calls + 10x faster reads + Always consistent data
                    </text>
                    
                    <defs>
                        <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00BFFF" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#8A2BE2" />
                        </marker>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Client-Side Cache</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Simple Implementation</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> threading

<span class="keyword">class</span> <span class="function">ClientSideCache</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self):
        <span class="comment"># Main connection for commands</span>
        self.redis = redis.Redis()
        
        <span class="comment"># Separate connection for tracking</span>
        self.tracking = redis.Redis()
        
        <span class="comment"># Local cache</span>
        self.cache = {}
        
        <span class="comment"># Enable tracking</span>
        self.tracking.execute_command(<span class="string">'CLIENT'</span>, <span class="string">'TRACKING'</span>, <span class="string">'ON'</span>)
        
        <span class="comment"># Start invalidation listener</span>
        self._start_listener()
    
    <span class="keyword">def</span> <span class="function">_start_listener</span>(self):
        <span class="string">"""Listen for invalidation messages"""</span>
        <span class="keyword">def</span> <span class="function">listen</span>():
            pubsub = self.tracking.pubsub()
            <span class="comment"># Subscribe to invalidation channel</span>
            pubsub.subscribe(<span class="string">'__redis__:invalidate'</span>)
            
            <span class="keyword">for</span> message <span class="keyword">in</span> pubsub.listen():
                <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'message'</span>:
                    <span class="comment"># Keys to invalidate</span>
                    keys = message[<span class="string">'data'</span>]
                    <span class="keyword">for</span> key <span class="keyword">in</span> keys:
                        self.cache.pop(key, <span class="keyword">None</span>)
                        <span class="keyword">print</span>(<span class="string">f"üóëÔ∏è Invalidated: {key}"</span>)
        
        thread = threading.Thread(target=listen, daemon=<span class="keyword">True</span>)
        thread.start()
    
    <span class="keyword">def</span> <span class="function">get</span>(self, key):
        <span class="string">"""Get with client-side cache"""</span>
        <span class="comment"># Check local cache first</span>
        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:
            <span class="keyword">print</span>(<span class="string">f"‚úÖ Cache HIT: {key}"</span>)
            <span class="keyword">return</span> self.cache[key]
        
        <span class="comment"># Cache miss - fetch from Redis</span>
        value = self.redis.get(key)
        <span class="keyword">if</span> value:
            self.cache[key] = value
            <span class="keyword">print</span>(<span class="string">f"üì• Cache MISS: {key} (fetched)"</span>)
        
        <span class="keyword">return</span> value

<span class="comment"># Usage</span>
cache = ClientSideCache()
cache.get(<span class="string">'user:123'</span>)  <span class="comment"># Miss, fetch from Redis</span>
cache.get(<span class="string">'user:123'</span>)  <span class="comment"># HIT, instant from local</span>
<span class="comment"># Another client: SET user:123 "new value"</span>
<span class="comment"># ‚Üí Invalidation triggered automatically!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: BCAST Mode (Prefix-Based)</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Broadcast Tracking</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># BCAST mode: Track by prefix, not exact keys</span>
<span class="comment"># Useful when you cache many related keys</span>

<span class="keyword">def</span> <span class="function">enable_bcast_tracking</span>():
    <span class="string">"""Enable broadcast mode for prefix matching"""</span>
    r = redis.Redis()
    
    <span class="comment"># Track all keys with 'user:' prefix</span>
    r.execute_command(
        <span class="string">'CLIENT'</span>, <span class="string">'TRACKING'</span>, <span class="string">'ON'</span>,
        <span class="string">'BCAST'</span>,
        <span class="string">'PREFIX'</span>, <span class="string">'user:'</span>,
        <span class="string">'PREFIX'</span>, <span class="string">'product:'</span>
    )
    
    <span class="keyword">print</span>(<span class="string">"‚úÖ BCAST tracking enabled for user: and product: prefixes"</span>)

<span class="comment"># Now ANY change to user:* or product:* triggers invalidation</span>
<span class="comment"># More notifications but simpler (don't track exact keys)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Production-Ready Cache</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - With TTL and Stats</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> time

<span class="keyword">class</span> <span class="function">ProductionCache</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self, max_size=<span class="number">10000</span>, ttl=<span class="number">300</span>):
        self.cache = {}  <span class="comment"># {key: (value, timestamp)}</span>
        self.max_size = max_size
        self.ttl = ttl
        self.stats = {<span class="string">'hits'</span>: <span class="number">0</span>, <span class="string">'misses'</span>: <span class="number">0</span>, <span class="string">'invalidations'</span>: <span class="number">0</span>}
    
    <span class="keyword">def</span> <span class="function">get</span>(self, key):
        <span class="comment"># Check cache</span>
        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:
            value, timestamp = self.cache[key]
            
            <span class="comment"># Check TTL</span>
            <span class="keyword">if</span> time.time() - timestamp < self.ttl:
                self.stats[<span class="string">'hits'</span>] += <span class="number">1</span>
                <span class="keyword">return</span> value
            <span class="keyword">else</span>:
                <span class="comment"># Expired</span>
                <span class="keyword">del</span> self.cache[key]
        
        <span class="comment"># Cache miss</span>
        self.stats[<span class="string">'misses'</span>] += <span class="number">1</span>
        value = self._fetch_from_redis(key)
        
        <span class="comment"># Store in cache (with size limit)</span>
        <span class="keyword">if</span> <span class="function">len</span>(self.cache) >= self.max_size:
            <span class="comment"># Evict oldest (simple LRU)</span>
            oldest = <span class="function">min</span>(self.cache.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>][<span class="number">1</span>])
            <span class="keyword">del</span> self.cache[oldest[<span class="number">0</span>]]
        
        self.cache[key] = (value, time.time())
        <span class="keyword">return</span> value
    
    <span class="keyword">def</span> <span class="function">invalidate</span>(self, key):
        <span class="string">"""Called by invalidation listener"""</span>
        <span class="keyword">if</span> key <span class="keyword">in</span> self.cache:
            <span class="keyword">del</span> self.cache[key]
            self.stats[<span class="string">'invalidations'</span>] += <span class="number">1</span>
    
    <span class="keyword">def</span> <span class="function">get_stats</span>(self):
        total = self.stats[<span class="string">'hits'</span>] + self.stats[<span class="string">'misses'</span>]
        hit_rate = (self.stats[<span class="string">'hits'</span>] / total * <span class="number">100</span>) <span class="keyword">if</span> total > <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>
        
        <span class="keyword">return</span> {
            <span class="string">'hit_rate'</span>: <span class="string">f'{hit_rate:.1f}%'</span>,
            <span class="string">'cache_size'</span>: <span class="function">len</span>(self.cache),
            **self.stats
        }</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Default mode vs BCAST mode - which to use?</h4>
                <p><strong>A:</strong> Default: Tracks exact keys accessed (precise, fewer notifications). BCAST: Tracks prefixes (simpler, more notifications). Use default when: Specific keys cached. Use BCAST when: Cache entire namespaces (user:*, product:*)!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What happens if invalidation message lost?</h4>
                <p><strong>A:</strong> Stale data! Solution: Add TTL to local cache (5-60 seconds). Ensures refresh even without invalidation. Trade-off: Eventual consistency vs guaranteed freshness. Production: Always use TTL as safety net!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Client-side cache size limit?</h4>
                <p><strong>A:</strong> Set max size (10K-100K items typical). Implement LRU eviction. Monitor memory usage. Don't cache everything - cache hot 20% that gets 80% of requests. Too big = memory waste, too small = low hit rate!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Does CLIENT TRACKING work with Cluster?</h4>
                <p><strong>Answer:</strong> YES but REDIRECT mode required! Each node tracks separately. Use CLIENT TRACKING ON REDIRECT <node_id>. Invalidations sent to redirect node. More complex setup but works!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Invalidation for EXPIRE vs DEL - different?</h4>
                <p><strong>Answer:</strong> NO! Both trigger invalidation. EXPIRE, DEL, SET all invalidate. Even lazy expiration (key accessed after TTL). All modifications = invalidation. Consistent behavior!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: API Performance Optimization</strong></p>
            <p>API makes 500 Redis GET calls per request. 2ms network latency √ó 500 = 1 second wasted!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Client-Side Cache</h4>
                <p><strong>Implementation:</strong> Enable CLIENT TRACKING, cache GET responses locally, TTL 30 seconds<br>
                <strong>Results after 1 hour:</strong> Hit rate 95% (475/500 requests from local cache)<br>
                <strong>Latency improvement:</strong> 500 √ó 2ms ‚Üí 25 √ó 2ms + 475 √ó 0.1ms = 100ms (90% reduction!)<br>
                <strong>Redis load:</strong> 500 req/sec ‚Üí 25 req/sec (95% reduction)</p>
                <p><strong>Impact:</strong> ‚úÖ API response 1000ms ‚Üí 150ms ‚úÖ Redis capacity 10x ‚úÖ Cost savings $2K/month ‚úÖ Same data freshness (invalidations work!)</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üöÄ</span><p><strong>CLIENT TRACKING ON</strong> - Enable server-side tracking</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì±</span><p><strong>Local cache</strong> - Store GET responses in memory</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîî</span><p><strong>Invalidation</strong> - Pub/Sub notifications on changes</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>Add TTL</strong> - Safety net for lost messages</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>70% fewer calls</strong> - Massive Redis load reduction</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>10x faster reads</strong> - Sub-millisecond access</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Client Caching</span><span class="keyword-tag">TRACKING</span><span class="keyword-tag">Invalidation</span><span class="keyword-tag">Two-Tier</span><span class="keyword-tag">Performance</span><span class="keyword-tag">BCAST</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Application makes 1000 Redis GETs/sec with 95% cache hit rate possible. Best optimization?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Add read replicas</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Enable CLIENT TRACKING with local cache</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Use pipeline for batching</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Upgrade to faster network</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - CLIENT TRACKING with local cache</strong>
                    <p>Client-side cache perfect! 95% hit rate = 950/1000 from local memory (0.1ms). Only 50 Redis calls. Reduces load 95%, improves latency 10x. Read replicas don't help (still network latency). Pipeline good but doesn't reduce calls. Network upgrade expensive. CLIENT TRACKING = best ROI!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 78: Redis Data Migration Strategies
// ============================================================

function getQuestion78Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Migration crisis:</strong> "Need to migrate 50GB Redis from old server to new cluster. Zero downtime required! Can't lose data! How?" Engineer: "Three options: (1) DUMP/RESTORE for offline, (2) Replication for online sync, (3) Dual-write during cutover. Choose replication: Setup replica ‚Üí Wait for sync ‚Üí Promote replica ‚Üí Redirect clients. Zero downtime achieved!"</p>
            <p>Migration = careful planning.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis migration strategies: (1) DUMP/RESTORE: Per-key export/import (works cross-version), (2) RDB file copy: Faster bulk transfer, (3) Replication: Live sync with REPLICAOF, (4) redis-cli --rdb: Stream RDB to new instance, (5) Dual-write: Write to both old and new during transition. Choose based on: downtime tolerance, data size, version compatibility.</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Migration Approaches Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Method</th><th style="padding: 10px;">Downtime</th><th style="padding: 10px;">Speed</th><th style="padding: 10px;">Use Case</th></tr>
                    <tr><td style="padding: 8px;">DUMP/RESTORE</td><td>Required</td><td>Slow (per-key)</td><td>Small datasets, selective migration</td></tr>
                    <tr><td style="padding: 8px;">RDB Copy</td><td>Required</td><td>Fast (bulk)</td><td>Complete migration, same version</td></tr>
                    <tr><td style="padding: 8px;">Replication</td><td>Zero</td><td>Fast</td><td>Production, zero-downtime</td></tr>
                    <tr><td style="padding: 8px;">redis-cli --rdb</td><td>Zero</td><td>Medium</td><td>Cross-network, remote sync</td></tr>
                    <tr><td style="padding: 8px;">Dual-write</td><td>Zero</td><td>N/A</td><td>Complex transitions, testing</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Migration Checklist:</strong></p>
                <ul>
                    <li><strong>Before:</strong> Backup data, test migration on staging, plan rollback</li>
                    <li><strong>During:</strong> Monitor replication lag, verify data integrity</li>
                    <li><strong>After:</strong> Compare key counts, validate TTLs, performance test</li>
                    <li><strong>Rollback plan:</strong> Keep old instance running 24-48 hours</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Zero-Downtime Migration Flow</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Replication-Based Migration</text>
                    
                    <!-- Step 1 -->
                    <rect x="50" y="60" width="180" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="3" rx="6"/>
                    <text x="140" y="85" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="700">Step 1: Old Master</text>
                    <text x="60" y="105" fill="#888" font-size="10">Production traffic</text>
                    <text x="60" y="120" fill="#888" font-size="10">50GB data</text>
                    
                    <rect x="50" y="160" width="180" height="50" fill="rgba(0,191,255,0.2)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="140" y="190" text-anchor="middle" fill="#00BFFF" font-size="12">Application Servers</text>
                    
                    <path d="M 140 160 L 140 140" stroke="#00BFFF" stroke-width="2" marker-end="url(#arrowBlue)"/>
                    <text x="150" y="150" fill="#00BFFF" font-size="9">Read/Write</text>
                    
                    <!-- Step 2 -->
                    <rect x="280" y="60" width="180" height="80" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="370" y="85" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="700">Step 2: New Instance</text>
                    <text x="290" y="105" fill="#888" font-size="10">REPLICAOF old_host port</text>
                    <text x="290" y="120" fill="#888" font-size="10">Syncing data...</text>
                    
                    <path d="M 230 100 L 280 100" stroke="#FFA500" stroke-width="3" marker-end="url(#arrowOrange)"/>
                    <text x="250" y="90" fill="#FFA500" font-size="9">RDB + AOF</text>
                    
                    <!-- Step 3 -->
                    <rect x="510" y="60" width="180" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="3" rx="6"/>
                    <text x="600" y="85" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="700">Step 3: Synced!</text>
                    <text x="520" y="105" fill="#888" font-size="10">REPLICAOF NO ONE</text>
                    <text x="520" y="120" fill="#888" font-size="10">Now independent master</text>
                    
                    <path d="M 460 100 L 510 100" stroke="#00FF88" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="475" y="90" fill="#00FF88" font-size="9">Promote</text>
                    
                    <!-- Step 4 -->
                    <rect x="740" y="160" width="140" height="50" fill="rgba(138,43,226,0.2)" stroke="#8A2BE2" stroke-width="2" rx="6"/>
                    <text x="810" y="190" text-anchor="middle" fill="#8A2BE2" font-size="12">Redirect Apps</text>
                    
                    <path d="M 600 140 L 740 185" stroke="#8A2BE2" stroke-width="2" marker-end="url(#arrowPurple)"/>
                    <text x="665" y="155" fill="#8A2BE2" font-size="9">Update config</text>
                    
                    <!-- Timeline -->
                    <rect x="50" y="260" width="800" height="120" fill="rgba(0,0,0,0.05)" stroke="#666" stroke-width="2" rx="6"/>
                    <text x="450" y="285" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">Migration Timeline</text>
                    
                    <text x="70" y="310" fill="#888" font-size="11" font-weight="600">T+0min: Setup replication</text>
                    <text x="80" y="325" fill="#888" font-size="9">REPLICAOF old_master 6379</text>
                    
                    <text x="70" y="345" fill="#888" font-size="11" font-weight="600">T+30min: Full sync complete</text>
                    <text x="80" y="360" fill="#888" font-size="9">INFO replication: master_link_status:up</text>
                    
                    <text x="470" y="310" fill="#888" font-size="11" font-weight="600">T+31min: Promote new master</text>
                    <text x="480" y="325" fill="#888" font-size="9">REPLICAOF NO ONE</text>
                    
                    <text x="470" y="345" fill="#888" font-size="11" font-weight="600">T+32min: Redirect clients</text>
                    <text x="480" y="360" fill="#888" font-size="9">Update config, restart apps</text>
                    
                    <rect x="50" y="395" width="800" height="20" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="450" y="410" text-anchor="middle" fill="#00FF88" font-size="10">
                        ‚úÖ Zero data loss + Zero downtime + Total time: 32 minutes for 50GB
                    </text>
                    
                    <defs>
                        <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00BFFF" />
                        </marker>
                        <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#FFA500" />
                        </marker>
                        <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#8A2BE2" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: DUMP/RESTORE Migration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Selective Key Migration</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

old_redis = redis.Redis(host=<span class="string">'old-server'</span>, port=<span class="number">6379</span>)
new_redis = redis.Redis(host=<span class="string">'new-server'</span>, port=<span class="number">6379</span>)

<span class="keyword">def</span> <span class="function">migrate_keys</span>(pattern=<span class="string">'*'</span>, batch_size=<span class="number">1000</span>):
    <span class="string">"""Migrate keys matching pattern"""</span>
    migrated = <span class="number">0</span>
    failed = []
    
    <span class="comment"># Scan for keys (don't use KEYS *!)</span>
    <span class="keyword">for</span> key <span class="keyword">in</span> old_redis.scan_iter(match=pattern, count=batch_size):
        <span class="keyword">try</span>:
            <span class="comment"># DUMP: Serialize key+value+TTL</span>
            dump_data = old_redis.dump(key)
            ttl = old_redis.pttl(key)  <span class="comment"># Milliseconds</span>
            
            <span class="comment"># Handle TTL edge cases</span>
            <span class="keyword">if</span> ttl == <span class="number">-2</span>:  <span class="comment"># Key doesn't exist (expired between SCAN and DUMP)</span>
                <span class="keyword">continue</span>
            <span class="keyword">elif</span> ttl == <span class="number">-1</span>:  <span class="comment"># No expiry</span>
                ttl = <span class="number">0</span>
            
            <span class="comment"># RESTORE: Deserialize to new instance</span>
            <span class="comment"># REPLACE flag: Overwrite if exists</span>
            new_redis.restore(key, ttl, dump_data, replace=<span class="keyword">True</span>)
            
            migrated += <span class="number">1</span>
            
            <span class="keyword">if</span> migrated % <span class="number">1000</span> == <span class="number">0</span>:
                <span class="keyword">print</span>(<span class="string">f"‚úÖ Migrated {migrated} keys..."</span>)
                
        <span class="keyword">except</span> <span class="function">Exception</span> <span class="keyword">as</span> e:
            failed.append((key, <span class="function">str</span>(e)))
            <span class="keyword">print</span>(<span class="string">f"‚ùå Failed {key}: {e}"</span>)
    
    <span class="keyword">print</span>(<span class="string">f"\nüéâ Migration complete!"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Migrated: {migrated}"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Failed: {len(failed)}"</span>)
    
    <span class="keyword">return</span> migrated, failed

<span class="comment"># Migrate specific namespace</span>
migrate_keys(pattern=<span class="string">'user:*'</span>)

<span class="comment"># Verify migration</span>
old_count = old_redis.dbsize()
new_count = new_redis.dbsize()
<span class="keyword">print</span>(<span class="string">f"Old: {old_count} keys, New: {new_count} keys"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Replication-Based Migration</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Bash - Zero-Downtime Migration</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment">#!/bin/bash</span>
<span class="comment"># Zero-downtime migration script</span>

OLD_HOST=<span class="string">"old-server.com"</span>
NEW_HOST=<span class="string">"new-server.com"</span>

<span class="keyword">echo</span> <span class="string">"Step 1: Setup replication"</span>
redis-cli -h <span class="variable">$NEW_HOST</span> REPLICAOF <span class="variable">$OLD_HOST</span> <span class="number">6379</span>

<span class="keyword">echo</span> <span class="string">"Step 2: Wait for full sync..."</span>
<span class="keyword">while</span> <span class="keyword">true</span>; <span class="keyword">do</span>
    STATUS=$(redis-cli -h <span class="variable">$NEW_HOST</span> INFO replication | grep master_link_status)
    <span class="keyword">if</span> [[ <span class="variable">$STATUS</span> == *<span class="string">"up"</span>* ]]; <span class="keyword">then</span>
        <span class="keyword">echo</span> <span class="string">"‚úÖ Sync complete!"</span>
        <span class="keyword">break</span>
    <span class="keyword">fi</span>
    <span class="keyword">echo</span> <span class="string">"‚è≥ Syncing... $(date)"</span>
    sleep <span class="number">10</span>
<span class="keyword">done</span>

<span class="keyword">echo</span> <span class="string">"Step 3: Check replication lag"</span>
LAG=$(redis-cli -h <span class="variable">$NEW_HOST</span> INFO replication | grep master_repl_offset)
<span class="keyword">echo</span> <span class="variable">$LAG</span>

<span class="keyword">echo</span> <span class="string">"Step 4: Promote new instance to master"</span>
redis-cli -h <span class="variable">$NEW_HOST</span> REPLICAOF NO ONE
<span class="keyword">echo</span> <span class="string">"‚úÖ New instance is now master!"</span>

<span class="keyword">echo</span> <span class="string">"Step 5: Verify data"</span>
OLD_COUNT=$(redis-cli -h <span class="variable">$OLD_HOST</span> DBSIZE)
NEW_COUNT=$(redis-cli -h <span class="variable">$NEW_HOST</span> DBSIZE)
<span class="keyword">echo</span> <span class="string">"Old: <span class="variable">$OLD_COUNT</span> keys, New: <span class="variable">$NEW_COUNT</span> keys"</span>

<span class="keyword">echo</span> <span class="string">""</span>
<span class="keyword">echo</span> <span class="string">"üéâ Migration complete!"</span>
<span class="keyword">echo</span> <span class="string">"Next: Update application config to use <span class="variable">$NEW_HOST</span>"</span>
<span class="keyword">echo</span> <span class="string">"Keep old server running for 24-48 hours as backup"</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Dual-Write Pattern</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Write to Both During Transition</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">class</span> <span class="function">DualWriteRedis</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self, old_host, new_host):
        self.old_redis = redis.Redis(host=old_host)
        self.new_redis = redis.Redis(host=new_host)
        self.read_from = <span class="string">'new'</span>  <span class="comment"># 'old' or 'new'</span>
    
    <span class="keyword">def</span> <span class="function">set</span>(self, key, value, ex=<span class="keyword">None</span>):
        <span class="string">"""Write to both instances"""</span>
        <span class="keyword">try</span>:
            <span class="comment"># Primary write (new instance)</span>
            self.new_redis.set(key, value, ex=ex)
            
            <span class="keyword">try</span>:
                <span class="comment"># Secondary write (old instance, best effort)</span>
                self.old_redis.set(key, value, ex=ex)
            <span class="keyword">except</span>:
                <span class="comment"># Log but don't fail (new is source of truth)</span>
                <span class="keyword">print</span>(<span class="string">f"‚ö†Ô∏è Secondary write failed for {key}"</span>)
                
        <span class="keyword">except</span> <span class="function">Exception</span> <span class="keyword">as</span> e:
            <span class="comment"># Fallback to old</span>
            <span class="keyword">print</span>(<span class="string">f"‚ùå New instance failed, using old: {e}"</span>)
            self.old_redis.set(key, value, ex=ex)
    
    <span class="keyword">def</span> <span class="function">get</span>(self, key):
        <span class="string">"""Read from configured source"""</span>
        <span class="keyword">if</span> self.read_from == <span class="string">'new'</span>:
            <span class="keyword">try</span>:
                <span class="keyword">return</span> self.new_redis.get(key)
            <span class="keyword">except</span>:
                <span class="comment"># Fallback to old</span>
                <span class="keyword">return</span> self.old_redis.get(key)
        <span class="keyword">else</span>:
            <span class="keyword">return</span> self.old_redis.get(key)
    
    <span class="keyword">def</span> <span class="function">switch_to_new</span>(self):
        <span class="string">"""Switch reads to new instance"""</span>
        self.read_from = <span class="string">'new'</span>
        <span class="keyword">print</span>(<span class="string">"‚úÖ Now reading from new instance"</span>)

<span class="comment"># Usage during migration</span>
redis_client = DualWriteRedis(<span class="string">'old-server'</span>, <span class="string">'new-server'</span>)
redis_client.set(<span class="string">'user:123'</span>, <span class="string">'data'</span>)  <span class="comment"># Written to both</span>

<span class="comment"># After verifying new instance is stable</span>
redis_client.switch_to_new()  <span class="comment"># Start reading from new</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: DUMP vs RDB file copy - which is faster?</h4>
                <p><strong>A:</strong> RDB copy MUCH faster! DUMP = per-key serialization (slow for millions of keys). RDB = single file copy (GB/sec). Use DUMP for: Selective migration, cross-version. Use RDB for: Complete migration, speed critical!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: How to verify migration success?</h4>
                <p><strong>A:</strong> Check: (1) DBSIZE matches, (2) Random key sampling (GET old vs new), (3) INFO keyspace (key count per DB), (4) TTL verification, (5) Performance test. Always verify BEFORE switching production!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: What if migration fails midway?</h4>
                <p><strong>A:</strong> Rollback plan essential! Keep old instance running. Replication-based: Just switch back (REPLICAOF old). DUMP/RESTORE: Stop, keep old running. Always have rollback tested before migration!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: RESTORE with REPLACE flag - when to use?</h4>
                <p><strong>Answer:</strong> When key might already exist on target! Without REPLACE: RESTORE fails if key exists. With REPLACE: Overwrites existing key. Always use REPLACE for idempotent migrations (can re-run safely)!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Replication lag during migration - acceptable?</h4>
                <p><strong>Answer:</strong> Initially yes (full sync takes time). Before cutover: Lag must be <1 second! Check: master_repl_offset on both instances. If lag high: Wait or investigate (network, load). Zero lag = safe to promote!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Migrate Production Redis Cluster</strong></p>
            <p>50GB database, 10K writes/sec, zero downtime required, 4-hour maintenance window!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Replication + Traffic Shift</h4>
                <p><strong>T+0:00:</strong> Setup new cluster as replica (REPLICAOF old_master)<br>
                <strong>T+0:30:</strong> Full sync complete (50GB transferred)<br>
                <strong>T+0:31:</strong> Verify: Replication lag <100ms, key count matches<br>
                <strong>T+0:35:</strong> Promote new cluster (REPLICAOF NO ONE)<br>
                <strong>T+0:40:</strong> Update load balancer to new cluster<br>
                <strong>T+0:45:</strong> Monitor: No errors, performance good<br>
                <strong>T+24:00:</strong> Decommission old cluster (after 24hr safety period)</p>
                <p><strong>Results:</strong> ‚úÖ Zero data loss ‚úÖ Zero downtime ‚úÖ 45-minute cutover ‚úÖ Smooth rollback available ‚úÖ Production stable</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Replication best</strong> - Zero downtime, fast sync</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>DUMP/RESTORE</strong> - Per-key, cross-version compatible</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>RDB copy fastest</strong> - Bulk transfer for complete migration</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚úÖ</span><p><strong>Always verify</strong> - DBSIZE, sampling, TTLs</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîô</span><p><strong>Rollback plan</strong> - Keep old instance 24-48 hours</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor lag</strong> - <1s before cutover</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Migration</span><span class="keyword-tag">DUMP</span><span class="keyword-tag">RESTORE</span><span class="keyword-tag">Replication</span><span class="keyword-tag">Zero-Downtime</span><span class="keyword-tag">RDB</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Migrate 100GB production Redis. Zero downtime required. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) DUMP/RESTORE all keys</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Setup replication, then promote replica</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Copy RDB file during maintenance window</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Dual-write during transition period</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Setup replication, then promote replica</strong>
                    <p>Replication perfect for zero-downtime! New instance syncs as replica (background, no downtime). When sync complete: REPLICAOF NO ONE promotes to independent master. Redirect traffic. DUMP/RESTORE too slow for 100GB. RDB copy requires downtime. Dual-write complex and risky. Replication = industry standard for zero-downtime migrations!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 79: Redis Performance Benchmarking
// ============================================================

function getQuestion79Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Performance validation:</strong> "Boss asks: Can Redis handle 100K req/sec for our app? Need proof before production!" Engineer: "Run redis-benchmark! Baseline: 45K ops/sec. Enable pipeline (-P 10): 450K ops/sec! 10x improvement! Add connection pooling: 500K ops/sec. Yes, Redis can handle it!"</p>
            <p>Benchmark = prove performance.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis benchmarking: redis-benchmark tool tests throughput and latency. Key flags: -t (test types), -n (requests), -c (clients), -P (pipeline), -q (quiet). Pipeline critical: 10x+ throughput improvement. Measure: ops/sec, p50/p95/p99 latency. Production factors: Network latency, persistence (AOF/RDB), key/value size, CPU cores. Always benchmark YOUR workload!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Benchmark Command Reference</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Flag</th><th style="padding: 10px;">Purpose</th><th style="padding: 10px;">Example</th></tr>
                    <tr><td style="padding: 8px;">-t</td><td>Test types</td><td>-t get,set,lpush</td></tr>
                    <tr><td style="padding: 8px;">-n</td><td>Total requests</td><td>-n 1000000</td></tr>
                    <tr><td style="padding: 8px;">-c</td><td>Parallel clients</td><td>-c 50</td></tr>
                    <tr><td style="padding: 8px;">-P</td><td>Pipeline (batch)</td><td>-P 10 (10 commands/request)</td></tr>
                    <tr><td style="padding: 8px;">-q</td><td>Quiet mode</td><td>-q (summary only)</td></tr>
                    <tr><td style="padding: 8px;">-d</td><td>Data size</td><td>-d 1024 (1KB values)</td></tr>
                    <tr><td style="padding: 8px;">--csv</td><td>CSV output</td><td>--csv > results.csv</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Performance Factors:</strong></p>
                <ul>
                    <li><strong>Pipeline:</strong> Biggest impact (10x+ throughput)</li>
                    <li><strong>Network:</strong> Localhost vs remote (2ms latency = huge difference)</li>
                    <li><strong>Persistence:</strong> AOF everysec vs always (3x difference)</li>
                    <li><strong>Value size:</strong> 100 bytes vs 10KB (5x difference)</li>
                    <li><strong>Commands:</strong> GET faster than complex operations</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Benchmark Results Comparison</div>
                <svg viewBox="0 0 900 380" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Pipeline Impact on Throughput</text>
                    
                    <!-- Chart -->
                    <rect x="100" y="60" width="700" height="250" fill="rgba(0,0,0,0.02)" stroke="#666" stroke-width="1"/>
                    
                    <!-- Y-axis labels -->
                    <text x="80" y="310" text-anchor="end" fill="#888" font-size="11">0</text>
                    <text x="80" y="245" text-anchor="end" fill="#888" font-size="11">100K</text>
                    <text x="80" y="180" text-anchor="end" fill="#888" font-size="11">200K</text>
                    <text x="80" y="115" text-anchor="end" fill="#888" font-size="11">300K</text>
                    <text x="80" y="70" text-anchor="end" fill="#888" font-size="11">400K</text>
                    
                    <text x="50" y="180" text-anchor="middle" fill="#888" font-size="12" transform="rotate(-90 50 180)">Requests/sec</text>
                    
                    <!-- Bar 1: No Pipeline -->
                    <rect x="150" y="260" width="120" height="50" fill="rgba(255,69,0,0.3)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="210" y="240" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="600">45K</text>
                    <text x="210" y="340" text-anchor="middle" fill="#888" font-size="11">No Pipeline</text>
                    <text x="210" y="355" text-anchor="middle" fill="#888" font-size="9">-P 1 (default)</text>
                    
                    <!-- Bar 2: Pipeline 5 -->
                    <rect x="320" y="150" width="120" height="160" fill="rgba(255,165,0,0.3)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="380" y="130" text-anchor="middle" fill="#FFA500" font-size="14" font-weight="600">180K</text>
                    <text x="380" y="340" text-anchor="middle" fill="#888" font-size="11">Pipeline 5</text>
                    <text x="380" y="355" text-anchor="middle" fill="#888" font-size="9">-P 5</text>
                    
                    <!-- Bar 3: Pipeline 10 -->
                    <rect x="490" y="90" width="120" height="220" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="3" rx="4"/>
                    <text x="550" y="70" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="700">350K</text>
                    <text x="550" y="340" text-anchor="middle" fill="#888" font-size="11">Pipeline 10</text>
                    <text x="550" y="355" text-anchor="middle" fill="#888" font-size="9">-P 10 ‚≠ê</text>
                    
                    <!-- Bar 4: Pipeline 20 -->
                    <rect x="660" y="85" width="120" height="225" fill="rgba(220,20,60,0.3)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="720" y="65" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="600">370K</text>
                    <text x="720" y="340" text-anchor="middle" fill="#888" font-size="11">Pipeline 20</text>
                    <text x="720" y="355" text-anchor="middle" fill="#888" font-size="9">-P 20 (diminishing)</text>
                    
                    <!-- Improvement annotation -->
                    <path d="M 210 280 L 550 280" stroke="#00FF88" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="380" y="270" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">7.8x improvement!</text>
                    
                    <rect x="100" y="368" width="700" height="8" fill="rgba(0,0,0,0.1)" rx="2"/>
                    <text x="450" y="345" text-anchor="middle" fill="#888" font-size="10">Configuration</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Benchmarking</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Bash - redis-benchmark Commands</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Basic benchmark - GET and SET</span>
redis-benchmark -t get,set -n <span class="number">100000</span> -q

<span class="comment"># Results:</span>
<span class="comment"># SET: 45234.23 requests per second</span>
<span class="comment"># GET: 48512.34 requests per second</span>

<span class="comment"># -------------------------------------------</span>

<span class="comment"># With pipeline (10 commands per request)</span>
redis-benchmark -t get,set -n <span class="number">100000</span> -P <span class="number">10</span> -q

<span class="comment"># Results:</span>
<span class="comment"># SET: 452341.23 requests per second (10x faster!)</span>
<span class="comment"># GET: 485123.45 requests per second</span>

<span class="comment"># -------------------------------------------</span>

<span class="comment"># More parallel clients</span>
redis-benchmark -t get,set -n <span class="number">100000</span> -c <span class="number">100</span> -P <span class="number">10</span> -q

<span class="comment"># -------------------------------------------</span>

<span class="comment"># Specific data size (1KB values)</span>
redis-benchmark -t set -n <span class="number">10000</span> -d <span class="number">1024</span> -q

<span class="comment"># -------------------------------------------</span>

<span class="comment"># Full detailed output (not quiet)</span>
redis-benchmark -t get,set -n <span class="number">100000</span> -c <span class="number">50</span>

<span class="comment"># Shows percentile latencies:</span>
<span class="comment"># 50.00% <= 0.3 milliseconds</span>
<span class="comment"># 95.00% <= 0.5 milliseconds</span>
<span class="comment"># 99.00% <= 0.9 milliseconds</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Custom Benchmark Script</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Application-Specific Benchmark</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time
<span class="keyword">import</span> statistics

<span class="keyword">def</span> <span class="function">benchmark_operation</span>(operation_func, iterations=<span class="number">10000</span>):
    <span class="string">"""Benchmark custom operation"""</span>
    latencies = []
    
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(iterations):
        start = time.time()
        operation_func(i)
        latency = (time.time() - start) * <span class="number">1000</span>  <span class="comment"># ms</span>
        latencies.append(latency)
    
    <span class="comment"># Calculate statistics</span>
    latencies.sort()
    
    results = {
        <span class="string">'ops_per_sec'</span>: iterations / <span class="function">sum</span>(latencies) * <span class="number">1000</span>,
        <span class="string">'p50_ms'</span>: latencies[<span class="function">int</span>(<span class="function">len</span>(latencies) * <span class="number">0.50</span>)],
        <span class="string">'p95_ms'</span>: latencies[<span class="function">int</span>(<span class="function">len</span>(latencies) * <span class="number">0.95</span>)],
        <span class="string">'p99_ms'</span>: latencies[<span class="function">int</span>(<span class="function">len</span>(latencies) * <span class="number">0.99</span>)],
        <span class="string">'avg_ms'</span>: statistics.mean(latencies)
    }
    
    <span class="keyword">return</span> results

<span class="comment"># Benchmark your actual workload</span>
r = redis.Redis()

<span class="keyword">def</span> <span class="function">user_session_read</span>(i):
    <span class="string">"""Simulate reading user session"""</span>
    r.hgetall(<span class="string">f'session:user{i%1000}'</span>)

results = benchmark_operation(user_session_read)

<span class="keyword">print</span>(<span class="string">f"üìä Benchmark Results:"</span>)
<span class="keyword">print</span>(<span class="string">f"  Throughput: {results['ops_per_sec']:.0f} ops/sec"</span>)
<span class="keyword">print</span>(<span class="string">f"  p50 latency: {results['p50_ms']:.2f}ms"</span>)
<span class="keyword">print</span>(<span class="string">f"  p95 latency: {results['p95_ms']:.2f}ms"</span>)
<span class="keyword">print</span>(<span class="string">f"  p99 latency: {results['p99_ms']:.2f}ms"</span>)
<span class="keyword">print</span>(<span class="string">f"  Average: {results['avg_ms']:.2f}ms"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Before/After Optimization</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Performance Tuning Comparison</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># BEFORE: Individual commands</span>
<span class="keyword">def</span> <span class="function">slow_batch_get</span>(keys):
    results = []
    <span class="keyword">for</span> key <span class="keyword">in</span> keys:
        results.append(r.get(key))  <span class="comment"># 100 round trips!</span>
    <span class="keyword">return</span> results

start = time.time()
data = slow_batch_get([<span class="string">f'key:{i}'</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">100</span>)])
slow_time = time.time() - start
<span class="keyword">print</span>(<span class="string">f"‚ùå Slow: {slow_time*1000:.1f}ms"</span>)

<span class="comment"># -------------------------------------------</span>

<span class="comment"># AFTER: Pipeline</span>
<span class="keyword">def</span> <span class="function">fast_batch_get</span>(keys):
    pipe = r.pipeline()
    <span class="keyword">for</span> key <span class="keyword">in</span> keys:
        pipe.get(key)
    <span class="keyword">return</span> pipe.execute()  <span class="comment"># 1 round trip!</span>

start = time.time()
data = fast_batch_get([<span class="string">f'key:{i}'</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">100</span>)])
fast_time = time.time() - start
<span class="keyword">print</span>(<span class="string">f"‚úÖ Fast: {fast_time*1000:.1f}ms"</span>)

improvement = slow_time / fast_time
<span class="keyword">print</span>(<span class="string">f"\nüöÄ {improvement:.1f}x faster with pipeline!"</span>)

<span class="comment"># Output example:</span>
<span class="comment"># ‚ùå Slow: 205.3ms</span>
<span class="comment"># ‚úÖ Fast: 2.1ms</span>
<span class="comment"># üöÄ 97.8x faster with pipeline!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why does pipeline improve throughput so much?</h4>
                <p><strong>A:</strong> Eliminates network round-trips! Without pipeline: 100 commands = 100 round trips (200ms with 2ms latency). With pipeline: 100 commands = 1 round trip (2ms). Batching = massive win!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Localhost vs remote - how much difference?</h4>
                <p><strong>A:</strong> HUGE! Localhost <0.1ms RTT = 500K ops/sec. Remote 2ms RTT = 25K ops/sec (20x slower!). Network latency dominates. Always benchmark in production-like environment!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: AOF impact on benchmark?</h4>
                <p><strong>A:</strong> appendfsync everysec: ~5% slower. appendfsync always: ~50% slower (every write waits for disk!). Benchmark with production persistence settings for accuracy!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Why does -P 20 not double throughput vs -P 10?</h4>
                <p><strong>Answer:</strong> Diminishing returns! Pipeline 10 already saturates network/CPU. Pipeline 20 adds little benefit, increases latency. Sweet spot: -P 10 to 16. Beyond that: marginal gains, higher p99 latency!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Benchmark shows 500K ops/sec but production only 50K - why?</h4>
                <p><strong>Answer:</strong> Different workload! Benchmark uses: Localhost, simple GET/SET, small values, no persistence. Production has: Network latency, complex commands, large values, AOF enabled. Always benchmark YOUR actual workload!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Optimize API Performance</strong></p>
            <p>API making 200 Redis calls per request. Latency 400ms. Need <100ms!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Benchmark-Driven Optimization</h4>
                <p><strong>Baseline benchmark:</strong> 200 individual GET commands = 400ms<br>
                <strong>Optimization 1:</strong> Use pipeline ‚Üí 40ms (10x faster!)<br>
                <strong>Optimization 2:</strong> Use MGET instead ‚Üí 20ms (2x more!)<br>
                <strong>Optimization 3:</strong> Connection pooling ‚Üí 15ms (1.3x more!)<br>
                <strong>Optimization 4:</strong> Client-side caching ‚Üí 2ms (7.5x more!)</p>
                <p><strong>Results:</strong> ‚úÖ 400ms ‚Üí 2ms (200x faster!) ‚úÖ Each optimization validated by benchmark ‚úÖ Production confirms: <100ms target achieved!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Pipeline essential</strong> - 10x+ throughput improvement</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Measure p50/p95/p99</strong> - Not just average</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåê</span><p><strong>Network matters</strong> - Benchmark production network</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Persistence overhead</strong> - AOF always = 50% slower</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Benchmark YOUR workload</strong> - Not just GET/SET</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìà</span><p><strong>Before/after testing</strong> - Validate optimizations</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Benchmark</span><span class="keyword-tag">redis-benchmark</span><span class="keyword-tag">Performance</span><span class="keyword-tag">Pipeline</span><span class="keyword-tag">Throughput</span><span class="keyword-tag">Latency</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Benchmark shows 40K ops/sec. Need to prove 100K possible. Best optimization?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Add more -c (parallel clients)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Add -P 10 (pipeline)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Upgrade Redis server CPU</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Disable persistence</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Add -P 10 (pipeline)</strong>
                    <p>Pipeline BIGGEST win! 40K ‚Üí 400K+ ops/sec (10x!). Batches commands to eliminate network round-trips. More clients helps but limited (maybe 2x). CPU upgrade expensive and minor gain. Disabling persistence unsafe. Pipeline = free performance multiplier!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 80: Redis Time-Series Data Use Case
// ============================================================

function getQuestion80Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>IoT data explosion:</strong> "1 million sensors, each sending 1 reading/minute. Database can't keep up! 1M √ó 60 = 60M writes/hour!" Engineer: "Use Redis time-series! Sorted Set: timestamp as score, reading as member. Query last hour: ZRANGEBYSCORE. Downsample old data. Result: handles 16K writes/sec, queries <10ms!"</p>
            <p>Time-series = timestamped data at scale.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis for time-series data: (1) Sorted Sets: Timestamp as score for chronological ordering, (2) ZADD to append readings, (3) ZRANGEBYSCORE for time-range queries, (4) ZREMRANGEBYSCORE to expire old data, (5) RedisTimeSeries module for advanced features. Perfect for: IoT sensors, metrics, stock prices, logs. Challenge: Memory grows without downsampling/expiry!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Time-Series Patterns</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Operation</th><th style="padding: 10px;">Command</th><th style="padding: 10px;">Complexity</th></tr>
                    <tr><td style="padding: 8px;">Add reading</td><td>ZADD sensor:123 timestamp value</td><td>O(log N)</td></tr>
                    <tr><td style="padding: 8px;">Last hour</td><td>ZRANGEBYSCORE key start_ts end_ts</td><td>O(log N + M)</td></tr>
                    <tr><td style="padding: 8px;">Count readings</td><td>ZCOUNT key start_ts end_ts</td><td>O(log N)</td></tr>
                    <tr><td style="padding: 8px;">Latest value</td><td>ZREVRANGE key 0 0</td><td>O(log N)</td></tr>
                    <tr><td style="padding: 8px;">Delete old</td><td>ZREMRANGEBYSCORE key -inf old_ts</td><td>O(log N + M)</td></tr>
                    <tr><td style="padding: 8px;">Aggregate</td><td>Downsample to hourly avg</td><td>Custom script</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° Memory Management Strategies:</strong></p>
                <ul>
                    <li><strong>TTL on keys:</strong> Auto-delete old sensors (EXPIRE sensor:123 604800 = 7 days)</li>
                    <li><strong>Downsampling:</strong> 1-min data ‚Üí hourly averages after 24 hours</li>
                    <li><strong>Pruning:</strong> ZREMRANGEBYSCORE to delete readings >30 days</li>
                    <li><strong>Aggregation:</strong> Pre-calculate min/max/avg per hour</li>
                    <li><strong>Archive:</strong> Move old data to S3/TimescaleDB</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">IoT Time-Series Architecture</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Smart Home Sensor Data Flow</text>
                    
                    <!-- Sensors -->
                    <rect x="50" y="80" width="160" height="180" fill="rgba(0,191,255,0.1)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="130" y="105" text-anchor="middle" fill="#00BFFF" font-size="13" font-weight="600">üè† IoT Sensors</text>
                    
                    <rect x="70" y="120" width="120" height="30" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="1" rx="4"/>
                    <text x="130" y="140" text-anchor="middle" fill="#888" font-size="10">üå°Ô∏è Temp: 72¬∞F</text>
                    
                    <rect x="70" y="160" width="120" height="30" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="1" rx="4"/>
                    <text x="130" y="180" text-anchor="middle" fill="#888" font-size="10">üíß Humidity: 45%</text>
                    
                    <rect x="70" y="200" width="120" height="30" fill="rgba(138,43,226,0.2)" stroke="#8A2BE2" stroke-width="1" rx="4"/>
                    <text x="130" y="220" text-anchor="middle" fill="#888" font-size="10">‚ö° Power: 1.2kW</text>
                    
                    <text x="130" y="250" text-anchor="middle" fill="#888" font-size="9">1000 sensors √ó 1/min</text>
                    
                    <path d="M 210 170 L 280 170" stroke="#DC143C" stroke-width="3" marker-end="url(#arrowRed)"/>
                    <text x="240" y="160" fill="#DC143C" font-size="9">16K writes/sec</text>
                    
                    <!-- Redis Time-Series -->
                    <rect x="280" y="70" width="340" height="250" fill="rgba(220,20,60,0.1)" stroke="#DC143C" stroke-width="3" rx="8"/>
                    <text x="450" y="95" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">‚ö° Redis Time-Series</text>
                    
                    <rect x="300" y="110" width="300" height="190" fill="rgba(0,0,0,0.05)" stroke="#666" stroke-width="1" rx="4"/>
                    <text x="450" y="130" text-anchor="middle" fill="#888" font-size="11" font-family="monospace">Sorted Set: sensor:temp:123</text>
                    
                    <rect x="320" y="145" width="260" height="25" fill="rgba(255,165,0,0.15)" stroke="#FFA500" stroke-width="1" rx="3"/>
                    <text x="330" y="162" fill="#888" font-size="9" font-family="monospace">1705334400 ‚Üí 72.1</text>
                    
                    <rect x="320" y="175" width="260" height="25" fill="rgba(255,165,0,0.15)" stroke="#FFA500" stroke-width="1" rx="3"/>
                    <text x="330" y="192" fill="#888" font-size="9" font-family="monospace">1705334460 ‚Üí 72.3</text>
                    
                    <rect x="320" y="205" width="260" height="25" fill="rgba(255,165,0,0.15)" stroke="#FFA500" stroke-width="1" rx="3"/>
                    <text x="330" y="222" fill="#888" font-size="9" font-family="monospace">1705334520 ‚Üí 72.0</text>
                    
                    <text x="450" y="250" text-anchor="middle" fill="#888" font-size="9">... 1440 readings/day/sensor</text>
                    
                    <text x="450" y="275" text-anchor="middle" fill="#00FF88" font-size="10">üìä Query: ZRANGEBYSCORE (last hour)</text>
                    <text x="450" y="290" text-anchor="middle" fill="#888" font-size="9">Result: 60 readings in <5ms</text>
                    
                    <!-- Dashboard -->
                    <rect x="670" y="100" width="180" height="140" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="760" y="125" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">üì± Dashboard</text>
                    
                    <text x="680" y="150" fill="#888" font-size="10">Real-time graphs:</text>
                    <text x="690" y="168" fill="#888" font-size="9">‚Ä¢ Temp: 24-hour trend</text>
                    <text x="690" y="183" fill="#888" font-size="9">‚Ä¢ Power: Current usage</text>
                    <text x="690" y="198" fill="#888" font-size="9">‚Ä¢ Humidity: Weekly avg</text>
                    <text x="690" y="218" fill="#00FF88" font-size="10" font-weight="600">‚ö° <10ms query time</text>
                    
                    <path d="M 620 195 L 670 150" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    
                    <!-- Cleanup -->
                    <rect x="280" y="340" width="340" height="35" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="450" y="360" text-anchor="middle" fill="#FF6347" font-size="11" font-weight="600">üóëÔ∏è Auto-cleanup: Data >30 days deleted</text>
                    <text x="450" y="372" text-anchor="middle" fill="#888" font-size="9">ZREMRANGEBYSCORE sensor:* -inf old_timestamp</text>
                    
                    <defs>
                        <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#DC143C" />
                        </marker>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Basic Time-Series Operations</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Sensor Data Storage</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis()

<span class="keyword">def</span> <span class="function">record_sensor_reading</span>(sensor_id, value):
    <span class="string">"""Store sensor reading with timestamp"""</span>
    key = <span class="string">f'sensor:{sensor_id}'</span>
    timestamp = <span class="function">int</span>(time.time() * <span class="number">1000</span>)  <span class="comment"># Milliseconds</span>
    
    <span class="comment"># Store: timestamp as score, value as member</span>
    r.zadd(key, {<span class="function">str</span>(value): timestamp})
    
    <span class="comment"># Set TTL on key (30 days)</span>
    r.expire(key, <span class="number">2592000</span>)
    
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Recorded: sensor {sensor_id} = {value} at {timestamp}"</span>)

<span class="keyword">def</span> <span class="function">get_last_hour_readings</span>(sensor_id):
    <span class="string">"""Query readings from last hour"""</span>
    key = <span class="string">f'sensor:{sensor_id}'</span>
    
    <span class="comment"># Calculate time range</span>
    end_time = time.time() * <span class="number">1000</span>
    start_time = end_time - (<span class="number">3600</span> * <span class="number">1000</span>)  <span class="comment"># 1 hour ago</span>
    
    <span class="comment"># Get readings in time range</span>
    readings = r.zrangebyscore(
        key,
        start_time,
        end_time,
        withscores=<span class="keyword">True</span>
    )
    
    <span class="comment"># Format results</span>
    formatted = []
    <span class="keyword">for</span> value, timestamp <span class="keyword">in</span> readings:
        formatted.append({
            <span class="string">'value'</span>: <span class="function">float</span>(value),
            <span class="string">'timestamp'</span>: <span class="function">int</span>(timestamp),
            <span class="string">'time'</span>: time.ctime(timestamp/<span class="number">1000</span>)
        })
    
    <span class="keyword">return</span> formatted

<span class="keyword">def</span> <span class="function">get_latest_reading</span>(sensor_id):
    <span class="string">"""Get most recent reading"""</span>
    key = <span class="string">f'sensor:{sensor_id}'</span>
    
    <span class="comment"># Get highest score (latest timestamp)</span>
    latest = r.zrevrange(key, <span class="number">0</span>, <span class="number">0</span>, withscores=<span class="keyword">True</span>)
    
    <span class="keyword">if</span> latest:
        value, timestamp = latest[<span class="number">0</span>]
        <span class="keyword">return</span> <span class="function">float</span>(value), <span class="function">int</span>(timestamp)
    <span class="keyword">return</span> <span class="keyword">None</span>, <span class="keyword">None</span>

<span class="comment"># Usage</span>
record_sensor_reading(<span class="string">'temp_123'</span>, <span class="number">72.5</span>)
readings = get_last_hour_readings(<span class="string">'temp_123'</span>)
<span class="keyword">print</span>(<span class="string">f"Last hour: {len(readings)} readings"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Downsampling Strategy</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Reduce Memory with Aggregation</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> statistics

<span class="keyword">def</span> <span class="function">downsample_to_hourly</span>(sensor_id, days_old=<span class="number">1</span>):
    <span class="string">"""Convert 1-minute data to hourly averages"""</span>
    raw_key = <span class="string">f'sensor:{sensor_id}:raw'</span>
    hourly_key = <span class="string">f'sensor:{sensor_id}:hourly'</span>
    
    <span class="comment"># Time range: 24-48 hours ago</span>
    end_time = (time.time() - days_old * <span class="number">86400</span>) * <span class="number">1000</span>
    start_time = end_time - (<span class="number">86400</span> * <span class="number">1000</span>)
    
    <span class="comment"># Get raw data</span>
    raw_readings = r.zrangebyscore(raw_key, start_time, end_time, withscores=<span class="keyword">True</span>)
    
    <span class="keyword">if</span> <span class="keyword">not</span> raw_readings:
        <span class="keyword">return</span>
    
    <span class="comment"># Group by hour</span>
    hourly_data = {}
    <span class="keyword">for</span> value, timestamp <span class="keyword">in</span> raw_readings:
        hour = <span class="function">int</span>(timestamp / (<span class="number">3600</span> * <span class="number">1000</span>))
        <span class="keyword">if</span> hour <span class="keyword">not</span> <span class="keyword">in</span> hourly_data:
            hourly_data[hour] = []
        hourly_data[hour].append(<span class="function">float</span>(value))
    
    <span class="comment"># Calculate hourly averages</span>
    pipe = r.pipeline()
    <span class="keyword">for</span> hour, values <span class="keyword">in</span> hourly_data.items():
        avg = statistics.mean(values)
        hour_timestamp = hour * <span class="number">3600</span> * <span class="number">1000</span>
        
        <span class="comment"># Store hourly average</span>
        pipe.zadd(hourly_key, {<span class="function">str</span>(avg): hour_timestamp})
    
    pipe.execute()
    
    <span class="comment"># Delete raw data (already downsampled)</span>
    r.zremrangebyscore(raw_key, start_time, end_time)
    
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Downsampled {len(raw_readings)} readings to {len(hourly_data)} hourly avgs"</span>)
    <span class="keyword">print</span>(<span class="string">f"üìâ Saved {len(raw_readings) - len(hourly_data)} data points"</span>)

<span class="comment"># Run nightly to downsample old data</span>
downsample_to_hourly(<span class="string">'temp_123'</span>, days_old=<span class="number">1</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Pruning Old Data</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Auto-Cleanup</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">prune_old_data</span>(days_to_keep=<span class="number">30</span>):
    <span class="string">"""Delete data older than N days"""</span>
    cutoff_time = (time.time() - days_to_keep * <span class="number">86400</span>) * <span class="number">1000</span>
    
    <span class="comment"># Find all sensor keys</span>
    sensor_keys = r.keys(<span class="string">'sensor:*'</span>)
    
    total_deleted = <span class="number">0</span>
    
    <span class="keyword">for</span> key <span class="keyword">in</span> sensor_keys:
        <span class="comment"># Delete readings with timestamp < cutoff</span>
        deleted = r.zremrangebyscore(key, <span class="string">'-inf'</span>, cutoff_time)
        total_deleted += deleted
        
        <span class="comment"># If key now empty, delete it entirely</span>
        <span class="keyword">if</span> r.zcard(key) == <span class="number">0</span>:
            r.delete(key)
            <span class="keyword">print</span>(<span class="string">f"üóëÔ∏è Deleted empty key: {key}"</span>)
    
    <span class="keyword">print</span>(<span class="string">f"\n‚úÖ Pruning complete:"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Deleted {total_deleted} old readings"</span>)
    <span class="keyword">print</span>(<span class="string">f"  Kept last {days_to_keep} days of data"</span>)
    
    <span class="keyword">return</span> total_deleted

<span class="keyword">def</span> <span class="function">get_data_stats</span>(sensor_id):
    <span class="string">"""Get statistics about stored data"""</span>
    key = <span class="string">f'sensor:{sensor_id}'</span>
    
    total_readings = r.zcard(key)
    
    <span class="keyword">if</span> total_readings == <span class="number">0</span>:
        <span class="keyword">return</span> <span class="keyword">None</span>
    
    <span class="comment"># Get oldest and newest</span>
    oldest = r.zrange(key, <span class="number">0</span>, <span class="number">0</span>, withscores=<span class="keyword">True</span>)[<span class="number">0</span>][<span class="number">1</span>]
    newest = r.zrevrange(key, <span class="number">0</span>, <span class="number">0</span>, withscores=<span class="keyword">True</span>)[<span class="number">0</span>][<span class="number">1</span>]
    
    age_days = (newest - oldest) / (<span class="number">1000</span> * <span class="number">86400</span>)
    
    <span class="keyword">return</span> {
        <span class="string">'total_readings'</span>: total_readings,
        <span class="string">'oldest'</span>: time.ctime(oldest/<span class="number">1000</span>),
        <span class="string">'newest'</span>: time.ctime(newest/<span class="number">1000</span>),
        <span class="string">'days_of_data'</span>: age_days
    }

<span class="comment"># Schedule daily cleanup</span>
prune_old_data(days_to_keep=<span class="number">30</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why not use database for time-series?</h4>
                <p><strong>A:</strong> Speed! Redis: <1ms queries. Database: 10-100ms. For real-time dashboards, Redis essential. Use database for: Long-term storage, complex queries, analytics. Use Redis for: Hot data (hours/days), real-time visualization!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Memory explosion without downsampling?</h4>
                <p><strong>A:</strong> YES! 1000 sensors √ó 1 reading/min √ó 30 days = 43M data points. With downsampling: 1-min data kept 24h, then hourly ‚Üí 1000 √ó (1440 + 720) = 2.1M points. 20x reduction!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: RedisTimeSeries vs Sorted Sets?</h4>
                <p><strong>A:</strong> RedisTimeSeries: Built-in aggregation, compaction, better memory. Sorted Sets: Flexible, no module needed, good for simple cases. Use TimeSeries for: Complex downsampling, large scale. Use Sorted Sets for: Simple time-series, existing Redis!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Why milliseconds for timestamp not seconds?</h4>
                <p><strong>Answer:</strong> Precision! Multiple readings same second possible (high-frequency sensors). Milliseconds ensure unique timestamps. Also: Easier range queries (no decimal math). Production: Always use milliseconds for time-series!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: ZADD duplicate timestamp - what happens?</h4>
                <p><strong>Answer:</strong> Value OVERWRITES! Same score (timestamp) = replaces existing member. For multiple readings same timestamp: Use timestamp_sequence as score (e.g., 1705334400_001). Or: Use Lists with LPUSH if order-only needed!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Smart Factory Monitoring</strong></p>
            <p>500 machines, 20 sensors each (10K sensors). Each sensor: 1 reading/second. 10K writes/sec!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Tiered Time-Series Storage</h4>
                <p><strong>Hot tier (Redis):</strong> Last 1 hour at 1-second resolution ‚Üí 10K √ó 3600 = 36M points<br>
                <strong>Warm tier (Redis):</strong> 1-24 hours at 1-minute downsampled ‚Üí 10K √ó 1440 = 14.4M points<br>
                <strong>Cold tier (TimescaleDB):</strong> >24 hours hourly aggregates ‚Üí Archive<br>
                <strong>Dashboard queries:</strong> Last minute (hot), Last hour (warm), Historical (cold)</p>
                <p><strong>Results:</strong> ‚úÖ Handles 10K writes/sec ‚úÖ Queries <5ms ‚úÖ Memory: 12GB for 25 hours ‚úÖ Anomaly detection real-time ‚úÖ Historical analysis available</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Sorted Sets perfect</strong> - Timestamp as score</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>Milliseconds precision</strong> - Prevent duplicates</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìâ</span><p><strong>Downsample required</strong> - Prevent memory explosion</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üóëÔ∏è</span><p><strong>Auto-prune old data</strong> - ZREMRANGEBYSCORE</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong><1ms queries</strong> - ZRANGEBYSCORE time range</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Hot data only</strong> - Archive old to database</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Time-Series</span><span class="keyword-tag">ZADD</span><span class="keyword-tag">IoT</span><span class="keyword-tag">Sensors</span><span class="keyword-tag">Downsampling</span><span class="keyword-tag">Metrics</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> 1000 IoT sensors, 1 reading/minute, 30 days retention. Memory concern. Best strategy?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Store all raw readings (43M points)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) 1-day raw, then downsample to hourly</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Use database instead of Redis</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Store only latest value per sensor</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Downsample to hourly after 1 day</strong>
                    <p>Downsampling essential! Keep 1-minute data for 24h (real-time needs), then convert to hourly averages. Reduces from 43M to 2.1M points (20x savings!). Option A wastes memory. Database too slow for real-time. Latest-only loses history. Downsampling = best balance of detail and efficiency!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 81: Redis Advanced Patterns Collection
// ============================================================

function getQuestion81Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Expert patterns needed:</strong> "Know basic Redis but need advanced patterns for production? Bloom filters for deduplication? HyperLogLog for counting? Geofencing? Probabilistic data structures?" Architect: "Master these patterns: (1) Bloom filters (membership tests), (2) HyperLogLog (unique counts), (3) Rate limiting (sliding window), (4) Distributed locks, (5) Reservation systems. Production-ready patterns!"</p>
            <p>Advanced patterns = production power.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Advanced Redis patterns: (1) Bloom Filters: Probabilistic membership (RedisBloom module, 0.1% false positive), (2) HyperLogLog: Count unique items with 0.81% error using 12KB, (3) Sliding window rate limiter: Sorted Set with timestamps, (4) Reservation system: WATCH + MULTI for atomic booking, (5) Geofencing: GEORADIUS for location-based features. Each solves specific production problems efficiently!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Pattern Selection Guide</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Use Case</th><th style="padding: 10px;">Pattern</th><th style="padding: 10px;">Why</th></tr>
                    <tr><td style="padding: 8px;">Duplicate detection</td><td>Bloom Filter</td><td>Space-efficient, fast lookup</td></tr>
                    <tr><td style="padding: 8px;">Unique visitor count</td><td>HyperLogLog</td><td>Fixed 12KB for billions</td></tr>
                    <tr><td style="padding: 8px;">API rate limiting</td><td>Sliding window</td><td>Precise, no reset spike</td></tr>
                    <tr><td style="padding: 8px;">Seat reservation</td><td>WATCH + MULTI</td><td>Optimistic locking</td></tr>
                    <tr><td style="padding: 8px;">Location features</td><td>Geospatial</td><td>Built-in geo commands</td></tr>
                    <tr><td style="padding: 8px;">Session store</td><td>Hash with TTL</td><td>Structured data + expiry</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° When to Use What:</strong></p>
                <ul>
                    <li><strong>Bloom Filter:</strong> "Has this email been sent?" (allow 0.1% false positives)</li>
                    <li><strong>HyperLogLog:</strong> "How many unique visitors today?" (12KB vs 100MB Set)</li>
                    <li><strong>Sliding Window:</strong> "Block user after 100 req/min" (no reset spike)</li>
                    <li><strong>WATCH:</strong> "Reserve seat 5A" (prevent double booking)</li>
                    <li><strong>Geo:</strong> "Find restaurants within 5km" (sub-ms queries)</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Advanced Patterns Decision Tree</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Choose the Right Pattern</text>
                    
                    <rect x="325" y="60" width="250" height="50" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">What problem are you solving?</text>
                    
                    <!-- Bloom Filter -->
                    <rect x="50" y="160" width="160" height="80" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="130" y="185" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">Bloom Filter</text>
                    <text x="60" y="205" fill="#888" font-size="9">Membership test</text>
                    <text x="60" y="220" fill="#888" font-size="9">Space-efficient</text>
                    <text x="60" y="235" fill="#888" font-size="9">0.1% false positive OK</text>
                    
                    <path d="M 400 110 L 130 160" stroke="#666" stroke-width="2"/>
                    <text x="240" y="130" fill="#888" font-size="10">Dedup?</text>
                    
                    <!-- HyperLogLog -->
                    <rect x="250" y="160" width="160" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="330" y="185" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">HyperLogLog</text>
                    <text x="260" y="205" fill="#888" font-size="9">Count unique</text>
                    <text x="260" y="220" fill="#888" font-size="9">Fixed 12KB memory</text>
                    <text x="260" y="235" fill="#888" font-size="9">0.81% error</text>
                    
                    <path d="M 430 110 L 330 160" stroke="#666" stroke-width="2"/>
                    <text x="370" y="130" fill="#888" font-size="10">Count?</text>
                    
                    <!-- Rate Limit -->
                    <rect x="450" y="160" width="160" height="80" fill="rgba(0,191,255,0.2)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="530" y="185" text-anchor="middle" fill="#00BFFF" font-size="13" font-weight="600">Sliding Window</text>
                    <text x="460" y="205" fill="#888" font-size="9">Rate limiting</text>
                    <text x="460" y="220" fill="#888" font-size="9">No reset spike</text>
                    <text x="460" y="235" fill="#888" font-size="9">Precise control</text>
                    
                    <path d="M 470 110 L 530 160" stroke="#666" stroke-width="2"/>
                    <text x="510" y="130" fill="#888" font-size="10">Limit?</text>
                    
                    <!-- Reservation -->
                    <rect x="650" y="160" width="160" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="730" y="185" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">WATCH + MULTI</text>
                    <text x="660" y="205" fill="#888" font-size="9">Atomic operations</text>
                    <text x="660" y="220" fill="#888" font-size="9">Optimistic locking</text>
                    <text x="660" y="235" fill="#888" font-size="9">Prevent conflicts</text>
                    
                    <path d="M 500 110 L 730 160" stroke="#666" stroke-width="2"/>
                    <text x="630" y="130" fill="#888" font-size="10">Reserve?</text>
                    
                    <!-- Examples -->
                    <rect x="50" y="280" width="800" height="100" fill="rgba(0,0,0,0.02)" stroke="#666" stroke-width="1" rx="6"/>
                    <text x="450" y="305" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">Real-World Examples</text>
                    
                    <text x="70" y="330" fill="#888" font-size="10"><tspan font-weight="600">Bloom:</tspan> "Has user seen this notification?" ‚Üí 1GB Set vs 10MB Bloom</text>
                    <text x="70" y="350" fill="#888" font-size="10"><tspan font-weight="600">HLL:</tspan> "1B unique visitors/day?" ‚Üí 12KB vs 8GB Set</text>
                    <text x="70" y="370" fill="#888" font-size="10"><tspan font-weight="600">Sliding:</tspan> "Max 100 API calls/minute" ‚Üí Smooth rate limit</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: HyperLogLog for Unique Counts</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Count Unique Visitors</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis()

<span class="keyword">def</span> <span class="function">track_unique_visitor</span>(page, user_id):
    <span class="string">"""Track unique page visitor with HyperLogLog"""</span>
    key = <span class="string">f'visitors:{page}:unique'</span>
    
    <span class="comment"># Add to HyperLogLog (only 12KB for billions!)</span>
    r.pfadd(key, user_id)
    
    <span class="comment"># Get count</span>
    count = r.pfcount(key)
    
    <span class="keyword">return</span> count

<span class="keyword">def</span> <span class="function">get_total_unique_visitors</span>():
    <span class="string">"""Merge multiple pages into total unique"""</span>
    home_key = <span class="string">'visitors:home:unique'</span>
    about_key = <span class="string">'visitors:about:unique'</span>
    total_key = <span class="string">'visitors:total:unique'</span>
    
    <span class="comment"># Merge HyperLogLogs</span>
    r.pfmerge(total_key, home_key, about_key)
    
    <span class="comment"># Get total unique (deduped across pages)</span>
    <span class="keyword">return</span> r.pfcount(total_key)

<span class="comment"># Track 1 million unique visitors</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000000</span>):
    track_unique_visitor(<span class="string">'home'</span>, <span class="string">f'user_{i}'</span>)

count = r.pfcount(<span class="string">'visitors:home:unique'</span>)
<span class="keyword">print</span>(<span class="string">f"Unique visitors: {count}"</span>)  <span class="comment"># ~1,000,000 (0.81% error)</span>

<span class="comment"># Memory usage: Only 12KB!</span>
memory = r.memory_usage(<span class="string">'visitors:home:unique'</span>)
<span class="keyword">print</span>(<span class="string">f"Memory: {memory / 1024:.1f}KB"</span>)  <span class="comment"># ~12KB</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Sliding Window Rate Limiter</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Precise Rate Limiting</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> time

<span class="keyword">def</span> <span class="function">sliding_window_rate_limit</span>(user_id, max_requests=<span class="number">100</span>, window_seconds=<span class="number">60</span>):
    <span class="string">"""Sliding window rate limiter with Sorted Set"""</span>
    key = <span class="string">f'rate_limit:{user_id}'</span>
    now = time.time()
    window_start = now - window_seconds
    
    pipe = r.pipeline()
    
    <span class="comment"># 1. Remove old entries outside window</span>
    pipe.zremrangebyscore(key, <span class="number">0</span>, window_start)
    
    <span class="comment"># 2. Count requests in current window</span>
    pipe.zcard(key)
    
    <span class="comment"># 3. Add current request</span>
    pipe.zadd(key, {<span class="function">str</span>(now): now})
    
    <span class="comment"># 4. Set expiry</span>
    pipe.expire(key, window_seconds)
    
    results = pipe.execute()
    current_count = results[<span class="number">1</span>]
    
    <span class="keyword">if</span> current_count < max_requests:
        <span class="keyword">return</span> <span class="keyword">True</span>, max_requests - current_count
    <span class="keyword">else</span>:
        <span class="keyword">return</span> <span class="keyword">False</span>, <span class="number">0</span>

<span class="comment"># Test rate limiting</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">105</span>):
    allowed, remaining = sliding_window_rate_limit(<span class="string">'user123'</span>)
    <span class="keyword">if</span> <span class="keyword">not</span> allowed:
        <span class="keyword">print</span>(<span class="string">f"‚ùå Request {i+1} blocked - rate limit exceeded"</span>)
        <span class="keyword">break</span>
    <span class="keyword">if</span> i % <span class="number">20</span> == <span class="number">0</span>:
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Request {i+1} allowed - {remaining} remaining"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Optimistic Locking with WATCH</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Atomic Seat Reservation</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">reserve_seat</span>(seat_id, user_id, max_retries=<span class="number">3</span>):
    <span class="string">"""Reserve seat with optimistic locking"""</span>
    key = <span class="string">f'seat:{seat_id}'</span>
    
    <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="function">range</span>(max_retries):
        <span class="keyword">try</span>:
            <span class="comment"># WATCH the key</span>
            r.watch(key)
            
            <span class="comment"># Check if available</span>
            current_owner = r.get(key)
            
            <span class="keyword">if</span> current_owner:
                r.unwatch()
                <span class="keyword">return</span> <span class="keyword">False</span>, <span class="string">f"Seat taken by {current_owner}"</span>
            
            <span class="comment"># Start transaction</span>
            pipe = r.pipeline()
            pipe.set(key, user_id)
            pipe.expire(key, <span class="number">900</span>)  <span class="comment"># 15-min hold</span>
            pipe.execute()
            
            <span class="keyword">return</span> <span class="keyword">True</span>, <span class="string">f"Seat reserved for {user_id}"</span>
            
        <span class="keyword">except</span> redis.WatchError:
            <span class="comment"># Someone else modified - retry</span>
            <span class="keyword">print</span>(<span class="string">f"‚ö†Ô∏è Conflict, retry {attempt + 1}/{max_retries}"</span>)
            time.sleep(<span class="number">0.01</span>)
            <span class="keyword">continue</span>
    
    <span class="keyword">return</span> <span class="keyword">False</span>, <span class="string">"Failed after retries"</span>

<span class="comment"># Simulate concurrent reservations</span>
<span class="keyword">import</span> threading

<span class="keyword">def</span> <span class="function">try_reserve</span>(user):
    success, msg = reserve_seat(<span class="string">'5A'</span>, user)
    <span class="keyword">print</span>(<span class="string">f"{user}: {msg}"</span>)

<span class="comment"># 5 users try to reserve same seat</span>
threads = []
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">5</span>):
    t = threading.Thread(target=try_reserve, args=(<span class="string">f'user{i}'</span>,))
    threads.append(t)
    t.start()

<span class="keyword">for</span> t <span class="keyword">in</span> threads:
    t.join()

<span class="comment"># Result: Only 1 user gets the seat!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Bloom Filter false positives - acceptable?</h4>
                <p><strong>A:</strong> Depends on use case! Email dedup: Yes (worst case = send duplicate, not critical). Payment processing: NO (false positive = lost money). Configure error rate: 0.01% to 1%. Lower error = more memory!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: HyperLogLog vs Set for unique counts - when to use each?</h4>
                <p><strong>A:</strong> HyperLogLog: Large scale (millions+), 0.81% error OK, constant 12KB memory. Set: Exact count needed, small scale (<10K items), need actual member list. Rule: >100K unique ‚Üí HyperLogLog!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: WATCH + MULTI vs Lua script - which for atomicity?</h4>
                <p><strong>A:</strong> Lua faster (no network round-trips), supports complex logic. WATCH better for: Simple operations, optimistic locking patterns, when Lua overkill. High contention: Lua wins. Low contention: WATCH fine!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can HyperLogLog be decremented?</h4>
                <p><strong>Answer:</strong> NO! HyperLogLog is append-only. Can't remove items. Workaround: Time-based keys (daily HLL), expire old ones. For decrementable counts: Use regular counter or Set!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Sliding window vs fixed window rate limiting?</h4>
                <p><strong>Answer:</strong> Sliding prevents reset spike! Fixed: 100 req at 10:59, 100 at 11:01 = 200 in 2 minutes. Sliding: Counts last 60 seconds continuously. Sliding more precise but complex. Production: Use sliding!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: News Site Analytics</strong></p>
            <p>Track 10M daily visitors across 1000 pages. Need unique counts. Set would use 800MB √ó 1000 = 800GB!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: HyperLogLog Pattern</h4>
                <p><strong>Implementation:</strong> HyperLogLog per page (12KB √ó 1000 = 12MB total)<br>
                <strong>PFMERGE for totals:</strong> Combine all pages ‚Üí site-wide unique count<br>
                <strong>Accuracy:</strong> 0.81% error = ¬±81K on 10M (acceptable for analytics)<br>
                <strong>Memory savings:</strong> 12MB vs 800GB = 66,000x reduction!</p>
                <p><strong>Results:</strong> ‚úÖ Track 10M visitors/day ‚úÖ 12MB memory only ‚úÖ Sub-ms queries ‚úÖ Per-page and total metrics ‚úÖ $50/month vs $3000/month</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Bloom Filter</strong> - Space-efficient membership tests</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>HyperLogLog</strong> - Count unique with 12KB fixed memory</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>Sliding window</strong> - Precise rate limiting, no spikes</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>WATCH + MULTI</strong> - Optimistic locking pattern</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåç</span><p><strong>Geospatial</strong> - Location queries <10ms</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üí™</span><p><strong>Pattern mastery</strong> - Production-ready solutions</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Bloom Filter</span><span class="keyword-tag">HyperLogLog</span><span class="keyword-tag">Rate Limiting</span><span class="keyword-tag">WATCH</span><span class="keyword-tag">Patterns</span><span class="keyword-tag">Advanced</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need to count unique visitors across 1000 pages (10M visitors/day). Memory constrained. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Set per page (store all IDs)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) HyperLogLog per page</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Counter with deduplication in app</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Store in database, count with SQL</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - HyperLogLog per page</strong>
                    <p>HyperLogLog perfect! 12KB per page √ó 1000 = 12MB total (vs 800GB for Sets!). 0.81% error acceptable for analytics. PFMERGE for site totals. Set would explode memory. App dedup complex + stateful. Database too slow for real-time. HyperLogLog = designed exactly for this!</p>
                </div>
            </div>
        </div>
    `;
}




// ============================================================
// QUESTION 81: Redis Advanced Patterns Collection
// ============================================================

function getQuestion81Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Expert patterns needed:</strong> "Know basic Redis but need advanced patterns for production? Bloom filters for deduplication? HyperLogLog for counting? Geofencing? Probabilistic data structures?" Architect: "Master these patterns: (1) Bloom filters (membership tests), (2) HyperLogLog (unique counts), (3) Rate limiting (sliding window), (4) Distributed locks, (5) Reservation systems. Production-ready patterns!"</p>
            <p>Advanced patterns = production power.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Advanced Redis patterns: (1) Bloom Filters: Probabilistic membership (RedisBloom module, 0.1% false positive), (2) HyperLogLog: Count unique items with 0.81% error using 12KB, (3) Sliding window rate limiter: Sorted Set with timestamps, (4) Reservation system: WATCH + MULTI for atomic booking, (5) Geofencing: GEORADIUS for location-based features. Each solves specific production problems efficiently!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Pattern Selection Guide</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Use Case</th><th style="padding: 10px;">Pattern</th><th style="padding: 10px;">Why</th></tr>
                    <tr><td style="padding: 8px;">Duplicate detection</td><td>Bloom Filter</td><td>Space-efficient, fast lookup</td></tr>
                    <tr><td style="padding: 8px;">Unique visitor count</td><td>HyperLogLog</td><td>Fixed 12KB for billions</td></tr>
                    <tr><td style="padding: 8px;">API rate limiting</td><td>Sliding window</td><td>Precise, no reset spike</td></tr>
                    <tr><td style="padding: 8px;">Seat reservation</td><td>WATCH + MULTI</td><td>Optimistic locking</td></tr>
                    <tr><td style="padding: 8px;">Location features</td><td>Geospatial</td><td>Built-in geo commands</td></tr>
                    <tr><td style="padding: 8px;">Session store</td><td>Hash with TTL</td><td>Structured data + expiry</td></tr>
                </table>
            </div>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 20px 0;">
                <p><strong>üí° When to Use What:</strong></p>
                <ul>
                    <li><strong>Bloom Filter:</strong> "Has this email been sent?" (allow 0.1% false positives)</li>
                    <li><strong>HyperLogLog:</strong> "How many unique visitors today?" (12KB vs 100MB Set)</li>
                    <li><strong>Sliding Window:</strong> "Block user after 100 req/min" (no reset spike)</li>
                    <li><strong>WATCH:</strong> "Reserve seat 5A" (prevent double booking)</li>
                    <li><strong>Geo:</strong> "Find restaurants within 5km" (sub-ms queries)</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Advanced Patterns Decision Tree</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Choose the Right Pattern</text>
                    
                    <rect x="325" y="60" width="250" height="50" fill="rgba(156,39,176,0.2)" stroke="#9C27B0" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#9C27B0" font-size="14" font-weight="700">What problem are you solving?</text>
                    
                    <!-- Bloom Filter -->
                    <rect x="50" y="160" width="160" height="80" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="130" y="185" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">Bloom Filter</text>
                    <text x="60" y="205" fill="#888" font-size="9">Membership test</text>
                    <text x="60" y="220" fill="#888" font-size="9">Space-efficient</text>
                    <text x="60" y="235" fill="#888" font-size="9">0.1% false positive OK</text>
                    
                    <path d="M 400 110 L 130 160" stroke="#666" stroke-width="2"/>
                    <text x="240" y="130" fill="#888" font-size="10">Dedup?</text>
                    
                    <!-- HyperLogLog -->
                    <rect x="250" y="160" width="160" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="330" y="185" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">HyperLogLog</text>
                    <text x="260" y="205" fill="#888" font-size="9">Count unique</text>
                    <text x="260" y="220" fill="#888" font-size="9">Fixed 12KB memory</text>
                    <text x="260" y="235" fill="#888" font-size="9">0.81% error</text>
                    
                    <path d="M 430 110 L 330 160" stroke="#666" stroke-width="2"/>
                    <text x="370" y="130" fill="#888" font-size="10">Count?</text>
                    
                    <!-- Rate Limit -->
                    <rect x="450" y="160" width="160" height="80" fill="rgba(0,191,255,0.2)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="530" y="185" text-anchor="middle" fill="#00BFFF" font-size="13" font-weight="600">Sliding Window</text>
                    <text x="460" y="205" fill="#888" font-size="9">Rate limiting</text>
                    <text x="460" y="220" fill="#888" font-size="9">No reset spike</text>
                    <text x="460" y="235" fill="#888" font-size="9">Precise control</text>
                    
                    <path d="M 470 110 L 530 160" stroke="#666" stroke-width="2"/>
                    <text x="510" y="130" fill="#888" font-size="10">Limit?</text>
                    
                    <!-- Reservation -->
                    <rect x="650" y="160" width="160" height="80" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="730" y="185" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">WATCH + MULTI</text>
                    <text x="660" y="205" fill="#888" font-size="9">Atomic operations</text>
                    <text x="660" y="220" fill="#888" font-size="9">Optimistic locking</text>
                    <text x="660" y="235" fill="#888" font-size="9">Prevent conflicts</text>
                    
                    <path d="M 500 110 L 730 160" stroke="#666" stroke-width="2"/>
                    <text x="630" y="130" fill="#888" font-size="10">Reserve?</text>
                    
                    <!-- Examples -->
                    <rect x="50" y="280" width="800" height="100" fill="rgba(0,0,0,0.02)" stroke="#666" stroke-width="1" rx="6"/>
                    <text x="450" y="305" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">Real-World Examples</text>
                    
                    <text x="70" y="330" fill="#888" font-size="10"><tspan font-weight="600">Bloom:</tspan> "Has user seen this notification?" ‚Üí 1GB Set vs 10MB Bloom</text>
                    <text x="70" y="350" fill="#888" font-size="10"><tspan font-weight="600">HLL:</tspan> "1B unique visitors/day?" ‚Üí 12KB vs 8GB Set</text>
                    <text x="70" y="370" fill="#888" font-size="10"><tspan font-weight="600">Sliding:</tspan> "Max 100 API calls/minute" ‚Üí Smooth rate limit</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: HyperLogLog for Unique Counts</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Count Unique Visitors</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis()

<span class="keyword">def</span> <span class="function">track_unique_visitor</span>(page, user_id):
    <span class="string">"""Track unique page visitor with HyperLogLog"""</span>
    key = <span class="string">f'visitors:{page}:unique'</span>
    
    <span class="comment"># Add to HyperLogLog (only 12KB for billions!)</span>
    r.pfadd(key, user_id)
    
    <span class="comment"># Get count</span>
    count = r.pfcount(key)
    
    <span class="keyword">return</span> count

<span class="keyword">def</span> <span class="function">get_total_unique_visitors</span>():
    <span class="string">"""Merge multiple pages into total unique"""</span>
    home_key = <span class="string">'visitors:home:unique'</span>
    about_key = <span class="string">'visitors:about:unique'</span>
    total_key = <span class="string">'visitors:total:unique'</span>
    
    <span class="comment"># Merge HyperLogLogs</span>
    r.pfmerge(total_key, home_key, about_key)
    
    <span class="comment"># Get total unique (deduped across pages)</span>
    <span class="keyword">return</span> r.pfcount(total_key)

<span class="comment"># Track 1 million unique visitors</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000000</span>):
    track_unique_visitor(<span class="string">'home'</span>, <span class="string">f'user_{i}'</span>)

count = r.pfcount(<span class="string">'visitors:home:unique'</span>)
<span class="keyword">print</span>(<span class="string">f"Unique visitors: {count}"</span>)  <span class="comment"># ~1,000,000 (0.81% error)</span>

<span class="comment"># Memory usage: Only 12KB!</span>
memory = r.memory_usage(<span class="string">'visitors:home:unique'</span>)
<span class="keyword">print</span>(<span class="string">f"Memory: {memory / 1024:.1f}KB"</span>)  <span class="comment"># ~12KB</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Sliding Window Rate Limiter</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Precise Rate Limiting</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> time

<span class="keyword">def</span> <span class="function">sliding_window_rate_limit</span>(user_id, max_requests=<span class="number">100</span>, window_seconds=<span class="number">60</span>):
    <span class="string">"""Sliding window rate limiter with Sorted Set"""</span>
    key = <span class="string">f'rate_limit:{user_id}'</span>
    now = time.time()
    window_start = now - window_seconds
    
    pipe = r.pipeline()
    
    <span class="comment"># 1. Remove old entries outside window</span>
    pipe.zremrangebyscore(key, <span class="number">0</span>, window_start)
    
    <span class="comment"># 2. Count requests in current window</span>
    pipe.zcard(key)
    
    <span class="comment"># 3. Add current request</span>
    pipe.zadd(key, {<span class="function">str</span>(now): now})
    
    <span class="comment"># 4. Set expiry</span>
    pipe.expire(key, window_seconds)
    
    results = pipe.execute()
    current_count = results[<span class="number">1</span>]
    
    <span class="keyword">if</span> current_count < max_requests:
        <span class="keyword">return</span> <span class="keyword">True</span>, max_requests - current_count
    <span class="keyword">else</span>:
        <span class="keyword">return</span> <span class="keyword">False</span>, <span class="number">0</span>

<span class="comment"># Test rate limiting</span>
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">105</span>):
    allowed, remaining = sliding_window_rate_limit(<span class="string">'user123'</span>)
    <span class="keyword">if</span> <span class="keyword">not</span> allowed:
        <span class="keyword">print</span>(<span class="string">f"‚ùå Request {i+1} blocked - rate limit exceeded"</span>)
        <span class="keyword">break</span>
    <span class="keyword">if</span> i % <span class="number">20</span> == <span class="number">0</span>:
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Request {i+1} allowed - {remaining} remaining"</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Optimistic Locking with WATCH</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Atomic Seat Reservation</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">reserve_seat</span>(seat_id, user_id, max_retries=<span class="number">3</span>):
    <span class="string">"""Reserve seat with optimistic locking"""</span>
    key = <span class="string">f'seat:{seat_id}'</span>
    
    <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="function">range</span>(max_retries):
        <span class="keyword">try</span>:
            <span class="comment"># WATCH the key</span>
            r.watch(key)
            
            <span class="comment"># Check if available</span>
            current_owner = r.get(key)
            
            <span class="keyword">if</span> current_owner:
                r.unwatch()
                <span class="keyword">return</span> <span class="keyword">False</span>, <span class="string">f"Seat taken by {current_owner}"</span>
            
            <span class="comment"># Start transaction</span>
            pipe = r.pipeline()
            pipe.set(key, user_id)
            pipe.expire(key, <span class="number">900</span>)  <span class="comment"># 15-min hold</span>
            pipe.execute()
            
            <span class="keyword">return</span> <span class="keyword">True</span>, <span class="string">f"Seat reserved for {user_id}"</span>
            
        <span class="keyword">except</span> redis.WatchError:
            <span class="comment"># Someone else modified - retry</span>
            <span class="keyword">print</span>(<span class="string">f"‚ö†Ô∏è Conflict, retry {attempt + 1}/{max_retries}"</span>)
            time.sleep(<span class="number">0.01</span>)
            <span class="keyword">continue</span>
    
    <span class="keyword">return</span> <span class="keyword">False</span>, <span class="string">"Failed after retries"</span>

<span class="comment"># Simulate concurrent reservations</span>
<span class="keyword">import</span> threading

<span class="keyword">def</span> <span class="function">try_reserve</span>(user):
    success, msg = reserve_seat(<span class="string">'5A'</span>, user)
    <span class="keyword">print</span>(<span class="string">f"{user}: {msg}"</span>)

<span class="comment"># 5 users try to reserve same seat</span>
threads = []
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">5</span>):
    t = threading.Thread(target=try_reserve, args=(<span class="string">f'user{i}'</span>,))
    threads.append(t)
    t.start()

<span class="keyword">for</span> t <span class="keyword">in</span> threads:
    t.join()

<span class="comment"># Result: Only 1 user gets the seat!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Bloom Filter false positives - acceptable?</h4>
                <p><strong>A:</strong> Depends on use case! Email dedup: Yes (worst case = send duplicate, not critical). Payment processing: NO (false positive = lost money). Configure error rate: 0.01% to 1%. Lower error = more memory!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: HyperLogLog vs Set for unique counts - when to use each?</h4>
                <p><strong>A:</strong> HyperLogLog: Large scale (millions+), 0.81% error OK, constant 12KB memory. Set: Exact count needed, small scale (<10K items), need actual member list. Rule: >100K unique ‚Üí HyperLogLog!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: WATCH + MULTI vs Lua script - which for atomicity?</h4>
                <p><strong>A:</strong> Lua faster (no network round-trips), supports complex logic. WATCH better for: Simple operations, optimistic locking patterns, when Lua overkill. High contention: Lua wins. Low contention: WATCH fine!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can HyperLogLog be decremented?</h4>
                <p><strong>Answer:</strong> NO! HyperLogLog is append-only. Can't remove items. Workaround: Time-based keys (daily HLL), expire old ones. For decrementable counts: Use regular counter or Set!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Sliding window vs fixed window rate limiting?</h4>
                <p><strong>Answer:</strong> Sliding prevents reset spike! Fixed: 100 req at 10:59, 100 at 11:01 = 200 in 2 minutes. Sliding: Counts last 60 seconds continuously. Sliding more precise but complex. Production: Use sliding!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: News Site Analytics</strong></p>
            <p>Track 10M daily visitors across 1000 pages. Need unique counts. Set would use 800MB √ó 1000 = 800GB!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: HyperLogLog Pattern</h4>
                <p><strong>Implementation:</strong> HyperLogLog per page (12KB √ó 1000 = 12MB total)<br>
                <strong>PFMERGE for totals:</strong> Combine all pages ‚Üí site-wide unique count<br>
                <strong>Accuracy:</strong> 0.81% error = ¬±81K on 10M (acceptable for analytics)<br>
                <strong>Memory savings:</strong> 12MB vs 800GB = 66,000x reduction!</p>
                <p><strong>Results:</strong> ‚úÖ Track 10M visitors/day ‚úÖ 12MB memory only ‚úÖ Sub-ms queries ‚úÖ Per-page and total metrics ‚úÖ $50/month vs $3000/month</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Bloom Filter</strong> - Space-efficient membership tests</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>HyperLogLog</strong> - Count unique with 12KB fixed memory</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚è±Ô∏è</span><p><strong>Sliding window</strong> - Precise rate limiting, no spikes</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>WATCH + MULTI</strong> - Optimistic locking pattern</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåç</span><p><strong>Geospatial</strong> - Location queries <10ms</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üí™</span><p><strong>Pattern mastery</strong> - Production-ready solutions</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Bloom Filter</span><span class="keyword-tag">HyperLogLog</span><span class="keyword-tag">Rate Limiting</span><span class="keyword-tag">WATCH</span><span class="keyword-tag">Patterns</span><span class="keyword-tag">Advanced</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need to count unique visitors across 1000 pages (10M visitors/day). Memory constrained. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Set per page (store all IDs)</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) HyperLogLog per page</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Counter with deduplication in app</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Store in database, count with SQL</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - HyperLogLog per page</strong>
                    <p>HyperLogLog perfect! 12KB per page √ó 1000 = 12MB total (vs 800GB for Sets!). 0.81% error acceptable for analytics. PFMERGE for site totals. Set would explode memory. App dedup complex + stateful. Database too slow for real-time. HyperLogLog = designed exactly for this!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 82: Redis in Microservices Architecture
// ============================================================

function getQuestion82Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Microservices chaos:</strong> "50 microservices, each with own cache! Inconsistent sessions! Can't share data! Pub/Sub needed for events!" Architect: "Use Redis as shared infrastructure! (1) Centralized session store, (2) Cross-service cache, (3) Pub/Sub event bus, (4) Distributed locks, (5) Service discovery. All services connect to same Redis cluster!"</p>
            <p>Redis = microservices glue.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis in microservices: (1) Shared session store across all services (Hash with TTL), (2) Distributed cache layer (reduce DB load 90%), (3) Pub/Sub for event-driven communication, (4) Rate limiting per service, (5) Distributed locks for coordination, (6) Service configuration cache. Benefits: Reduce latency, decouple services, scale independently!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Redis Roles in Microservices</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Role</th><th style="padding: 10px;">Pattern</th><th style="padding: 10px;">Benefit</th></tr>
                    <tr><td style="padding: 8px;">Session Store</td><td>Hash with user_id key</td><td>All services access same session</td></tr>
                    <tr><td style="padding: 8px;">Cache Layer</td><td>Cache-aside pattern</td><td>90% fewer DB queries</td></tr>
                    <tr><td style="padding: 8px;">Event Bus</td><td>Pub/Sub channels</td><td>Loose coupling, real-time events</td></tr>
                    <tr><td style="padding: 8px;">Rate Limiting</td><td>Per-service quotas</td><td>Prevent service abuse</td></tr>
                    <tr><td style="padding: 8px;">Distributed Lock</td><td>SET NX EX pattern</td><td>Coordinate across services</td></tr>
                    <tr><td style="padding: 8px;">Config Store</td><td>Hash per service</td><td>Dynamic configuration</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Microservices with Redis</div>
                <svg viewBox="0 0 900 420" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis as Microservices Hub</text>
                    
                    <!-- Redis Cluster Center -->
                    <rect x="325" y="150" width="250" height="120" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="4" rx="8"/>
                    <text x="450" y="180" text-anchor="middle" fill="#DC143C" font-size="16" font-weight="700">‚ö° Redis Cluster</text>
                    <text x="340" y="205" fill="#888" font-size="10">üì¶ Session Store</text>
                    <text x="340" y="222" fill="#888" font-size="10">üíæ Shared Cache</text>
                    <text x="340" y="239" fill="#888" font-size="10">üì¢ Pub/Sub Events</text>
                    <text x="340" y="256" fill="#888" font-size="10">üîí Distributed Locks</text>
                    
                    <!-- User Service -->
                    <rect x="50" y="60" width="120" height="70" fill="rgba(0,191,255,0.2)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="110" y="85" text-anchor="middle" fill="#00BFFF" font-size="12" font-weight="600">üë§ User Service</text>
                    <text x="60" y="105" fill="#888" font-size="9">GET/SET sessions</text>
                    <text x="60" y="118" fill="#888" font-size="9">Publish user.created</text>
                    
                    <path d="M 170 95 L 325 190" stroke="#00BFFF" stroke-width="2" marker-end="url(#arrowBlue)"/>
                    
                    <!-- Order Service -->
                    <rect x="50" y="180" width="120" height="70" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="110" y="205" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">üõí Order Service</text>
                    <text x="60" y="225" fill="#888" font-size="9">Cache products</text>
                    <text x="60" y="238" fill="#888" font-size="9">Subscribe order.*</text>
                    
                    <path d="M 170 215 L 325 210" stroke="#00FF88" stroke-width="2" marker-end="url(#arrowGreen)"/>
                    
                    <!-- Payment Service -->
                    <rect x="50" y="300" width="120" height="70" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="110" y="325" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">üí≥ Payment Service</text>
                    <text x="60" y="345" fill="#888" font-size="9">Distributed lock</text>
                    <text x="60" y="358" fill="#888" font-size="9">Publish payment.done</text>
                    
                    <path d="M 170 335 L 325 235" stroke="#FFA500" stroke-width="2" marker-end="url(#arrowOrange)"/>
                    
                    <!-- Notification Service -->
                    <rect x="730" y="60" width="120" height="70" fill="rgba(138,43,226,0.2)" stroke="#8A2BE2" stroke-width="2" rx="6"/>
                    <text x="790" y="85" text-anchor="middle" fill="#8A2BE2" font-size="12" font-weight="600">üìß Notification</text>
                    <text x="740" y="105" fill="#888" font-size="9">Subscribe user.*</text>
                    <text x="740" y="118" fill="#888" font-size="9">Subscribe payment.*</text>
                    
                    <path d="M 575 190 L 730 95" stroke="#8A2BE2" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- Inventory Service -->
                    <rect x="730" y="180" width="120" height="70" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="790" y="205" text-anchor="middle" fill="#DC143C" font-size="12" font-weight="600">üì¶ Inventory</text>
                    <text x="740" y="225" fill="#888" font-size="9">Cache stock levels</text>
                    <text x="740" y="238" fill="#888" font-size="9">Subscribe order.placed</text>
                    
                    <path d="M 575 210 L 730 215" stroke="#DC143C" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- Analytics Service -->
                    <rect x="730" y="300" width="120" height="70" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="790" y="325" text-anchor="middle" fill="#FF6347" font-size="12" font-weight="600">üìä Analytics</text>
                    <text x="740" y="345" fill="#888" font-size="9">Subscribe all events</text>
                    <text x="740" y="358" fill="#888" font-size="9">HyperLogLog counts</text>
                    
                    <path d="M 575 235 L 730 335" stroke="#FF6347" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <rect x="50" y="395" width="800" height="20" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="450" y="410" text-anchor="middle" fill="#00FF88" font-size="10">
                        ‚úÖ Shared state + Event-driven + Decoupled services + Independent scaling
                    </text>
                    
                    <defs>
                        <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00BFFF" />
                        </marker>
                        <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#00FF88" />
                        </marker>
                        <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#FFA500" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Shared Session Store</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Cross-Service Session</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json

r = redis.Redis(host=<span class="string">'redis-cluster'</span>, port=<span class="number">6379</span>)

<span class="keyword">class</span> <span class="function">SessionStore</span>:
    <span class="string">"""Shared session store for all microservices"""</span>
    
    <span class="keyword">def</span> <span class="function">create_session</span>(self, user_id, session_data, ttl=<span class="number">3600</span>):
        <span class="string">"""Create session accessible by all services"""</span>
        session_id = <span class="string">f'session:{user_id}'</span>
        
        <span class="comment"># Store as Hash</span>
        r.hset(session_id, mapping=session_data)
        r.expire(session_id, ttl)
        
        <span class="keyword">return</span> session_id
    
    <span class="keyword">def</span> <span class="function">get_session</span>(self, user_id):
        <span class="string">"""Any service can read session"""</span>
        session_id = <span class="string">f'session:{user_id}'</span>
        <span class="keyword">return</span> r.hgetall(session_id)
    
    <span class="keyword">def</span> <span class="function">update_session</span>(self, user_id, field, value):
        <span class="string">"""Update specific session field"""</span>
        session_id = <span class="string">f'session:{user_id}'</span>
        r.hset(session_id, field, value)
        r.expire(session_id, <span class="number">3600</span>)  <span class="comment"># Reset TTL</span>

<span class="comment"># Usage in User Service</span>
session_store = SessionStore()
session_store.create_session(<span class="string">'user123'</span>, {
    <span class="string">'name'</span>: <span class="string">'Alice'</span>,
    <span class="string">'email'</span>: <span class="string">'alice@example.com'</span>,
    <span class="string">'role'</span>: <span class="string">'admin'</span>
})

<span class="comment"># Usage in Order Service (different microservice!)</span>
session = session_store.get_session(<span class="string">'user123'</span>)
<span class="keyword">print</span>(<span class="string">f"Order for: {session['name']}"</span>)  <span class="comment"># Works!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Event-Driven Pub/Sub</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Microservice Events</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># Order Service - Publisher</span>
<span class="keyword">def</span> <span class="function">place_order</span>(order_data):
    <span class="string">"""Place order and notify other services"""</span>
    order_id = save_order_to_db(order_data)
    
    <span class="comment"># Publish event</span>
    event = json.dumps({
        <span class="string">'order_id'</span>: order_id,
        <span class="string">'user_id'</span>: order_data[<span class="string">'user_id'</span>],
        <span class="string">'items'</span>: order_data[<span class="string">'items'</span>],
        <span class="string">'total'</span>: order_data[<span class="string">'total'</span>]
    })
    
    r.publish(<span class="string">'order.placed'</span>, event)
    <span class="keyword">print</span>(<span class="string">f"‚úÖ Published order.placed: {order_id}"</span>)
    
    <span class="keyword">return</span> order_id

<span class="comment"># -------------------------------------------</span>

<span class="comment"># Inventory Service - Subscriber</span>
<span class="keyword">def</span> <span class="function">handle_order_placed</span>(message):
    <span class="string">"""Update inventory when order placed"""</span>
    event = json.loads(message[<span class="string">'data'</span>])
    
    <span class="keyword">for</span> item <span class="keyword">in</span> event[<span class="string">'items'</span>]:
        r.decr(<span class="string">f'inventory:{item["product_id"]}'</span>, item[<span class="string">'quantity'</span>])
    
    <span class="keyword">print</span>(<span class="string">f"üì¶ Inventory updated for order {event['order_id']}"</span>)

<span class="keyword">def</span> <span class="function">start_inventory_subscriber</span>():
    pubsub = r.pubsub()
    pubsub.subscribe(**{<span class="string">'order.placed'</span>: handle_order_placed})
    
    <span class="keyword">for</span> message <span class="keyword">in</span> pubsub.listen():
        <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'message'</span>:
            handle_order_placed(message)

<span class="comment"># -------------------------------------------</span>

<span class="comment"># Notification Service - Subscriber</span>
<span class="keyword">def</span> <span class="function">handle_order_for_notification</span>(message):
    <span class="string">"""Send email when order placed"""</span>
    event = json.loads(message[<span class="string">'data'</span>])
    send_email(event[<span class="string">'user_id'</span>], <span class="string">f"Order {event['order_id']} confirmed"</span>)
    
pubsub = r.pubsub()
pubsub.subscribe(**{<span class="string">'order.placed'</span>: handle_order_for_notification})</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Service Configuration Cache</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Dynamic Config</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">class</span> <span class="function">ServiceConfig</span>:
    <span class="string">"""Centralized configuration for microservices"""</span>
    
    <span class="keyword">def</span> <span class="function">set_config</span>(self, service_name, config):
        <span class="string">"""Update service configuration"""</span>
        key = <span class="string">f'config:{service_name}'</span>
        r.hset(key, mapping=config)
        
        <span class="comment"># Publish config change event</span>
        r.publish(<span class="string">f'config.updated.{service_name}'</span>, json.dumps(config))
        <span class="keyword">print</span>(<span class="string">f"‚úÖ Config updated for {service_name}"</span>)
    
    <span class="keyword">def</span> <span class="function">get_config</span>(self, service_name, field=<span class="keyword">None</span>):
        <span class="string">"""Get service configuration"""</span>
        key = <span class="string">f'config:{service_name}'</span>
        
        <span class="keyword">if</span> field:
            <span class="keyword">return</span> r.hget(key, field)
        <span class="keyword">else</span>:
            <span class="keyword">return</span> r.hgetall(key)

<span class="comment"># Admin sets config</span>
config = ServiceConfig()
config.set_config(<span class="string">'payment'</span>, {
    <span class="string">'max_retry'</span>: <span class="string">'3'</span>,
    <span class="string">'timeout_ms'</span>: <span class="string">'5000'</span>,
    <span class="string">'rate_limit'</span>: <span class="string">'100'</span>
})

<span class="comment"># Payment service reads config (no restart needed!)</span>
max_retry = <span class="function">int</span>(config.get_config(<span class="string">'payment'</span>, <span class="string">'max_retry'</span>))
timeout = <span class="function">int</span>(config.get_config(<span class="string">'payment'</span>, <span class="string">'timeout_ms'</span>))

<span class="keyword">print</span>(<span class="string">f"Payment config: retry={max_retry}, timeout={timeout}ms"</span>)</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why not use message queue (Kafka/RabbitMQ) instead of Redis Pub/Sub?</h4>
                <p><strong>A:</strong> Use both! Kafka for: Durable events, replay, complex routing. Redis Pub/Sub for: Real-time notifications, ephemeral events, low latency. Example: Order placed ‚Üí Kafka (audit). User online ‚Üí Redis (real-time)!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Single Redis instance vs cluster for microservices?</h4>
                <p><strong>A:</strong> Cluster for production! Single point of failure risk. Use: Redis Cluster (6+ nodes) or Redis Sentinel (HA). All microservices connect to same cluster. Failover automatic. Don't let Redis become bottleneck!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Session consistency across service deployments?</h4>
                <p><strong>A:</strong> Redis solves it! Sessions in Redis (not in-memory of services). Deploy/restart services ‚Üí Sessions persist. Users stay logged in. Key: Use external session store, never in-process memory!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Pub/Sub message delivery guarantee?</h4>
                <p><strong>Answer:</strong> NONE! Pub/Sub is fire-and-forget. Subscriber offline = message lost. For guaranteed delivery: Use Redis Streams or Kafka. Pub/Sub for: Notifications where loss acceptable. Streams for: Critical events!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Cache stampede in microservices?</h4>
                <p><strong>Answer:</strong> Many services request same uncached data simultaneously! Database overwhelmed. Solution: (1) Distributed lock (first service fetches), (2) Early expiry refresh, (3) Probabilistic early recompute. Never let all services hit DB at once!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce with 20 Microservices</strong></p>
            <p>Services: User, Auth, Product, Cart, Order, Payment, Inventory, Shipping, Notification, Analytics, etc.</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Redis as Central Hub</h4>
                <p><strong>Session:</strong> User logs in ‚Üí Session in Redis ‚Üí All services read same session<br>
                <strong>Cache:</strong> Product catalog cached ‚Üí 90% requests from Redis, 10% from DB<br>
                <strong>Events:</strong> Order placed ‚Üí Pub/Sub ‚Üí Inventory, Payment, Notification all notified<br>
                <strong>Locks:</strong> Payment processing ‚Üí Distributed lock ‚Üí No duplicate charges<br>
                <strong>Config:</strong> Feature flags in Redis ‚Üí Enable/disable features without deployment</p>
                <p><strong>Results:</strong> ‚úÖ 20 services coordinated ‚úÖ <50ms cross-service latency ‚úÖ 10K req/sec capacity ‚úÖ Zero session loss on deployments ‚úÖ Real-time event processing</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¶</span><p><strong>Shared session store</strong> - All services access same data</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Centralized cache</strong> - Reduce DB load 90%</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¢</span><p><strong>Pub/Sub events</strong> - Decouple service communication</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîí</span><p><strong>Distributed locks</strong> - Coordinate operations</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚öôÔ∏è</span><p><strong>Dynamic config</strong> - Change settings without restart</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Low latency</strong> - <1ms for most operations</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Microservices</span><span class="keyword-tag">Session</span><span class="keyword-tag">Pub/Sub</span><span class="keyword-tag">Events</span><span class="keyword-tag">Cache</span><span class="keyword-tag">Distributed</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> 30 microservices need to share user session. Each service has own in-memory session. Problem?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Use sticky sessions on load balancer</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Store sessions in Redis, all services read from Redis</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Synchronize sessions between services via API</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Each service maintains separate sessions</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Store sessions in Redis</strong>
                    <p>Redis shared session perfect! All 30 services connect to same Redis cluster. User logs in once, session accessible everywhere. Sticky sessions break load balancing. API sync complex + slow. Separate sessions = user re-authenticates for each service (terrible UX!). Redis = single source of truth!</p>
                </div>
            </div>
        </div>
    `;
}




// ============================================================
// QUESTION 83: Redis Production Troubleshooting Guide
// ============================================================

function getQuestion83Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Production crisis:</strong> "Redis suddenly slow! 200ms ‚Üí 2 seconds latency! Memory at 99%! CPU spiking! Users complaining!" Engineer: "TROUBLESHOOT! (1) SLOWLOG ‚Üí Found KEYS * command, (2) INFO memory ‚Üí Evictions spiking, (3) CLIENT LIST ‚Üí 500 idle connections, (4) Fixed: Killed bad client, added maxmemory, banned KEYS *. Back to <10ms!"</p>
            <p>Systematic troubleshooting = save production.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis troubleshooting methodology: (1) SLOWLOG GET 10 - Find slow commands (>10ms), (2) INFO ALL - Check memory, CPU, connections, evictions, (3) CLIENT LIST - Identify problematic clients, (4) MONITOR (careful!) - Watch commands in real-time, (5) Memory profiling - Find large keys. Common issues: KEYS *, no maxmemory, large keys, connection leaks, network latency!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Troubleshooting Decision Tree</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Symptom</th><th style="padding: 10px;">Command</th><th style="padding: 10px;">Common Cause</th></tr>
                    <tr><td style="padding: 8px;">High latency</td><td>SLOWLOG GET 10</td><td>Slow commands (KEYS *, large ops)</td></tr>
                    <tr><td style="padding: 8px;">Memory at 100%</td><td>INFO memory</td><td>No maxmemory, memory leak, large keys</td></tr>
                    <tr><td style="padding: 8px;">High CPU</td><td>SLOWLOG, INFO stats</td><td>Complex commands, too many ops</td></tr>
                    <tr><td style="padding: 8px;">Connection errors</td><td>CLIENT LIST</td><td>Max clients reached, connection leak</td></tr>
                    <tr><td style="padding: 8px;">Evictions spiking</td><td>INFO stats</td><td>Memory pressure, wrong policy</td></tr>
                    <tr><td style="padding: 8px;">Network timeouts</td><td>Ping latency</td><td>Network issues, overloaded server</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Production Troubleshooting Flow</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Emergency Response Protocol</text>
                    
                    <rect x="350" y="60" width="200" height="50" fill="rgba(255,69,0,0.3)" stroke="#FF6347" stroke-width="3" rx="8"/>
                    <text x="450" y="90" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="700">üö® Alert: Redis Slow!</text>
                    
                    <path d="M 450 110 L 450 140" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                    
                    <rect x="50" y="140" width="180" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="140" y="165" text-anchor="middle" fill="#DC143C" font-size="12" font-weight="600">Step 1: SLOWLOG</text>
                    <text x="60" y="185" fill="#888" font-size="9">SLOWLOG GET 10</text>
                    <text x="60" y="200" fill="#888" font-size="9">Find commands >10ms</text>
                    <text x="60" y="215" fill="#00FF88" font-size="9" font-weight="600">‚Üí Found KEYS *!</text>
                    
                    <rect x="260" y="140" width="180" height="80" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="350" y="165" text-anchor="middle" fill="#FFA500" font-size="12" font-weight="600">Step 2: INFO</text>
                    <text x="270" y="185" fill="#888" font-size="9">INFO memory, stats</text>
                    <text x="270" y="200" fill="#888" font-size="9">Check usage, evictions</text>
                    <text x="270" y="215" fill="#00FF88" font-size="9" font-weight="600">‚Üí 99% memory!</text>
                    
                    <rect x="470" y="140" width="180" height="80" fill="rgba(0,191,255,0.2)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="560" y="165" text-anchor="middle" fill="#00BFFF" font-size="12" font-weight="600">Step 3: CLIENT LIST</text>
                    <text x="480" y="185" fill="#888" font-size="9">CLIENT LIST</text>
                    <text x="480" y="200" fill="#888" font-size="9">Find problematic clients</text>
                    <text x="480" y="215" fill="#00FF88" font-size="9" font-weight="600">‚Üí 500 idle conns!</text>
                    
                    <rect x="680" y="140" width="180" height="80" fill="rgba(138,43,226,0.2)" stroke="#8A2BE2" stroke-width="2" rx="6"/>
                    <text x="770" y="165" text-anchor="middle" fill="#8A2BE2" font-size="12" font-weight="600">Step 4: Fix Issues</text>
                    <text x="690" y="185" fill="#888" font-size="9">Kill bad clients</text>
                    <text x="690" y="200" fill="#888" font-size="9">Add maxmemory</text>
                    <text x="690" y="215" fill="#888" font-size="9">Ban KEYS command</text>
                    
                    <path d="M 230 180 L 260 180" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                    <path d="M 440 180 L 470 180" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                    <path d="M 650 180 L 680 180" stroke="#666" stroke-width="2" marker-end="url(#arrow)"/>
                    
                    <rect x="50" y="260" width="800" height="120" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="285" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">Root Cause Analysis</text>
                    
                    <text x="70" y="310" fill="#DC143C" font-size="11" font-weight="600">Problem: Developer ran KEYS * in production</text>
                    <text x="70" y="330" fill="#888" font-size="10">Impact: Blocked Redis for 2 seconds, 500 connections queued</text>
                    <text x="70" y="350" fill="#00FF88" font-size="10">Fix: CLIENT KILL, rename-command KEYS "", maxmemory 8GB</text>
                    <text x="70" y="370" fill="#00FF88" font-size="10">Result: Latency back to <10ms, memory stable at 70%</text>
                    
                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#666" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Automated Health Check</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Production Monitoring</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> json

<span class="keyword">def</span> <span class="function">redis_health_check</span>():
    <span class="string">"""Complete Redis health check"""</span>
    r = redis.Redis()
    issues = []
    
    <span class="comment"># 1. Check SLOWLOG</span>
    slowlog = r.slowlog_get(<span class="number">10</span>)
    <span class="keyword">if</span> slowlog:
        slow_commands = [entry[<span class="string">'command'</span>] <span class="keyword">for</span> entry <span class="keyword">in</span> slowlog]
        <span class="keyword">if</span> <span class="keyword">any</span>(<span class="string">'KEYS'</span> <span class="keyword">in</span> cmd <span class="keyword">for</span> cmd <span class="keyword">in</span> slow_commands):
            issues.append(<span class="string">"‚ö†Ô∏è KEYS command in slowlog!"</span>)
    
    <span class="comment"># 2. Check memory</span>
    info = r.info(<span class="string">'memory'</span>)
    used_memory_pct = info[<span class="string">'used_memory'</span>] / info[<span class="string">'maxmemory'</span>] * <span class="number">100</span>
    
    <span class="keyword">if</span> used_memory_pct > <span class="number">90</span>:
        issues.append(<span class="string">f"üö® Memory at {used_memory_pct:.1f}%!"</span>)
    <span class="keyword">elif</span> used_memory_pct > <span class="number">80</span>:
        issues.append(<span class="string">f"‚ö†Ô∏è Memory at {used_memory_pct:.1f}%"</span>)
    
    <span class="comment"># 3. Check evictions</span>
    stats = r.info(<span class="string">'stats'</span>)
    evicted = stats.get(<span class="string">'evicted_keys'</span>, <span class="number">0</span>)
    <span class="keyword">if</span> evicted > <span class="number">1000</span>:
        issues.append(<span class="string">f"‚ö†Ô∏è {evicted} keys evicted!"</span>)
    
    <span class="comment"># 4. Check connections</span>
    clients = r.info(<span class="string">'clients'</span>)
    connected = clients[<span class="string">'connected_clients'</span>]
    <span class="keyword">if</span> connected > <span class="number">1000</span>:
        issues.append(<span class="string">f"‚ö†Ô∏è {connected} connections!"</span>)
    
    <span class="comment"># 5. Check hit rate</span>
    keyspace = r.info(<span class="string">'stats'</span>)
    hits = keyspace.get(<span class="string">'keyspace_hits'</span>, <span class="number">0</span>)
    misses = keyspace.get(<span class="string">'keyspace_misses'</span>, <span class="number">0</span>)
    hit_rate = hits / (hits + misses) * <span class="number">100</span> <span class="keyword">if</span> (hits + misses) > <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>
    
    <span class="keyword">if</span> hit_rate < <span class="number">80</span>:
        issues.append(<span class="string">f"‚ö†Ô∏è Hit rate only {hit_rate:.1f}%"</span>)
    
    <span class="keyword">if</span> issues:
        <span class="keyword">print</span>(<span class="string">"üö® HEALTH CHECK FAILED:"</span>)
        <span class="keyword">for</span> issue <span class="keyword">in</span> issues:
            <span class="keyword">print</span>(<span class="string">f"  {issue}"</span>)
        <span class="keyword">return</span> <span class="keyword">False</span>
    <span class="keyword">else</span>:
        <span class="keyword">print</span>(<span class="string">"‚úÖ Redis healthy!"</span>)
        <span class="keyword">return</span> <span class="keyword">True</span>

<span class="comment"># Run every minute</span>
redis_health_check()</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Debug Slow Queries</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - SLOWLOG Analysis</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">analyze_slowlog</span>(threshold_ms=<span class="number">100</span>):
    <span class="string">"""Find and report slow commands"""</span>
    slowlog = r.slowlog_get(<span class="number">100</span>)
    
    <span class="comment"># Group by command</span>
    command_stats = {}
    
    <span class="keyword">for</span> entry <span class="keyword">in</span> slowlog:
        duration_ms = entry[<span class="string">'duration'</span>] / <span class="number">1000</span>
        
        <span class="keyword">if</span> duration_ms < threshold_ms:
            <span class="keyword">continue</span>
        
        cmd = entry[<span class="string">'command'</span>].split()[<span class="number">0</span>]
        
        <span class="keyword">if</span> cmd <span class="keyword">not</span> <span class="keyword">in</span> command_stats:
            command_stats[cmd] = {
                <span class="string">'count'</span>: <span class="number">0</span>,
                <span class="string">'total_ms'</span>: <span class="number">0</span>,
                <span class="string">'max_ms'</span>: <span class="number">0</span>,
                <span class="string">'examples'</span>: []
            }
        
        command_stats[cmd][<span class="string">'count'</span>] += <span class="number">1</span>
        command_stats[cmd][<span class="string">'total_ms'</span>] += duration_ms
        command_stats[cmd][<span class="string">'max_ms'</span>] = <span class="function">max</span>(command_stats[cmd][<span class="string">'max_ms'</span>], duration_ms)
        
        <span class="keyword">if</span> <span class="function">len</span>(command_stats[cmd][<span class="string">'examples'</span>]) < <span class="number">3</span>:
            command_stats[cmd][<span class="string">'examples'</span>].append(entry[<span class="string">'command'</span>])
    
    <span class="comment"># Report</span>
    <span class="keyword">print</span>(<span class="string">f"\nüîç Slow Commands (>{threshold_ms}ms):\n"</span>)
    
    <span class="keyword">for</span> cmd, stats <span class="keyword">in</span> <span class="function">sorted</span>(command_stats.items(), 
                                    key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>][<span class="string">'total_ms'</span>], 
                                    reverse=<span class="keyword">True</span>):
        avg_ms = stats[<span class="string">'total_ms'</span>] / stats[<span class="string">'count'</span>]
        <span class="keyword">print</span>(<span class="string">f"{cmd}:"</span>)
        <span class="keyword">print</span>(<span class="string">f"  Count: {stats['count']}"</span>)
        <span class="keyword">print</span>(<span class="string">f"  Avg: {avg_ms:.1f}ms"</span>)
        <span class="keyword">print</span>(<span class="string">f"  Max: {stats['max_ms']:.1f}ms"</span>)
        <span class="keyword">print</span>(<span class="string">f"  Examples:"</span>)
        <span class="keyword">for</span> example <span class="keyword">in</span> stats[<span class="string">'examples'</span>]:
            <span class="keyword">print</span>(<span class="string">f"    {example}"</span>)
        <span class="keyword">print</span>()

analyze_slowlog(threshold_ms=<span class="number">100</span>)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Client Connection Debug</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Find Problem Clients</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">find_problematic_clients</span>():
    <span class="string">"""Identify clients causing issues"""</span>
    clients = r.client_list()
    
    issues = {
        <span class="string">'idle_too_long'</span>: [],
        <span class="string">'too_many_commands'</span>: [],
        <span class="string">'blocked'</span>: []
    }
    
    <span class="keyword">for</span> client <span class="keyword">in</span> clients:
        <span class="comment"># Idle connections (>300s)</span>
        <span class="keyword">if</span> client[<span class="string">'idle'</span>] > <span class="number">300</span>:
            issues[<span class="string">'idle_too_long'</span>].append(client)
        
        <span class="comment"># Too many commands queued</span>
        <span class="keyword">if</span> client.get(<span class="string">'qbuf'</span>, <span class="number">0</span>) > <span class="number">1024</span> * <span class="number">1024</span>:  <span class="comment"># 1MB</span>
            issues[<span class="string">'too_many_commands'</span>].append(client)
        
        <span class="comment"># Blocked clients</span>
        <span class="keyword">if</span> client.get(<span class="string">'flags'</span>, <span class="string">''</span>).find(<span class="string">'b'</span>) >= <span class="number">0</span>:
            issues[<span class="string">'blocked'</span>].append(client)
    
    <span class="comment"># Report</span>
    <span class="keyword">print</span>(<span class="string">f"\nüë• Client Analysis ({len(clients)} total):\n"</span>)
    
    <span class="keyword">if</span> issues[<span class="string">'idle_too_long'</span>]:
        <span class="keyword">print</span>(<span class="string">f"‚ö†Ô∏è {len(issues['idle_too_long'])} idle >5min:"</span>)
        <span class="keyword">for</span> client <span class="keyword">in</span> issues[<span class="string">'idle_too_long'</span>][:<span class="number">5</span>]:
            <span class="keyword">print</span>(<span class="string">f"  {client['addr']} - idle {client['idle']}s"</span>)
    
    <span class="keyword">if</span> issues[<span class="string">'too_many_commands'</span>]:
        <span class="keyword">print</span>(<span class="string">f"\n‚ö†Ô∏è {len(issues['too_many_commands'])} with large queues"</span>)
    
    <span class="keyword">if</span> issues[<span class="string">'blocked'</span>]:
        <span class="keyword">print</span>(<span class="string">f"\n‚ö†Ô∏è {len(issues['blocked'])} blocked clients"</span>)
    
    <span class="keyword">return</span> issues

<span class="comment"># Find and optionally kill problematic clients</span>
problematic = find_problematic_clients()

<span class="comment"># Kill idle connections</span>
<span class="keyword">for</span> client <span class="keyword">in</span> problematic[<span class="string">'idle_too_long'</span>]:
    <span class="keyword">print</span>(<span class="string">f"üóëÔ∏è Killing idle client: {client['addr']}"</span>)
    r.client_kill_filter(_id=client[<span class="string">'id'</span>])</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: MONITOR command - safe in production?</h4>
                <p><strong>A:</strong> DANGEROUS! MONITOR streams ALL commands ‚Üí Performance impact 50%+ ‚Üí Use only for <30 seconds debugging. Better: SLOWLOG for slow queries, CLIENT LIST for connection issues. MONITOR = last resort!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Memory fragmentation - how to detect and fix?</h4>
                <p><strong>A:</strong> Check INFO memory ‚Üí mem_fragmentation_ratio. >1.5 = fragmented. Fix: Restart Redis (copies to defragmented memory) or use activedefrag (Redis 4.0+). Prevention: Avoid frequent key creation/deletion!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: How to find which keys are consuming most memory?</h4>
                <p><strong>A:</strong> Use redis-cli --bigkeys (scans database), or MEMORY USAGE key command. For precise analysis: Use redis-rdb-tools to analyze RDB file. Identify top 100 largest keys!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Latency spike but SLOWLOG empty?</h4>
                <p><strong>Answer:</strong> SLOWLOG threshold too high! Default 10ms might miss issues. Lower it: CONFIG SET slowlog-log-slower-than 1000 (1ms). Or: Network latency (check ping time). Or: CPU scheduling (check system load)!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Memory increasing but no new keys?</h4>
                <p><strong>Answer:</strong> Memory fragmentation! Or: Values getting larger. Or: AOF rewrite buffer. Check: INFO memory for fragmentation ratio, MEMORY STATS for details. Solution: Restart or enable activedefrag!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Production Outage Investigation</strong></p>
            <p>3 AM alert: API response time 200ms ‚Üí 5000ms. Users can't log in!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: 5-Minute Debug</h4>
                <p><strong>T+0min:</strong> SLOWLOG GET 10 ‚Üí Found "KEYS session:*" taking 2000ms<br>
                <strong>T+1min:</strong> CLIENT LIST ‚Üí Found rogue monitoring script<br>
                <strong>T+2min:</strong> CLIENT KILL for monitoring script<br>
                <strong>T+3min:</strong> rename-command KEYS "" in redis.conf<br>
                <strong>T+4min:</strong> Verify latency back to <50ms<br>
                <strong>T+5min:</strong> Root cause: New monitoring tool added, used KEYS</p>
                <p><strong>Results:</strong> ‚úÖ 5-minute resolution ‚úÖ Prevented KEYS usage ‚úÖ Implemented proper monitoring ‚úÖ Added alerting for SLOWLOG ‚úÖ Documented incident</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîç</span><p><strong>SLOWLOG first</strong> - Find slow commands immediately</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>INFO comprehensive</strong> - Memory, stats, connections</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üë•</span><p><strong>CLIENT LIST</strong> - Identify problem connections</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö†Ô∏è</span><p><strong>MONITOR dangerous</strong> - Use sparingly, <30 seconds</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Systematic approach</strong> - Follow debug tree</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìù</span><p><strong>Document incidents</strong> - Prevent recurrence</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Troubleshooting</span><span class="keyword-tag">SLOWLOG</span><span class="keyword-tag">DEBUG</span><span class="keyword-tag">INFO</span><span class="keyword-tag">Production</span><span class="keyword-tag">Monitoring</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Redis latency suddenly increased to 3 seconds. First troubleshooting step?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Restart Redis immediately</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Check SLOWLOG GET 10</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Run MONITOR to see all commands</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Increase memory and CPU</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Check SLOWLOG GET 10</strong>
                    <p>SLOWLOG shows slow commands! Likely culprit: KEYS *, large operation, or inefficient query. Restart loses data and doesn't fix root cause. MONITOR impacts performance further. Hardware upgrade expensive and might not help. SLOWLOG = quick, safe, identifies exact problem!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 84: Redis Disaster Recovery & Backup
// ============================================================

function getQuestion84Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Datacenter disaster:</strong> "Fire in datacenter! Lost entire Redis cluster! No backups! All session data gone! Users kicked out!" Engineer: "Never again! Implement DR: (1) Hourly RDB to S3, (2) Cross-region replication, (3) Point-in-time recovery, (4) Automated restore testing. RPO 1 hour, RTO 15 minutes!"</p>
            <p>Disaster recovery = business continuity.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis disaster recovery: (1) RDB snapshots to S3/GCS (hourly), (2) AOF backup for point-in-time recovery, (3) Cross-region replication to DR datacenter, (4) Automated restore testing (monthly), (5) Runbook for emergency. Goals: RPO <1 hour (data loss), RTO <15 minutes (recovery time). Test recovery quarterly!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">DR Strategy Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Strategy</th><th style="padding: 10px;">RPO</th><th style="padding: 10px;">RTO</th><th style="padding: 10pm;">Cost</th></tr>
                    <tr><td style="padding: 8px;">RDB snapshots only</td><td>1 hour</td><td>30 min</td><td>Low</td></tr>
                    <tr><td style="padding: 8px;">RDB + AOF backup</td><td>1 second</td><td>30 min</td><td>Medium</td></tr>
                    <tr><td style="padding: 8px;">Cross-region replica</td><td>Real-time</td><td>5 min</td><td>High</td></tr>
                    <tr><td style="padding: 8px;">Multi-region active</td><td>0 (no loss)</td><td>0 (failover)</td><td>Very High</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Disaster Recovery Architecture</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Multi-Layer DR Strategy</text>
                    
                    <!-- Primary Datacenter -->
                    <rect x="50" y="60" width="280" height="150" fill="rgba(0,191,255,0.1)" stroke="#00BFFF" stroke-width="3" rx="8"/>
                    <text x="190" y="85" text-anchor="middle" fill="#00BFFF" font-size="14" font-weight="700">üè¢ Primary Datacenter (US-East)</text>
                    
                    <rect x="70" y="100" width="240" height="40" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="190" y="125" text-anchor="middle" fill="#DC143C" font-size="12" font-weight="600">Redis Cluster (Master)</text>
                    
                    <rect x="70" y="150" width="240" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="190" y="170" text-anchor="middle" fill="#00FF88" font-size="11">BGSAVE every hour</text>
                    <text x="190" y="185" text-anchor="middle" fill="#00FF88" font-size="11">AOF everysec enabled</text>
                    
                    <!-- S3 Backup -->
                    <rect x="370" y="80" width="180" height="100" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="460" y="105" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">‚òÅÔ∏è S3 Backup</text>
                    <text x="380" y="125" fill="#888" font-size="9">Hourly RDB snapshots</text>
                    <text x="380" y="140" fill="#888" font-size="9">7-day retention</text>
                    <text x="380" y="155" fill="#888" font-size="9">Versioned</text>
                    <text x="380" y="170" fill="#888" font-size="9">Cross-region replication</text>
                    
                    <path d="M 310 165 L 370 140" stroke="#FFA500" stroke-width="2" marker-end="url(#arrowOrange)"/>
                    <text x="330" y="145" fill="#FFA500" font-size="9">Upload RDB</text>
                    
                    <!-- DR Datacenter -->
                    <rect x="570" y="60" width="280" height="150" fill="rgba(138,43,226,0.1)" stroke="#8A2BE2" stroke-width="3" rx="8"/>
                    <text x="710" y="85" text-anchor="middle" fill="#8A2BE2" font-size="14" font-weight="700">üè¢ DR Datacenter (US-West)</text>
                    
                    <rect x="590" y="100" width="240" height="40" fill="rgba(138,43,226,0.2)" stroke="#8A2BE2" stroke-width="2" rx="4"/>
                    <text x="710" y="125" text-anchor="middle" fill="#8A2BE2" font-size="12" font-weight="600">Redis Replica (Standby)</text>
                    
                    <rect x="590" y="150" width="240" height="50" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="710" y="170" text-anchor="middle" fill="#FF6347" font-size="11">REPLICAOF primary</text>
                    <text x="710" y="185" text-anchor="middle" fill="#FF6347" font-size="11">Ready for promotion</text>
                    
                    <path d="M 330 120 L 590 120" stroke="#8A2BE2" stroke-width="3" stroke-dasharray="5,5"/>
                    <text x="450" y="110" text-anchor="middle" fill="#8A2BE2" font-size="10">Real-time replication</text>
                    
                    <!-- Disaster Scenario -->
                    <rect x="50" y="250" width="800" height="130" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="2" rx="6"/>
                    <text x="450" y="275" text-anchor="middle" fill="#FF6347" font-size="14" font-weight="700">üö® Disaster Recovery Process</text>
                    
                    <text x="70" y="300" fill="#888" font-size="11"><tspan font-weight="600">T+0min:</tspan> Primary datacenter fails (fire/network/hardware)</text>
                    <text x="70" y="320" fill="#888" font-size="11"><tspan font-weight="600">T+5min:</tspan> Failover to DR: REPLICAOF NO ONE (promote replica to master)</text>
                    <text x="70" y="340" fill="#888" font-size="11"><tspan font-weight="600">T+10min:</tspan> Update DNS/load balancer to DR datacenter</text>
                    <text x="70" y="360" fill="#888" font-size="11"><tspan font-weight="600">T+15min:</tspan> ‚úÖ Service restored! RPO: 0 data loss, RTO: 15 minutes</text>
                    
                    <defs>
                        <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <path d="M0,0 L0,6 L9,3 z" fill="#FFA500" />
                        </marker>
                    </defs>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Automated Backup to S3</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Backup Automation</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> boto3
<span class="keyword">import</span> subprocess
<span class="keyword">import</span> datetime

<span class="keyword">def</span> <span class="function">backup_redis_to_s3</span>():
    <span class="string">"""Automated RDB backup to S3"""</span>
    
    <span class="comment"># 1. Trigger background save</span>
    <span class="keyword">print</span>(<span class="string">"üì∏ Starting BGSAVE..."</span>)
    subprocess.run([<span class="string">'redis-cli'</span>, <span class="string">'BGSAVE'</span>])
    
    <span class="comment"># 2. Wait for BGSAVE to complete</span>
    <span class="keyword">import</span> time
    <span class="keyword">while</span> <span class="keyword">True</span>:
        result = subprocess.run(
            [<span class="string">'redis-cli'</span>, <span class="string">'LASTSAVE'</span>],
            capture_output=<span class="keyword">True</span>,
            text=<span class="keyword">True</span>
        )
        last_save = <span class="function">int</span>(result.stdout.strip())
        
        <span class="keyword">if</span> last_save > start_time:
            <span class="keyword">break</span>
        
        time.sleep(<span class="number">5</span>)
    
    <span class="keyword">print</span>(<span class="string">"‚úÖ BGSAVE complete!"</span>)
    
    <span class="comment"># 3. Upload to S3</span>
    s3 = boto3.client(<span class="string">'s3'</span>)
    bucket = <span class="string">'redis-backups'</span>
    
    timestamp = datetime.datetime.now().strftime(<span class="string">'%Y%m%d_%H%M%S'</span>)
    key = <span class="string">f'redis/dump_{timestamp}.rdb'</span>
    
    <span class="keyword">print</span>(<span class="string">f"‚òÅÔ∏è Uploading to S3: {key}"</span>)
    s3.upload_file(
        <span class="string">'/var/lib/redis/dump.rdb'</span>,
        bucket,
        key,
        ExtraArgs={<span class="string">'StorageClass'</span>: <span class="string">'STANDARD_IA'</span>}
    )
    
    <span class="keyword">print</span>(<span class="string">"‚úÖ Backup uploaded!"</span>)
    
    <span class="comment"># 4. Cleanup old backups (keep 7 days)</span>
    cutoff = datetime.datetime.now() - datetime.timedelta(days=<span class="number">7</span>)
    response = s3.list_objects_v2(Bucket=bucket, Prefix=<span class="string">'redis/'</span>)
    
    <span class="keyword">for</span> obj <span class="keyword">in</span> response.get(<span class="string">'Contents'</span>, []):
        <span class="keyword">if</span> obj[<span class="string">'LastModified'</span>].replace(tzinfo=<span class="keyword">None</span>) < cutoff:
            s3.delete_object(Bucket=bucket, Key=obj[<span class="string">'Key'</span>])
            <span class="keyword">print</span>(<span class="string">f"üóëÔ∏è Deleted old backup: {obj['Key']}"</span>)
    
    <span class="keyword">return</span> key

<span class="comment"># Run hourly via cron</span>
<span class="comment"># 0 * * * * python3 /scripts/backup_redis.py</span>
backup_redis_to_s3()</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Point-in-Time Recovery</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Bash - Restore from Backup</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment">#!/bin/bash</span>
<span class="comment"># Point-in-time recovery script</span>

BACKUP_TIME=<span class="string">"$1"</span>  <span class="comment"># Format: 20240115_143000</span>
S3_BUCKET=<span class="string">"redis-backups"</span>
REDIS_DIR=<span class="string">"/var/lib/redis"</span>

<span class="keyword">if</span> [ -z <span class="string">"$BACKUP_TIME"</span> ]; <span class="keyword">then</span>
    <span class="keyword">echo</span> <span class="string">"Usage: $0 YYYYMMDD_HHMMSS"</span>
    <span class="keyword">echo</span> <span class="string">"Example: $0 20240115_143000"</span>
    <span class="keyword">exit</span> 1
<span class="keyword">fi</span>

<span class="keyword">echo</span> <span class="string">"üîÑ Starting point-in-time recovery to $BACKUP_TIME"</span>

<span class="comment"># 1. Stop Redis</span>
<span class="keyword">echo</span> <span class="string">"‚è∏Ô∏è Stopping Redis..."</span>
systemctl stop redis

<span class="comment"># 2. Backup current data (safety)</span>
<span class="keyword">echo</span> <span class="string">"üíæ Backing up current data..."</span>
cp <span class="variable">$REDIS_DIR</span>/dump.rdb <span class="variable">$REDIS_DIR</span>/dump.rdb.before-restore

<span class="comment"># 3. Download backup from S3</span>
<span class="keyword">echo</span> <span class="string">"‚òÅÔ∏è Downloading backup from S3..."</span>
S3_KEY=<span class="string">"redis/dump_${BACKUP_TIME}.rdb"</span>
aws s3 cp s3://<span class="variable">$S3_BUCKET</span>/<span class="variable">$S3_KEY</span> <span class="variable">$REDIS_DIR</span>/dump.rdb

<span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span>
    <span class="keyword">echo</span> <span class="string">"‚ùå Download failed!"</span>
    <span class="comment"># Restore original</span>
    mv <span class="variable">$REDIS_DIR</span>/dump.rdb.before-restore <span class="variable">$REDIS_DIR</span>/dump.rdb
    <span class="keyword">exit</span> 1
<span class="keyword">fi</span>

<span class="comment"># 4. Set permissions</span>
chown redis:redis <span class="variable">$REDIS_DIR</span>/dump.rdb
chmod 660 <span class="variable">$REDIS_DIR</span>/dump.rdb

<span class="comment"># 5. Start Redis</span>
<span class="keyword">echo</span> <span class="string">"‚ñ∂Ô∏è Starting Redis..."</span>
systemctl start redis

<span class="comment"># 6. Verify</span>
sleep 5
KEYS_COUNT=$(redis-cli DBSIZE)
<span class="keyword">echo</span> <span class="string">"‚úÖ Recovery complete! Keys: $KEYS_COUNT"</span>

<span class="comment"># 7. Cleanup</span>
rm <span class="variable">$REDIS_DIR</span>/dump.rdb.before-restore

<span class="keyword">echo</span> <span class="string">"üéâ Point-in-time recovery successful!"</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: DR Failover Automation</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Automated Failover</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

<span class="keyword">def</span> <span class="function">failover_to_dr</span>():
    <span class="string">"""Promote DR replica to master"""</span>
    
    dr_redis = redis.Redis(host=<span class="string">'dr-redis.example.com'</span>)
    
    <span class="comment"># 1. Check DR replica status</span>
    info = dr_redis.info(<span class="string">'replication'</span>)
    
    <span class="keyword">if</span> info[<span class="string">'role'</span>] != <span class="string">'slave'</span>:
        <span class="keyword">print</span>(<span class="string">"‚ö†Ô∏è DR is not a replica!"</span>)
        <span class="keyword">return</span> <span class="keyword">False</span>
    
    <span class="comment"># 2. Check replication lag</span>
    lag = info.get(<span class="string">'master_repl_offset'</span>, <span class="number">0</span>) - info.get(<span class="string">'slave_repl_offset'</span>, <span class="number">0</span>)
    <span class="keyword">print</span>(<span class="string">f"üìä Replication lag: {lag} bytes"</span>)
    
    <span class="comment"># 3. Promote replica to master</span>
    <span class="keyword">print</span>(<span class="string">"üöÄ Promoting DR replica to master..."</span>)
    dr_redis.execute_command(<span class="string">'REPLICAOF'</span>, <span class="string">'NO'</span>, <span class="string">'ONE'</span>)
    
    <span class="comment"># 4. Verify promotion</span>
    time.sleep(<span class="number">2</span>)
    info = dr_redis.info(<span class="string">'replication'</span>)
    
    <span class="keyword">if</span> info[<span class="string">'role'</span>] == <span class="string">'master'</span>:
        <span class="keyword">print</span>(<span class="string">"‚úÖ DR is now master!"</span>)
        
        <span class="comment"># 5. Update application config/DNS</span>
        update_load_balancer(<span class="string">'dr-redis.example.com'</span>)
        
        <span class="comment"># 6. Send alerts</span>
        send_alert(<span class="string">"üö® Failover to DR datacenter complete!"</span>)
        
        <span class="keyword">return</span> <span class="keyword">True</span>
    <span class="keyword">else</span>:
        <span class="keyword">print</span>(<span class="string">"‚ùå Promotion failed!"</span>)
        <span class="keyword">return</span> <span class="keyword">False</span>

<span class="keyword">def</span> <span class="function">test_dr_recovery</span>():
    <span class="string">"""Monthly DR test"""</span>
    <span class="keyword">print</span>(<span class="string">"üß™ Starting DR recovery test..."</span>)
    
    <span class="comment"># 1. Create test Redis instance</span>
    <span class="comment"># 2. Restore from latest backup</span>
    <span class="comment"># 3. Verify data integrity</span>
    <span class="comment"># 4. Measure RTO</span>
    <span class="comment"># 5. Document results</span>
    
    <span class="keyword">print</span>(<span class="string">"‚úÖ DR test complete!"</span>)

<span class="comment"># Run DR test monthly</span>
test_dr_recovery()</code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: RDB vs AOF for disaster recovery?</h4>
                <p><strong>A:</strong> Use BOTH! RDB: Fast restore, smaller files, hourly backups to S3. AOF: Point-in-time recovery, every-second persistence. RDB alone: Lose up to 1 hour. AOF alone: Slower restore. Together: Best RPO + reasonable RTO!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: How often to test DR procedures?</h4>
                <p><strong>A:</strong> Quarterly minimum, monthly recommended! Untested DR = no DR. Test: (1) Restore from backup, (2) Measure RTO, (3) Verify data integrity, (4) Update runbook. Many companies discover broken backups during actual disaster!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Cross-region replication latency acceptable?</h4>
                <p><strong>A:</strong> Yes for DR! US-East to US-West: ~60ms replication lag. Acceptable for standby replica. NOT for active-active (would cause conflicts). DR replica is for failover only, not serving reads!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can restore RDB with different Redis version?</h4>
                <p><strong>Answer:</strong> Usually YES but risky! RDB format backward compatible (newer Redis reads older RDB). Forward compatibility NOT guaranteed (older Redis may fail on newer RDB). Best practice: Match versions exactly!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: RPO 0 possible with Redis?</h4>
                <p><strong>Answer:</strong> Nearly impossible! Even AOF appendfsync always has millisecond window. True RPO 0 requires: Synchronous replication (Redis doesn't have) or multi-region active-active with CRDTs. Realistic RPO: 1 second with AOF everysec!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Complete Datacenter Loss</strong></p>
            <p>Primary datacenter network failure. 500GB Redis cluster. Need recovery in <30 minutes!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Pre-Planned DR Execution</h4>
                <p><strong>Pre-Disaster Setup:</strong> Cross-region replica syncing continuously, hourly RDB to S3<br>
                <strong>T+0min:</strong> Primary datacenter network fails, alerts triggered<br>
                <strong>T+5min:</strong> Confirm primary unrecoverable, initiate DR procedure<br>
                <strong>T+10min:</strong> REPLICAOF NO ONE promotes DR replica to master<br>
                <strong>T+15min:</strong> Update DNS/load balancer to DR datacenter<br>
                <strong>T+20min:</strong> Applications reconnect, service restored<br>
                <strong>T+25min:</strong> Verify data integrity, monitor performance</p>
                <p><strong>Results:</strong> ‚úÖ RPO: 0 seconds (replica in sync) ‚úÖ RTO: 20 minutes ‚úÖ Zero data loss ‚úÖ All 500GB recovered ‚úÖ Business continuity maintained</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>RDB + AOF</strong> - Use both for best DR</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚òÅÔ∏è</span><p><strong>Backup to S3</strong> - Hourly snapshots, 7-day retention</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåç</span><p><strong>Cross-region replica</strong> - Real-time failover capability</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üß™</span><p><strong>Test quarterly</strong> - Untested DR = no DR</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>RPO <1hr, RTO <15min</strong> - Achievable targets</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìù</span><p><strong>Document runbook</strong> - Step-by-step procedures</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Disaster Recovery</span><span class="keyword-tag">Backup</span><span class="keyword-tag">RDB</span><span class="keyword-tag">AOF</span><span class="keyword-tag">S3</span><span class="keyword-tag">Failover</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Need RPO <5 minutes for critical Redis data. Best strategy?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) RDB snapshots every 5 minutes</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) AOF with everysec + cross-region replica</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Increase BGSAVE frequency</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Manual backups every 5 minutes</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - AOF with everysec + cross-region replica</strong>
                    <p>AOF everysec gives RPO ~1 second. Cross-region replica provides real-time failover. Frequent RDB too expensive (BGSAVE is heavy operation). Manual backups unreliable. AOF + replica = best combination for low RPO!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 85: Redis Anti-Patterns & Common Mistakes
// ============================================================

function getQuestion85Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Production disaster:</strong> "Used KEYS * ‚Üí Redis blocked 5 seconds! No maxmemory ‚Üí OOM killer! Exposed to internet ‚Üí Hacked! Stored 50MB values ‚Üí Memory explosion!" Engineer: "Every Redis anti-pattern! (1) NEVER use KEYS *, (2) ALWAYS set maxmemory, (3) Require authentication, (4) Small values <1MB, (5) Use correct data structures. Fixed everything, Redis stable!"</p>
            <p>Avoiding anti-patterns = production stability.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Top Redis anti-patterns: (1) KEYS * in production (blocks all operations), (2) No maxmemory policy (OOM crash), (3) Large keys >10MB (memory + network issues), (4) No requirepass (security breach), (5) Wrong data structures (using String for everything), (6) SAVE instead of BGSAVE (blocks), (7) No monitoring (blind operations). Fix these first!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Anti-Pattern Impact Matrix</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Anti-Pattern</th><th style="padding: 10px;">Impact</th><th style="padding: 10px;">Fix</th></tr>
                    <tr><td style="padding: 8px;">KEYS * in production</td><td>Blocks Redis 5+ seconds</td><td>Use SCAN iterator</td></tr>
                    <tr><td style="padding: 8px;">No maxmemory</td><td>OOM killer terminates Redis</td><td>Set maxmemory + policy</td></tr>
                    <tr><td style="padding: 8px;">Large keys (>10MB)</td><td>Network timeout, memory spike</td><td>Break into smaller keys</td></tr>
                    <tr><td style="padding: 8px;">No authentication</td><td>Security breach, data theft</td><td>requirepass + rename dangerous commands</td></tr>
                    <tr><td style="padding: 8px;">String for everything</td><td>Memory waste 5x-10x</td><td>Use Hash, Set, Sorted Set</td></tr>
                    <tr><td style="padding: 8px;">SAVE instead of BGSAVE</td><td>Blocks all operations</td><td>Always use BGSAVE</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Good vs Bad Patterns</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Anti-Patterns vs Best Practices</text>
                    
                    <!-- Bad Side -->
                    <rect x="50" y="50" width="380" height="320" fill="rgba(255,69,0,0.1)" stroke="#FF6347" stroke-width="3" rx="8"/>
                    <text x="240" y="80" text-anchor="middle" fill="#FF6347" font-size="16" font-weight="700">‚ùå ANTI-PATTERNS</text>
                    
                    <rect x="70" y="100" width="340" height="50" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="80" y="120" fill="#FF6347" font-size="11" font-weight="600">1. KEYS * in production</text>
                    <text x="80" y="135" fill="#888" font-size="9">Blocks Redis for 5+ seconds</text>
                    
                    <rect x="70" y="160" width="340" height="50" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="80" y="180" fill="#FF6347" font-size="11" font-weight="600">2. No maxmemory policy</text>
                    <text x="80" y="195" fill="#888" font-size="9">OOM killer terminates Redis</text>
                    
                    <rect x="70" y="220" width="340" height="50" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="80" y="240" fill="#FF6347" font-size="11" font-weight="600">3. Storing 50MB values</text>
                    <text x="80" y="255" fill="#888" font-size="9">Network timeout, memory spike</text>
                    
                    <rect x="70" y="280" width="340" height="50" fill="rgba(255,69,0,0.2)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="80" y="300" fill="#FF6347" font-size="11" font-weight="600">4. No authentication</text>
                    <text x="80" y="315" fill="#888" font-size="9">Exposed to internet attacks</text>
                    
                    <!-- Good Side -->
                    <rect x="470" y="50" width="380" height="320" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="3" rx="8"/>
                    <text x="660" y="80" text-anchor="middle" fill="#00FF88" font-size="16" font-weight="700">‚úÖ BEST PRACTICES</text>
                    
                    <rect x="490" y="100" width="340" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="500" y="120" fill="#00FF88" font-size="11" font-weight="600">1. Use SCAN iterator</text>
                    <text x="500" y="135" fill="#888" font-size="9">Non-blocking, cursor-based iteration</text>
                    
                    <rect x="490" y="160" width="340" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="500" y="180" fill="#00FF88" font-size="11" font-weight="600">2. maxmemory 8GB + allkeys-lru</text>
                    <text x="500" y="195" fill="#888" font-size="9">Controlled eviction, no crashes</text>
                    
                    <rect x="490" y="220" width="340" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="500" y="240" fill="#00FF88" font-size="11" font-weight="600">3. Values <1MB, use Hash</text>
                    <text x="500" y="255" fill="#888" font-size="9">Fast operations, efficient memory</text>
                    
                    <rect x="490" y="280" width="340" height="50" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="500" y="300" fill="#00FF88" font-size="11" font-weight="600">4. requirepass + rename-command</text>
                    <text x="500" y="315" fill="#888" font-size="9">Secure by default</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: KEYS vs SCAN</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Anti-Pattern Fix</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis

r = redis.Redis()

<span class="comment"># ‚ùå ANTI-PATTERN: KEYS *</span>
<span class="keyword">def</span> <span class="function">bad_get_all_users</span>():
    <span class="string">"""NEVER DO THIS IN PRODUCTION!"""</span>
    keys = r.keys(<span class="string">'user:*'</span>)  <span class="comment"># Blocks Redis for seconds!</span>
    <span class="keyword">return</span> keys
    <span class="comment"># Problems:</span>
    <span class="comment"># - Blocks Redis (single-threaded!)</span>
    <span class="comment"># - Returns ALL keys (memory spike)</span>
    <span class="comment"># - No pagination</span>
    <span class="comment"># - O(N) complexity</span>

<span class="comment"># ‚úÖ BEST PRACTICE: SCAN</span>
<span class="keyword">def</span> <span class="function">good_get_all_users</span>():
    <span class="string">"""Non-blocking iteration"""</span>
    cursor = <span class="number">0</span>
    users = []
    
    <span class="keyword">while</span> <span class="keyword">True</span>:
        cursor, keys = r.scan(cursor, match=<span class="string">'user:*'</span>, count=<span class="number">100</span>)
        users.extend(keys)
        
        <span class="keyword">if</span> cursor == <span class="number">0</span>:
            <span class="keyword">break</span>
    
    <span class="keyword">return</span> users
    <span class="comment"># Benefits:</span>
    <span class="comment"># - Non-blocking (other clients not affected)</span>
    <span class="comment"># - Cursor-based (can pause/resume)</span>
    <span class="comment"># - Batch processing (count parameter)</span>

<span class="comment"># Even better: Generator for memory efficiency</span>
<span class="keyword">def</span> <span class="function">iterate_users</span>():
    <span class="string">"""Memory-efficient iteration"""</span>
    <span class="keyword">for</span> key <span class="keyword">in</span> r.scan_iter(match=<span class="string">'user:*'</span>, count=<span class="number">100</span>):
        <span class="keyword">yield</span> key

<span class="comment"># Usage</span>
<span class="keyword">for</span> user_key <span class="keyword">in</span> iterate_users():
    user_data = r.hgetall(user_key)
    process(user_data)</code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: String vs Hash Memory</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Data Structure Choice</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># ‚ùå ANTI-PATTERN: String for structured data</span>
<span class="keyword">def</span> <span class="function">bad_store_user</span>(user_id, user_data):
    <span class="string">"""Wastes memory, hard to update"""</span>
    <span class="keyword">import</span> json
    
    <span class="comment"># Store entire object as JSON string</span>
    r.set(<span class="string">f'user:{user_id}'</span>, json.dumps(user_data))
    
    <span class="comment"># Problems:</span>
    <span class="comment"># - Must deserialize entire object to update one field</span>
    <span class="comment"># - Wastes memory (JSON overhead)</span>
    <span class="comment"># - Can't query individual fields</span>

<span class="comment"># To update one field:</span>
<span class="keyword">def</span> <span class="function">bad_update_email</span>(user_id, new_email):
    data = json.loads(r.get(<span class="string">f'user:{user_id}'</span>))
    data[<span class="string">'email'</span>] = new_email
    r.set(<span class="string">f'user:{user_id}'</span>, json.dumps(data))
    <span class="comment"># Inefficient!</span>

<span class="comment"># ‚úÖ BEST PRACTICE: Hash for structured data</span>
<span class="keyword">def</span> <span class="function">good_store_user</span>(user_id, user_data):
    <span class="string">"""Efficient, queryable"""</span>
    r.hset(<span class="string">f'user:{user_id}'</span>, mapping=user_data)
    
    <span class="comment"># Benefits:</span>
    <span class="comment"># - 5x-10x less memory than JSON string</span>
    <span class="comment"># - Update individual fields efficiently</span>
    <span class="comment"># - Query specific fields</span>

<span class="comment"># Update one field efficiently</span>
<span class="keyword">def</span> <span class="function">good_update_email</span>(user_id, new_email):
    r.hset(<span class="string">f'user:{user_id}'</span>, <span class="string">'email'</span>, new_email)
    <span class="comment"># Fast and efficient!</span>

<span class="comment"># Memory comparison</span>
<span class="keyword">import</span> sys

user = {
    <span class="string">'name'</span>: <span class="string">'Alice'</span>,
    <span class="string">'email'</span>: <span class="string">'alice@example.com'</span>,
    <span class="string">'age'</span>: <span class="string">'30'</span>,
    <span class="string">'city'</span>: <span class="string">'New York'</span>
}

<span class="comment"># String: ~150 bytes (JSON overhead)</span>
string_size = sys.getsizeof(json.dumps(user))

<span class="comment"># Hash: ~80 bytes (native Redis structure)</span>
<span class="comment"># 50% less memory!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Large Keys Problem</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Large Key Handling</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="comment"># ‚ùå ANTI-PATTERN: Storing large values</span>
<span class="keyword">def</span> <span class="function">bad_store_file</span>(file_id, file_content):
    <span class="string">"""50MB file in Redis - BAD!"""</span>
    r.set(<span class="string">f'file:{file_id}'</span>, file_content)  <span class="comment"># 50MB!</span>
    
    <span class="comment"># Problems:</span>
    <span class="comment"># - Network timeout (transfer 50MB)</span>
    <span class="comment"># - Memory spike</span>
    <span class="comment"># - Blocks Redis during write</span>
    <span class="comment"># - Eviction issues</span>

<span class="comment"># ‚úÖ BEST PRACTICE: Use appropriate storage</span>
<span class="keyword">def</span> <span class="function">good_store_file</span>(file_id, file_content):
    <span class="string">"""Store large files in S3, metadata in Redis"""</span>
    <span class="keyword">import</span> boto3
    
    <span class="comment"># 1. Upload to S3</span>
    s3 = boto3.client(<span class="string">'s3'</span>)
    s3_key = <span class="string">f'files/{file_id}'</span>
    s3.put_object(Bucket=<span class="string">'my-bucket'</span>, Key=s3_key, Body=file_content)
    
    <span class="comment"># 2. Store metadata in Redis (small!)</span>
    metadata = {
        <span class="string">'s3_key'</span>: s3_key,
        <span class="string">'size'</span>: <span class="function">len</span>(file_content),
        <span class="string">'uploaded_at'</span>: <span class="function">str</span>(datetime.now())
    }
    r.hset(<span class="string">f'file:{file_id}'</span>, mapping=metadata)
    
    <span class="comment"># Benefits:</span>
    <span class="comment"># - Redis stores only ~200 bytes (metadata)</span>
    <span class="comment"># - Large file in appropriate storage (S3)</span>
    <span class="comment"># - Fast Redis operations</span>

<span class="comment"># ‚úÖ ALTERNATIVE: Chunking for moderate sizes</span>
<span class="keyword">def</span> <span class="function">store_chunked</span>(key, large_data, chunk_size=<span class="number">1024</span>*<span class="number">1024</span>):  <span class="comment"># 1MB chunks</span>
    <span class="string">"""Break large data into chunks"""</span>
    chunks = [large_data[i:i+chunk_size] 
              <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">0</span>, <span class="function">len</span>(large_data), chunk_size)]
    
    <span class="keyword">for</span> i, chunk <span class="keyword">in</span> <span class="function">enumerate</span>(chunks):
        r.set(<span class="string">f'{key}:chunk:{i}'</span>, chunk)
    
    r.set(<span class="string">f'{key}:chunks'</span>, <span class="function">len</span>(chunks))

<span class="comment"># Rule: Keep values <1MB in Redis!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Is FLUSHALL ever acceptable in production?</h4>
                <p><strong>A:</strong> RARELY! Only acceptable: (1) Pure cache (data elsewhere), (2) Maintenance window announced, (3) Automated tests on separate instance. Best practice: rename-command FLUSHALL "" in production! One typo = catastrophe!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: What's worst: KEYS *, no maxmemory, or no auth?</h4>
                <p><strong>A:</strong> No auth WORST (security breach, data theft, ransomware). KEYS * second (blocks Redis, hurts all users). No maxmemory third (crashes Redis but recoverable). Security > Availability > Performance!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Can I use Redis as primary database?</h4>
                <p><strong>A:</strong> Possible but risky! Missing: (1) Complex queries (JOIN), (2) Transactions across keys, (3) ACID guarantees. Use when: Small dataset, simple queries, speed critical, have backups. Most cases: Use PostgreSQL + Redis cache!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Is SELECT 0-15 switching an anti-pattern?</h4>
                <p><strong>Answer:</strong> YES in modern Redis! Multiple databases (SELECT 0-15) don't provide isolation, share memory, cause confusion. Better: Use key prefixes (user:, session:) or separate Redis instances. Redis Cluster doesn't support SELECT!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: EXPIRE on Hash - anti-pattern?</h4>
                <p><strong>Answer:</strong> Not anti-pattern but limitation! EXPIRE applies to entire Hash, not individual fields. Need per-field expiry? Use: Sorted Set with timestamp scores, or separate keys with TTL. No built-in field-level expiration!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Anti-Pattern Catastrophe</strong></p>
            <p>New developer used KEYS *, no maxmemory, stored 20MB JSON blobs. Production crashed!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Complete Refactoring</h4>
                <p><strong>Problem 1:</strong> KEYS user:* blocked Redis 8 seconds ‚Üí Changed to SCAN iterator<br>
                <strong>Problem 2:</strong> No maxmemory, Redis used 15GB, crashed ‚Üí Set maxmemory 8GB allkeys-lru<br>
                <strong>Problem 3:</strong> 20MB JSON values ‚Üí Moved to S3, kept metadata in Redis<br>
                <strong>Problem 4:</strong> No authentication ‚Üí Added requirepass, renamed dangerous commands<br>
                <strong>Problem 5:</strong> Using Strings everywhere ‚Üí Converted to Hashes (70% memory savings)</p>
                <p><strong>Results:</strong> ‚úÖ Redis stable ‚úÖ No more crashes ‚úÖ Memory 8GB ‚Üí 2.5GB ‚úÖ Latency 500ms ‚Üí 5ms ‚úÖ Security hardened ‚úÖ Production-ready</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üö´</span><p><strong>NEVER KEYS *</strong> - Use SCAN iterator always</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>ALWAYS maxmemory</strong> - Prevent OOM crashes</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîê</span><p><strong>Require authentication</strong> - Security first</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìè</span><p><strong>Values <1MB</strong> - Keep Redis fast</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üèóÔ∏è</span><p><strong>Correct data structures</strong> - Hash > String for objects</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor always</strong> - Catch issues early</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Anti-Patterns</span><span class="keyword-tag">Mistakes</span><span class="keyword-tag">KEYS</span><span class="keyword-tag">Security</span><span class="keyword-tag">Best Practices</span><span class="keyword-tag">Production</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Production Redis has 1M keys. Developer needs to find all keys starting with "session:". What to use?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) KEYS session:*</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) SCAN with match="session:*"</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Get all keys then filter in application</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Use SELECT to different database</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - SCAN with match="session:*"</strong>
                    <p>SCAN is non-blocking, cursor-based iteration. KEYS * would block Redis for seconds with 1M keys (disaster!). Getting all keys worse (memory + network). SELECT doesn't help (same keys). SCAN = production-safe pattern!</p>
                </div>
            </div>
        </div>
    `;
}




// ============================================================
// QUESTION 86: Redis Interview Questions Collection
// ============================================================

function getQuestion86Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Interview preparation:</strong> "Redis interview tomorrow! What's commonly asked?" Senior: "Top 20 questions: (1) What is Redis? (2) Data structures? (3) Persistence? (4) Clustering? (5) Performance? Plus system design: Build rate limiter, design leaderboard, implement session store. Practice coding challenges and trade-off discussions!"</p>
            <p>Preparation = confidence = success.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Top Redis interview questions: (1) What is Redis & use cases, (2) Data structures (String/Hash/List/Set/Sorted Set), (3) Persistence (RDB vs AOF), (4) Clustering & scaling, (5) Caching strategies, (6) Pub/Sub vs Streams, (7) Performance optimization, (8) Security, (9) Monitoring, (10) Real-world scenarios. Format: Technical questions + System design + Coding challenges + Trade-offs!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Interview Question Categories</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Category</th><th style="padding: 10px;">Questions</th><th style="padding: 10px;">Frequency</th></tr>
                    <tr><td style="padding: 8px;">Fundamentals</td><td>What is Redis, data types, commands</td><td>90%</td></tr>
                    <tr><td style="padding: 8px;">Architecture</td><td>Persistence, replication, clustering</td><td>80%</td></tr>
                    <tr><td style="padding: 8px;">Performance</td><td>Optimization, benchmarking, pipeline</td><td>70%</td></tr>
                    <tr><td style="padding: 8px;">System Design</td><td>Rate limiter, leaderboard, cache</td><td>85%</td></tr>
                    <tr><td style="padding: 8px;">Coding</td><td>Implement patterns, algorithms</td><td>75%</td></tr>
                    <tr><td style="padding: 8px;">Trade-offs</td><td>Redis vs X, RDB vs AOF</td><td>65%</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Interview Topics Frequency</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Most Asked Interview Topics</text>
                    
                    <!-- Bar Chart -->
                    <text x="50" y="70" fill="#888" font-size="12">Fundamentals (90%)</text>
                    <rect x="200" y="55" width="540" height="30" fill="rgba(220,20,60,0.3)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="750" y="75" fill="#DC143C" font-size="12" font-weight="600">90%</text>
                    
                    <text x="50" y="115" fill="#888" font-size="12">System Design (85%)</text>
                    <rect x="200" y="100" width="510" height="30" fill="rgba(255,165,0,0.3)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="720" y="120" fill="#FFA500" font-size="12" font-weight="600">85%</text>
                    
                    <text x="50" y="160" fill="#888" font-size="12">Architecture (80%)</text>
                    <rect x="200" y="145" width="480" height="30" fill="rgba(0,191,255,0.3)" stroke="#00BFFF" stroke-width="2" rx="4"/>
                    <text x="690" y="165" fill="#00BFFF" font-size="12" font-weight="600">80%</text>
                    
                    <text x="50" y="205" fill="#888" font-size="12">Coding (75%)</text>
                    <rect x="200" y="190" width="450" height="30" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="660" y="210" fill="#00FF88" font-size="12" font-weight="600">75%</text>
                    
                    <text x="50" y="250" fill="#888" font-size="12">Performance (70%)</text>
                    <rect x="200" y="235" width="420" height="30" fill="rgba(138,43,226,0.3)" stroke="#8A2BE2" stroke-width="2" rx="4"/>
                    <text x="630" y="255" fill="#8A2BE2" font-size="12" font-weight="600">70%</text>
                    
                    <text x="50" y="295" fill="#888" font-size="12">Trade-offs (65%)</text>
                    <rect x="200" y="280" width="390" height="30" fill="rgba(255,69,0,0.3)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="600" y="300" fill="#FF6347" font-size="12" font-weight="600">65%</text>
                    
                    <!-- Common Questions -->
                    <rect x="50" y="330" width="800" height="60" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="350" text-anchor="middle" fill="#00FF88" font-size="12" font-weight="600">Top 5 Most Common Questions</text>
                    <text x="70" y="370" fill="#888" font-size="10">1. What is Redis & when to use it?  2. Explain data structures  3. RDB vs AOF</text>
                    <text x="70" y="385" fill="#888" font-size="10">4. Design a rate limiter with Redis  5. How does Redis Cluster work?</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Rate Limiter (Most Common Coding Question)</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Interview Favorite</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

<span class="keyword">def</span> <span class="function">rate_limiter</span>(user_id, max_requests=<span class="number">100</span>, window_seconds=<span class="number">60</span>):
    <span class="string">"""
    Implement sliding window rate limiter
    Common interview question!
    """</span>
    r = redis.Redis()
    key = <span class="string">f'rate_limit:{user_id}'</span>
    now = time.time()
    window_start = now - window_seconds
    
    <span class="comment"># Pipeline for atomicity</span>
    pipe = r.pipeline()
    
    <span class="comment"># Remove old entries</span>
    pipe.zremrangebyscore(key, <span class="number">0</span>, window_start)
    
    <span class="comment"># Count current requests</span>
    pipe.zcard(key)
    
    <span class="comment"># Add current request</span>
    pipe.zadd(key, {<span class="function">str</span>(now): now})
    
    <span class="comment"># Set expiry</span>
    pipe.expire(key, window_seconds)
    
    results = pipe.execute()
    request_count = results[<span class="number">1</span>]
    
    <span class="keyword">if</span> request_count < max_requests:
        <span class="keyword">return</span> <span class="keyword">True</span>, max_requests - request_count
    <span class="keyword">else</span>:
        <span class="keyword">return</span> <span class="keyword">False</span>, <span class="number">0</span>

<span class="comment"># Interview follow-up: Why Sorted Set?</span>
<span class="comment"># Answer: Timestamp as score enables time-range queries</span>
<span class="comment"># ZREMRANGEBYSCORE removes old entries efficiently</span>
<span class="comment"># O(log N) operations</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Leaderboard (System Design Favorite)</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Top Interview Question</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">class</span> <span class="function">Leaderboard</span>:
    <span class="string">"""
    Gaming leaderboard - Very common interview question
    Interviewers love this because it shows:
    1. Sorted Set mastery
    2. Understanding O(log N) complexity
    3. Handling ties
    4. Pagination
    """</span>
    
    <span class="keyword">def</span> <span class="function">__init__</span>(self):
        self.r = redis.Redis()
        self.key = <span class="string">'leaderboard'</span>
    
    <span class="keyword">def</span> <span class="function">add_score</span>(self, player_id, score):
        <span class="string">"""Add/update player score"""</span>
        self.r.zadd(self.key, {player_id: score})
    
    <span class="keyword">def</span> <span class="function">get_top_n</span>(self, n=<span class="number">10</span>):
        <span class="string">"""Get top N players - O(log N + M)"""</span>
        <span class="keyword">return</span> self.r.zrevrange(
            self.key, 
            <span class="number">0</span>, 
            n<span class="number">-1</span>, 
            withscores=<span class="keyword">True</span>
        )
    
    <span class="keyword">def</span> <span class="function">get_rank</span>(self, player_id):
        <span class="string">"""Get player rank - O(log N)"""</span>
        rank = self.r.zrevrank(self.key, player_id)
        <span class="keyword">return</span> rank + <span class="number">1</span> <span class="keyword">if</span> rank <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">else</span> <span class="keyword">None</span>
    
    <span class="keyword">def</span> <span class="function">get_score</span>(self, player_id):
        <span class="string">"""Get player score - O(1)"""</span>
        <span class="keyword">return</span> self.r.zscore(self.key, player_id)
    
    <span class="keyword">def</span> <span class="function">get_around_player</span>(self, player_id, count=<span class="number">5</span>):
        <span class="string">"""Get players around specific player"""</span>
        rank = self.r.zrevrank(self.key, player_id)
        
        <span class="keyword">if</span> rank <span class="keyword">is</span> <span class="keyword">None</span>:
            <span class="keyword">return</span> []
        
        start = <span class="function">max</span>(<span class="number">0</span>, rank - count)
        end = rank + count
        
        <span class="keyword">return</span> self.r.zrevrange(
            self.key,
            start,
            end,
            withscores=<span class="keyword">True</span>
        )

<span class="comment"># Interview answers:</span>
<span class="comment"># Q: Why Sorted Set? A: O(log N) for updates/queries</span>
<span class="comment"># Q: How handle millions? A: Sorted Set scales to millions</span>
<span class="comment"># Q: Real-time updates? A: ZADD is instant</span>
<span class="comment"># Q: Ties? A: Redis breaks ties lexicographically</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Session Store (Design Question)</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Common Interview</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">class</span> <span class="function">SessionStore</span>:
    <span class="string">"""
    Design question: Build a session management system
    
    Interview expects you to discuss:
    1. Why Hash over String? (memory efficient)
    2. TTL strategy (sliding window)
    3. Security (tokens)
    4. Scalability (millions of sessions)
    """</span>
    
    <span class="keyword">def</span> <span class="function">create_session</span>(self, user_id, session_data, ttl=<span class="number">3600</span>):
        <span class="string">"""Create session with automatic expiry"""</span>
        session_id = generate_secure_token()
        key = <span class="string">f'session:{session_id}'</span>
        
        <span class="comment"># Add metadata</span>
        session_data[<span class="string">'user_id'</span>] = user_id
        session_data[<span class="string">'created_at'</span>] = <span class="function">str</span>(datetime.now())
        
        <span class="comment"># Store as Hash (memory efficient)</span>
        r.hset(key, mapping=session_data)
        r.expire(key, ttl)
        
        <span class="keyword">return</span> session_id
    
    <span class="keyword">def</span> <span class="function">get_session</span>(self, session_id):
        <span class="string">"""Get and refresh session (sliding window)"""</span>
        key = <span class="string">f'session:{session_id}'</span>
        session = r.hgetall(key)
        
        <span class="keyword">if</span> session:
            <span class="comment"># Refresh TTL (sliding window)</span>
            r.expire(key, <span class="number">3600</span>)
        
        <span class="keyword">return</span> session
    
    <span class="keyword">def</span> <span class="function">update_session</span>(self, session_id, field, value):
        <span class="string">"""Update specific field"""</span>
        key = <span class="string">f'session:{session_id}'</span>
        r.hset(key, field, value)
        r.expire(key, <span class="number">3600</span>)
    
    <span class="keyword">def</span> <span class="function">destroy_session</span>(self, session_id):
        <span class="string">"""Logout - delete session"""</span>
        key = <span class="string">f'session:{session_id}'</span>
        r.delete(key)

<span class="comment"># Interview Q&A:</span>
<span class="comment"># Q: Why not store in app memory?</span>
<span class="comment"># A: Sessions persist across server restarts, shared across instances</span>

<span class="comment"># Q: How to handle millions of sessions?</span>
<span class="comment"># A: Redis Cluster for horizontal scaling, TTL handles cleanup</span>

<span class="comment"># Q: Security concerns?</span>
<span class="comment"># A: Secure token generation, HTTPS only, short TTL, Redis authentication</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: "Tell me about a time you debugged a Redis issue"</h4>
                <p><strong>A (STAR format):</strong> Situation: Production slow (2s latency). Task: Debug quickly. Action: Checked SLOWLOG ‚Üí Found KEYS * command, killed client, added SCAN. Result: Latency back to 10ms, prevented recurrence with monitoring!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: "How would you scale Redis to handle 10x traffic?"</h4>
                <p><strong>A:</strong> Current state: Single instance. Solution: (1) Add read replicas for read-heavy (3-5 replicas = 10x read capacity), (2) Redis Cluster for write-heavy (6 nodes = horizontal scaling), (3) Client-side caching (95% load reduction). Choose based on workload!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: "Redis vs Memcached - when to use each?"</h4>
                <p><strong>A:</strong> Memcached: Simple key-value cache, multi-threaded, no persistence. Redis: Rich data structures, persistence, pub/sub, transactions. Use Memcached: Simple cache only. Use Redis: Need data structures, persistence, or advanced features. Redis more versatile!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: "Why is Redis single-threaded but so fast?"</h4>
                <p><strong>Answer:</strong> Single-threaded for command execution (no lock contention!), but uses I/O multiplexing (epoll) for network. Fast because: (1) In-memory, (2) No context switching, (3) Optimized data structures, (4) I/O multiplexing handles thousands of concurrent connections!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: "What happens if Redis runs out of memory?"</h4>
                <p><strong>Answer:</strong> Depends on maxmemory-policy! (1) noeviction: Return errors (safe for databases), (2) allkeys-lru: Evict least recently used (good for cache), (3) volatile-lru: Evict only keys with TTL. Without maxmemory: OOM killer terminates Redis! Always set maxmemory!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real Interview: System Design Question</strong></p>
            <p>"Design a URL shortener using Redis. Handle 1000 requests/sec. Explain your approach."</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Model Answer (Impress Interviewer)</h4>
                <p><strong>Design:</strong> String for URL mapping, counter for ID generation, Hash for analytics<br>
                <strong>Key Generation:</strong> INCR counter ‚Üí Base62 encode ‚Üí 6 chars (56B possibilities)<br>
                <strong>Store Mapping:</strong> SET short:abc123 ‚Üí long_url (TTL optional)<br>
                <strong>Redirect:</strong> GET short:abc123 ‚Üí Return 301 redirect<br>
                <strong>Analytics:</strong> HINCRBY analytics:abc123 clicks 1 (track usage)<br>
                <strong>Performance:</strong> 1K req/sec easily handled, <1ms latency<br>
                <strong>Scaling:</strong> Add read replicas for 10K req/sec<br>
                <strong>Persistence:</strong> RDB hourly (can rebuild), or AOF for no data loss</p>
                <p><strong>Interviewer impressed because:</strong> ‚úÖ Chose right data structures ‚úÖ Considered scaling ‚úÖ Thought about persistence ‚úÖ Added analytics ‚úÖ Discussed trade-offs</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìö</span><p><strong>Know fundamentals cold</strong> - Data structures, commands, use cases</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíª</span><p><strong>Practice coding</strong> - Rate limiter, leaderboard, session store</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üèóÔ∏è</span><p><strong>System design ready</strong> - Explain architecture decisions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚öñÔ∏è</span><p><strong>Discuss trade-offs</strong> - Redis vs X, RDB vs AOF</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Use STAR method</strong> - For behavioral questions</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Ask good questions</strong> - Show you think deeply</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Interview</span><span class="keyword-tag">Questions</span><span class="keyword-tag">Preparation</span><span class="keyword-tag">Coding</span><span class="keyword-tag">System Design</span><span class="keyword-tag">Practice</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Interview asks: "Design real-time leaderboard for 1M players, update scores every second." Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Store in database with index on score</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Redis Sorted Set with ZADD for updates</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) In-memory array sorted on each update</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Cache top 100 in Redis, rest in DB</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Redis Sorted Set</strong>
                    <p>Perfect choice! Sorted Set handles 1M players easily with O(log N) updates (ZADD) and queries (ZRANGE, ZRANK). Database too slow for real-time updates. In-memory array requires O(N log N) sorting constantly. Partial caching loses real-time accuracy. Sorted Set = designed exactly for this!</p>
                </div>
            </div>
        </div>
    `;
}




// ============================================================
// QUESTION 87: Redis Performance Optimization Checklist
// ============================================================

function getQuestion87Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Performance emergency:</strong> "Need 10x Redis performance! Currently 5K ops/sec, need 50K!" Engineer: "Apply ALL optimizations: (1) Pipeline ‚Üí 10x faster, (2) Connection pooling ‚Üí 2x, (3) Hash vs String ‚Üí 5x memory savings, (4) Client-side caching ‚Üí 95% load reduction, (5) Lua scripting ‚Üí atomic operations. Combined: 50K+ ops/sec achieved!"</p>
            <p>Systematic optimization = 10x performance.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis performance optimization checklist: (1) Pipeline everything (10x faster - #1 priority!), (2) Connection pooling (reuse connections), (3) Correct data structures (Hash 5x better than String for objects), (4) Lua scripting (atomic multi-key ops), (5) Client-side caching (95% load reduction), (6) Batch operations (MGET, MSET), (7) Disable persistence for pure cache (2x faster writes), (8) Avoid KEYS * (use SCAN). Apply in order of impact!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Optimization Impact Matrix</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Optimization</th><th style="padding: 10px;">Impact</th><th style="padding: 10px;">Difficulty</th></tr>
                    <tr><td style="padding: 8px;">Pipeline batching</td><td>10x faster</td><td>Easy</td></tr>
                    <tr><td style="padding: 8px;">Connection pooling</td><td>2x throughput</td><td>Easy</td></tr>
                    <tr><td style="padding: 8px;">Hash vs String</td><td>5x memory savings</td><td>Medium</td></tr>
                    <tr><td style="padding: 8px;">Client-side cache</td><td>95% load reduction</td><td>Medium</td></tr>
                    <tr><td style="padding: 8px;">Lua scripting</td><td>Atomic + fast</td><td>Medium</td></tr>
                    <tr><td style="padding: 8px;">Disable persistence</td><td>2x write speed</td><td>Easy</td></tr>
                    <tr><td style="padding: 8px;">MGET/MSET batch</td><td>5x vs individual</td><td>Easy</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Performance Optimization Pyramid</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Optimization Priority (Top = Highest Impact)</text>
                    
                    <!-- Pyramid Layers -->
                    <polygon points="450,60 250,140 650,140" fill="rgba(220,20,60,0.3)" stroke="#DC143C" stroke-width="3"/>
                    <text x="450" y="105" text-anchor="middle" fill="#DC143C" font-size="14" font-weight="700">1. Pipeline (10x) üöÄ</text>
                    
                    <polygon points="250,140 650,140 600,200 300,200" fill="rgba(255,165,0,0.3)" stroke="#FFA500" stroke-width="2"/>
                    <text x="450" y="175" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">2. Client-Side Cache (95% reduction)</text>
                    
                    <polygon points="300,200 600,200 570,250 330,250" fill="rgba(0,191,255,0.3)" stroke="#00BFFF" stroke-width="2"/>
                    <text x="450" y="230" text-anchor="middle" fill="#00BFFF" font-size="12" font-weight="600">3. Connection Pool (2x)</text>
                    
                    <polygon points="330,250 570,250 550,290 350,290" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="2"/>
                    <text x="450" y="275" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">4. Hash vs String (5x memory)</text>
                    
                    <polygon points="350,290 550,290 530,330 370,330" fill="rgba(138,43,226,0.3)" stroke="#8A2BE2" stroke-width="2"/>
                    <text x="450" y="315" text-anchor="middle" fill="#8A2BE2" font-size="10">5. Lua Scripting</text>
                    
                    <rect x="380" y="330" width="140" height="30" fill="rgba(255,69,0,0.3)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="450" y="350" text-anchor="middle" fill="#FF6347" font-size="10">6. Other Optimizations</text>
                    
                    <text x="450" y="385" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">Combined: 100x performance possible! üèÜ</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Pipeline - #1 Optimization</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - 10x Performance Boost</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis()

<span class="comment"># ‚ùå SLOW: Individual commands (baseline)</span>
<span class="keyword">def</span> <span class="function">slow_set_1000_keys</span>():
    start = time.time()
    
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
        r.set(<span class="string">f'key:{i}'</span>, <span class="string">f'value:{i}'</span>)
    
    elapsed = time.time() - start
    <span class="keyword">print</span>(<span class="string">f"Individual: {elapsed:.2f}s"</span>)
    <span class="keyword">return</span> elapsed

<span class="comment"># ‚úÖ FAST: Pipeline (10x faster!)</span>
<span class="keyword">def</span> <span class="function">fast_set_1000_keys</span>():
    start = time.time()
    
    pipe = r.pipeline()
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
        pipe.set(<span class="string">f'key:{i}'</span>, <span class="string">f'value:{i}'</span>)
    pipe.execute()
    
    elapsed = time.time() - start
    <span class="keyword">print</span>(<span class="string">f"Pipeline: {elapsed:.2f}s"</span>)
    <span class="keyword">return</span> elapsed

<span class="comment"># Results:</span>
slow_time = slow_set_1000_keys()  <span class="comment"># ~2.5 seconds</span>
fast_time = fast_set_1000_keys()  <span class="comment"># ~0.25 seconds</span>
speedup = slow_time / fast_time
<span class="keyword">print</span>(<span class="string">f"Speedup: {speedup:.1f}x"</span>)  <span class="comment"># 10x faster!</span>

<span class="comment"># Why so fast?</span>
<span class="comment"># Individual: 1000 round trips (2ms each = 2000ms total)</span>
<span class="comment"># Pipeline: 1 round trip (all commands batched)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Hash vs String Memory</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - 5x Memory Savings</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> json

<span class="comment"># ‚ùå BAD: String for structured data (wastes memory)</span>
<span class="keyword">def</span> <span class="function">store_users_as_string</span>(count=<span class="number">10000</span>):
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(count):
        user = {
            <span class="string">'id'</span>: i,
            <span class="string">'name'</span>: <span class="string">f'user_{i}'</span>,
            <span class="string">'email'</span>: <span class="string">f'user{i}@example.com'</span>,
            <span class="string">'age'</span>: <span class="number">30</span>,
            <span class="string">'city'</span>: <span class="string">'NYC'</span>
        }
        r.set(<span class="string">f'user:{i}'</span>, json.dumps(user))
    
    <span class="comment"># Check memory</span>
    memory_string = r.info(<span class="string">'memory'</span>)[<span class="string">'used_memory'</span>]
    <span class="keyword">print</span>(<span class="string">f"String memory: {memory_string / 1024 / 1024:.1f} MB"</span>)
    <span class="keyword">return</span> memory_string

<span class="comment"># ‚úÖ GOOD: Hash for structured data (5x less memory!)</span>
<span class="keyword">def</span> <span class="function">store_users_as_hash</span>(count=<span class="number">10000</span>):
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(count):
        user = {
            <span class="string">'id'</span>: <span class="function">str</span>(i),
            <span class="string">'name'</span>: <span class="string">f'user_{i}'</span>,
            <span class="string">'email'</span>: <span class="string">f'user{i}@example.com'</span>,
            <span class="string">'age'</span>: <span class="string">'30'</span>,
            <span class="string">'city'</span>: <span class="string">'NYC'</span>
        }
        r.hset(<span class="string">f'user:{i}'</span>, mapping=user)
    
    <span class="comment"># Check memory</span>
    memory_hash = r.info(<span class="string">'memory'</span>)[<span class="string">'used_memory'</span>]
    <span class="keyword">print</span>(<span class="string">f"Hash memory: {memory_hash / 1024 / 1024:.1f} MB"</span>)
    <span class="keyword">return</span> memory_hash

<span class="comment"># Clear Redis first</span>
r.flushdb()

<span class="comment"># Test String</span>
mem_string = store_users_as_string(<span class="number">10000</span>)
r.flushdb()

<span class="comment"># Test Hash</span>
mem_hash = store_users_as_hash(<span class="number">10000</span>)

<span class="comment"># Compare</span>
savings = mem_string / mem_hash
<span class="keyword">print</span>(<span class="string">f"\nMemory savings: {savings:.1f}x with Hash!"</span>)
<span class="comment"># String: ~50 MB, Hash: ~10 MB = 5x savings!</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Complete Optimization Stack</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - All Optimizations Combined</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">from</span> redis.connection <span class="keyword">import</span> ConnectionPool

<span class="comment"># ‚úÖ Optimization 1: Connection Pool</span>
pool = ConnectionPool(
    host=<span class="string">'localhost'</span>,
    port=<span class="number">6379</span>,
    max_connections=<span class="number">50</span>,
    decode_responses=<span class="keyword">True</span>
)
r = redis.Redis(connection_pool=pool)

<span class="comment"># ‚úÖ Optimization 2: Pipeline + Batch operations</span>
<span class="keyword">def</span> <span class="function">optimized_bulk_operations</span>():
    <span class="string">"""All optimizations combined"""</span>
    pipe = r.pipeline()
    
    <span class="comment"># Batch 1000 operations in one pipeline</span>
    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
        <span class="comment"># Use Hash (not String)</span>
        pipe.hset(<span class="string">f'user:{i}'</span>, mapping={
            <span class="string">'name'</span>: <span class="string">f'user_{i}'</span>,
            <span class="string">'score'</span>: <span class="function">str</span>(i * <span class="number">100</span>)
        })
    
    pipe.execute()

<span class="comment"># ‚úÖ Optimization 3: MGET for batch reads</span>
<span class="keyword">def</span> <span class="function">batch_read_optimized</span>():
    <span class="string">"""Read multiple keys at once"""</span>
    keys = [<span class="string">f'user:{i}'</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">100</span>)]
    
    <span class="comment"># MGET: 1 round trip for 100 keys</span>
    values = r.mget(keys)
    <span class="keyword">return</span> values

<span class="comment"># ‚úÖ Optimization 4: Lua for atomicity</span>
lua_increment = <span class="string">"""
local current = redis.call('GET', KEYS[1])
if not current then
    current = 0
end
return redis.call('SET', KEYS[1], current + ARGV[1])
"""</span>

increment_script = r.register_script(lua_increment)

<span class="keyword">def</span> <span class="function">atomic_increment</span>(key, amount):
    <span class="string">"""Atomic increment with Lua (1 round trip)"""</span>
    <span class="keyword">return</span> increment_script(keys=[key], args=[amount])

<span class="comment"># ‚úÖ Performance comparison</span>
<span class="keyword">import</span> time

<span class="comment"># Unoptimized</span>
start = time.time()
<span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(<span class="number">1000</span>):
    r.set(<span class="string">f'test:{i}'</span>, i)
unoptimized_time = time.time() - start

<span class="comment"># Optimized</span>
start = time.time()
optimized_bulk_operations()
optimized_time = time.time() - start

<span class="keyword">print</span>(<span class="string">f"Unoptimized: {unoptimized_time:.2f}s"</span>)
<span class="keyword">print</span>(<span class="string">f"Optimized: {optimized_time:.2f}s"</span>)
<span class="keyword">print</span>(<span class="string">f"Speedup: {unoptimized_time/optimized_time:.1f}x"</span>)
<span class="comment"># Typical: 10-50x faster!</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Should I always use pipeline?</h4>
                <p><strong>A:</strong> YES for multiple commands! Exception: Single command (no benefit), or need immediate response per command. Pipeline = free 10x speedup for batch operations. No downside except complexity!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: Disable persistence for pure cache - safe?</h4>
                <p><strong>A:</strong> YES if data elsewhere (database)! Disabling RDB+AOF = 2x faster writes. Perfect for: Session cache, API cache, temporary data. NOT for: Only copy of data. Rule: Cache = disable persistence!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: How much faster is Lua vs multiple commands?</h4>
                <p><strong>A:</strong> 5-10x faster! Example: GET + conditional SET = 2 round trips (4ms). Lua: 1 round trip (2ms) + atomic guarantee. Bigger win with more commands. Lua also eliminates race conditions!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Pipeline with millions of commands - safe?</h4>
                <p><strong>Answer:</strong> NO! Pipeline buffers responses in memory. Million commands = GB of buffered data = OOM. Solution: Batch in chunks (1000-10000 commands per pipeline). Process in batches, not all at once!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Client-side caching with Cluster - works?</h4>
                <p><strong>Answer:</strong> YES but complex! Need CLIENT TRACKING in REDIRECT mode. Invalidations go to separate connection. Each shard tracks its keys. Doable but more setup than standalone Redis. Worth it for 95% load reduction!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: API Optimization</strong></p>
            <p>API making 200 Redis calls per request = 400ms latency. Unacceptable!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Apply All Optimizations</h4>
                <p><strong>Before:</strong> 200 individual commands √ó 2ms = 400ms per request<br>
                <strong>Step 1 - Pipeline:</strong> 200 commands in 1 batch = 40ms (10x faster!)<br>
                <strong>Step 2 - Use MGET:</strong> Batch GETs together = 20ms (2x faster)<br>
                <strong>Step 3 - Connection Pool:</strong> Reuse connections = 15ms (1.3x faster)<br>
                <strong>Step 4 - Client-side cache:</strong> 95% hit rate = 0.75ms + 0.25ms = 1ms (15x faster!)<br>
                <strong>After:</strong> ~1ms average (400x improvement!)</p>
                <p><strong>Results:</strong> ‚úÖ 400ms ‚Üí 1ms latency ‚úÖ 400x faster ‚úÖ 200 ops ‚Üí 10 ops per request ‚úÖ 95% less Redis load ‚úÖ Can handle 100x more traffic</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üöÄ</span><p><strong>Pipeline ALWAYS</strong> - 10x faster for batches</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíæ</span><p><strong>Hash over String</strong> - 5x memory savings</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÑ</span><p><strong>Connection pool</strong> - Reuse connections</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üì¶</span><p><strong>MGET/MSET</strong> - Batch operations</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíª</span><p><strong>Client-side cache</strong> - 95% load reduction</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Combined effect</strong> - 100x possible!</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Optimization</span><span class="keyword-tag">Performance</span><span class="keyword-tag">Pipeline</span><span class="keyword-tag">Speed</span><span class="keyword-tag">Efficiency</span><span class="keyword-tag">Tuning</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> API needs to read 100 keys from Redis. Currently takes 200ms. Fastest optimization?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Add more Redis replicas</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Use pipeline or MGET for batch read</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Upgrade to faster server</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Enable client-side caching</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Use pipeline or MGET</strong>
                    <p>MGET reads 100 keys in 1 round trip (2ms) vs 100 round trips (200ms) = 100x faster! More replicas doesn't help (still 100 round trips per replica). Faster server marginal improvement. Client-side caching great but requires code changes. MGET = instant win!</p>
                </div>
            </div>
        </div>
    `;
}



// ============================================================
// QUESTION 88: Redis Scaling Strategies Deep Dive
// ============================================================

function getQuestion88Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Scaling emergency:</strong> "Single Redis maxed at 100K ops/sec! Need 1M ops/sec!" Architect: "Scale strategically: (1) Read replicas for read-heavy (5 replicas = 500K reads/sec), (2) Redis Cluster for writes (6 nodes = 600K writes/sec), (3) Client-side caching (95% load reduction). Evolution: Single ‚Üí Master+Replicas ‚Üí Cluster ‚Üí Multi-region. Achieved 1.2M ops/sec!"</p>
            <p>Strategic scaling = unlimited capacity.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis scaling strategies: (1) Read replicas (3-5 replicas = 10x read capacity via Sentinel), (2) Redis Cluster (16K hash slots, horizontal sharding across nodes), (3) Client-side partitioning (application-level sharding), (4) Vertical scaling (bigger machine, easiest but limited), (5) Multiple Redis instances (separate by use case). Evolution: Single (0-100K ops/sec) ‚Üí Master+Replicas (100K-500K) ‚Üí Cluster (500K-2M) ‚Üí Multi-region (2M+ ops/sec)!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Scaling Strategy Matrix</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Strategy</th><th style="padding: 10px;">Best For</th><th style="padding: 10px;">Capacity</th><th style="padding: 10px;">Complexity</th></tr>
                    <tr><td style="padding: 8px;">Single instance</td><td>0-100K ops/sec</td><td>Limited</td><td>Easy</td></tr>
                    <tr><td style="padding: 8px;">Read replicas</td><td>Read-heavy (90% reads)</td><td>100K-500K</td><td>Medium</td></tr>
                    <tr><td style="padding: 8px;">Redis Cluster</td><td>Write-heavy, large dataset</td><td>500K-2M</td><td>High</td></tr>
                    <tr><td style="padding: 8px;">Client-side partition</td><td>Simple sharding needs</td><td>100K-500K</td><td>Medium</td></tr>
                    <tr><td style="padding: 8px;">Multi-region cluster</td><td>Global scale</td><td>2M+ ops/sec</td><td>Very High</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Scaling Evolution Journey</div>
                <svg viewBox="0 0 900 450" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Redis Scaling Evolution</text>
                    
                    <!-- Phase 1: Single -->
                    <rect x="50" y="60" width="180" height="80" fill="rgba(220,20,60,0.2)" stroke="#DC143C" stroke-width="2" rx="6"/>
                    <text x="140" y="85" text-anchor="middle" fill="#DC143C" font-size="13" font-weight="600">Phase 1: Single</text>
                    <circle cx="140" cy="110" r="15" fill="#DC143C"/>
                    <text x="140" y="115" text-anchor="middle" fill="#FFF" font-size="10" font-weight="600">M</text>
                    <text x="140" y="135" text-anchor="middle" fill="#888" font-size="10">0-100K ops/sec</text>
                    
                    <text x="240" y="105" fill="#FFA500" font-size="16">‚Üí</text>
                    
                    <!-- Phase 2: Master + Replicas -->
                    <rect x="260" y="60" width="180" height="130" fill="rgba(255,165,0,0.2)" stroke="#FFA500" stroke-width="2" rx="6"/>
                    <text x="350" y="85" text-anchor="middle" fill="#FFA500" font-size="13" font-weight="600">Phase 2: Replicas</text>
                    <circle cx="350" cy="110" r="15" fill="#FFA500"/>
                    <text x="350" y="115" text-anchor="middle" fill="#FFF" font-size="10" font-weight="600">M</text>
                    <circle cx="310" cy="150" r="12" fill="#00BFFF"/>
                    <text x="310" y="155" text-anchor="middle" fill="#FFF" font-size="9">R1</text>
                    <circle cx="350" cy="150" r="12" fill="#00BFFF"/>
                    <text x="350" y="155" text-anchor="middle" fill="#FFF" font-size="9">R2</text>
                    <circle cx="390" cy="150" r="12" fill="#00BFFF"/>
                    <text x="390" y="155" text-anchor="middle" fill="#FFF" font-size="9">R3</text>
                    <text x="350" y="180" text-anchor="middle" fill="#888" font-size="10">100K-500K ops/sec</text>
                    
                    <text x="450" y="125" fill="#00FF88" font-size="16">‚Üí</text>
                    
                    <!-- Phase 3: Cluster -->
                    <rect x="470" y="60" width="180" height="180" fill="rgba(0,255,136,0.2)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="560" y="85" text-anchor="middle" fill="#00FF88" font-size="13" font-weight="600">Phase 3: Cluster</text>
                    
                    <circle cx="520" cy="110" r="12" fill="#00FF88"/>
                    <text x="520" y="115" text-anchor="middle" fill="#000" font-size="9">N1</text>
                    <circle cx="560" cy="110" r="12" fill="#00FF88"/>
                    <text x="560" y="115" text-anchor="middle" fill="#000" font-size="9">N2</text>
                    <circle cx="600" cy="110" r="12" fill="#00FF88"/>
                    <text x="600" y="115" text-anchor="middle" fill="#000" font-size="9">N3</text>
                    
                    <circle cx="520" cy="145" r="12" fill="#00FF88"/>
                    <text x="520" y="150" text-anchor="middle" fill="#000" font-size="9">N4</text>
                    <circle cx="560" cy="145" r="12" fill="#00FF88"/>
                    <text x="560" y="150" text-anchor="middle" fill="#000" font-size="9">N5</text>
                    <circle cx="600" cy="145" r="12" fill="#00FF88"/>
                    <text x="600" y="150" text-anchor="middle" fill="#000" font-size="9">N6</text>
                    
                    <text x="560" y="175" text-anchor="middle" fill="#888" font-size="9">16,384 hash slots</text>
                    <text x="560" y="190" text-anchor="middle" fill="#888" font-size="9">Sharded data</text>
                    <text x="560" y="230" text-anchor="middle" fill="#888" font-size="10">500K-2M ops/sec</text>
                    
                    <text x="660" y="145" fill="#8A2BE2" font-size="16">‚Üí</text>
                    
                    <!-- Phase 4: Multi-region -->
                    <rect x="680" y="60" width="180" height="180" fill="rgba(138,43,226,0.2)" stroke="#8A2BE2" stroke-width="2" rx="6"/>
                    <text x="770" y="85" text-anchor="middle" fill="#8A2BE2" font-size="13" font-weight="600">Phase 4: Multi-Region</text>
                    
                    <rect x="700" y="100" width="140" height="50" fill="rgba(138,43,226,0.3)" stroke="#8A2BE2" stroke-width="1" rx="3"/>
                    <text x="770" y="120" text-anchor="middle" fill="#888" font-size="9">US-East Cluster</text>
                    <text x="770" y="135" text-anchor="middle" fill="#888" font-size="9">6 nodes</text>
                    
                    <rect x="700" y="160" width="140" height="50" fill="rgba(138,43,226,0.3)" stroke="#8A2BE2" stroke-width="1" rx="3"/>
                    <text x="770" y="180" text-anchor="middle" fill="#888" font-size="9">EU-West Cluster</text>
                    <text x="770" y="195" text-anchor="middle" fill="#888" font-size="9">6 nodes</text>
                    
                    <text x="770" y="230" text-anchor="middle" fill="#888" font-size="10">2M+ ops/sec</text>
                    
                    <!-- Bottom Summary -->
                    <rect x="50" y="270" width="800" height="160" fill="rgba(0,191,255,0.1)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="450" y="295" text-anchor="middle" fill="#00BFFF" font-size="14" font-weight="600">When to Use Each Strategy</text>
                    
                    <text x="70" y="320" fill="#888" font-size="11"><tspan font-weight="600">Single:</tspan> Starting out, <100K ops/sec, simple needs</text>
                    <text x="70" y="340" fill="#888" font-size="11"><tspan font-weight="600">Replicas:</tspan> Read-heavy (90% reads), need HA, 100K-500K ops/sec</text>
                    <text x="70" y="360" fill="#888" font-size="11"><tspan font-weight="600">Cluster:</tspan> Large dataset (>memory), write-heavy, 500K-2M ops/sec</text>
                    <text x="70" y="380" fill="#888" font-size="11"><tspan font-weight="600">Multi-region:</tspan> Global users, <50ms latency worldwide, 2M+ ops/sec</text>
                    <text x="70" y="410" fill="#00FF88" font-size="11" font-weight="600">üí° Tip: Start simple, scale when needed. Don't over-engineer early!</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Read Replicas with Sentinel</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - HA with Failover</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">from</span> redis.sentinel <span class="keyword">import</span> Sentinel

<span class="comment"># Setup Sentinel for HA</span>
sentinel = Sentinel([
    (<span class="string">'sentinel1'</span>, <span class="number">26379</span>),
    (<span class="string">'sentinel2'</span>, <span class="number">26379</span>),
    (<span class="string">'sentinel3'</span>, <span class="number">26379</span>)
], socket_timeout=<span class="number">0.1</span>)

<span class="comment"># Get master for writes</span>
master = sentinel.master_for(
    <span class="string">'mymaster'</span>,
    socket_timeout=<span class="number">0.1</span>,
    db=<span class="number">0</span>
)

<span class="comment"># Get slave for reads (load balancing)</span>
slave = sentinel.slave_for(
    <span class="string">'mymaster'</span>,
    socket_timeout=<span class="number">0.1</span>,
    db=<span class="number">0</span>
)

<span class="comment"># Write to master</span>
master.set(<span class="string">'user:1000'</span>, <span class="string">'John Doe'</span>)

<span class="comment"># Read from slave (random replica)</span>
user = slave.get(<span class="string">'user:1000'</span>)

<span class="comment"># Benefits:</span>
<span class="comment"># - Automatic failover (Sentinel promotes slave)</span>
<span class="comment"># - Read scaling (5 replicas = 5x read capacity)</span>
<span class="comment"># - High availability (master fails, slave promoted)</span>

<span class="comment"># Scaling calculation:</span>
<span class="comment"># Single master: 20K reads/sec</span>
<span class="comment"># 5 replicas: 100K reads/sec (5x scale!)</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Redis Cluster Client</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Horizontal Sharding</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">from</span> rediscluster <span class="keyword">import</span> RedisCluster

<span class="comment"># Connect to cluster (any node)</span>
startup_nodes = [
    {<span class="string">"host"</span>: <span class="string">"node1"</span>, <span class="string">"port"</span>: <span class="string">"7000"</span>},
    {<span class="string">"host"</span>: <span class="string">"node2"</span>, <span class="string">"port"</span>: <span class="string">"7001"</span>},
    {<span class="string">"host"</span>: <span class="string">"node3"</span>, <span class="string">"port"</span>: <span class="string">"7002"</span>}
]

rc = RedisCluster(
    startup_nodes=startup_nodes,
    decode_responses=<span class="keyword">True</span>,
    skip_full_coverage_check=<span class="keyword">True</span>
)

<span class="comment"># Use like normal Redis (client handles sharding!)</span>
rc.set(<span class="string">'user:1000'</span>, <span class="string">'John'</span>)   <span class="comment"># Goes to node based on hash slot</span>
rc.set(<span class="string">'user:2000'</span>, <span class="string">'Jane'</span>)   <span class="comment"># May go to different node</span>

<span class="comment"># Cluster automatically distributes data</span>
<span class="comment"># 16,384 hash slots across nodes</span>

<span class="comment"># Multi-key operations need same slot</span>
<span class="comment"># Use hash tags: {user1} forces same slot</span>
rc.mset({
    <span class="string">'{user:1000}:name'</span>: <span class="string">'John'</span>,
    <span class="string">'{user:1000}:age'</span>: <span class="string">'30'</span>
})  <span class="comment"># Both keys on same node!</span>

<span class="comment"># Scaling calculation:</span>
<span class="comment"># 6 nodes √ó 100K ops/sec = 600K total capacity</span>
<span class="comment"># Add 6 more nodes = 1.2M ops/sec</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Client-Side Partitioning</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Simple Sharding</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> hashlib

<span class="keyword">class</span> <span class="function">ShardedRedis</span>:
    <span class="string">"""Simple client-side partitioning"""</span>
    
    <span class="keyword">def</span> <span class="function">__init__</span>(self, nodes):
        self.nodes = [redis.Redis(**node) <span class="keyword">for</span> node <span class="keyword">in</span> nodes]
        self.num_nodes = <span class="function">len</span>(self.nodes)
    
    <span class="keyword">def</span> <span class="function">_get_shard</span>(self, key):
        <span class="string">"""Consistent hashing to pick shard"""</span>
        hash_val = <span class="function">int</span>(hashlib.md5(key.encode()).hexdigest(), <span class="number">16</span>)
        shard_id = hash_val % self.num_nodes
        <span class="keyword">return</span> self.nodes[shard_id]
    
    <span class="keyword">def</span> <span class="function">set</span>(self, key, value):
        shard = self._get_shard(key)
        <span class="keyword">return</span> shard.set(key, value)
    
    <span class="keyword">def</span> <span class="function">get</span>(self, key):
        shard = self._get_shard(key)
        <span class="keyword">return</span> shard.get(key)
    
    <span class="keyword">def</span> <span class="function">mget</span>(self, keys):
        <span class="string">"""Multi-get across shards"""</span>
        <span class="comment"># Group keys by shard</span>
        shard_keys = {}
        <span class="keyword">for</span> key <span class="keyword">in</span> keys:
            shard = self._get_shard(key)
            <span class="keyword">if</span> shard <span class="keyword">not</span> <span class="keyword">in</span> shard_keys:
                shard_keys[shard] = []
            shard_keys[shard].append(key)
        
        <span class="comment"># Fetch from each shard in parallel</span>
        results = []
        <span class="keyword">for</span> shard, shard_key_list <span class="keyword">in</span> shard_keys.items():
            results.extend(shard.mget(shard_key_list))
        
        <span class="keyword">return</span> results

<span class="comment"># Setup 4 Redis instances</span>
sharded = ShardedRedis([
    {<span class="string">'host'</span>: <span class="string">'redis1'</span>, <span class="string">'port'</span>: <span class="number">6379</span>},
    {<span class="string">'host'</span>: <span class="string">'redis2'</span>, <span class="string">'port'</span>: <span class="number">6379</span>},
    {<span class="string">'host'</span>: <span class="string">'redis3'</span>, <span class="string">'port'</span>: <span class="number">6379</span>},
    {<span class="string">'host'</span>: <span class="string">'redis4'</span>, <span class="string">'port'</span>: <span class="number">6379</span>}
])

<span class="comment"># Use transparently</span>
sharded.set(<span class="string">'user:1000'</span>, <span class="string">'data'</span>)
<span class="comment"># Scaling: 4 instances = 4x capacity</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Read replicas vs Redis Cluster - which to use?</h4>
                <p><strong>A:</strong> Depends on workload! Read replicas: Read-heavy (90% reads), data fits in single instance memory. Cluster: Write-heavy, dataset >memory, need sharding. Can combine both: Clustered masters + replicas per master!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: How to migrate from single to cluster without downtime?</h4>
                <p><strong>A:</strong> Use redis-cli --cluster reshard! Steps: (1) Setup cluster, (2) Use proxy (like Twemproxy) for dual writes, (3) Migrate data slot by slot, (4) Switch reads to cluster, (5) Disable proxy. Takes hours but zero downtime!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: When is vertical scaling better than horizontal?</h4>
                <p><strong>A:</strong> When: (1) Still under 100K ops/sec, (2) Operations need cross-key atomicity, (3) Simplicity preferred, (4) Budget for big machine. Vertical easier but hits ceiling. Horizontal unlimited but complex!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: Can replicas handle 100% of read load?</h4>
                <p><strong>Answer:</strong> NO! Replication lag exists (typically <1 second but can spike). Reads from replica may be stale. Use replicas for: Eventually consistent reads OK. Use master for: Immediately after write, strong consistency needed!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Redis Cluster multi-key operations - work?</h4>
                <p><strong>Answer:</strong> Only if keys in same hash slot! Use hash tags {user:1000} to force keys together. Otherwise CROSSSLOT error. Transactions (MULTI) also need same slot. Design keys carefully for Cluster!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: E-commerce Scaling Journey</strong></p>
            <p>E-commerce site scaled from 5K to 2M ops/sec over 3 years!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Scaling Evolution Success</h4>
                <p><strong>Year 1 (5K ops/sec):</strong> Single Redis instance, 16GB RAM, simple setup<br>
                <strong>Year 2 (50K ops/sec):</strong> Master + 3 replicas with Sentinel, 90% reads from replicas<br>
                <strong>Year 3 (500K ops/sec):</strong> 6-node Redis Cluster, dataset grew to 200GB (sharding needed)<br>
                <strong>Year 4 (2M ops/sec):</strong> Multi-region clusters (US-East, EU-West, Asia), <50ms global latency</p>
                <p><strong>Key Decisions:</strong><br>
                ‚úÖ Started simple (avoided over-engineering)<br>
                ‚úÖ Added replicas when read-heavy (90% reads)<br>
                ‚úÖ Moved to Cluster when dataset >memory<br>
                ‚úÖ Multi-region only when global users<br>
                ‚úÖ Each step 3-6 months, tested thoroughly</p>
                <p><strong>Cost:</strong> Year 1: $200/mo ‚Üí Year 4: $5,000/mo (but serving 400x traffic!)</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìà</span><p><strong>Start simple</strong> - Don't over-engineer early</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìñ</span><p><strong>Replicas for reads</strong> - 90% read-heavy workloads</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üîÄ</span><p><strong>Cluster for sharding</strong> - Dataset >memory or write-heavy</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåç</span><p><strong>Multi-region for global</strong> - <50ms worldwide</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚öñÔ∏è</span><p><strong>Consider trade-offs</strong> - Complexity vs capacity</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Monitor and test</strong> - Before each scaling step</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Scaling</span><span class="keyword-tag">Cluster</span><span class="keyword-tag">Replicas</span><span class="keyword-tag">Sharding</span><span class="keyword-tag">Horizontal</span><span class="keyword-tag">Capacity</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Traffic growing from 80K to 500K ops/sec. Workload: 95% reads, 5% writes. Data: 30GB (fits single instance). Best scaling strategy?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Redis Cluster with 6 nodes</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Master + 5 read replicas with Sentinel</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Vertical scaling to bigger machine</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Client-side partitioning with 4 instances</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Master + 5 read replicas</strong>
                    <p>Perfect match! 95% reads ‚Üí replicas excel here. 5 replicas handle 400K reads/sec (80K each). Master handles 25K writes/sec (plenty). Data fits single instance (30GB). Cluster unnecessary (adds complexity, no sharding needed). Vertical scaling hits limits. Client-side partitioning loses transactions. Replicas = simple + effective!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 89: Real-World Redis Case Studies
// ============================================================

function getQuestion89Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Learning from giants:</strong> "How do tech companies use Redis at scale?" Senior: "Study the best: (1) Twitter timeline cache (100K reads/sec, Sorted Sets), (2) Instagram feed (ZUNIONSTORE aggregation), (3) Airbnb sessions (millions concurrent), (4) GitHub job queues (Lists + BRPOP), (5) Stack Overflow cache (95% hit rate). Learn patterns, apply to your architecture!"</p>
            <p>Case studies = proven patterns.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Real-world Redis case studies: (1) Twitter timeline cache (Sorted Sets for 100K reads/sec per user, multi-DC replication), (2) Instagram feed generation (ZUNIONSTORE for friend aggregation), (3) Airbnb session store (Hash with millions concurrent users, cross-region), (4) GitHub job queues (Lists with BRPOP for distributed workers), (5) Stack Overflow page cache (cache-aside, 95% hit rate, tag-based invalidation). Common patterns: Sorted Sets for ranking, Hashes for objects, Lists for queues!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Case Study Comparison</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Company</th><th style="padding: 10px;">Use Case</th><th style="padding: 10px;">Data Structure</th><th style="padding: 10px;">Scale</th></tr>
                    <tr><td style="padding: 8px;">Twitter</td><td>Timeline cache</td><td>Sorted Set</td><td>100K reads/sec/user</td></tr>
                    <tr><td style="padding: 8px;">Instagram</td><td>Feed generation</td><td>Sorted Set + ZUNIONSTORE</td><td>Millions ops/sec</td></tr>
                    <tr><td style="padding: 8px;">Airbnb</td><td>Session store</td><td>Hash with TTL</td><td>Millions sessions</td></tr>
                    <tr><td style="padding: 8px;">GitHub</td><td>Job queues</td><td>List + BRPOP</td><td>100K jobs/day</td></tr>
                    <tr><td style="padding: 8px;">Stack Overflow</td><td>Page cache</td><td>String</td><td>95% hit rate</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">Case Study Architectures</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Tech Giants Using Redis</text>
                    
                    <!-- Twitter -->
                    <rect x="50" y="50" width="250" height="80" fill="rgba(29,161,242,0.2)" stroke="#1DA1F2" stroke-width="2" rx="6"/>
                    <text x="175" y="70" text-anchor="middle" fill="#1DA1F2" font-size="13" font-weight="600">üê¶ Twitter Timeline</text>
                    <text x="60" y="90" fill="#888" font-size="10">ZREVRANGE timeline:user_id 0 49</text>
                    <text x="60" y="105" fill="#888" font-size="10">Sorted Set (score=timestamp)</text>
                    <text x="60" y="120" fill="#888" font-size="10">100K reads/sec per active user</text>
                    
                    <!-- Instagram -->
                    <rect x="320" y="50" width="250" height="80" fill="rgba(193,53,132,0.2)" stroke="#C13584" stroke-width="2" rx="6"/>
                    <text x="445" y="70" text-anchor="middle" fill="#C13584" font-size="13" font-weight="600">üì∏ Instagram Feed</text>
                    <text x="330" y="90" fill="#888" font-size="10">ZUNIONSTORE feed:user keys...</text>
                    <text x="330" y="105" fill="#888" font-size="10">Aggregate friend posts</text>
                    <text x="330" y="120" fill="#888" font-size="10">Millions operations/second</text>
                    
                    <!-- Airbnb -->
                    <rect x="600" y="50" width="250" height="80" fill="rgba(255,90,95,0.2)" stroke="#FF5A5F" stroke-width="2" rx="6"/>
                    <text x="725" y="70" text-anchor="middle" fill="#FF5A5F" font-size="13" font-weight="600">üè† Airbnb Sessions</text>
                    <text x="610" y="90" fill="#888" font-size="10">HSET session:id mapping={...}</text>
                    <text x="610" y="105" fill="#888" font-size="10">Hash with 15min TTL</text>
                    <text x="610" y="120" fill="#888" font-size="10">Millions concurrent users</text>
                    
                    <!-- GitHub -->
                    <rect x="50" y="150" width="400" height="80" fill="rgba(36,41,46,0.2)" stroke="#24292e" stroke-width="2" rx="6"/>
                    <text x="250" y="170" text-anchor="middle" fill="#24292e" font-size="13" font-weight="600">üêô GitHub Job Queues</text>
                    <text x="60" y="190" fill="#888" font-size="10">LPUSH queue:ci job_data ‚Üí BRPOP queue:ci (workers)</text>
                    <text x="60" y="205" fill="#888" font-size="10">Reliable distributed task queue with multiple workers</text>
                    <text x="60" y="220" fill="#888" font-size="10">100K+ jobs/day, <1s latency, AOF persistence for reliability</text>
                    
                    <!-- Stack Overflow -->
                    <rect x="470" y="150" width="380" height="80" fill="rgba(244,128,36,0.2)" stroke="#F48024" stroke-width="2" rx="6"/>
                    <text x="660" y="170" text-anchor="middle" fill="#F48024" font-size="13" font-weight="600">üìö Stack Overflow Cache</text>
                    <text x="480" y="190" fill="#888" font-size="10">Cache-aside pattern: Check Redis ‚Üí Miss ‚Üí Query DB ‚Üí SET</text>
                    <text x="480" y="205" fill="#888" font-size="10">95% hit rate, Tag-based invalidation, Hash for metadata</text>
                    <text x="480" y="220" fill="#888" font-size="10">Millions of page views, <10ms Redis latency</text>
                    
                    <!-- Common Patterns -->
                    <rect x="50" y="250" width="800" height="130" fill="rgba(0,255,136,0.1)" stroke="#00FF88" stroke-width="2" rx="6"/>
                    <text x="450" y="275" text-anchor="middle" fill="#00FF88" font-size="14" font-weight="600">Common Patterns Across All</text>
                    
                    <text x="70" y="300" fill="#888" font-size="11"><tspan font-weight="600">1. Right Data Structure:</tspan> Timeline/Feed ‚Üí Sorted Set, Sessions ‚Üí Hash, Queues ‚Üí List</text>
                    <text x="70" y="320" fill="#888" font-size="11"><tspan font-weight="600">2. Appropriate TTL:</tspan> Sessions 15min, Cache 1hr, Timeline 24hr</text>
                    <text x="70" y="340" fill="#888" font-size="11"><tspan font-weight="600">3. Multi-DC Replication:</tspan> All use cross-region for global users</text>
                    <text x="70" y="360" fill="#888" font-size="11"><tspan font-weight="600">4. Monitoring:</tspan> redis_exporter + Grafana, alerting on latency/memory/hit rate</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: Twitter Timeline Pattern</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Timeline Cache</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> time

r = redis.Redis()

<span class="keyword">def</span> <span class="function">add_to_timeline</span>(user_id, tweet_id, timestamp=<span class="keyword">None</span>):
    <span class="string">"""Add tweet to user's timeline (fanout on write)"""</span>
    <span class="keyword">if</span> timestamp <span class="keyword">is</span> <span class="keyword">None</span>:
        timestamp = time.time()
    
    timeline_key = <span class="string">f'timeline:{user_id}'</span>
    
    <span class="comment"># Add to sorted set (score = timestamp)</span>
    r.zadd(timeline_key, {tweet_id: timestamp})
    
    <span class="comment"># Keep only last 800 tweets (memory optimization)</span>
    r.zremrangebyrank(timeline_key, <span class="number">0</span>, <span class="number">-801</span>)
    
    <span class="comment"># Set 24hr TTL</span>
    r.expire(timeline_key, <span class="number">86400</span>)

<span class="keyword">def</span> <span class="function">get_timeline</span>(user_id, page=<span class="number">0</span>, per_page=<span class="number">50</span>):
    <span class="string">"""Get user timeline (reverse chronological)"""</span>
    timeline_key = <span class="string">f'timeline:{user_id}'</span>
    
    start = page * per_page
    end = start + per_page - <span class="number">1</span>
    
    <span class="comment"># Get tweets (newest first)</span>
    tweet_ids = r.zrevrange(timeline_key, start, end)
    
    <span class="keyword">return</span> tweet_ids

<span class="keyword">def</span> <span class="function">fanout_tweet</span>(author_id, tweet_id, follower_ids):
    <span class="string">"""Fanout on write: Add tweet to all followers"""</span>
    timestamp = time.time()
    
    pipe = r.pipeline()
    <span class="keyword">for</span> follower_id <span class="keyword">in</span> follower_ids:
        pipe.zadd(<span class="string">f'timeline:{follower_id}'</span>, {tweet_id: timestamp})
    pipe.execute()

<span class="comment"># Twitter's scale:</span>
<span class="comment"># - Celebrity with 10M followers ‚Üí 10M ZADD operations</span>
<span class="comment"># - Mitigated with: Hybrid approach (celebs use fanout-on-read)</span>
<span class="comment"># - Regular users (<5K followers): Fanout-on-write</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Instagram Feed Aggregation</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Feed Generation</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">generate_feed</span>(user_id, num_friends=<span class="number">200</span>):
    <span class="string">"""Instagram-style feed aggregation"""</span>
    
    <span class="comment"># Get user's following list</span>
    following = r.smembers(<span class="string">f'following:{user_id}'</span>)
    
    <span class="comment"># Each friend has posts in Sorted Set</span>
    friend_post_keys = [<span class="string">f'posts:{friend_id}'</span> <span class="keyword">for</span> friend_id <span class="keyword">in</span> following]
    
    <span class="comment"># Aggregate using ZUNIONSTORE</span>
    feed_key = <span class="string">f'feed:{user_id}'</span>
    
    <span class="keyword">if</span> <span class="function">len</span>(friend_post_keys) > <span class="number">0</span>:
        <span class="comment"># Union all friend posts (combines scores = timestamps)</span>
        r.zunionstore(feed_key, friend_post_keys)
        
        <span class="comment"># Cache for 10 minutes</span>
        r.expire(feed_key, <span class="number">600</span>)
    
    <span class="comment"># Get top 50 posts</span>
    posts = r.zrevrange(feed_key, <span class="number">0</span>, <span class="number">49</span>, withscores=<span class="keyword">True</span>)
    
    <span class="keyword">return</span> posts

<span class="keyword">def</span> <span class="function">add_post</span>(user_id, post_id, timestamp=<span class="keyword">None</span>):
    <span class="string">"""Add new post to user's posts"""</span>
    <span class="keyword">if</span> timestamp <span class="keyword">is</span> <span class="keyword">None</span>:
        timestamp = time.time()
    
    r.zadd(<span class="string">f'posts:{user_id}'</span>, {post_id: timestamp})
    
    <span class="comment"># Keep only recent 500 posts</span>
    r.zremrangebyrank(<span class="string">f'posts:{user_id}'</span>, <span class="number">0</span>, <span class="number">-501</span>)

<span class="comment"># Instagram optimizations:</span>
<span class="comment"># - Precompute feeds in background</span>
<span class="comment"># - Cache ZUNIONSTORE result for 10min</span>
<span class="comment"># - Limit to 200 friends for performance</span>
<span class="comment"># - Use ML ranking on top of chronological</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: GitHub Job Queue</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Distributed Queue</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> json

<span class="keyword">class</span> <span class="function">JobQueue</span>:
    <span class="string">"""GitHub-style job queue with workers"""</span>
    
    <span class="keyword">def</span> <span class="function">__init__</span>(self, queue_name):
        self.queue_name = queue_name
        self.key = <span class="string">f'queue:{queue_name}'</span>
    
    <span class="keyword">def</span> <span class="function">enqueue</span>(self, job_data, priority=<span class="string">'normal'</span>):
        <span class="string">"""Add job to queue"""</span>
        job = {
            <span class="string">'id'</span>: <span class="function">str</span>(uuid.uuid4()),
            <span class="string">'data'</span>: job_data,
            <span class="string">'created_at'</span>: time.time(),
            <span class="string">'priority'</span>: priority
        }
        
        <span class="keyword">if</span> priority == <span class="string">'high'</span>:
            <span class="comment"># High priority ‚Üí Front of queue</span>
            r.lpush(self.key, json.dumps(job))
        <span class="keyword">else</span>:
            <span class="comment"># Normal priority ‚Üí Back of queue</span>
            r.rpush(self.key, json.dumps(job))
        
        <span class="keyword">return</span> job[<span class="string">'id'</span>]
    
    <span class="keyword">def</span> <span class="function">dequeue</span>(self, timeout=<span class="number">5</span>):
        <span class="string">"""Worker gets next job (blocking)"""</span>
        result = r.brpop(self.key, timeout=timeout)
        
        <span class="keyword">if</span> result:
            queue_name, job_json = result
            <span class="keyword">return</span> json.loads(job_json)
        
        <span class="keyword">return</span> <span class="keyword">None</span>
    
    <span class="keyword">def</span> <span class="function">get_size</span>(self):
        <span class="string">"""Get queue length"""</span>
        <span class="keyword">return</span> r.llen(self.key)

<span class="comment"># Producer (CI trigger)</span>
queue = JobQueue(<span class="string">'ci-builds'</span>)
job_id = queue.enqueue({
    <span class="string">'repo'</span>: <span class="string">'user/repo'</span>,
    <span class="string">'commit'</span>: <span class="string">'abc123'</span>,
    <span class="string">'tests'</span>: [<span class="string">'unit'</span>, <span class="string">'integration'</span>]
}, priority=<span class="string">'high'</span>)

<span class="comment"># Worker (distributed across machines)</span>
<span class="keyword">while</span> <span class="keyword">True</span>:
    job = queue.dequeue(timeout=<span class="number">30</span>)
    
    <span class="keyword">if</span> job:
        <span class="comment"># Process job</span>
        run_ci_build(job)
    <span class="keyword">else</span>:
        <span class="comment"># No jobs, sleep a bit</span>
        time.sleep(<span class="number">1</span>)

<span class="comment"># GitHub scale:</span>
<span class="comment"># - 100K+ jobs/day</span>
<span class="comment"># - Multiple queues (ci, deploy, notify)</span>
<span class="comment"># - AOF persistence (no job loss)</span>
<span class="comment"># - Horizontal worker scaling</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: Why does Twitter use fanout-on-write instead of fanout-on-read?</h4>
                <p><strong>A:</strong> Speed! Read 100x more frequent than write. Fanout-on-write: Pre-compute timelines (write cost high, read instant). Fanout-on-read: Compute on every view (slow!). Exception: Celebrities use hybrid (too many followers to fanout)!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: How does Instagram handle 1M+ friend lists in ZUNIONSTORE?</h4>
                <p><strong>A:</strong> They don't! Limited to ~200 friends for performance. ZUNIONSTORE with 1M keys = slow. Solution: Sample recent active friends, use ML ranking, cache aggressively. Real-world trumps theoretical purity!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: Why does GitHub use Redis Lists instead of a proper queue like RabbitMQ?</h4>
                <p><strong>A:</strong> Simplicity + Speed! Redis Lists with BRPOP: Simple, fast (<1ms), easy to monitor. RabbitMQ: More features but complex. For simple queues with moderate volume, Redis perfect. High volume + complex routing ‚Üí RabbitMQ!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: What happens if ZUNIONSTORE takes too long?</h4>
                <p><strong>Answer:</strong> It blocks! ZUNIONSTORE is O(N) where N = total elements. 200 friends √ó 500 posts = 100K elements = ~50ms. Mitigation: (1) Limit friend count, (2) Keep recent posts only, (3) Run in background worker, (4) Cache result!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: Job queue with Redis - what if worker crashes mid-job?</h4>
                <p><strong>Answer:</strong> Job lost! BRPOP removes from queue immediately. Solution: (1) Use RPOPLPUSH to "processing" list, (2) Worker marks complete when done, (3) Separate process monitors "processing" for stale jobs. Or use Redis Streams with consumer groups!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real-World: Building Social Feed Like Instagram</strong></p>
            <p>Startup building social network. Need feed generation for 1M users!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Solution: Learn from Instagram</h4>
                <p><strong>Architecture:</strong><br>
                1. Each user's posts ‚Üí Sorted Set (posts:user_id)<br>
                2. Following ‚Üí Set (following:user_id)<br>
                3. Feed generation ‚Üí ZUNIONSTORE on-demand<br>
                4. Cache feed for 10 minutes<br>
                5. Background job refreshes popular users</p>
                <p><strong>Optimizations Applied:</strong><br>
                ‚úÖ Limit ZUNIONSTORE to 200 friends (performance)<br>
                ‚úÖ Keep only 500 recent posts per user (memory)<br>
                ‚úÖ Cache computed feeds (95% hit rate)<br>
                ‚úÖ Use Redis Cluster for horizontal scaling<br>
                ‚úÖ Multi-DC replication for global users</p>
                <p><strong>Results:</strong> 1M users, <50ms feed generation, 100K feeds/sec capacity, $2K/mo Redis cost</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Right data structure</strong> - Timeline/Feed ‚Üí Sorted Set</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ö°</span><p><strong>Cache aggressively</strong> - Pre-compute expensive operations</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üî¢</span><p><strong>Set limits</strong> - 200 friends, 500 posts (performance)</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üåç</span><p><strong>Multi-DC replication</strong> - For global scale</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìà</span><p><strong>Monitor everything</strong> - Hit rate, latency, memory</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Learn from giants</strong> - Patterns are proven</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Case Studies</span><span class="keyword-tag">Twitter</span><span class="keyword-tag">Instagram</span><span class="keyword-tag">Production</span><span class="keyword-tag">Scale</span><span class="keyword-tag">Architecture</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Building social feed. User follows 500 people, each has 1000 posts. Need <100ms feed generation. Best approach?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) ZUNIONSTORE all 500 friends on every request</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Limit to 200 active friends, cache result 10min</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Store all posts in single Sorted Set</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Use database with complex JOIN queries</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Limit + Cache</strong>
                    <p>Perfect Instagram pattern! ZUNIONSTORE with 500 √ó 1000 = 500K elements = too slow (>1 second). Limit to 200 active friends = 200K elements = 50ms. Cache for 10min = 95% requests instant. Single Sorted Set doesn't scale (millions of posts). Database JOINs too slow. Real-world constraints require smart limits!</p>
                </div>
            </div>
        </div>
    `;
}


// ============================================================
// QUESTION 90: Final Redis Interview Preparation
// ============================================================

function getQuestion90Content() {
    return `
        <div class="content-section">
            <div class="section-header"><span class="section-icon">üé¨</span><h2 class="section-label">1. Real Scenario</h2></div>
            <p><strong>Interview tomorrow:</strong> "Redis interview in 12 hours! What to focus on?" Senior: "Master the format: (1) System design (15min - design URL shortener/rate limiter), (2) Coding (10min - implement distributed lock), (3) Troubleshooting (10min - debug slow Redis), (4) Trade-offs (10min - Redis vs X, RDB vs AOF), (5) Behavioral (10min - describe outage). Practice each type!"</p>
            <p>Format preparation = interview success.</p>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìö</span><h2 class="section-label">2. Actual Definition</h2></div>
            <p><strong>Redis interview format: (1) System Design Questions (design URL shortener, notification system, rate limiter, leaderboard - 15min), (2) Coding Challenges (implement distributed lock, LRU cache, sliding window counter, session manager - 10min), (3) Troubleshooting Scenarios (Redis slow, memory full, replication lag, connections errors - 10min), (4) Trade-off Discussions (Redis vs Memcached, RDB vs AOF, Cluster vs Sentinel, sync vs async - 10min), (5) Behavioral Questions (outage resolved, monitoring approach, scaling story - 10min). Practice each!</strong></p>
            
            <div style="background: rgba(220, 20, 60, 0.1); border-left: 3px solid var(--primary-color); padding: 20px; border-radius: 6px; margin: 20px 0;">
                <h4 style="color: var(--primary-color); margin-bottom: 15px;">Interview Format Breakdown</h4>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: rgba(220,20,60,0.2);"><th style="padding: 10px;">Type</th><th style="padding: 10px;">Duration</th><th style="padding: 10px;">Focus</th><th style="padding: 10px;">Frequency</th></tr>
                    <tr><td style="padding: 8px;">System Design</td><td>15 min</td><td>Architecture, trade-offs</td><td>90%</td></tr>
                    <tr><td style="padding: 8px;">Coding Challenge</td><td>10 min</td><td>Implementation, patterns</td><td>80%</td></tr>
                    <tr><td style="padding: 8px;">Troubleshooting</td><td>10 min</td><td>Debugging, production</td><td>70%</td></tr>
                    <tr><td style="padding: 8px;">Trade-offs</td><td>10 min</td><td>Decisions, reasoning</td><td>75%</td></tr>
                    <tr><td style="padding: 8px;">Behavioral</td><td>10 min</td><td>Experience, STAR method</td><td>60%</td></tr>
                </table>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìä</span><h2 class="section-label">3. Visual Diagram</h2></div>
            <div class="diagram-container">
                <div class="diagram-title">60-Minute Mock Interview Timeline</div>
                <svg viewBox="0 0 900 400" style="max-width: 100%; height: auto;">
                    <text x="450" y="25" text-anchor="middle" fill="#DC143C" font-size="20" font-weight="700">Complete Interview Structure</text>
                    
                    <!-- Timeline -->
                    <line x1="50" y1="100" x2="850" y2="100" stroke="#888" stroke-width="2"/>
                    
                    <!-- Phase 1: Introduction (0-5 min) -->
                    <rect x="50" y="60" width="80" height="30" fill="rgba(220,20,60,0.3)" stroke="#DC143C" stroke-width="2" rx="4"/>
                    <text x="90" y="80" text-anchor="middle" fill="#DC143C" font-size="11" font-weight="600">0-5 min</text>
                    <text x="90" y="125" text-anchor="middle" fill="#888" font-size="10">Intro</text>
                    <text x="90" y="140" text-anchor="middle" fill="#888" font-size="9">Background</text>
                    
                    <!-- Phase 2: System Design (5-20 min) -->
                    <rect x="160" y="60" width="150" height="30" fill="rgba(255,165,0,0.3)" stroke="#FFA500" stroke-width="2" rx="4"/>
                    <text x="235" y="80" text-anchor="middle" fill="#FFA500" font-size="11" font-weight="600">5-20 min</text>
                    <text x="235" y="125" text-anchor="middle" fill="#888" font-size="10">System Design</text>
                    <text x="235" y="140" text-anchor="middle" fill="#888" font-size="9">URL shortener</text>
                    
                    <!-- Phase 3: Coding (20-30 min) -->
                    <rect x="340" y="60" width="100" height="30" fill="rgba(0,191,255,0.3)" stroke="#00BFFF" stroke-width="2" rx="4"/>
                    <text x="390" y="80" text-anchor="middle" fill="#00BFFF" font-size="11" font-weight="600">20-30 min</text>
                    <text x="390" y="125" text-anchor="middle" fill="#888" font-size="10">Coding</text>
                    <text x="390" y="140" text-anchor="middle" fill="#888" font-size="9">Distributed lock</text>
                    
                    <!-- Phase 4: Troubleshooting (30-40 min) -->
                    <rect x="470" y="60" width="100" height="30" fill="rgba(0,255,136,0.3)" stroke="#00FF88" stroke-width="2" rx="4"/>
                    <text x="520" y="80" text-anchor="middle" fill="#00FF88" font-size="11" font-weight="600">30-40 min</text>
                    <text x="520" y="125" text-anchor="middle" fill="#888" font-size="10">Debug</text>
                    <text x="520" y="140" text-anchor="middle" fill="#888" font-size="9">Slow Redis</text>
                    
                    <!-- Phase 5: Trade-offs (40-50 min) -->
                    <rect x="600" y="60" width="100" height="30" fill="rgba(138,43,226,0.3)" stroke="#8A2BE2" stroke-width="2" rx="4"/>
                    <text x="650" y="80" text-anchor="middle" fill="#8A2BE2" font-size="11" font-weight="600">40-50 min</text>
                    <text x="650" y="125" text-anchor="middle" fill="#888" font-size="10">Trade-offs</text>
                    <text x="650" y="140" text-anchor="middle" fill="#888" font-size="9">Redis vs X</text>
                    
                    <!-- Phase 6: Questions (50-60 min) -->
                    <rect x="730" y="60" width="100" height="30" fill="rgba(255,69,0,0.3)" stroke="#FF6347" stroke-width="2" rx="4"/>
                    <text x="780" y="80" text-anchor="middle" fill="#FF6347" font-size="11" font-weight="600">50-60 min</text>
                    <text x="780" y="125" text-anchor="middle" fill="#888" font-size="10">Your Qs</text>
                    <text x="780" y="140" text-anchor="middle" fill="#888" font-size="9">Ask away!</text>
                    
                    <!-- Key Topics -->
                    <rect x="50" y="170" width="800" height="210" fill="rgba(0,191,255,0.1)" stroke="#00BFFF" stroke-width="2" rx="6"/>
                    <text x="450" y="195" text-anchor="middle" fill="#00BFFF" font-size="14" font-weight="600">Most Common Interview Questions</text>
                    
                    <text x="70" y="220" fill="#DC143C" font-size="11" font-weight="600">System Design:</text>
                    <text x="70" y="235" fill="#888" font-size="10">‚Ä¢ Design URL shortener  ‚Ä¢ Build rate limiter  ‚Ä¢ Create leaderboard  ‚Ä¢ Notification system</text>
                    
                    <text x="70" y="260" fill="#FFA500" font-size="11" font-weight="600">Coding Challenges:</text>
                    <text x="70" y="275" fill="#888" font-size="10">‚Ä¢ Distributed lock  ‚Ä¢ LRU cache  ‚Ä¢ Sliding window counter  ‚Ä¢ Session manager</text>
                    
                    <text x="70" y="300" fill="#00FF88" font-size="11" font-weight="600">Troubleshooting:</text>
                    <text x="70" y="315" fill="#888" font-size="10">‚Ä¢ Redis suddenly slow  ‚Ä¢ Memory at 100%  ‚Ä¢ Replication lag  ‚Ä¢ Connection errors</text>
                    
                    <text x="70" y="340" fill="#8A2BE2" font-size="11" font-weight="600">Trade-offs:</text>
                    <text x="70" y="355" fill="#888" font-size="10">‚Ä¢ Redis vs Memcached  ‚Ä¢ RDB vs AOF  ‚Ä¢ Cluster vs Sentinel  ‚Ä¢ Sync vs async</text>
                    
                    <text x="450" y="375" text-anchor="middle" fill="#00FF88" font-size="10" font-weight="600">üí° Tip: Practice each type 3x before interview!</text>
                </svg>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üíª</span><h2 class="section-label">4. Code Examples</h2></div>
            
            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 1: System Design - URL Shortener</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Complete Solution</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> redis
<span class="keyword">import</span> string

<span class="keyword">class</span> <span class="function">URLShortener</span>:
    <span class="string">"""
    Interview Question: Design URL shortener with Redis
    Requirements: 1K req/sec, unique IDs, analytics
    """</span>
    
    <span class="keyword">def</span> <span class="function">__init__</span>(self):
        self.r = redis.Redis()
        self.base62 = string.ascii_letters + string.digits
    
    <span class="keyword">def</span> <span class="function">_encode_base62</span>(self, num):
        <span class="string">"""Convert number to base62 (aA-zZ0-9)"""</span>
        <span class="keyword">if</span> num == <span class="number">0</span>:
            <span class="keyword">return</span> self.base62[<span class="number">0</span>]
        
        result = []
        <span class="keyword">while</span> num:
            result.append(self.base62[num % <span class="number">62</span>])
            num //= <span class="number">62</span>
        
        <span class="keyword">return</span> <span class="string">''</span>.join(<span class="function">reversed</span>(result))
    
    <span class="keyword">def</span> <span class="function">shorten</span>(self, long_url):
        <span class="string">"""Create short URL"""</span>
        <span class="comment"># Generate unique ID</span>
        url_id = self.r.incr(<span class="string">'url:counter'</span>)
        
        <span class="comment"># Convert to base62 (6 chars = 56B combinations)</span>
        short_code = self._encode_base62(url_id).zfill(<span class="number">6</span>)
        
        <span class="comment"># Store mapping</span>
        self.r.set(<span class="string">f'url:{short_code}'</span>, long_url)
        
        <span class="comment"># Optional: TTL for expiring links</span>
        <span class="comment"># self.r.expire(f'url:{short_code}', 86400*365)</span>
        
        <span class="comment"># Analytics: Track creation</span>
        self.r.hset(<span class="string">f'analytics:{short_code}'</span>, mapping={
            <span class="string">'created_at'</span>: <span class="function">str</span>(datetime.now()),
            <span class="string">'clicks'</span>: <span class="number">0</span>
        })
        
        <span class="keyword">return</span> short_code
    
    <span class="keyword">def</span> <span class="function">expand</span>(self, short_code):
        <span class="string">"""Get original URL and track click"""</span>
        long_url = self.r.get(<span class="string">f'url:{short_code}'</span>)
        
        <span class="keyword">if</span> long_url:
            <span class="comment"># Track analytics</span>
            self.r.hincrby(<span class="string">f'analytics:{short_code}'</span>, <span class="string">'clicks'</span>, <span class="number">1</span>)
        
        <span class="keyword">return</span> long_url
    
    <span class="keyword">def</span> <span class="function">get_analytics</span>(self, short_code):
        <span class="string">"""Get click analytics"""</span>
        <span class="keyword">return</span> self.r.hgetall(<span class="string">f'analytics:{short_code}'</span>)

<span class="comment"># Interview talking points:</span>
<span class="comment"># 1. Why INCR? Atomic, unique IDs</span>
<span class="comment"># 2. Why base62? URL-safe, compact (6 chars = 56B URLs)</span>
<span class="comment"># 3. Performance: Redis handles 100K+ ops/sec easily</span>
<span class="comment"># 4. Scaling: Add read replicas or Redis Cluster</span>
<span class="comment"># 5. Analytics: Hash for metadata, efficient</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 2: Coding - Distributed Lock</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Production-Grade</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">import</span> uuid
<span class="keyword">import</span> time

<span class="keyword">class</span> <span class="function">DistributedLock</span>:
    <span class="string">"""
    Interview Favorite: Implement distributed lock
    Must handle: Atomicity, TTL, unlock by owner only
    """</span>
    
    <span class="keyword">def</span> <span class="function">__init__</span>(self, redis_client, lock_name, timeout=<span class="number">10</span>):
        self.redis = redis_client
        self.lock_name = <span class="string">f'lock:{lock_name}'</span>
        self.timeout = timeout
        self.identifier = <span class="keyword">None</span>
    
    <span class="keyword">def</span> <span class="function">acquire</span>(self, blocking=<span class="keyword">True</span>, retry_interval=<span class="number">0.1</span>):
        <span class="string">"""Acquire lock (with retry if blocking)"""</span>
        self.identifier = <span class="function">str</span>(uuid.uuid4())
        
        <span class="keyword">while</span> <span class="keyword">True</span>:
            <span class="comment"># SET NX EX: Atomic set if not exists with expiry</span>
            acquired = self.redis.set(
                self.lock_name,
                self.identifier,
                nx=<span class="keyword">True</span>,          <span class="comment"># Only if not exists</span>
                ex=self.timeout    <span class="comment"># Expiry in seconds</span>
            )
            
            <span class="keyword">if</span> acquired:
                <span class="keyword">return</span> <span class="keyword">True</span>
            
            <span class="keyword">if</span> <span class="keyword">not</span> blocking:
                <span class="keyword">return</span> <span class="keyword">False</span>
            
            <span class="comment"># Wait and retry</span>
            time.sleep(retry_interval)
    
    <span class="keyword">def</span> <span class="function">release</span>(self):
        <span class="string">"""Release lock (only if we own it)"""</span>
        <span class="comment"># Lua script for atomic check-and-delete</span>
        lua_script = <span class="string">"""
        if redis.call("GET", KEYS[1]) == ARGV[1] then
            return redis.call("DEL", KEYS[1])
        else
            return 0
        end
        """</span>
        
        result = self.redis.eval(
            lua_script,
            <span class="number">1</span>,
            self.lock_name,
            self.identifier
        )
        
        <span class="keyword">return</span> result == <span class="number">1</span>
    
    <span class="keyword">def</span> <span class="function">__enter__</span>(self):
        self.acquire()
        <span class="keyword">return</span> self
    
    <span class="keyword">def</span> <span class="function">__exit__</span>(self, exc_type, exc_val, exc_tb):
        self.release()

<span class="comment"># Usage</span>
<span class="keyword">with</span> DistributedLock(r, <span class="string">'payment:user:1000'</span>) <span class="keyword">as</span> lock:
    <span class="comment"># Critical section - only one process executes</span>
    process_payment(user_id=<span class="number">1000</span>)

<span class="comment"># Interview answers:</span>
<span class="comment"># Q: Why SET NX EX atomic?</span>
<span class="comment"># A: Race condition if separate SET + EXPIRE</span>
<span class="comment"># Q: Why Lua for release?</span>
<span class="comment"># A: Atomic check-and-delete (avoid releasing others' lock)</span>
<span class="comment"># Q: What if process crashes?</span>
<span class="comment"># A: TTL auto-releases (timeout parameter)</span>
<span class="comment"># Q: Redlock algorithm?</span>
<span class="comment"># A: For multi-master, acquire majority of nodes</span></code></pre>
            </div>

            <h3 style="color: var(--primary-color); margin: 25px 0 15px 0;">Example 3: Troubleshooting Scenario</h3>
            <div class="code-block">
                <div class="code-header"><span class="code-lang">Python - Debug Workflow</span><button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
                <pre class="code-content"><code><span class="keyword">def</span> <span class="function">debug_slow_redis</span>():
    <span class="string">"""
    Interview: Redis suddenly slow (2 seconds latency)
    Show systematic debugging approach
    """</span>
    
    <span class="keyword">print</span>(<span class="string">"=== Step 1: Check SLOWLOG ==="</span>)
    slowlog = r.slowlog_get(<span class="number">10</span>)
    <span class="keyword">for</span> entry <span class="keyword">in</span> slowlog:
        <span class="keyword">print</span>(<span class="string">f"Duration: {entry['duration']}Œºs"</span>)
        <span class="keyword">print</span>(<span class="string">f"Command: {entry['command']}"</span>)
    
    <span class="comment"># Found: KEYS * taking 2000000Œºs (2 seconds!)</span>
    
    <span class="keyword">print</span>(<span class="string">"=== Step 2: Check INFO ==="</span>)
    info = r.info(<span class="string">'all'</span>)
    <span class="keyword">print</span>(<span class="string">f"Used memory: {info['used_memory_human']}"</span>)
    <span class="keyword">print</span>(<span class="string">f"Connected clients: {info['connected_clients']}"</span>)
    <span class="keyword">print</span>(<span class="string">f"Evicted keys: {info['evicted_keys']}"</span>)
    
    <span class="keyword">print</span>(<span class="string">"=== Step 3: Identify bad client ==="</span>)
    clients = r.client_list()
    <span class="keyword">for</span> client <span class="keyword">in</span> clients:
        <span class="keyword">if</span> <span class="string">'KEYS'</span> <span class="keyword">in</span> client.get(<span class="string">'cmd'</span>, <span class="string">''</span>):
            <span class="keyword">print</span>(<span class="string">f"Bad client: {client['addr']}"</span>)
            <span class="comment"># Kill it: r.client_kill(client['addr'])</span>
    
    <span class="keyword">print</span>(<span class="string">"=== Step 4: Prevent recurrence ==="</span>)
    <span class="comment"># In redis.conf:</span>
    <span class="comment"># rename-command KEYS ""</span>
    <span class="comment"># rename-command FLUSHALL ""</span>
    
    <span class="keyword">return</span> {
        <span class="string">'root_cause'</span>: <span class="string">'KEYS * command blocking Redis'</span>,
        <span class="string">'fix'</span>: <span class="string">'Killed client, renamed KEYS command'</span>,
        <span class="string">'prevention'</span>: <span class="string">'Use SCAN, add monitoring alerts'</span>
    }

<span class="comment"># Interview talking points:</span>
<span class="comment"># 1. Systematic approach (SLOWLOG ‚Üí INFO ‚Üí CLIENT LIST)</span>
<span class="comment"># 2. Root cause analysis (KEYS * blocks single-threaded Redis)</span>
<span class="comment"># 3. Immediate fix (kill client)</span>
<span class="comment"># 4. Long-term prevention (rename command, monitoring)</span>
<span class="comment"># 5. Document for postmortem</span></code></pre>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">‚ùì</span><h2 class="section-label">5. Cross Questions</h2></div>
            
            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q1: "Walk me through how you'd monitor Redis in production"</h4>
                <p><strong>A (Show expertise):</strong> (1) redis_exporter + Grafana (metrics), (2) Alerts: Latency >50ms, Memory >80%, Hit rate <80%, (3) SLOWLOG monitoring, (4) Daily capacity planning, (5) Synthetic transactions. Review weekly!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q2: "Redis vs Memcached - when would you use each?"</h4>
                <p><strong>A:</strong> Memcached: Pure cache, multi-threaded, no persistence needed. Redis: Need data structures, persistence, pub/sub, transactions. Default: Redis (more versatile). Use Memcached only if: Simple cache + multi-threaded important!</p>
            </div>

            <div style="background: rgba(220, 20, 60, 0.05); border-left: 3px solid var(--primary-color); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4 style="color: var(--primary-color); margin-bottom: 8px;">Q3: "Tell me about a time you resolved a Redis production issue"</h4>
                <p><strong>A (STAR method):</strong> Situation: 3AM page - Redis slow. Task: Debug quickly. Action: SLOWLOG ‚Üí found KEYS *, killed client, renamed command. Result: Latency back to <10ms, prevented recurrence with monitoring. Learned: Always use SCAN!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üéØ</span><h2 class="section-label">6. Tricky Questions</h2></div>
            
            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">üî• Tricky: "How would you implement rate limiting with 0.001% error rate?"</h4>
                <p><strong>Answer:</strong> Tough requirement! Sliding window with Sorted Set gives ~0.1% error (timestamp precision). For 0.001%: Use token bucket with Lua script (atomic), or distributed counter with strong consistency. Trade-off: Performance vs accuracy. Discuss with interviewer!</p>
            </div>

            <div style="background: rgba(255, 69, 0, 0.1); border: 2px solid var(--accent-color); padding: 20px; border-radius: 8px;">
                <h4 style="color: var(--accent-color); margin-bottom: 10pm;">üî• Tricky: "Redis Cluster split-brain scenario - how to handle?"</h4>
                <p><strong>Answer:</strong> Network partition creates two clusters accepting writes = split-brain. Redis Cluster uses majority voting (3+ masters). Minority partition becomes read-only. When partition heals, last-write-wins merges. Prevention: Minimum 3 masters, proper network design!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè¢</span><h2 class="section-label">7. Practical Scenario</h2></div>
            
            <p><strong>Real Interview: Complete 60-Minute Session</strong></p>
            <p>Actual interview experience - what to expect and how to succeed!</p>

            <div style="background: rgba(0, 255, 136, 0.1); border-left: 3px solid #00FF88; padding: 15px; border-radius: 6px; margin: 15px 0;">
                <h4 style="color: #00FF88;">Successful Interview Example</h4>
                <p><strong>0-5 min (Intro):</strong> "Hi! I'm a backend engineer with 3 years Redis experience. Built leaderboards, caching layers, session stores at scale. Excited to discuss!"</p>
                <p><strong>5-20 min (System Design):</strong> "Let's design URL shortener. Use INCR for unique IDs, base62 encode to 6 chars = 56B URLs. Store in String, analytics in Hash. Handle 1K req/sec easily, scale with replicas if needed."</p>
                <p><strong>20-30 min (Coding):</strong> Implement distributed lock with SET NX EX, Lua script for safe release, TTL for crash handling. *Writes clean, working code*</p>
                <p><strong>30-40 min (Debug):</strong> "Redis slow? Check SLOWLOG first. Found KEYS *? Kill client, use SCAN instead. Set up monitoring to prevent recurrence."</p>
                <p><strong>40-50 min (Trade-offs):</strong> "Redis vs Memcached? Redis more versatile with data structures, persistence. RDB vs AOF? RDB fast recovery, AOF better durability. Choose based on use case!"</p>
                <p><strong>50-60 min (Questions):</strong> "What Redis version? Cluster or Sentinel? Monitoring tools? Team size? On-call rotation?" *Shows genuine interest*</p>
                <p><strong>Result:</strong> ‚úÖ Offer received! Interviewer impressed by: Systematic thinking, production experience, trade-off awareness, clean code!</p>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üí°</span><h2 class="section-label">8. Key Takeaways</h2></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìù</span><p><strong>Practice each format</strong> - System design, coding, debug, trade-offs</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üéØ</span><p><strong>Show production experience</strong> - Metrics, monitoring, trade-offs</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üíª</span><p><strong>Write working code</strong> - Not pseudocode, actual implementation</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üó£Ô∏è</span><p><strong>Think out loud</strong> - Explain reasoning as you work</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">‚ùì</span><p><strong>Ask good questions</strong> - Requirements, scale, constraints</p></div>
            <div class="takeaway-item"><span class="takeaway-icon">üìä</span><p><strong>Use STAR method</strong> - For behavioral questions</p></div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üè∑Ô∏è</span><h2 class="section-label">9. Keywords</h2></div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                <span class="keyword-tag">Interview</span><span class="keyword-tag">Preparation</span><span class="keyword-tag">Mock</span><span class="keyword-tag">System Design</span><span class="keyword-tag">Coding</span><span class="keyword-tag">Final</span>
            </div>
        </div>

        <div class="content-section">
            <div class="section-header"><span class="section-icon">üìù</span><h2 class="section-label">10. Quiz</h2></div>
            <div class="quiz-container">
                <div class="quiz-question"><strong>Q:</strong> Interview asks: "Design notification system for 1M users using Redis." What's your first question?</div>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(this, false)">A) Start designing immediately with Pub/Sub</div>
                    <div class="quiz-option" onclick="checkAnswer(this, true)">B) Ask: "Real-time push or polling? Delivery guarantee? Message TTL?"</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">C) Explain why Redis is perfect for this</div>
                    <div class="quiz-option" onclick="checkAnswer(this, false)">D) Draw architecture diagram immediately</div>
                </div>
                <div class="quiz-explanation" style="display: none; margin-top: 15px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 6px;">
                    <strong>‚úÖ Correct: B - Clarify requirements first!</strong>
                    <p>NEVER start designing without clarifying requirements! Real-time vs polling changes architecture dramatically (Pub/Sub vs Streams). Delivery guarantee affects persistence (Pub/Sub = fire-and-forget, Streams = reliable). TTL affects memory. Asking questions shows: (1) Production thinking, (2) Trade-off awareness, (3) Requirement gathering skills. Interviewers LOVE this!</p>
                </div>
            </div>
        </div>
    `;
}





// Quiz answer checking
        function checkAnswer(element, isCorrect) {
            const options = element.parentElement.querySelectorAll('.quiz-option');
            const explanation = element.parentElement.nextElementSibling;
            
            // Disable all options
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
                opt.style.opacity = '0.6';
            });
            
            // Mark selected answer
            if (isCorrect) {
                element.classList.add('correct');
                element.style.opacity = '1';
            } else {
                element.classList.add('incorrect');
                element.style.opacity = '1';
                
                // Show correct answer
                options.forEach(opt => {
                    const onclickStr = opt.getAttribute('onclick');
                    if (onclickStr && onclickStr.includes('true')) {
                        opt.classList.add('correct');
                        opt.style.opacity = '1';
                    }
                });
            }
            
            // Show explanation
            if (explanation && explanation.classList.contains('quiz-explanation')) {
                explanation.style.display = 'block';
            }
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>